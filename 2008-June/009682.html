<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r26007 - in haiku/trunk/src/tests/add-ons/print: .	ppd ppd/doc ppd/model ppd/parser ppd/shared ppd/test ppd/ui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26007%20-%20in%20haiku/trunk/src/tests/add-ons/print%3A%20.%0A%09ppd%20ppd/doc%20ppd/model%20ppd/parser%20ppd/shared%20ppd/test%20ppd/ui&In-Reply-To=%3C200806181825.m5IIPG3R021319%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009681.html">
   <LINK REL="Next"  HREF="009685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r26007 - in haiku/trunk/src/tests/add-ons/print: .	ppd ppd/doc ppd/model ppd/parser ppd/shared ppd/test ppd/ui</H1>
    <B>laplace at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26007%20-%20in%20haiku/trunk/src/tests/add-ons/print%3A%20.%0A%09ppd%20ppd/doc%20ppd/model%20ppd/parser%20ppd/shared%20ppd/test%20ppd/ui&In-Reply-To=%3C200806181825.m5IIPG3R021319%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r26007 - in haiku/trunk/src/tests/add-ons/print: .	ppd ppd/doc ppd/model ppd/parser ppd/shared ppd/test ppd/ui">laplace at mail.berlios.de
       </A><BR>
    <I>Wed Jun 18 20:25:16 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="009681.html">[Haiku-commits] r26006 - haiku/trunk/build/scripts
</A></li>
        <LI>Next message: <A HREF="009685.html">[Haiku-commits] r26007 - in haiku/trunk/src/tests/add-ons/print: . ppd ppd/doc ppd/model ppd/parser ppd/shared ppd/test ppd/ui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9682">[ date ]</a>
              <a href="thread.html#9682">[ thread ]</a>
              <a href="subject.html#9682">[ subject ]</a>
              <a href="author.html#9682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: laplace
Date: 2008-06-18 20:24:54 +0200 (Wed, 18 Jun 2008)
New Revision: 26007
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=26007&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=26007&amp;view=rev</A>

Added:
   haiku/trunk/src/tests/add-ons/print/ppd/
   haiku/trunk/src/tests/add-ons/print/ppd/Jamfile
   haiku/trunk/src/tests/add-ons/print/ppd/doc/
   haiku/trunk/src/tests/add-ons/print/ppd/doc/PPD_Object_Model.txt
   haiku/trunk/src/tests/add-ons/print/ppd/doc/TODO.txt
   haiku/trunk/src/tests/add-ons/print/ppd/model/
   haiku/trunk/src/tests/add-ons/print/ppd/model/Jamfile
   haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.h
   haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.h
   haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.h
   haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.h
   haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.h
   haiku/trunk/src/tests/add-ons/print/ppd/model/Value.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/model/Value.h
   haiku/trunk/src/tests/add-ons/print/ppd/parser/
   haiku/trunk/src/tests/add-ons/print/ppd/parser/CharacterClasses.h
   haiku/trunk/src/tests/add-ons/print/ppd/parser/Jamfile
   haiku/trunk/src/tests/add-ons/print/ppd/parser/PPDFile.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/parser/PPDFile.h
   haiku/trunk/src/tests/add-ons/print/ppd/parser/PPDParser.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/parser/PPDParser.h
   haiku/trunk/src/tests/add-ons/print/ppd/parser/Parser.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/parser/Parser.h
   haiku/trunk/src/tests/add-ons/print/ppd/parser/Scanner.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/parser/Scanner.h
   haiku/trunk/src/tests/add-ons/print/ppd/shared/
   haiku/trunk/src/tests/add-ons/print/ppd/shared/AutoDelete.h
   haiku/trunk/src/tests/add-ons/print/ppd/test/
   haiku/trunk/src/tests/add-ons/print/ppd/test/Jamfile
   haiku/trunk/src/tests/add-ons/print/ppd/test/MsgConsts.h
   haiku/trunk/src/tests/add-ons/print/ppd/test/PPDConfigApplication.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/test/PPDConfigApplication.h
   haiku/trunk/src/tests/add-ons/print/ppd/test/PPDConfigApplication.rsrc
   haiku/trunk/src/tests/add-ons/print/ppd/test/Test.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/test/Test.h
   haiku/trunk/src/tests/add-ons/print/ppd/test/TestParser.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/test/TestScanner.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/test/aptollw1.ppd
   haiku/trunk/src/tests/add-ons/print/ppd/test/header.txt
   haiku/trunk/src/tests/add-ons/print/ppd/test/include.ppd
   haiku/trunk/src/tests/add-ons/print/ppd/test/main.ppd
   haiku/trunk/src/tests/add-ons/print/ppd/test/readme.txt
   haiku/trunk/src/tests/add-ons/print/ppd/ui/
   haiku/trunk/src/tests/add-ons/print/ppd/ui/Jamfile
   haiku/trunk/src/tests/add-ons/print/ppd/ui/PPDConfigView.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/ui/PPDConfigView.h
   haiku/trunk/src/tests/add-ons/print/ppd/ui/PrinterSelection.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/ui/PrinterSelection.h
   haiku/trunk/src/tests/add-ons/print/ppd/ui/UIUtils.cpp
   haiku/trunk/src/tests/add-ons/print/ppd/ui/UIUtils.h
Modified:
   haiku/trunk/src/tests/add-ons/print/Jamfile
Log:
PPD parser and configuration UI prototype from 2004. Maybe it can be of some use for the CUPS port HCD 2008 project.

Modified: haiku/trunk/src/tests/add-ons/print/Jamfile
===================================================================
--- haiku/trunk/src/tests/add-ons/print/Jamfile	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/Jamfile	2008-06-18 18:24:54 UTC (rev 26007)
@@ -1,5 +1,8 @@
 SubDir HAIKU_TOP src tests add-ons print ;
 
+# Skip PCL6 as jetlib.h is not in repository any more
+# TODO if there are no license issues add it to directory &quot;pcl6&quot;
+#SubInclude HAIKU_TOP src tests add-ons print pcl6 ;
 SubInclude HAIKU_TOP src tests add-ons print pdf ;
-SubInclude HAIKU_TOP src tests add-ons print pcl6 ;
+SubInclude HAIKU_TOP src tests add-ons print ppd ;
 SubInclude HAIKU_TOP src tests add-ons print transports ;

Added: haiku/trunk/src/tests/add-ons/print/ppd/Jamfile
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/Jamfile	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/Jamfile	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,6 @@
+SubDir HAIKU_TOP src tests add-ons print ppd ;
+
+SubInclude HAIKU_TOP src tests add-ons print ppd model ;
+SubInclude HAIKU_TOP src tests add-ons print ppd parser ;
+SubInclude HAIKU_TOP src tests add-ons print ppd ui ;
+SubInclude HAIKU_TOP src tests add-ons print ppd test ;

Added: haiku/trunk/src/tests/add-ons/print/ppd/doc/PPD_Object_Model.txt
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/doc/PPD_Object_Model.txt	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/doc/PPD_Object_Model.txt	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,78 @@
+PPD
+
+# translationKeyword only if stand-alone = no *Keyword statements
+&quot;*Default&quot;Keyword &quot;:&quot; StringValue [&quot;/&quot; translationString ].
+&quot;*&quot;Keyword [Option [&quot;/&quot; translationString ]] &quot;:&quot; Value [&quot;/&quot; translationString ].
+&quot;*?&quot;Keyword &quot;:&quot; InvocationValue [&quot;/&quot; translationString ].
+&quot;*Param&quot;Keyword [Option [&quot;/&quot; translationString ]] &quot;:&quot; Value [&quot;/&quot; translationString ].
+
+Line comments start with &quot;*%&quot;.
+
+*Include
+
+Keyword = ident.       # ,'.',/
+Option = ident {&quot;.&quot; ident}.
+# translationString must not follow SymbolValue!
+# translationString is terminated by &quot;:&quot; if it follows a Option
+# or CR if it follows a Value.
+Value = InvocationValue | QuotedValue | SymbolValue | StringValue | NoValue.
+
+# ps code
+# requires statement with option keyword!
+# Must end with in separate line *End if multiline.
+InvocationValue = '&quot;' printable '&quot;' [&quot;/&quot; translationString ].
+
+# requires statement without an option keyword!
+# *JCL can have an option keyword!
+# Must end with in separate line *End if multiline.
+QuotedValue = '&quot;' literalSubstring '&quot;'.
+
+SymbolValue = &quot;^&quot; printable. # without whitespaces
+
+# In case of translation string it is separated by newline or slash.
+StringValue = printable . # first char must not be &quot; or ^
+
+literalSubstring = { hexadecimalSubstring | char }.
+
+hexadecimalSubstring = &quot;&lt;&quot; { whitespace* hexdigit hexdigit} &quot;&gt;&quot;.
+hexdigit = ['0'..'9','a'..'f','A'..'F'].
+
+# No option keyword present. Keyword stands alone.
+NoValue =.
+
+ident = identChar+.
+identChar = [33..126].
+
+printable = printableChar+.
+printableChar = [32..126] | tab | lf | cr. # &quot; belongs not to printableChar!
+
+translationString = literalSubstring. # without lf and cr.
+
+char = [32..255] | tab | lf | cr.
+	
+whitespace= space | tab.
+
+tab=9.
+lf=10.
+cr=13.
+space=32.
+
+max size of MainKeyword = 40 characters
+
+File Structure see 3.8
+
+Standard Option Values:
+True | False | None | Unknown
+
+
+OpenUI Keyword: PickOne | PickMany | Boolean
+CloseUI: Keyword
+Open[Sub]Group: string
+# InstallableOptions is a registered option!
+Close[Sub]Group: string
+
+UIConstraints: keyword1 option1 keyword2 option2
+# option 1 can be omitted see page 57
+
+# Unique name
+ModelName: &quot;text&quot; 
\ No newline at end of file

Added: haiku/trunk/src/tests/add-ons/print/ppd/doc/TODO.txt
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/doc/TODO.txt	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/doc/TODO.txt	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,17 @@
+Scanner/Parser:
+	Handle JCLKeywords correctly.
+	Convert strings according to LanguageEncoding.
+
+PPDConfigView.cpp:
+	Add outline sub items in reverse order
+	Provide UI for single and multiple choice
+	Read settings
+	Write settings
+	Read default settings
+	Revert and OK button
+	Handle constraints
+	
+Integrate to PS driver
+	- Page setup dialog
+	- Job setup dialog
+	- Provide PS driver setup model selection dialog

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/Jamfile
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/Jamfile	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/Jamfile	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,12 @@
+SubDir HAIKU_TOP src tests add-ons print ppd model ;
+
+# SetSubDirSupportedPlatformsBeOSCompatible ;
+
+StaticLibrary libppdtest.a : 
+	PPD.cpp
+	Statement.cpp
+	StatementList.cpp
+	StatementListVisitor.cpp
+	StatementWrapper.cpp
+	Value.cpp
+;

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.cpp
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.cpp	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.cpp	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,28 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#include &quot;PPD.h&quot;
+
+#include &lt;stdio.h&gt;
+
+PPD::PPD()
+	: StatementList(true)
+	, fSymbols(false)
+{
+}
+
+PPD::~PPD()
+{
+}
+
+void PPD::Print()
+{
+	printf(&quot;&lt;ppd&gt;\n&quot;);
+	StatementList::Print();
+	printf(&quot;&lt;/ppd&gt;\n&quot;);
+}

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.h
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.h	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/PPD.h	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,28 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#ifndef _PPD_H
+#define _PPD_H
+
+#include &quot;Statement.h&quot;
+
+// PostScript Printer Definiton
+class PPD : public StatementList {
+private:
+	StatementList fSymbols;
+
+public:
+	PPD();
+	virtual ~PPD();
+	
+	// Prints the PPD to stdout in XML		
+	void Print();
+};
+
+#endif
+

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.cpp
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.cpp	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.cpp	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,187 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#include &quot;Statement.h&quot;
+
+#include &lt;stdio.h&gt;
+
+
+Statement::Statement()
+	: fType(kUnknown)
+	, fKeyword(NULL)
+	, fOption(NULL)
+	, fValue(NULL)
+	, fChildren(NULL)
+{
+}
+
+Statement::~Statement()
+{
+	delete fKeyword;
+	delete fOption;
+	delete fValue;
+	delete fChildren;
+}
+
+void Statement::SetType(Type type)
+{
+	fType = type;
+}
+
+Statement::Type Statement::GetType()
+{
+	return fType;
+}
+
+void Statement::SetKeyword(BString* keyword)
+{
+	fKeyword = keyword;
+}
+
+BString* Statement::GetKeyword()
+{
+	return fKeyword;
+}
+
+void Statement::SetOption(Value* option)
+{
+	fOption = option;
+}
+
+Value* Statement::GetOption()
+{
+	return fOption;
+}
+
+
+void Statement::SetValue(Value* value)
+{
+	fValue = value;
+}
+
+Value* Statement::GetValue()
+{
+	return fValue;
+}
+
+StatementList* Statement::GetChildren()
+{
+	return fChildren;
+}
+
+void Statement::AddChild(Statement* statement)
+{
+	if (fChildren == NULL) {
+		fChildren = new StatementList(true);
+	}
+	fChildren-&gt;Add(statement);
+}
+
+const char* Statement::GetKeywordString() 
+{
+	if (fKeyword != NULL) {
+		return fKeyword-&gt;String();
+	}
+	return NULL;
+}
+
+const char* Statement::GetOptionString()
+{
+	Value* option = GetOption();
+	if (option != NULL) {
+		return option-&gt;GetValueString();
+	}
+	return NULL;
+}
+
+const char* Statement::GetTranslationString()
+{
+	Value* option = GetOption();
+	if (option != NULL) {
+		return option-&gt;GetTranslationString();
+	}
+	return NULL;
+}
+
+const char* Statement::GetValueString()
+{
+	Value* value = GetValue();
+	if (value != NULL) {
+		return value-&gt;GetValueString();
+	}
+	return NULL;
+}
+
+const char* Statement::GetValueTranslationString()
+{
+	Value* value = GetValue();
+	if (value != NULL) {
+		return value-&gt;GetTranslationString();
+	}
+	return NULL;
+}
+
+
+const char* Statement::ElementForType() {
+	switch (fType) {
+		case kDefault: return &quot;Default&quot;;
+			break;
+		case kParam:   return &quot;Param&quot;;
+			break;
+		case kQuery:   return &quot;Query&quot;;
+			break;
+		case kValue:   return &quot;Value&quot;;
+			break;
+		case kUnknown: return &quot;Unknown&quot;;
+			break;
+	}
+	return NULL;
+}
+
+void Statement::Print()
+{
+	bool hasValue = fValue != NULL;
+	bool hasOption = fOption != NULL;
+	
+	printf(&quot;&lt;%s&quot;, ElementForType());
+	
+	if (fKeyword != NULL) {
+		printf(&quot; keyword=\&quot;%s\&quot;&quot;, fKeyword-&gt;String());
+	}
+	
+	if (hasValue || hasOption) {
+		printf(&quot;&gt;\n&quot;);
+	} else {
+		printf(&quot;/&gt;\n&quot;);
+	}
+
+
+	if (hasOption) {
+		printf(&quot;\t&lt;option&gt;\n&quot;);
+		fOption-&gt;Print();
+		printf(&quot;\t&lt;/option&gt;\n&quot;);
+	}			
+	
+	
+	if (hasValue) {
+		printf(&quot;\t&lt;value&gt;\n&quot;);
+		fValue-&gt;Print();
+		printf(&quot;\t&lt;/value&gt;\n&quot;);
+	}
+	
+	if (GetChildren() != NULL) {
+		printf(&quot;\t&lt;children&gt;\n&quot;);
+		GetChildren()-&gt;Print();
+		printf(&quot;\t&lt;/children&gt;\n&quot;);
+	}
+
+	if (hasValue || hasOption) {
+		printf(&quot;&lt;/%s&gt;\n\n&quot;, ElementForType());
+	}	
+}
+

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.h
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.h	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/Statement.h	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,74 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#ifndef _STATEMENT_H
+#define _STATEMENT_H
+
+#include &quot;StatementList.h&quot;
+#include &quot;Value.h&quot;
+
+class Statement
+{
+public:
+	enum Type {
+		kDefault,
+		kQuery,
+		kValue,
+		kParam,
+		kUnknown
+	};
+
+private:
+	Type           fType;
+	BString*       fKeyword;
+	Value*         fOption;
+	Value*         fValue;
+	StatementList* fChildren;
+
+	const char* ElementForType();
+	
+public:
+	Statement();
+	virtual ~Statement();
+	
+	void SetType(Type type);	
+	Type GetType();
+	
+	void SetKeyword(BString* keyword);
+	// mandatory in a valid statement
+	BString* GetKeyword();
+
+	void SetOption(Value* value);	
+	// optional in a valid statement
+	Value* GetOption();
+
+	void SetValue(Value* value);
+	// optional in a valid statement
+	Value* GetValue(); 
+
+	void AddChild(Statement* statement);
+	// optional in a valid statement
+	StatementList* GetChildren();
+	
+	// convenience methods
+	bool IsDefaultStatement() { return fType == kDefault; }
+	bool IsQueryStatement()   { return fType == kQuery; }
+	bool IsValueStatement()   { return fType == kValue; }
+	bool IsParamStatement()   { return fType == kParam; }
+	bool IsUnknownStatement() { return fType == kUnknown; }
+	
+	const char* GetKeywordString();
+	const char* GetOptionString();
+	const char* GetTranslationString();
+	const char* GetValueString();
+	const char* GetValueTranslationString();
+	
+	void Print();
+};
+
+#endif

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.cpp
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.cpp	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.cpp	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,74 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#include &quot;StatementList.h&quot;
+#include &quot;Statement.h&quot;
+
+#include &lt;stdio.h&gt;
+
+StatementList::StatementList(bool ownsStatements)
+	: fOwnsStatements(ownsStatements)
+{
+}
+
+StatementList::~StatementList()
+{
+	if (fOwnsStatements) {
+		for (int32 i = 0; i &lt; Size(); i ++) {
+			Statement* statement = StatementAt(i);
+			delete statement;
+		}
+	}
+	fList.MakeEmpty();
+}
+
+void StatementList::Add(Statement* statement)
+{
+	fList.AddItem(statement);
+}
+
+void StatementList::Remove(Statement* statement)
+{
+	fList.RemoveItem(statement);
+}
+
+int32 StatementList::Size()
+{
+	return fList.CountItems();
+}
+
+Statement* StatementList::StatementAt(int32 index)
+{
+	return (Statement*)fList.ItemAt(index);
+}
+
+Statement* StatementList::GetStatement(const char* keyword)
+{
+	for (int32 i = 0; i &lt; fList.CountItems(); i ++) {
+		if (strcmp(keyword, StatementAt(i)-&gt;GetKeywordString()) == 0) {
+			return StatementAt(i);
+		}
+	}
+	return NULL;
+}
+
+const char* StatementList::GetValue(const char* keyword)
+{
+	Statement* statement = GetStatement(keyword);
+	if (statement != NULL) {
+		return statement-&gt;GetValueString();
+	}
+	return NULL;
+}
+
+void StatementList::Print()
+{
+	for (int32 i = 0; i &lt; Size(); i ++) {
+		StatementAt(i)-&gt;Print();
+	}	
+}

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.h
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.h	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/StatementList.h	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,36 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#ifndef _STATEMENT_LIST_H
+#define _STATEMENT_LIST_H
+
+#include &lt;List.h&gt;
+
+class Statement;
+
+class StatementList {
+private:
+	BList fList;
+	bool  fOwnsStatements;
+	
+public:
+	StatementList(bool ownsStatements);
+	~StatementList();
+	
+	void Add(Statement* statement);
+	void Remove(Statement* statement);
+	int32 Size();
+	Statement* StatementAt(int32 index);
+
+	Statement* GetStatement(const char* keyword);
+	const char* GetValue(const char* keyword);
+	
+	void Print();
+};
+
+#endif

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.cpp
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.cpp	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.cpp	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,43 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#include &quot;StatementListVisitor.h&quot;
+
+void StatementListVisitor::Visit(StatementList* list)
+{
+	if (list == NULL) return;
+
+	const int32 n = list-&gt;Size();
+	for (int32 i = 0; i &lt; n; i ++) {
+		Statement* statement = list-&gt;StatementAt(i);
+		GroupStatement group(statement);
+		if (group.IsOpenGroup()) {
+			BeginGroup(&amp;group);
+			fLevel ++;
+		} else if (statement-&gt;IsValueStatement()) {
+			DoValue(statement);
+		} else if (statement-&gt;IsDefaultStatement()) {
+			DoDefault(statement);
+		} else if (statement-&gt;IsQueryStatement()) {
+			DoQuery(statement);
+		} else if (statement-&gt;IsParamStatement()) {
+			DoParam(statement);
+		}		
+		
+		StatementList* children = statement-&gt;GetChildren();
+		if (children != NULL) {
+			Visit(children);
+		}
+		
+		// Close statements have been removed
+		if (group.IsOpenGroup()) {
+			fLevel --;
+			EndGroup(&amp;group);
+		}
+	}
+}

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.h
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.h	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/StatementListVisitor.h	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,36 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#ifndef _STATEMENT_LIST_VISITOR_H
+#define _STATEMENT_LIST_VISITOR_H
+
+#include &quot;StatementWrapper.h&quot;
+#include &quot;StatementList.h&quot;
+
+class StatementListVisitor {
+private:
+	int32 fLevel;
+public:
+	StatementListVisitor() : fLevel(0) {}
+	virtual ~StatementListVisitor() {}
+	
+	virtual void Visit(StatementList* list);
+	
+	// the nesting level
+	int32 GetLevel() const { return fLevel; }
+	
+	virtual void BeginGroup(GroupStatement* group) {};
+	virtual void DoDefault(Statement* statement) {};
+	virtual void DoQuery(Statement* statement) {};
+	virtual void DoValue(Statement* statement) {};
+	virtual void DoParam(Statement* statement) {};
+	virtual void EndGroup(GroupStatement* group) {};
+};
+
+
+#endif

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.cpp
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.cpp	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.cpp	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,120 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#include &quot;StatementWrapper.h&quot;
+
+static const char* kOpenUIStatement = &quot;OpenUI&quot;;
+static const char* kCloseUIStatement = &quot;CloseUI&quot;;
+
+static const char* kOpenGroupStatement = &quot;OpenGroup&quot;;
+static const char* kCloseGroupStatement = &quot;CloseGroup&quot;;
+static const char* kOpenSubGroupStatement = &quot;OpenSubGroup&quot;;
+static const char* kCloseSubGroupStatement = &quot;CloseSubGroup&quot;;
+
+// JCL
+static const char* kJCL = &quot;JCL&quot;;             
+static const char* kJCLOpenUIStatement = &quot;JCLOpenUI&quot;;
+static const char* kJCLCloseUIStatement = &quot;JCLCloseUI&quot;;
+
+
+StatementWrapper::StatementWrapper(Statement* statement)
+	: fStatement(statement)
+{
+	// nothing to do	
+}
+
+GroupStatement::GroupStatement(Statement* statement)
+	: StatementWrapper(statement)
+{
+	// nothing to do	
+}
+
+bool GroupStatement::IsUIGroup()
+{
+	return strcmp(GetKeyword(), kOpenUIStatement) == 0;
+}
+
+bool GroupStatement::IsGroup()
+{
+	return strcmp(GetKeyword(), kOpenGroupStatement) == 0;
+}
+
+bool GroupStatement::IsSubGroup()
+{
+	return strcmp(GetKeyword(), kOpenSubGroupStatement) == 0;
+}
+
+bool GroupStatement::IsJCL()
+{
+	return strstr(GetKeyword(), kJCL) == GetKeyword();
+}
+
+bool GroupStatement::IsOpenGroup()
+{
+	const char* keyword = GetKeyword();
+	
+	return strcmp(keyword, kOpenUIStatement) == 0 || 
+		strcmp(keyword, kOpenGroupStatement) == 0 ||
+		strcmp(keyword, kOpenSubGroupStatement) == 0 ||
+		strcmp(keyword, kJCLOpenUIStatement) == 0;
+}
+
+bool GroupStatement::IsCloseGroup()
+{
+	const char* keyword = GetKeyword();
+
+	return strcmp(keyword, kCloseUIStatement) == 0 || 
+		strcmp(keyword, kCloseGroupStatement) == 0 ||
+		strcmp(keyword, kCloseSubGroupStatement) == 0 ||
+		strcmp(keyword, kJCLCloseUIStatement) == 0;	
+}
+
+Value* GroupStatement::GetValue() 
+{
+	if (strcmp(GetKeyword(), kOpenUIStatement) == 0 ||
+		strcmp(GetKeyword(), kJCLOpenUIStatement) == 0) {
+		return GetStatement()-&gt;GetOption();
+	} else {
+		return GetStatement()-&gt;GetValue();
+	}
+}
+
+const char* GroupStatement::GetGroupName()
+{
+	Value* value = GetValue();
+	if (value == NULL) return NULL;
+	BString* string = value-&gt;GetValue();
+	if (string == NULL) return NULL;
+	const char* name = string-&gt;String();	
+	if (name != NULL &amp;&amp; *name == '*') {
+		// skip '*'
+		name ++;
+	}
+	return name;
+}
+
+const char* GroupStatement::GetGroupTranslation()
+{
+	Value* value = GetValue();
+	if (value == NULL) return NULL;
+	BString* string = value-&gt;GetTranslation();
+	if (string == NULL) return NULL;
+	return string-&gt;String();	
+}
+
+GroupStatement::Type GroupStatement::GetType()
+{
+	const char* type = GetStatement()-&gt;GetValueString();
+	if (type == NULL) return kUnknown;
+	
+	if (strstr(type, &quot;PickOne&quot;) != NULL) return kPickOne;
+	if (strstr(type, &quot;PickMany&quot;) != NULL) return kPickMany;
+	if (strstr(type, &quot;Boolean&quot;) != NULL) return kBoolean;
+	
+	return kUnknown;
+}

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.h
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.h	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/StatementWrapper.h	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,92 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#ifndef _STATEMENT_WRAPPER_H
+#define _STATEMENT_WRAPPER_H
+
+#include &quot;Statement.h&quot;
+
+// wrapper classes to provide specific access to
+// statement members
+
+class StatementWrapper
+{
+private:
+	Statement* fStatement;
+
+public:
+	StatementWrapper(Statement* statement);
+
+	Statement* GetStatement() { return fStatement; }	
+	const char* GetKeyword() { return fStatement-&gt;GetKeyword()-&gt;String(); }
+};
+
+class GroupStatement : public StatementWrapper
+{
+private:	
+	Value* GetValue();
+	
+public:
+	GroupStatement(Statement* statement);
+
+	// test methods if the wrapped statement is a group statement
+	bool IsUIGroup();
+	bool IsGroup();
+	bool IsSubGroup();
+	
+	bool IsOpenGroup();
+	bool IsCloseGroup();
+
+	bool IsJCL();
+	
+	// accessors	
+	const char* GetGroupName();
+	const char* GetGroupTranslation();
+
+	enum Type {
+		kPickOne,
+		kPickMany,
+		kBoolean,
+		kUnknown
+	};
+	
+	Type GetType();
+};
+
+class ConstraintsStatement : public StatementWrapper
+{
+public:
+	ConstraintsStatement(Statement* statement);
+	
+	// is this realy a constraints statement
+	bool IsConstraints();
+
+	const char* GetFirstKeyword();	
+	const char* GetFirstOption();	
+	const char* GetSecondKeyword();	
+	const char* GetSecondOption();	
+};
+
+class OrderDependencyStatement : public StatementWrapper
+{
+public:
+	OrderDependencyStatement(Statement* statement);
+
+	// is this realy a order dependency statement	
+	bool IsOrderDependency();
+	
+	// is this a NonUIOrderDependencyStatement
+	bool IsNonUI();
+	
+	float GetOrder();
+	const char* GetSection();	
+	const char* GetKeyword();
+	const char* GetOption();
+};
+
+#endif

Added: haiku/trunk/src/tests/add-ons/print/ppd/model/Value.cpp
===================================================================
--- haiku/trunk/src/tests/add-ons/print/ppd/model/Value.cpp	2008-06-18 13:02:41 UTC (rev 26006)
+++ haiku/trunk/src/tests/add-ons/print/ppd/model/Value.cpp	2008-06-18 18:24:54 UTC (rev 26007)
@@ -0,0 +1,100 @@
+/*
+ * Copyright 2008, Haiku.
+ * Distributed under the terms of the MIT license.
+ *
+ * Authors:
+ *		Michael Pfeiffer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">laplace at users.sourceforge.net</A>&gt;
+ */
+
+#include &quot;Value.h&quot;
+
+#include &lt;stdio.h&gt;
+
+Value::Value(BString* value, Type type)
+	: fType(type)
+	, fValue(value)
+	, fTranslation(NULL)
+{
+}
+
+Value::~Value()
+{
+	delete fValue;
+	delete fTranslation;
+}
+
+void Value::SetType(Type type)
+{
+	fType = type;
+}
+
+Value::Type Value::GetType()
+{
+	return fType;
+}
+
+void Value::SetValue(BString* value)
+{
+	fValue = value;
+}
+
+BString* Value::GetValue()
+{
+	return fValue;
+}
+
+void Value::SetTranslation(BString* translation)
+{
+	fTranslation = translation;
+}
+
+BString* Value::GetTranslation()
+{
+	return fTranslation;
+}
+
+const char* Value::GetValueString()
+{
+	if (fValue != NULL) {
+		return fValue-&gt;String();
+	}
+	return NULL;
+}
+
+const char* Value::GetTranslationString()

[... truncated: 6981 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009681.html">[Haiku-commits] r26006 - haiku/trunk/build/scripts
</A></li>
	<LI>Next message: <A HREF="009685.html">[Haiku-commits] r26007 - in haiku/trunk/src/tests/add-ons/print: . ppd ppd/doc ppd/model ppd/parser ppd/shared ppd/test ppd/ui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9682">[ date ]</a>
              <a href="thread.html#9682">[ thread ]</a>
              <a href="subject.html#9682">[ subject ]</a>
              <a href="author.html#9682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
