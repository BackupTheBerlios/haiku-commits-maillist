<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r26181 - in	haiku/trunk/src/add-ons/kernel/bus_managers/acpi: . common	compiler debugger disassembler events hardware include	include/platform namespace resources tables utilities
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26181%20-%20in%0A%09haiku/trunk/src/add-ons/kernel/bus_managers/acpi%3A%20.%20common%0A%09compiler%20debugger%20disassembler%20events%20hardware%20include%0A%09include/platform%20namespace%20resources%20tables%20utilities&In-Reply-To=%3C200806302106.m5UL6Seb018393%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009914.html">
   <LINK REL="Next"  HREF="009916.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r26181 - in	haiku/trunk/src/add-ons/kernel/bus_managers/acpi: . common	compiler debugger disassembler events hardware include	include/platform namespace resources tables utilities</H1>
    <B>korli at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26181%20-%20in%0A%09haiku/trunk/src/add-ons/kernel/bus_managers/acpi%3A%20.%20common%0A%09compiler%20debugger%20disassembler%20events%20hardware%20include%0A%09include/platform%20namespace%20resources%20tables%20utilities&In-Reply-To=%3C200806302106.m5UL6Seb018393%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r26181 - in	haiku/trunk/src/add-ons/kernel/bus_managers/acpi: . common	compiler debugger disassembler events hardware include	include/platform namespace resources tables utilities">korli at mail.berlios.de
       </A><BR>
    <I>Mon Jun 30 23:06:28 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="009914.html">[Haiku-commits] r26180 - haiku/vendor/acpica
</A></li>
        <LI>Next message: <A HREF="009916.html">[Haiku-commits] r26182 - haiku/trunk/headers/os/bluetooth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9915">[ date ]</a>
              <a href="thread.html#9915">[ thread ]</a>
              <a href="subject.html#9915">[ subject ]</a>
              <a href="author.html#9915">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: korli
Date: 2008-06-30 23:06:24 +0200 (Mon, 30 Jun 2008)
New Revision: 26181
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=26181&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=26181&amp;view=rev</A>

Added:
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/dispatcher/
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/executer/
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/parser/
Removed:
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/platform/acdos16.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/interpreter/
Modified:
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/Jamfile
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/a16find.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adfile.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adisasm.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtable.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbdump.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbinfo.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/Makefile
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslmain.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopcodes.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/asloperands.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopt.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslstubs.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslutils.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbcmds.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbdisply.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbexec.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbfileio.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbhistry.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbutils.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmbuffer.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmnames.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmopcode.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrc.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrcl.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmwalk.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evevent.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evgpe.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evgpeblk.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evmisc.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evregion.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evrgnini.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/hardware/hwregs.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/hardware/hwsleep.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acconfig.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acdisasm.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acdispat.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acexcep.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/achware.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acinterp.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/aclocal.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acmacros.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acnamesp.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acpiosxf.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acpixf.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acstruct.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/actables.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/actbl1.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/actypes.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/include/acutils.h
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nsdump.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nseval.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nsinit.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nsload.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nsparse.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nssearch.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nsutils.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/namespace/nsxfeval.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/oshaiku.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/resources/rscalc.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/resources/rscreate.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/resources/rsmisc.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/resources/rsutils.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/tables/tbfadt.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/tables/tbfind.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/tables/tbinstal.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/tables/tbutils.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/tables/tbxface.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/tables/tbxfroot.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utalloc.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utclib.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utcopy.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utdebug.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utdelete.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/uteval.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utglobal.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utmisc.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utmutex.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utobject.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/uttrack.c
   haiku/trunk/src/add-ons/kernel/bus_managers/acpi/utilities/utxface.c
Log:
merging acpica-20080609 into trunk, changes some types in os code


Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/Jamfile	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/Jamfile	2008-06-30 21:06:24 UTC (rev 26181)
@@ -187,9 +187,9 @@
 SEARCH on [ FGristFiles $(resources_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi resources ] ;
 SEARCH on [ FGristFiles $(tables_src) tbutils.c ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi tables ] ;
 SEARCH on [ FGristFiles $(utilities_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi utilities ] ;
-SEARCH on [ FGristFiles $(dispatcher_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi interpreter dispatcher ] ;
-SEARCH on [ FGristFiles $(executer_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi interpreter executer ] ;
-SEARCH on [ FGristFiles $(parser_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi interpreter parser ] ;
+SEARCH on [ FGristFiles $(dispatcher_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi dispatcher ] ;
+SEARCH on [ FGristFiles $(executer_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi executer ] ;
+SEARCH on [ FGristFiles $(parser_src)  ] = [ FDirName $(HAIKU_TOP) src add-ons kernel bus_managers acpi parser ] ;
 
 KernelAddon acpi :
 	oshaiku.c

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/a16find.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/a16find.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/a16find.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -201,7 +201,7 @@
 char *
 AfGenerateFilename (char *TableId)
 {
-    ACPI_NATIVE_UINT         i;
+    UINT16                  i;
 
 
     for (i = 0; i &lt; 8 &amp;&amp; TableId[i] != ' ' &amp;&amp; TableId[i] != 0; i++)

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adfile.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adfile.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adfile.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -146,8 +146,8 @@
     char                    *Prefix,
     char                    *TableId)
 {
-    ACPI_NATIVE_UINT         i;
-    ACPI_NATIVE_UINT         j;
+    UINT32                  i;
+    UINT32                  j;
 
 
     for (i = 0; Prefix[i]; i++)
@@ -183,7 +183,7 @@
  *
  ******************************************************************************/
 
-ACPI_NATIVE_INT
+INT32
 AdWriteBuffer (
     char                *Filename,
     char                *Buffer,
@@ -202,7 +202,7 @@
 
     Actual = fwrite (Buffer, (size_t) Length, 1, fp);
     fclose (fp);
-    return ((ACPI_NATIVE_INT) Actual);
+    return ((INT32) Actual);
 }
 
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adisasm.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adisasm.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/adisasm.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -179,7 +179,7 @@
 
 ACPI_STATUS
 AcpiNsLoadTable (
-    ACPI_NATIVE_UINT        TableIndex,
+    UINT32                  TableIndex,
     ACPI_NAMESPACE_NODE     *Node)
 {
     return (AE_NOT_IMPLEMENTED);
@@ -665,8 +665,31 @@
     AcpiOsPrintf (&quot; *\n * Original Table Header:\n&quot;);
     AcpiOsPrintf (&quot; *     Signature        \&quot;%4.4s\&quot;\n&quot;,    Table-&gt;Signature);
     AcpiOsPrintf (&quot; *     Length           0x%8.8X (%u)\n&quot;, Table-&gt;Length, Table-&gt;Length);
-    AcpiOsPrintf (&quot; *     Revision         0x%2.2X\n&quot;,      Table-&gt;Revision);
 
+    /* Print and validate the revision */
+
+    AcpiOsPrintf (&quot; *     Revision         0x%2.2X&quot;,      Table-&gt;Revision);
+
+    switch (Table-&gt;Revision)
+    {
+    case 0:
+        AcpiOsPrintf (&quot; **** Invalid Revision&quot;);
+        break;
+
+    case 1:
+        /* Revision of DSDT controls the ACPI integer width */
+
+        if (ACPI_COMPARE_NAME (Table-&gt;Signature, ACPI_SIG_DSDT))
+        {
+            AcpiOsPrintf (&quot; **** ACPI 1.0, no 64-bit math support&quot;);
+        }
+        break;
+
+    default:
+        break;
+    }
+    AcpiOsPrintf (&quot;\n&quot;);
+
     /* Print and validate the table checksum */
 
     AcpiOsPrintf (&quot; *     Checksum         0x%2.2X&quot;,        Table-&gt;Checksum);
@@ -980,7 +1003,7 @@
     ACPI_TABLE_HEADER       *NewTable;
     UINT32                  NumTables;
     UINT32                  PointerSize;
-    ACPI_NATIVE_UINT        TableIndex;
+    UINT32                  TableIndex;
 
 
     if (GetAllTables)
@@ -1087,7 +1110,7 @@
     ACPI_WALK_STATE         *WalkState;
     UINT8                   *AmlStart;
     UINT32                  AmlLength;
-    ACPI_NATIVE_UINT        TableIndex;
+    UINT32                  TableIndex;
 
 
     if (!Table)
@@ -1139,7 +1162,7 @@
 
     if (LoadTable)
     {
-        Status = AcpiTbStoreTable ((ACPI_NATIVE_UINT) Table, Table,
+        Status = AcpiTbStoreTable ((ACPI_PHYSICAL_ADDRESS) Table, Table,
                     Table-&gt;Length, ACPI_TABLE_ORIGIN_ALLOCATED, &amp;TableIndex);
         if (ACPI_FAILURE (Status))
         {

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtable.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtable.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtable.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -151,6 +151,7 @@
 {
     &quot;Hardware Unit Definition&quot;,
     &quot;Reserved Memory Region&quot;,
+    &quot;Root Port ATS Capability&quot;,
     &quot;Unknown SubTable Type&quot;         /* Reserved */
 };
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbdump.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbdump.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbdump.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -295,10 +295,10 @@
     ACPI_DMTABLE_INFO       *InfoTable;
     ACPI_DMTABLE_INFO       *DataInfoTable = NULL;
     UINT8                   *DataTable = NULL;
-    ACPI_NATIVE_UINT        DataCount = 0;
-    ACPI_NATIVE_UINT        DataLength = 0;
-    ACPI_NATIVE_UINT        DataOffset = 0;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  DataCount = 0;
+    UINT32                  DataLength = 0;
+    UINT32                  DataOffset = 0;
+    UINT32                  i;
 
 
     /* No main table, only sub-tables */
@@ -536,6 +536,10 @@
             InfoTable = AcpiDmTableInfoDmar1;
             ScopeOffset = sizeof (ACPI_DMAR_RESERVED_MEMORY);
             break;
+        case ACPI_DMAR_TYPE_ATSR:
+            InfoTable = AcpiDmTableInfoDmar2;
+            ScopeOffset = sizeof (ACPI_DMAR_TYPE_ATSR);
+            break;
         default:
             AcpiOsPrintf (&quot;\n**** Unknown DMAR sub-table type %X\n\n&quot;, SubTable-&gt;Type);
             return;
@@ -548,49 +552,42 @@
             return;
         }
 
-        /*
-         * Currently, a common flag indicates whether there are any
-         * device scope entries present at the end of the subtable.
-         */
-        if ((SubTable-&gt;Flags &amp; ACPI_DMAR_INCLUDE_ALL) == 0)
-        {
-            /* Dump the device scope entries */
+        /* Dump the device scope entries (if any) */
 
-            ScopeTable = ACPI_ADD_PTR (ACPI_DMAR_DEVICE_SCOPE, SubTable, ScopeOffset);
-            while (ScopeOffset &lt; SubTable-&gt;Length)
+        ScopeTable = ACPI_ADD_PTR (ACPI_DMAR_DEVICE_SCOPE, SubTable, ScopeOffset);
+        while (ScopeOffset &lt; SubTable-&gt;Length)
+        {
+            AcpiOsPrintf (&quot;\n&quot;);
+            Status = AcpiDmDumpTable (Length, Offset + ScopeOffset, ScopeTable,
+                        ScopeTable-&gt;Length, AcpiDmTableInfoDmarScope);
+            if (ACPI_FAILURE (Status))
             {
-                AcpiOsPrintf (&quot;\n&quot;);
-                Status = AcpiDmDumpTable (Length, Offset + ScopeOffset, ScopeTable,
-                            ScopeTable-&gt;Length, AcpiDmTableInfoDmarScope);
-                if (ACPI_FAILURE (Status))
-                {
-                    return;
-                }
+                return;
+            }
 
-                /* Dump the PCI Path entries for this device scope */
+            /* Dump the PCI Path entries for this device scope */
 
-                PathOffset = sizeof (ACPI_DMAR_DEVICE_SCOPE); /* Path entries start at this offset */
+            PathOffset = sizeof (ACPI_DMAR_DEVICE_SCOPE); /* Path entries start at this offset */
 
-                PciPath = ACPI_ADD_PTR (UINT8, ScopeTable,
-                    sizeof (ACPI_DMAR_DEVICE_SCOPE));
+            PciPath = ACPI_ADD_PTR (UINT8, ScopeTable,
+                sizeof (ACPI_DMAR_DEVICE_SCOPE));
 
-                while (PathOffset &lt; ScopeTable-&gt;Length)
-                {
-                    AcpiDmLineHeader ((PathOffset + ScopeOffset + Offset), 2, &quot;PCI Path&quot;);
-                    AcpiOsPrintf (&quot;[%2.2X, %2.2X]\n&quot;, PciPath[0], PciPath[1]);
+            while (PathOffset &lt; ScopeTable-&gt;Length)
+            {
+                AcpiDmLineHeader ((PathOffset + ScopeOffset + Offset), 2, &quot;PCI Path&quot;);
+                AcpiOsPrintf (&quot;[%2.2X, %2.2X]\n&quot;, PciPath[0], PciPath[1]);
 
-                    /* Point to next PCI Path entry */
+                /* Point to next PCI Path entry */
 
-                    PathOffset += 2;
-                    PciPath += 2;
-                }
+                PathOffset += 2;
+                PciPath += 2;
+            }
 
-                /* Point to next device scope entry */
+            /* Point to next device scope entry */
 
-                ScopeOffset += ScopeTable-&gt;Length;
-                ScopeTable = ACPI_ADD_PTR (ACPI_DMAR_DEVICE_SCOPE,
-                    ScopeTable, ScopeTable-&gt;Length);
-            }
+            ScopeOffset += ScopeTable-&gt;Length;
+            ScopeTable = ACPI_ADD_PTR (ACPI_DMAR_DEVICE_SCOPE,
+                ScopeTable, ScopeTable-&gt;Length);
         }
 
         /* Point to next sub-table */

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbinfo.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbinfo.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/common/dmtbinfo.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -162,6 +162,7 @@
 #define ACPI_DMARS_OFFSET(f)            (UINT8) ACPI_OFFSET (ACPI_DMAR_DEVICE_SCOPE,f)
 #define ACPI_DMAR0_OFFSET(f)            (UINT8) ACPI_OFFSET (ACPI_DMAR_HARDWARE_UNIT,f)
 #define ACPI_DMAR1_OFFSET(f)            (UINT8) ACPI_OFFSET (ACPI_DMAR_RESERVED_MEMORY,f)
+#define ACPI_DMAR2_OFFSET(f)            (UINT8) ACPI_OFFSET (ACPI_DMAR_ATSR,f)
 #define ACPI_EINJ0_OFFSET(f)            (UINT8) ACPI_OFFSET (ACPI_WHEA_HEADER,f)
 #define ACPI_HEST9_OFFSET(f)            (UINT8) ACPI_OFFSET (ACPI_HEST_GENERIC,f)
 #define ACPI_HESTN_OFFSET(f)            (UINT8) ACPI_OFFSET (ACPI_HEST_NOTIFY,f)
@@ -576,6 +577,7 @@
 ACPI_DMTABLE_INFO           AcpiDmTableInfoDmar[] =
 {
     {ACPI_DMT_UINT8,    ACPI_DMAR_OFFSET (Width),                   &quot;Host Address Width&quot;},
+    {ACPI_DMT_UINT8,    ACPI_DMAR_OFFSET (Flags),                   &quot;Flags&quot;},
     {ACPI_DMT_EXIT,     0,                                          NULL}
 };
 
@@ -585,8 +587,6 @@
 {
     {ACPI_DMT_DMAR,     ACPI_DMAR0_OFFSET (Header.Type),            &quot;Subtable Type&quot;},
     {ACPI_DMT_UINT16,   ACPI_DMAR0_OFFSET (Header.Length),          &quot;Length&quot;},
-    {ACPI_DMT_UINT8,    ACPI_DMAR0_OFFSET (Header.Flags),           &quot;Flags&quot;},
-    {ACPI_DMT_UINT24,   ACPI_DMAR0_OFFSET (Header.Reserved[0]),     &quot;Reserved&quot;},
     {ACPI_DMT_EXIT,     0,                                          NULL}
 };
 
@@ -596,7 +596,8 @@
 {
     {ACPI_DMT_UINT8,    ACPI_DMARS_OFFSET (EntryType),              &quot;Device Scope Entry Type&quot;},
     {ACPI_DMT_UINT8,    ACPI_DMARS_OFFSET (Length),                 &quot;Entry Length&quot;},
-    {ACPI_DMT_UINT8,    ACPI_DMARS_OFFSET (Segment),                &quot;PCI Segment Number&quot;},
+    {ACPI_DMT_UINT16,   ACPI_DMARS_OFFSET (Reserved),               &quot;Reserved&quot;},
+    {ACPI_DMT_UINT8,    ACPI_DMARS_OFFSET (EnumerationId),          &quot;Enumeration ID&quot;},
     {ACPI_DMT_UINT8,    ACPI_DMARS_OFFSET (Bus),                    &quot;PCI Bus Number&quot;},
     {ACPI_DMT_EXIT,     0,                                          NULL}
 };
@@ -607,20 +608,35 @@
 
 ACPI_DMTABLE_INFO           AcpiDmTableInfoDmar0[] =
 {
+    {ACPI_DMT_UINT8,    ACPI_DMAR0_OFFSET (Flags),                  &quot;Flags&quot;},
+    {ACPI_DMT_UINT8,    ACPI_DMAR0_OFFSET (Reserved),               &quot;Reserved&quot;},
+    {ACPI_DMT_UINT16,   ACPI_DMAR0_OFFSET (Segment),                &quot;PCI Segment Number&quot;},
     {ACPI_DMT_UINT64,   ACPI_DMAR0_OFFSET (Address),                &quot;Register Base Address&quot;},
     {ACPI_DMT_EXIT,     0,                                          NULL}
 };
 
-/* 1: Reserved Memory Defininition */
+/* 1: Reserved Memory Definition */
 
 ACPI_DMTABLE_INFO           AcpiDmTableInfoDmar1[] =
 {
-    {ACPI_DMT_UINT64,   ACPI_DMAR1_OFFSET (Address),                &quot;Base Address&quot;},
+    {ACPI_DMT_UINT16,   ACPI_DMAR1_OFFSET (Reserved),               &quot;Reserved&quot;},
+    {ACPI_DMT_UINT16,   ACPI_DMAR1_OFFSET (Segment),                &quot;PCI Segment Number&quot;},
+    {ACPI_DMT_UINT64,   ACPI_DMAR1_OFFSET (BaseAddress),            &quot;Base Address&quot;},
     {ACPI_DMT_UINT64,   ACPI_DMAR1_OFFSET (EndAddress),             &quot;End Address (limit)&quot;},
     {ACPI_DMT_EXIT,     0,                                          NULL}
 };
 
+/* 2: Root Port ATS Capability Definition */
 
+ACPI_DMTABLE_INFO           AcpiDmTableInfoDmar2[] =
+{
+    {ACPI_DMT_UINT8,    ACPI_DMAR2_OFFSET (Flags),                  &quot;Flags&quot;},
+    {ACPI_DMT_UINT8,    ACPI_DMAR2_OFFSET (Reserved),               &quot;Reserved&quot;},
+    {ACPI_DMT_UINT16,   ACPI_DMAR2_OFFSET (Segment),                &quot;PCI Segment Number&quot;},
+    {ACPI_DMT_EXIT,     0,                                          NULL}
+};
+
+
 /*******************************************************************************
  *
  * ECDT - Embedded Controller Boot Resources Table
@@ -1034,7 +1050,6 @@
     {ACPI_DMT_UINT16,   ACPI_SRAT1_OFFSET (Reserved),               &quot;Reserved&quot;},
     {ACPI_DMT_UINT64,   ACPI_SRAT1_OFFSET (BaseAddress),            &quot;Base Address&quot;},
     {ACPI_DMT_UINT64,   ACPI_SRAT1_OFFSET (Length),                 &quot;Address Length&quot;},
-    {ACPI_DMT_UINT32,   ACPI_SRAT1_OFFSET (MemoryType),             &quot;Memory Type&quot;},
     {ACPI_DMT_UINT32,   ACPI_SRAT1_OFFSET (Flags),                  &quot;Flags (decoded below)&quot;},
     {ACPI_DMT_FLAG0,    ACPI_SRAT1_FLAG_OFFSET (Flags,0),           &quot;Enabled&quot;},
     {ACPI_DMT_FLAG1,    ACPI_SRAT1_FLAG_OFFSET (Flags,0),           &quot;Hot Pluggable&quot;},

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/Makefile
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/Makefile	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/Makefile	2008-06-30 21:06:24 UTC (rev 26181)
@@ -31,42 +31,42 @@
 	../namespace/nsutils.c \
 	../namespace/nswalk.c \
 	../namespace/nsxfobj.c \
-	../interpreter/parser/psargs.c \
-	../interpreter/parser/psloop.c \
-	../interpreter/parser/psopcode.c \
-	../interpreter/parser/psparse.c \
-	../interpreter/parser/psscope.c \
-	../interpreter/parser/pstree.c \
-	../interpreter/parser/psutils.c \
-	../interpreter/parser/pswalk.c \
-	../interpreter/dispatcher/dswscope.c \
-	../interpreter/dispatcher/dswstate.c \
-	../interpreter/dispatcher/dsfield.c \
-	../interpreter/dispatcher/dsobject.c \
-	../interpreter/dispatcher/dsopcode.c \
-	../interpreter/dispatcher/dsutils.c \
-	../interpreter/dispatcher/dswexec.c \
-	../interpreter/dispatcher/dswload.c \
-	../interpreter/executer/exconvrt.c \
-	../interpreter/executer/excreate.c \
-	../interpreter/executer/exdump.c \
-	../interpreter/executer/exmisc.c \
-	../interpreter/executer/exmutex.c \
-	../interpreter/executer/exnames.c \
-	../interpreter/executer/exoparg1.c \
-	../interpreter/executer/exoparg2.c \
-	../interpreter/executer/exoparg3.c \
-	../interpreter/executer/exoparg6.c \
-	../interpreter/executer/exprep.c \
-	../interpreter/executer/exregion.c \
-	../interpreter/executer/exresnte.c \
-	../interpreter/executer/exresolv.c \
-	../interpreter/executer/exresop.c \
-	../interpreter/executer/exstore.c \
-	../interpreter/executer/exstoren.c \
-	../interpreter/executer/exstorob.c \
-	../interpreter/executer/exsystem.c \
-	../interpreter/executer/exutils.c \
+	../parser/psargs.c \
+	../parser/psloop.c \
+	../parser/psopcode.c \
+	../parser/psparse.c \
+	../parser/psscope.c \
+	../parser/pstree.c \
+	../parser/psutils.c \
+	../parser/pswalk.c \
+	../dispatcher/dswscope.c \
+	../dispatcher/dswstate.c \
+	../dispatcher/dsfield.c \
+	../dispatcher/dsobject.c \
+	../dispatcher/dsopcode.c \
+	../dispatcher/dsutils.c \
+	../dispatcher/dswexec.c \
+	../dispatcher/dswload.c \
+	../executer/exconvrt.c \
+	../executer/excreate.c \
+	../executer/exdump.c \
+	../executer/exmisc.c \
+	../executer/exmutex.c \
+	../executer/exnames.c \
+	../executer/exoparg1.c \
+	../executer/exoparg2.c \
+	../executer/exoparg3.c \
+	../executer/exoparg6.c \
+	../executer/exprep.c \
+	../executer/exregion.c \
+	../executer/exresnte.c \
+	../executer/exresolv.c \
+	../executer/exresop.c \
+	../executer/exstore.c \
+	../executer/exstoren.c \
+	../executer/exstorob.c \
+	../executer/exsystem.c \
+	../executer/exutils.c \
 	../common/adfile.c \
 	../common/adisasm.c \
 	../common/adwalk.c \

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslmain.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslmain.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslmain.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -328,7 +328,7 @@
     char                    **argv)
 {
     BOOLEAN                 BadCommandLine = FALSE;
-    ACPI_NATIVE_INT         j;
+    int                     j;
 
 
     /* Minimum command line contains at least one option or an input file */

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopcodes.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopcodes.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopcodes.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -546,7 +546,7 @@
     UINT32                  BigEndianId;
     char                    *InString;
     ACPI_STATUS             Status = AE_OK;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
 
 
     InString = (char *) Op-&gt;Asl.Value.String;
@@ -642,7 +642,7 @@
     char                    *InString;
     char                    *Buffer;
     ACPI_STATUS             Status = AE_OK;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
     ACPI_PARSE_OBJECT       *NewOp;
 
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/asloperands.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/asloperands.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/asloperands.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -948,7 +948,7 @@
 {
     ACPI_PARSE_OBJECT       *Child;
     ACPI_SIZE               Length;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
     char                    *Filename;
 
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopt.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopt.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslopt.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -288,9 +288,9 @@
 {
     UINT32                  NumCommonSegments;
     UINT32                  MaxCommonSegments;
-    ACPI_NATIVE_UINT        Index;
+    UINT32                  Index;
     UINT32                  NumCarats;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
     char                    *NewPath;
     char                    *NewPathExternal;
     ACPI_NAMESPACE_NODE     *Node;

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslstubs.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslstubs.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslstubs.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -275,7 +275,7 @@
     char                    *Signature,
     char                    *OemId,
     char                    *OemTableId,
-    ACPI_NATIVE_UINT        *TableIndex)
+    UINT32                  *TableIndex)
 {
     return (AE_SUPPORT);
 }

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslutils.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslutils.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/compiler/aslutils.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -536,7 +536,7 @@
     if ((Gbl_ExceptionCount[ASL_ERROR] == 0) || (Gbl_IgnoreErrors))
     {
         FlPrintFile (FileId,
-            &quot;AML Output: %s - %d bytes %d named objects %d executable opcodes\n\n&quot;,
+            &quot;AML Output: %s - %d bytes, %d named objects, %d executable opcodes\n\n&quot;,
             Gbl_Files[ASL_FILE_AML_OUTPUT].Filename, Gbl_TableLength,
             TotalNamedObjects, TotalExecutableOpcodes);
     }

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbcmds.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbcmds.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbcmds.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -433,7 +433,7 @@
 AcpiDbDisplayTableInfo (
     char                    *TableArg)
 {
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
     ACPI_TABLE_DESC         *TableDesc;
 
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbdisply.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbdisply.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbdisply.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -685,7 +685,7 @@
     ACPI_BUFFER             Buffer;
     ACPI_DEVICE_INFO        *Info;
     ACPI_STATUS             Status;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
 
 
     Handle = ACPI_TO_POINTER (ACPI_STRTOUL (ObjectArg, NULL, 16));
@@ -707,7 +707,7 @@
         {
             for (i = 0; i &lt; Info-&gt;CompatibilityId.Count; i++)
             {
-                AcpiOsPrintf (&quot;CID #%d: %s\n&quot;, (UINT32) i,
+                AcpiOsPrintf (&quot;CID #%d: %s\n&quot;, i,
                     Info-&gt;CompatibilityId.Id[i].Value);
             }
         }

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbexec.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbexec.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbexec.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -512,12 +512,12 @@
     if (Info-&gt;InitArgs)
     {
         AcpiDbUInt32ToHexString (Info-&gt;NumCreated, Info-&gt;IndexOfThreadStr);
-        AcpiDbUInt32ToHexString (AcpiOsGetThreadId (), Info-&gt;IdOfThreadStr);
+        AcpiDbUInt32ToHexString ((UINT32) AcpiOsGetThreadId (), Info-&gt;IdOfThreadStr);
     }
 
     if (Info-&gt;Threads &amp;&amp; (Info-&gt;NumCreated &lt; Info-&gt;NumThreads))
     {
-        Info-&gt;Threads[Info-&gt;NumCreated++] = AcpiOsGetThreadId();
+        Info-&gt;Threads[Info-&gt;NumCreated++] = (UINT32) AcpiOsGetThreadId();
     }
 
     for (i = 0; i &lt; Info-&gt;NumLoops; i++)

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbfileio.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbfileio.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbfileio.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -118,7 +118,10 @@
 
 #include &quot;acpi.h&quot;
 #include &quot;acdebug.h&quot;
+
+#ifdef ACPI_APPLICATION
 #include &quot;actables.h&quot;
+#endif
 
 #if (defined ACPI_DEBUGGER || defined ACPI_DISASSEMBLER)
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbhistry.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbhistry.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbhistry.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -210,7 +210,7 @@
 AcpiDbDisplayHistory (
     void)
 {
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
     UINT16                  HistoryIndex;
 
 
@@ -249,7 +249,7 @@
 AcpiDbGetFromHistory (
     char                    *CommandNumArg)
 {
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
     UINT16                  HistoryIndex;
     UINT32                  CmdNum;
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbutils.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbutils.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/debugger/dbutils.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -299,7 +299,7 @@
 
     case ACPI_TYPE_LOCAL_REFERENCE:
 
-        AcpiOsPrintf (&quot;[Object Reference] = &quot;, ObjDesc-&gt;Reference.Handle);
+        AcpiOsPrintf (&quot;[Object Reference] = &quot;);
         AcpiDmDisplayInternalObject (ObjDesc-&gt;Reference.Handle, NULL);
         break;
 

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmbuffer.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmbuffer.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmbuffer.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -282,7 +282,7 @@
     UINT32                  WordCount;
     ACPI_PARSE_OBJECT       *SizeOp;
     ACPI_PARSE_OBJECT       *NextOp;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
 
 
     /* Buffer size is the buffer argument */
@@ -320,7 +320,7 @@
     for (i = 0; i &lt; (ByteCount - 2); i += 2)
     {
         if ((!ACPI_IS_PRINT (ByteData[i])) ||
-            (ByteData[i + 1] != 0))
+            (ByteData[(ACPI_SIZE) i + 1] != 0))
         {
             return (FALSE);
         }
@@ -441,54 +441,37 @@
 
 /*******************************************************************************
  *
- * FUNCTION:    AcpiDmIsEisaId
+ * FUNCTION:    AcpiDmIsEisaIdElement
  *
  * PARAMETERS:  Op              - Op to be examined
  *
  * RETURN:      None
  *
- * DESCRIPTION: Determine if an Op can be converted to an EisaId.
+ * DESCRIPTION: Determine if an Op (argument to _HID or _CID) can be converted
+ *              to an EISA ID.
  *
  ******************************************************************************/
 
 void
-AcpiDmIsEisaId (
+AcpiDmIsEisaIdElement (
     ACPI_PARSE_OBJECT       *Op)
 {
-    UINT32                  Name;
     UINT32                  BigEndianId;
-    ACPI_PARSE_OBJECT       *NextOp;
-    ACPI_NATIVE_UINT        i;
     UINT32                  Prefix[3];
+    UINT32                  i;
 
 
-    /* Get the NameSegment */
-
-    Name = AcpiPsGetName (Op);
-    if (!Name)
-    {
-        return;
-    }
-
-    /* We are looking for _HID */
-
-    if (!ACPI_COMPARE_NAME (&amp;Name, METHOD_NAME__HID))
-    {
-        return;
-    }
-
     /* The parameter must be either a word or a dword */
 
-    NextOp = AcpiPsGetDepthNext (NULL, Op);
-    if ((NextOp-&gt;Common.AmlOpcode != AML_DWORD_OP) &amp;&amp;
-        (NextOp-&gt;Common.AmlOpcode != AML_WORD_OP))
+    if ((Op-&gt;Common.AmlOpcode != AML_DWORD_OP) &amp;&amp;
+        (Op-&gt;Common.AmlOpcode != AML_WORD_OP))
     {
         return;
     }
 
     /* Swap from little-endian to big-endian to simplify conversion */
 
-    BigEndianId = AcpiUtDwordByteSwap ((UINT32) NextOp-&gt;Common.Value.Integer);
+    BigEndianId = AcpiUtDwordByteSwap ((UINT32) Op-&gt;Common.Value.Integer);
 
     /* Create the 3 leading ASCII letters */
 
@@ -509,12 +492,84 @@
 
     /* OK - mark this node as convertable to an EISA ID */
 
-    NextOp-&gt;Common.DisasmOpcode = ACPI_DASM_EISAID;
+    Op-&gt;Common.DisasmOpcode = ACPI_DASM_EISAID;
 }
 
 
 /*******************************************************************************
  *
+ * FUNCTION:    AcpiDmIsEisaId
+ *
+ * PARAMETERS:  Op              - Op to be examined
+ *
+ * RETURN:      None
+ *
+ * DESCRIPTION: Determine if a Name() Op can be converted to an EisaId.
+ *
+ ******************************************************************************/
+
+void
+AcpiDmIsEisaId (
+    ACPI_PARSE_OBJECT       *Op)
+{
+    UINT32                  Name;
+    ACPI_PARSE_OBJECT       *NextOp;
+
+
+    /* Get the NameSegment */
+
+    Name = AcpiPsGetName (Op);
+    if (!Name)
+    {
+        return;
+    }
+
+    NextOp = AcpiPsGetDepthNext (NULL, Op);
+    if (!NextOp)
+    {
+        return;
+    }
+
+    /* Check for _HID - has one argument */
+
+    if (ACPI_COMPARE_NAME (&amp;Name, METHOD_NAME__HID))
+    {
+        AcpiDmIsEisaIdElement (NextOp);
+        return;
+    }
+
+    /* Exit if not _CID */
+
+    if (!ACPI_COMPARE_NAME (&amp;Name, METHOD_NAME__CID))
+    {
+        return;
+    }
+
+    /* _CID can contain a single argument or a package */
+
+    if (NextOp-&gt;Common.AmlOpcode != AML_PACKAGE_OP)
+    {
+        AcpiDmIsEisaIdElement (NextOp);
+        return;
+    }
+
+    /* _CID with Package: get the package length */
+
+    NextOp = AcpiPsGetDepthNext (NULL, NextOp);
+
+    /* Don't need to use the length, just walk the peer list */
+
+    NextOp = NextOp-&gt;Common.Next;
+    while (NextOp)
+    {
+        AcpiDmIsEisaIdElement (NextOp);
+        NextOp = NextOp-&gt;Common.Next;
+    }
+}
+
+
+/*******************************************************************************
+ *
  * FUNCTION:    AcpiDmEisaId
  *
  * PARAMETERS:  EncodedId       - Raw encoded EISA ID.

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmnames.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmnames.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmnames.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -1,7 +1,7 @@
 /*******************************************************************************
  *
  * Module Name: dmnames - AML disassembler, names, namestrings, pathnames
- *              $Revision: 1.18 $
+ *              $Revision: 1.19 $
  *
  ******************************************************************************/
 
@@ -150,16 +150,20 @@
 
 UINT32
 AcpiDmDumpName (
-    char                    *Name)
+    UINT32                  Name)
 {
     UINT32                  i;
     UINT32                  Length;
     char                    NewName[4];
 
 
+    /* Copy name locally in case the original name is not writeable */
+
+    *(UINT32 *) NewName = Name;
+
     /* Ensure that the name is printable, even if we have to fix it */
 
-    *(UINT32 *) NewName = AcpiUtRepairName (Name);
+    AcpiUtRepairName (NewName);
 
     /* Remove all trailing underscores from the name */
 
@@ -327,7 +331,7 @@
     {
         /* Append Name segment */
 
-        AcpiDmDumpName ((char *) Name);
+        AcpiDmDumpName (*ACPI_CAST_PTR (UINT32, Name));
 
         SegCount--;
         if (SegCount)

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmopcode.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmopcode.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmopcode.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -1,7 +1,7 @@
 /*******************************************************************************
  *
  * Module Name: dmopcode - AML disassembler, specific AML opcodes
- *              $Revision: 1.105 $
+ *              $Revision: 1.106 $
  *
  ******************************************************************************/
 
@@ -549,7 +549,7 @@
 
     case AML_INT_NAMEDFIELD_OP:
 
-        Length = AcpiDmDumpName ((char *) &amp;Op-&gt;Named.Name);
+        Length = AcpiDmDumpName (Op-&gt;Named.Name);
         AcpiOsPrintf (&quot;,%*.s  %d&quot;, (int) (5 - Length), &quot; &quot;,
             (UINT32) Op-&gt;Common.Value.Integer);
         AcpiDmCommaIfFieldMember (Op);

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrc.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrc.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrc.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -133,7 +133,7 @@
     UINT32                  Length,
     UINT32                  Level);
 
-static ACPI_RESOURCE_HANDLER    AcpiGbl_DumpResourceDispatch [] =
+static ACPI_RESOURCE_HANDLER    AcpiGbl_DmResourceDispatch [] =
 {
     /* Small descriptors */
 
@@ -325,7 +325,7 @@
     UINT32                  ByteCount)
 {
     ACPI_STATUS             Status;
-    ACPI_NATIVE_UINT        CurrentByteOffset;
+    UINT32                  CurrentByteOffset;
     UINT8                   ResourceType;
     UINT32                  ResourceLength;
     void                    *Aml;
@@ -343,7 +343,7 @@
         Node = Node-&gt;Child;
     }
 
-    for (CurrentByteOffset = 0; CurrentByteOffset &lt; ByteCount; )
+    for (CurrentByteOffset = 0; CurrentByteOffset &lt; ByteCount;)
     {
         Aml = &amp;ByteData[CurrentByteOffset];
 
@@ -423,7 +423,7 @@
             Node = Node-&gt;Peer;
         }
 
-        AcpiGbl_DumpResourceDispatch [ResourceIndex] (
+        AcpiGbl_DmResourceDispatch [ResourceIndex] (
             Aml, ResourceLength, Level);
 
         /* Descriptor post-processing */

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrcl.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrcl.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmresrcl.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -215,7 +215,7 @@
     UINT8                   Type,
     UINT32                  Level)
 {
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
 
 
     for (i = 0; i &lt; 4; i++)
@@ -261,7 +261,7 @@
     UINT8                   Type,
     UINT32                  Level)
 {
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
 
 
     AcpiOsPrintf (&quot;\n&quot;);

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmwalk.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmwalk.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/disassembler/dmwalk.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -1,7 +1,7 @@
 /*******************************************************************************
  *
  * Module Name: dmwalk - AML disassembly tree walk
- *              $Revision: 1.34 $
+ *              $Revision: 1.35 $
  *
  ******************************************************************************/
 
@@ -622,7 +622,7 @@
                 }
                 else
                 {
-                    AcpiDmDumpName ((char *) &amp;Name);
+                    AcpiDmDumpName (Name);
                 }
 
                 if (Op-&gt;Common.AmlOpcode != AML_INT_NAMEDFIELD_OP)

Copied: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/dispatcher (from rev 26180, haiku/vendor/acpica/20080609/dispatcher)

Modified: haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evevent.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evevent.c	2008-06-30 20:51:00 UTC (rev 26180)
+++ haiku/trunk/src/add-ons/kernel/bus_managers/acpi/events/evevent.c	2008-06-30 21:06:24 UTC (rev 26181)
@@ -289,7 +289,7 @@
 AcpiEvFixedEventInitialize (
     void)
 {
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
     ACPI_STATUS             Status;
 
 
@@ -338,7 +338,7 @@
     UINT32                  IntStatus = ACPI_INTERRUPT_NOT_HANDLED;
     UINT32                  FixedStatus;
     UINT32                  FixedEnable;
-    ACPI_NATIVE_UINT        i;
+    UINT32                  i;
 
 
     ACPI_FUNCTION_NAME (EvFixedEventDetect);
@@ -348,10 +348,8 @@
      * Read the fixed feature status and enable registers, as all the cases
      * depend on their values.  Ignore errors here.
      */
-    (void) AcpiHwRegisterRead (ACPI_MTX_DO_NOT_LOCK, ACPI_REGISTER_PM1_STATUS,
-                &amp;FixedStatus);
-    (void) AcpiHwRegisterRead (ACPI_MTX_DO_NOT_LOCK, ACPI_REGISTER_PM1_ENABLE,
-                &amp;FixedEnable);
+    (void) AcpiHwRegisterRead (ACPI_REGISTER_PM1_STATUS, &amp;FixedStatus);
+    (void) AcpiHwRegisterRead (ACPI_REGISTER_PM1_ENABLE, &amp;FixedEnable);
 
     ACPI_DEBUG_PRINT ((ACPI_DB_INTERRUPTS,

[... truncated: 3443 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009914.html">[Haiku-commits] r26180 - haiku/vendor/acpica
</A></li>
	<LI>Next message: <A HREF="009916.html">[Haiku-commits] r26182 - haiku/trunk/headers/os/bluetooth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9915">[ date ]</a>
              <a href="thread.html#9915">[ thread ]</a>
              <a href="subject.html#9915">[ subject ]</a>
              <a href="author.html#9915">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
