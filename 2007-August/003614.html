<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r22003 - in haiku/trunk/src/servers/app: . drawing	drawing/Painter drawing/Painter/drawing_modes
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22003%20-%20in%20haiku/trunk/src/servers/app%3A%20.%20drawing%0A%09drawing/Painter%20drawing/Painter/drawing_modes&In-Reply-To=%3C200708171256.l7HCuOcQ026706%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003613.html">
   <LINK REL="Next"  HREF="003615.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r22003 - in haiku/trunk/src/servers/app: . drawing	drawing/Painter drawing/Painter/drawing_modes</H1>
    <B>stippi at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22003%20-%20in%20haiku/trunk/src/servers/app%3A%20.%20drawing%0A%09drawing/Painter%20drawing/Painter/drawing_modes&In-Reply-To=%3C200708171256.l7HCuOcQ026706%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r22003 - in haiku/trunk/src/servers/app: . drawing	drawing/Painter drawing/Painter/drawing_modes">stippi at mail.berlios.de
       </A><BR>
    <I>Fri Aug 17 14:56:24 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003613.html">[Haiku-commits] r22002 - haiku/trunk/src/preferences/fonts
</A></li>
        <LI>Next message: <A HREF="003615.html">[Haiku-commits] r22004 - in haiku/trunk/src: apps/terminal	system/kernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3614">[ date ]</a>
              <a href="thread.html#3614">[ thread ]</a>
              <a href="subject.html#3614">[ subject ]</a>
              <a href="author.html#3614">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: stippi
Date: 2007-08-17 14:56:20 +0200 (Fri, 17 Aug 2007)
New Revision: 22003
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=22003&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=22003&amp;view=rev</A>

Modified:
   haiku/trunk/src/servers/app/Decorator.cpp
   haiku/trunk/src/servers/app/Decorator.h
   haiku/trunk/src/servers/app/DefaultDecorator.cpp
   haiku/trunk/src/servers/app/DefaultDecorator.h
   haiku/trunk/src/servers/app/Desktop.cpp
   haiku/trunk/src/servers/app/DrawState.cpp
   haiku/trunk/src/servers/app/DrawState.h
   haiku/trunk/src/servers/app/ServerApp.cpp
   haiku/trunk/src/servers/app/ServerBitmap.h
   haiku/trunk/src/servers/app/ServerPicture.cpp
   haiku/trunk/src/servers/app/ServerWindow.cpp
   haiku/trunk/src/servers/app/ViewLayer.cpp
   haiku/trunk/src/servers/app/ViewLayer.h
   haiku/trunk/src/servers/app/WindowLayer.cpp
   haiku/trunk/src/servers/app/WindowLayer.h
   haiku/trunk/src/servers/app/Workspace.cpp
   haiku/trunk/src/servers/app/Workspace.h
   haiku/trunk/src/servers/app/WorkspacePrivate.h
   haiku/trunk/src/servers/app/WorkspacesLayer.cpp
   haiku/trunk/src/servers/app/WorkspacesLayer.h
   haiku/trunk/src/servers/app/drawing/AccelerantHWInterface.cpp
   haiku/trunk/src/servers/app/drawing/AccelerantHWInterface.h
   haiku/trunk/src/servers/app/drawing/DWindowHWInterface.cpp
   haiku/trunk/src/servers/app/drawing/DWindowHWInterface.h
   haiku/trunk/src/servers/app/drawing/DrawingEngine.cpp
   haiku/trunk/src/servers/app/drawing/DrawingEngine.h
   haiku/trunk/src/servers/app/drawing/HWInterface.h
   haiku/trunk/src/servers/app/drawing/Overlay.cpp
   haiku/trunk/src/servers/app/drawing/Overlay.h
   haiku/trunk/src/servers/app/drawing/Painter/Painter.cpp
   haiku/trunk/src/servers/app/drawing/Painter/Painter.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAdd.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaCC.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaCO.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaCOSolid.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaPC.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaPO.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeBlend.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeCopy.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeCopyText.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeErase.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeMax.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeMin.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeOver.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeSelect.h
   haiku/trunk/src/servers/app/drawing/Painter/drawing_modes/DrawingModeSubtract.h
   haiku/trunk/src/servers/app/drawing/PatternHandler.cpp
   haiku/trunk/src/servers/app/drawing/PatternHandler.h
Log:
* get rid of RGBColor usage where it is not needed, this simplified many things,
  possibly making them a little faster too
* mess with decorator button size calculation to make the whole layout scale
  more agreeable with the font size (no more fixed offsets/insets), but it
  is work in progress
* DefaultDecorator no longer allocated the border color array, it is part of
  the object now
* small memory footprint optimizations in ViewLayer, Decorator and WindowLayer


Modified: haiku/trunk/src/servers/app/Decorator.cpp
===================================================================
--- haiku/trunk/src/servers/app/Decorator.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/Decorator.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -482,7 +482,7 @@
 }
 
 
-RGBColor
+rgb_color
 Decorator::UIColor(color_which which)
 {
 	// TODO: for now - calling ui_color() from within the app_server

Modified: haiku/trunk/src/servers/app/Decorator.h
===================================================================
--- haiku/trunk/src/servers/app/Decorator.h	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/Decorator.h	2007-08-17 12:56:20 UTC (rev 22003)
@@ -116,7 +116,7 @@
 	virtual	void				DrawTitle();
 	virtual	void				DrawZoom();
 
-			RGBColor			UIColor(color_which which);
+			rgb_color			UIColor(color_which which);
 
  protected:
 			int32				_TitleWidth() const
@@ -149,11 +149,11 @@
 			BRect				fBorderRect;
 
  private:
-			bool				fClosePressed;
-			bool				fZoomPressed;
-			bool				fMinimizePressed;
+			bool				fClosePressed : 1;
+			bool				fZoomPressed : 1;
+			bool				fMinimizePressed : 1;
 
-			bool				fIsFocused;
+			bool				fIsFocused : 1;
 
 			BString				fTitle;
 };

Modified: haiku/trunk/src/servers/app/DefaultDecorator.cpp
===================================================================
--- haiku/trunk/src/servers/app/DefaultDecorator.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/DefaultDecorator.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -17,7 +17,6 @@
 #include &quot;DrawState.h&quot;
 #include &quot;FontManager.h&quot;
 #include &quot;PatternHandler.h&quot;
-#include &quot;RGBColor.h&quot;
 
 #include &lt;WindowPrivate.h&gt;
 
@@ -90,13 +89,12 @@
 {
 	DefaultDecorator::SetLook(settings, look);
 
-	fFrameColors = new RGBColor[6];
-	fFrameColors[0].SetColor(152, 152, 152);
-	fFrameColors[1].SetColor(255, 255, 255);
-	fFrameColors[2].SetColor(216, 216, 216);
-	fFrameColors[3].SetColor(136, 136, 136);
-	fFrameColors[4].SetColor(152, 152, 152);
-	fFrameColors[5].SetColor(96, 96, 96);
+	fFrameColors[0] = (rgb_color){ 152, 152, 152, 255 };
+	fFrameColors[1] = (rgb_color){ 255, 255, 255, 255 };
+	fFrameColors[2] = (rgb_color){ 216, 216, 216, 255 };
+	fFrameColors[3] = (rgb_color){ 136, 136, 136, 255 };
+	fFrameColors[4] = (rgb_color){ 152, 152, 152, 255 };
+	fFrameColors[5] = (rgb_color){ 96, 96, 96, 255 };
 
 	// Set appropriate colors based on the current focus value. In this case, each decorator
 	// defaults to not having the focus.
@@ -116,7 +114,6 @@
 DefaultDecorator::~DefaultDecorator()
 {
 	STRACE((&quot;DefaultDecorator: ~DefaultDecorator()\n&quot;));
-	delete [] fFrameColors;
 }
 
 
@@ -605,21 +602,23 @@
 	if (hasTab) {
 		// distance from one item of the tab bar to another.
 		// In this case the text and close/zoom rects
-		fTextOffset = (fLook == B_FLOATING_WINDOW_LOOK || fLook == kLeftTitledWindowLook)
-			? 10 : 18;
+		fTextOffset = (fLook == B_FLOATING_WINDOW_LOOK
+			|| fLook == kLeftTitledWindowLook) ? 10 : 18;
 
 		font_height fontHeight;
 		fDrawState.Font().GetHeight(fontHeight);
 
 		if (fLook != kLeftTitledWindowLook) {
 			fTabRect.Set(fFrame.left - fBorderWidth,
-				fFrame.top - fBorderWidth - ceilf(fontHeight.ascent + fontHeight.descent + 7.0),
+				fFrame.top - fBorderWidth
+					- ceilf(fontHeight.ascent + fontHeight.descent + 7.0),
 				((fFrame.right - fFrame.left) &lt; 35.0 ?
 					fFrame.left + 35.0 : fFrame.right) + fBorderWidth,
 				fFrame.top - fBorderWidth);
 		} else {
-			fTabRect.Set(fFrame.left - fBorderWidth - ceilf(fontHeight.ascent + fontHeight.descent + 5.0),
-				fFrame.top - fBorderWidth, fFrame.left - fBorderWidth,
+			fTabRect.Set(fFrame.left - fBorderWidth
+				- ceilf(fontHeight.ascent + fontHeight.descent + 5.0),
+					fFrame.top - fBorderWidth, fFrame.left - fBorderWidth,
 				fFrame.bottom + fBorderWidth);
 		}
 
@@ -631,10 +630,11 @@
 
 		float offset;
 		float size;
-		_GetButtonSizeAndOffset(fTabRect, &amp;offset, &amp;size);
+		float inset;
+		_GetButtonSizeAndOffset(fTabRect, &amp;offset, &amp;size, &amp;inset);
 
 		// fMinTabSize contains just the room for the buttons
-		fMinTabSize = 4.0 + fTextOffset;
+		fMinTabSize = inset * 2 + fTextOffset;
 		if ((fFlags &amp; B_NOT_CLOSABLE) == 0)
 			fMinTabSize += offset + size;
 		if ((fFlags &amp; B_NOT_ZOOMABLE) == 0)
@@ -701,8 +701,10 @@
 		if (fTabOffset &lt; 0)
 			fTabOffset = 0;
 		if (fTabLocation != 0.0
-			&amp;&amp; fTabOffset &gt; (fRightBorder.right - fLeftBorder.left - fTabRect.Width()))
-			fTabOffset = uint32(fRightBorder.right - fLeftBorder.left - fTabRect.Width());
+			&amp;&amp; fTabOffset &gt; (fRightBorder.right - fLeftBorder.left
+				- fTabRect.Width()))
+			fTabOffset = uint32(fRightBorder.right - fLeftBorder.left
+				- fTabRect.Width());
 		fTabRect.OffsetBy(fTabOffset, 0);
 
 		// finally, layout the buttons and text within the tab rect
@@ -737,38 +739,38 @@
 			if (invalid.Intersects(fTopBorder)) {
 				for (int8 i = 0; i &lt; 5; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.left + i, r.top + i),
-										BPoint(r.right - i, r.top + i),
-										fFrameColors[i]);
+						BPoint(r.right - i, r.top + i), fFrameColors[i]);
 				}
 				if (fTabRect.IsValid()) {
-					// grey along the bottom of the tab (overwrites &quot;white&quot; from frame)
-					fDrawingEngine-&gt;StrokeLine(BPoint(fTabRect.left + 2, fTabRect.bottom + 1),
-										BPoint(fTabRect.right - 2, fTabRect.bottom + 1),
-										fFrameColors[2]);
+					// grey along the bottom of the tab
+					// (overwrites &quot;white&quot; from frame)
+					fDrawingEngine-&gt;StrokeLine(
+						BPoint(fTabRect.left + 2, fTabRect.bottom + 1),
+						BPoint(fTabRect.right - 2, fTabRect.bottom + 1),
+						fFrameColors[2]);
 				}
 			}
 			// left
 			if (invalid.Intersects(fLeftBorder.InsetByCopy(0, -fBorderWidth))) {
 				for (int8 i = 0; i &lt; 5; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.left + i, r.top + i),
-										BPoint(r.left + i, r.bottom - i),
-										fFrameColors[i]);
+						BPoint(r.left + i, r.bottom - i), fFrameColors[i]);
 				}
 			}
 			// bottom
 			if (invalid.Intersects(fBottomBorder)) {
 				for (int8 i = 0; i &lt; 5; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.left + i, r.bottom - i),
-										BPoint(r.right - i, r.bottom - i),
-										fFrameColors[(4 - i) == 4 ? 5 : (4 - i)]);
+						BPoint(r.right - i, r.bottom - i),
+						fFrameColors[(4 - i) == 4 ? 5 : (4 - i)]);
 				}
 			}
 			// right
 			if (invalid.Intersects(fRightBorder.InsetByCopy(0, -fBorderWidth))) {
 				for (int8 i = 0; i &lt; 5; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.right - i, r.top + i),
-										BPoint(r.right - i, r.bottom - i),
-										fFrameColors[(4 - i) == 4 ? 5 : (4 - i)]);
+						BPoint(r.right - i, r.bottom - i),
+						fFrameColors[(4 - i) == 4 ? 5 : (4 - i)]);
 				}
 			}
 			break;
@@ -781,44 +783,46 @@
 			if (invalid.Intersects(fTopBorder)) {
 				for (int8 i = 0; i &lt; 3; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.left + i, r.top + i),
-										BPoint(r.right - i, r.top + i),
-										fFrameColors[i * 2]);
+						BPoint(r.right - i, r.top + i), fFrameColors[i * 2]);
 				}
 				if (fTabRect.IsValid() &amp;&amp; fLook != kLeftTitledWindowLook) {
-					// grey along the bottom of the tab (overwrites &quot;white&quot; from frame)
-					fDrawingEngine-&gt;StrokeLine(BPoint(fTabRect.left + 2, fTabRect.bottom + 1),
-										BPoint(fTabRect.right - 2, fTabRect.bottom + 1),
-										fFrameColors[2]);
+					// grey along the bottom of the tab
+					// (overwrites &quot;white&quot; from frame)
+					fDrawingEngine-&gt;StrokeLine(
+						BPoint(fTabRect.left + 2, fTabRect.bottom + 1),
+						BPoint(fTabRect.right - 2, fTabRect.bottom + 1),
+						fFrameColors[2]);
 				}
 			}
 			// left
 			if (invalid.Intersects(fLeftBorder.InsetByCopy(0, -fBorderWidth))) {
 				for (int8 i = 0; i &lt; 3; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.left + i, r.top + i),
-										BPoint(r.left + i, r.bottom - i),
-										fFrameColors[i * 2]);
+						BPoint(r.left + i, r.bottom - i), fFrameColors[i * 2]);
 				}
 				if (fLook == kLeftTitledWindowLook &amp;&amp; fTabRect.IsValid()) {
-					// grey along the right side of the tab (overwrites &quot;white&quot; from frame)
-					fDrawingEngine-&gt;StrokeLine(BPoint(fTabRect.right + 1, fTabRect.top + 2),
-										BPoint(fTabRect.right + 1, fTabRect.bottom - 2),
-										fFrameColors[2]);
+					// grey along the right side of the tab
+					// (overwrites &quot;white&quot; from frame)
+					fDrawingEngine-&gt;StrokeLine(
+						BPoint(fTabRect.right + 1, fTabRect.top + 2),
+						BPoint(fTabRect.right + 1, fTabRect.bottom - 2),
+						fFrameColors[2]);
 				}
 			}
 			// bottom
 			if (invalid.Intersects(fBottomBorder)) {
 				for (int8 i = 0; i &lt; 3; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.left + i, r.bottom - i),
-										BPoint(r.right - i, r.bottom - i),
-										fFrameColors[(2 - i) == 2 ? 5 : (2 - i) * 2]);
+						BPoint(r.right - i, r.bottom - i),
+						fFrameColors[(2 - i) == 2 ? 5 : (2 - i) * 2]);
 				}
 			}
 			// right
 			if (invalid.Intersects(fRightBorder.InsetByCopy(0, -fBorderWidth))) {
 				for (int8 i = 0; i &lt; 3; i++) {
 					fDrawingEngine-&gt;StrokeLine(BPoint(r.right - i, r.top + i),
-										BPoint(r.right - i, r.bottom - i),
-										fFrameColors[(2 - i) == 2 ? 5 : (2 - i) * 2]);
+						BPoint(r.right - i, r.bottom - i),
+						fFrameColors[(2 - i) == 2 ? 5 : (2 - i) * 2]);
 				}
 			}
 			break;
@@ -846,23 +850,24 @@
 				float x = r.right - 3;
 				float y = r.bottom - 3;
 
-				fDrawingEngine-&gt;FillRect(BRect(x - 13, y - 13, x, y), fFrameColors[2]);
-				fDrawingEngine-&gt;StrokeLine(BPoint(x - 15, y - 15), BPoint(x - 15, y - 2),
-					fFrameColors[0]);
-				fDrawingEngine-&gt;StrokeLine(BPoint(x - 14, y - 14), BPoint(x - 14, y - 1),
-					fFrameColors[1]);
-				fDrawingEngine-&gt;StrokeLine(BPoint(x - 15, y - 15), BPoint(x - 2, y - 15),
-					fFrameColors[0]);
-				fDrawingEngine-&gt;StrokeLine(BPoint(x - 14, y - 14), BPoint(x - 1, y - 14),
-					fFrameColors[1]);
+				fDrawingEngine-&gt;FillRect(BRect(x - 13, y - 13, x, y),
+					fFrameColors[2]);
+				fDrawingEngine-&gt;StrokeLine(BPoint(x - 15, y - 15),
+					BPoint(x - 15, y - 2), fFrameColors[0]);
+				fDrawingEngine-&gt;StrokeLine(BPoint(x - 14, y - 14),
+					BPoint(x - 14, y - 1), fFrameColors[1]);
+				fDrawingEngine-&gt;StrokeLine(BPoint(x - 15, y - 15),
+					BPoint(x - 2, y - 15), fFrameColors[0]);
+				fDrawingEngine-&gt;StrokeLine(BPoint(x - 14, y - 14),
+					BPoint(x - 1, y - 14), fFrameColors[1]);
 
 				if (!IsFocus())
 					break;
 
 				for (int8 i = 1; i &lt;= 4; i++) {
 					for (int8 j = 1; j &lt;= i; j++) {
-						BPoint		pt1(x - (3 * j) + 1, y - (3 * (5 - i)) + 1);
-						BPoint		pt2(x - (3 * j) + 2, y - (3 * (5 - i)) + 2);
+						BPoint pt1(x - (3 * j) + 1, y - (3 * (5 - i)) + 1);
+						BPoint pt2(x - (3 * j) + 2, y - (3 * (5 - i)) + 2);
 						fDrawingEngine-&gt;StrokePoint(pt1, fFrameColors[0]);
 						fDrawingEngine-&gt;StrokePoint(pt2, fFrameColors[1]);
 					}
@@ -876,16 +881,18 @@
 			case kLeftTitledWindowLook:
 			{
 				if (!invalid.Intersects(BRect(fRightBorder.right - 22,
-						fBottomBorder.bottom - 22, fRightBorder.right - 1,
-						fBottomBorder.bottom - 1)))
+					fBottomBorder.bottom - 22, fRightBorder.right - 1,
+					fBottomBorder.bottom - 1)))
 					break;
 		
-				fDrawingEngine-&gt;StrokeLine(BPoint(fRightBorder.left, fBottomBorder.bottom - 22),
-									BPoint(fRightBorder.right - 1, fBottomBorder.bottom - 22),
-									fFrameColors[0]);
-				fDrawingEngine-&gt;StrokeLine(BPoint(fRightBorder.right - 22, fBottomBorder.top),
-									BPoint(fRightBorder.right - 22, fBottomBorder.bottom - 1),
-									fFrameColors[0]);
+				fDrawingEngine-&gt;StrokeLine(
+					BPoint(fRightBorder.left, fBottomBorder.bottom - 22),
+					BPoint(fRightBorder.right - 1, fBottomBorder.bottom - 22),
+					fFrameColors[0]);
+				fDrawingEngine-&gt;StrokeLine(
+					BPoint(fRightBorder.right - 22, fBottomBorder.top),
+					BPoint(fRightBorder.right - 22, fBottomBorder.bottom - 1),
+					fFrameColors[0]);
 				break;
 			}
 
@@ -908,26 +915,34 @@
 		return;
 
 	// outer frame
-	fDrawingEngine-&gt;StrokeLine(fTabRect.LeftTop(), fTabRect.LeftBottom(), fFrameColors[0]);
-	fDrawingEngine-&gt;StrokeLine(fTabRect.LeftTop(), fTabRect.RightTop(), fFrameColors[0]);
-	if (fLook != kLeftTitledWindowLook)
-		fDrawingEngine-&gt;StrokeLine(fTabRect.RightTop(),fTabRect.RightBottom(), fFrameColors[5]);
-	else
-		fDrawingEngine-&gt;StrokeLine(fTabRect.LeftBottom(),fTabRect.RightBottom(), fFrameColors[5]);
+	fDrawingEngine-&gt;StrokeLine(fTabRect.LeftTop(), fTabRect.LeftBottom(),
+		fFrameColors[0]);
+	fDrawingEngine-&gt;StrokeLine(fTabRect.LeftTop(), fTabRect.RightTop(),
+		fFrameColors[0]);
+	if (fLook != kLeftTitledWindowLook) {
+		fDrawingEngine-&gt;StrokeLine(fTabRect.RightTop(), fTabRect.RightBottom(),
+			fFrameColors[5]);
+	} else {
+		fDrawingEngine-&gt;StrokeLine(fTabRect.LeftBottom(),
+			fTabRect.RightBottom(), fFrameColors[5]);
+	}
 
 	// bevel
 	fDrawingEngine-&gt;StrokeLine(BPoint(fTabRect.left + 1, fTabRect.top + 1),
-		BPoint(fTabRect.left + 1, fTabRect.bottom - (fLook == kLeftTitledWindowLook ? 1 : 0)),
+		BPoint(fTabRect.left + 1,
+			fTabRect.bottom - (fLook == kLeftTitledWindowLook ? 1 : 0)),
 		fTabColorLight);
 	fDrawingEngine-&gt;StrokeLine(BPoint(fTabRect.left + 1, fTabRect.top + 1),
-		BPoint(fTabRect.right - (fLook == kLeftTitledWindowLook ? 0 : 1), fTabRect.top + 1),
+		BPoint(fTabRect.right - (fLook == kLeftTitledWindowLook ? 0 : 1),
+			fTabRect.top + 1),
 		fTabColorLight);
 
 	if (fLook != kLeftTitledWindowLook) {
 		fDrawingEngine-&gt;StrokeLine(BPoint(fTabRect.right - 1, fTabRect.top + 2),
 			BPoint(fTabRect.right - 1, fTabRect.bottom), fTabColorShadow);
 	} else {
-		fDrawingEngine-&gt;StrokeLine(BPoint(fTabRect.left + 2, fTabRect.bottom - 1),
+		fDrawingEngine-&gt;StrokeLine(
+			BPoint(fTabRect.left + 2, fTabRect.bottom - 1),
 			BPoint(fTabRect.right, fTabRect.bottom - 1), fTabColorShadow);
 	}
 
@@ -964,8 +979,8 @@
 {
 	STRACE((&quot;_DrawTitle(%f,%f,%f,%f)\n&quot;, r.left, r.top, r.right, r.bottom));
 
-	fDrawingEngine-&gt;SetHighColor(fTextColor.GetColor32());
-	fDrawingEngine-&gt;SetLowColor(fTabColor.GetColor32());
+	fDrawingEngine-&gt;SetHighColor(fTextColor);
+	fDrawingEngine-&gt;SetLowColor(fTabColor);
 	fDrawingEngine-&gt;SetFont(fDrawState.Font());
 
 	// figure out position of text
@@ -976,11 +991,13 @@
 	if (fLook != kLeftTitledWindowLook) {
 		titlePos.x = fCloseRect.IsValid() ? fCloseRect.right + fTextOffset
 			: fTabRect.left + fTextOffset;
-		titlePos.y = floorf(((fTabRect.top + 2.0) + fTabRect.bottom + fontHeight.ascent
-			+ fontHeight.descent) / 2.0 - fontHeight.descent + 0.5);
+		titlePos.y = floorf(((fTabRect.top + 2.0) + fTabRect.bottom
+			+ fontHeight.ascent + fontHeight.descent) / 2.0
+			- fontHeight.descent + 0.5);
 	} else {
-		titlePos.x = floorf(((fTabRect.left + 2.0) + fTabRect.right + fontHeight.ascent
-			+ fontHeight.descent) / 2.0 - fontHeight.descent + 0.5);
+		titlePos.x = floorf(((fTabRect.left + 2.0) + fTabRect.right
+			+ fontHeight.ascent + fontHeight.descent) / 2.0
+			- fontHeight.descent + 0.5);
 		titlePos.y = fZoomRect.IsValid() ? fZoomRect.top - fTextOffset
 			: fTabRect.bottom - fTextOffset;
 	}
@@ -1015,37 +1032,30 @@
 	// SetFocus() performs necessary duties for color swapping and
 	// other things when a window is deactivated or activated.
 	
-	if (IsFocus() || ((fLook == B_FLOATING_WINDOW_LOOK || fLook == kLeftTitledWindowLook)
-			&amp;&amp; (fFlags &amp; B_AVOID_FOCUS) != 0)) {
+	if (IsFocus()
+		|| ((fLook == B_FLOATING_WINDOW_LOOK || fLook == kLeftTitledWindowLook)
+		&amp;&amp; (fFlags &amp; B_AVOID_FOCUS) != 0)) {
 		fTabColor = UIColor(B_WINDOW_TAB_COLOR);
 		fTextColor = UIColor(B_WINDOW_TEXT_COLOR);
-		fButtonHighColor.SetColor(tint_color(fTabColor.GetColor32(), B_LIGHTEN_2_TINT));
-		fButtonLowColor.SetColor(tint_color(fTabColor.GetColor32(), B_DARKEN_1_TINT));
+		fButtonHighColor = tint_color(fTabColor, B_LIGHTEN_2_TINT);
+		fButtonLowColor = tint_color(fTabColor, B_DARKEN_1_TINT);
 
-//		fFrameColors[0].SetColor(152, 152, 152);
-//		fFrameColors[1].SetColor(255, 255, 255);
-		fFrameColors[2].SetColor(216, 216, 216);
-		fFrameColors[3].SetColor(136, 136, 136);
-//		fFrameColors[4].SetColor(152, 152, 152);
-//		fFrameColors[5].SetColor(96, 96, 96);
+		fFrameColors[2] = (rgb_color){ 216, 216, 216, 255 };
+		fFrameColors[3] = (rgb_color){ 136, 136, 136, 255 };
 	} else {
 		fTabColor = UIColor(B_WINDOW_INACTIVE_TAB_COLOR);
 		fTextColor = UIColor(B_WINDOW_INACTIVE_TEXT_COLOR);
-		fButtonHighColor.SetColor(tint_color(fTabColor.GetColor32(), B_LIGHTEN_2_TINT));
-		fButtonLowColor.SetColor(tint_color(fTabColor.GetColor32(), B_DARKEN_1_TINT));
+		fButtonHighColor = tint_color(fTabColor, B_LIGHTEN_2_TINT);
+		fButtonLowColor = tint_color(fTabColor, B_DARKEN_1_TINT);
 
-//		fFrameColors[0].SetColor(152, 152, 152);
-//		fFrameColors[1].SetColor(255, 255, 255);
-		fFrameColors[2].SetColor(232, 232, 232);
-		fFrameColors[3].SetColor(148, 148, 148);
-//		fFrameColors[4].SetColor(152, 152, 152);
-//		fFrameColors[5].SetColor(96, 96, 96);
+		fFrameColors[2] = (rgb_color){ 232, 232, 232, 255 };
+		fFrameColors[3] = (rgb_color){ 148, 148, 148, 255 };
 	}
 
-	fTabColorLight = RGBColor(tint_color(fTabColor.GetColor32(),
-		(B_LIGHTEN_2_TINT + B_LIGHTEN_MAX_TINT) / 2));
-	fTabColorShadow = RGBColor(tint_color(fTabColor.GetColor32(),
-		B_DARKEN_2_TINT));
+	fTabColorLight = tint_color(fTabColor,
+		(B_LIGHTEN_2_TINT + B_LIGHTEN_MAX_TINT) / 2);
+	fTabColorShadow = tint_color(fTabColor,
+		B_DARKEN_2_TINT);
 }
 
 // _SetColors
@@ -1067,18 +1077,18 @@
 	int32 w = r.IntegerWidth();
 	int32 h = r.IntegerHeight();
 
-	RGBColor temprgbcol;
+	rgb_color tempColor;
 	rgb_color halfColor, startColor, endColor;
 	float rstep, gstep, bstep;
 
 	int steps = w &lt; h ? w : h;
 
 	if (down) {
-		startColor = fButtonLowColor.GetColor32();
-		endColor = fButtonHighColor.GetColor32();
+		startColor = fButtonLowColor;
+		endColor = fButtonHighColor;
 	} else {
-		startColor = fButtonHighColor.GetColor32();
-		endColor = fButtonLowColor.GetColor32();
+		startColor = fButtonHighColor;
+		endColor = fButtonLowColor;
 	}
 
 	halfColor = make_blend_color(startColor, endColor, 0.5);
@@ -1088,19 +1098,19 @@
 	bstep = float(startColor.blue - halfColor.blue) / steps;
 
 	for (int32 i = 0; i &lt;= steps; i++) {
-		temprgbcol.SetColor(uint8(startColor.red - (i * rstep)),
-							uint8(startColor.green - (i * gstep)),
-							uint8(startColor.blue - (i * bstep)));
+		tempColor.red = uint8(startColor.red - (i * rstep));
+		tempColor.green = uint8(startColor.green - (i * gstep));
+		tempColor.blue = uint8(startColor.blue - (i * bstep));
 		
 		fDrawingEngine-&gt;StrokeLine(BPoint(r.left, r.top + i),
-							BPoint(r.left + i, r.top), temprgbcol);
+			BPoint(r.left + i, r.top), tempColor);
 
-		temprgbcol.SetColor(uint8(halfColor.red - (i * rstep)),
-							uint8(halfColor.green - (i * gstep)),
-							uint8(halfColor.blue - (i * bstep)));
+		tempColor.red = uint8(halfColor.red - (i * rstep));
+		tempColor.green = uint8(halfColor.green - (i * gstep));
+		tempColor.blue = uint8(halfColor.blue - (i * bstep));
 
 		fDrawingEngine-&gt;StrokeLine(BPoint(r.left + steps, r.top + i),
-							BPoint(r.left + i, r.top + steps), temprgbcol);
+			BPoint(r.left + i, r.top + steps), tempColor);
 	}
 	fDrawingEngine-&gt;StrokeRect(r, fFrameColors[3]);
 }
@@ -1108,16 +1118,23 @@
 // _GetButtonSizeAndOffset
 void
 DefaultDecorator::_GetButtonSizeAndOffset(const BRect&amp; tabRect, float* _offset,
-	float* _size) const
+	float* _size, float* _inset) const
 {
-	*_offset = fLook == B_FLOATING_WINDOW_LOOK || fLook == kLeftTitledWindowLook ? 4.0 : 5.0;
+	float tabSize = fLook == kLeftTitledWindowLook ?
+		tabRect.Width() : tabRect.Height();
 
+	bool smallTab = fLook == B_FLOATING_WINDOW_LOOK
+		|| fLook == kLeftTitledWindowLook;
+
+	*_offset = smallTab ? floorf(fDrawState.Font().Size() / 2.5)
+		: floorf(fDrawState.Font().Size() / 2.0);
+	*_inset = smallTab ? floorf(fDrawState.Font().Size() / 5.0)
+		: floorf(fDrawState.Font().Size() / 6.0);
+printf(&quot;&quot;);
+
 	// &quot;+ 2&quot; so that the rects are centered within the solid area
 	// (without the 2 pixels for the top border)
-	if (fLook != kLeftTitledWindowLook)
-		*_size = tabRect.Height() - 2.0 * *_offset + 2.0f;
-	else
-		*_size = tabRect.Width() - 2.0 * *_offset + 2.0f;
+	*_size = tabSize - *_inset * *_offset + *_inset;
 }
 
 // _LayoutTabItems
@@ -1126,7 +1143,8 @@
 {
 	float offset;
 	float size;
-	_GetButtonSizeAndOffset(tabRect, &amp;offset, &amp;size);
+	float inset;
+	_GetButtonSizeAndOffset(tabRect, &amp;offset, &amp;size, &amp;inset);
 
 	// calulate close rect based on the tab rectangle
 	if (fLook != kLeftTitledWindowLook) {
@@ -1160,9 +1178,9 @@
 	//	truncated for no apparent reason - OTOH the title does
 	//	also not appear perfectly in the middle
 	if (fLook != kLeftTitledWindowLook)
-		size = (fZoomRect.left - fCloseRect.right) - fTextOffset * 2 + 2;
+		size = (fZoomRect.left - fCloseRect.right) - fTextOffset * 2 + inset;
 	else
-		size = (fZoomRect.top - fCloseRect.bottom) - fTextOffset * 2 + 2;
+		size = (fZoomRect.top - fCloseRect.bottom) - fTextOffset * 2 + inset;
 
 	fTruncatedTitle = Title();
 	fDrawState.Font().TruncateString(&amp;fTruncatedTitle, B_TRUNCATE_END, size);

Modified: haiku/trunk/src/servers/app/DefaultDecorator.h
===================================================================
--- haiku/trunk/src/servers/app/DefaultDecorator.h	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/DefaultDecorator.h	2007-08-17 12:56:20 UTC (rev 22003)
@@ -19,43 +19,40 @@
 class DefaultDecorator: public Decorator {
  public:
 								DefaultDecorator(DesktopSettings&amp; settings,
-												 BRect frame,
-												 window_look look,
-												 uint32 flags);
+									BRect frame, window_look look,
+									uint32 flags);
 	virtual						~DefaultDecorator();
 
 	virtual	void				SetTitle(const char* string,
-										 BRegion* updateRegion = NULL);
+									BRegion* updateRegion = NULL);
 	virtual void				SetLook(DesktopSettings&amp; settings,
-										window_look look,
-										BRegion* updateRegion = NULL);
+									window_look look,
+									BRegion* updateRegion = NULL);
 	virtual void				SetFlags(uint32 flags,
-										 BRegion* updateRegion = NULL);
+									BRegion* updateRegion = NULL);
 
 	virtual	void				MoveBy(BPoint offset);
 	virtual	void				ResizeBy(BPoint offset, BRegion* dirty);
 
 	virtual bool				SetTabLocation(float location,
-											   BRegion* updateRegion = NULL);
+									BRegion* updateRegion = NULL);
 	virtual float				TabLocation() const
 									{ return (float)fTabOffset; }
 
 	virtual	bool				SetSettings(const BMessage&amp; settings,
-											BRegion* updateRegion = NULL);
+									BRegion* updateRegion = NULL);
 	virtual	bool				GetSettings(BMessage* settings) const;
 
 	virtual	void				Draw(BRect updateRect);
 	virtual	void				Draw();
 
-	virtual	void				GetSizeLimits(int32* minWidth,
-											  int32* minHeight,
-											  int32* maxWidth,
-											  int32* maxHeight) const;
+	virtual	void				GetSizeLimits(int32* minWidth, int32* minHeight,
+									int32* maxWidth, int32* maxHeight) const;
 
 	virtual	void				GetFootprint(BRegion* region);
 
 	virtual	click_type			Clicked(BPoint pt, int32 buttons,
-										int32 modifiers);
+									int32 modifiers);
 
  protected:
 	virtual void				_DoLayout();
@@ -73,18 +70,18 @@
  private:
 			void				_DrawBlendedRect(BRect r, bool down);
 			void				_GetButtonSizeAndOffset(const BRect&amp; tabRect,
-														float* offset,
-														float*size) const;
+									float* offset, float* size,
+									float* inset) const;
 			void				_LayoutTabItems(const BRect&amp; tabRect);
 
-			RGBColor			fButtonHighColor;
-			RGBColor			fButtonLowColor;
-			RGBColor			fTextColor;
-			RGBColor			fTabColor;
-			RGBColor			fTabColorLight;
-			RGBColor			fTabColorShadow;
+			rgb_color			fButtonHighColor;
+			rgb_color			fButtonLowColor;
+			rgb_color			fTextColor;
+			rgb_color			fTabColor;
+			rgb_color			fTabColorLight;
+			rgb_color			fTabColorShadow;
 
-			RGBColor*			fFrameColors;
+			rgb_color			fFrameColors[6];
 	
 			// Individual rects for handling window frame
 			// rendering the proper way

Modified: haiku/trunk/src/servers/app/Desktop.cpp
===================================================================
--- haiku/trunk/src/servers/app/Desktop.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/Desktop.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -799,7 +799,7 @@
 Desktop::_SetWorkspace(int32 index)
 {
 	int32 previousIndex = fCurrentWorkspace;
-	RGBColor previousColor = fWorkspaces[fCurrentWorkspace].Color();
+	rgb_color previousColor = fWorkspaces[fCurrentWorkspace].Color();
 	bool movedMouseEventWindow = false;
 
 	if (fMouseEventWindow != NULL) {

Modified: haiku/trunk/src/servers/app/DrawState.cpp
===================================================================
--- haiku/trunk/src/servers/app/DrawState.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/DrawState.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -27,8 +27,8 @@
 	: fOrigin(0.0, 0.0),
 	  fScale(1.0),
 	  fClippingRegion(NULL),
-	  fHighColor(0, 0, 0, 255),
-	  fLowColor(255, 255, 255, 255),
+	  fHighColor((rgb_color){ 0, 0, 0, 255 }),
+	  fLowColor((rgb_color){ 255, 255, 255, 255 }),
 	  fPattern(kSolidHigh),
 	  fDrawingMode(B_OP_COPY),
 	  fAlphaSrcMode(B_PIXEL_ALPHA),
@@ -253,8 +253,8 @@
 	// Attach view state
 	link.Attach&lt;BPoint&gt;(fPenLocation);
 	link.Attach&lt;float&gt;(fPenSize);
-	link.Attach&lt;rgb_color&gt;(fHighColor.GetColor32());
-	link.Attach&lt;rgb_color&gt;(fLowColor.GetColor32());
+	link.Attach&lt;rgb_color&gt;(fHighColor);
+	link.Attach&lt;rgb_color&gt;(fLowColor);
 	link.Attach&lt;uint64&gt;(fPattern.GetInt64());
 	link.Attach&lt;BPoint&gt;(fOrigin);
 	link.Attach&lt;uint8&gt;((uint8)fDrawingMode);
@@ -434,14 +434,14 @@
 
 
 void
-DrawState::SetHighColor(const RGBColor&amp; color)
+DrawState::SetHighColor(const rgb_color&amp; color)
 {
 	fHighColor = color;
 }
 
 
 void
-DrawState::SetLowColor(const RGBColor&amp; color)
+DrawState::SetLowColor(const rgb_color&amp; color)
 {
 	fLowColor = color;
 }
@@ -606,8 +606,10 @@
 	printf(&quot;\t Pen Location and Size: (%.1f, %.1f) - %.2f (%.2f)\n&quot;,
 		   fPenLocation.x, fPenLocation.y, PenSize(), fPenSize);
 
-	printf(&quot;\t HighColor: &quot;); fHighColor.PrintToStream();
-	printf(&quot;\t LowColor: &quot;); fLowColor.PrintToStream();
+	printf(&quot;\t HighColor: r=%d g=%d b=%d a=%d\n&quot;,
+		fHighColor.red, fHighColor.green, fHighColor.blue, fHighColor.alpha);
+	printf(&quot;\t LowColor: r=%d g=%d b=%d a=%d\n&quot;,
+		fLowColor.red, fLowColor.green, fLowColor.blue, fLowColor.alpha);
 	printf(&quot;\t Pattern: %llu\n&quot;, fPattern.GetInt64());
 
 	printf(&quot;\t DrawMode: %lu\n&quot;, (uint32)fDrawingMode);

Modified: haiku/trunk/src/servers/app/DrawState.h
===================================================================
--- haiku/trunk/src/servers/app/DrawState.h	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/DrawState.h	2007-08-17 12:56:20 UTC (rev 22003)
@@ -17,7 +17,6 @@
 #include &lt;Point.h&gt;
 #include &lt;View.h&gt; // for B_FONT_ALL
 
-#include &quot;RGBColor.h&quot;
 #include &quot;FontManager.h&quot;
 #include &quot;ServerFont.h&quot;
 #include &quot;PatternHandler.h&quot;
@@ -78,12 +77,12 @@
 	inline	BRect				ClippingRectAt(int32 index) const;*/
 
 							// color
-		void				SetHighColor(const RGBColor&amp; color);
-		const RGBColor&amp;		HighColor() const
+		void				SetHighColor(const rgb_color&amp; color);
+		const rgb_color&amp;	HighColor() const
 								{ return fHighColor; }
 
-		void				SetLowColor(const RGBColor&amp; color);
-		const RGBColor&amp;		LowColor() const
+		void				SetLowColor(const rgb_color&amp; color);
+		const rgb_color&amp;		LowColor() const
 								{ return fLowColor; }
 
 		void				SetPattern(const Pattern&amp; pattern);
@@ -147,8 +146,8 @@
 
 		BRegion*			fClippingRegion;
 
-		RGBColor			fHighColor;
-		RGBColor			fLowColor;
+		rgb_color			fHighColor;
+		rgb_color			fLowColor;
 		Pattern				fPattern;
 
 		drawing_mode		fDrawingMode;

Modified: haiku/trunk/src/servers/app/ServerApp.cpp
===================================================================
--- haiku/trunk/src/servers/app/ServerApp.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/ServerApp.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -2231,7 +2231,7 @@
 				index = fDesktop-&gt;CurrentWorkspace();
 
 			Workspace workspace(*fDesktop, index);
-			fLink.Attach&lt;rgb_color&gt;(workspace.Color().GetColor32());
+			fLink.Attach&lt;rgb_color&gt;(workspace.Color());
 
 			fDesktop-&gt;Unlock();
 			fLink.Flush();

Modified: haiku/trunk/src/servers/app/ServerBitmap.h
===================================================================
--- haiku/trunk/src/servers/app/ServerBitmap.h	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/ServerBitmap.h	2007-08-17 12:56:20 UTC (rev 22003)
@@ -10,8 +10,6 @@
 #define SERVER_BITMAP_H
 
 
-#include &quot;RGBColor.h&quot;
-
 #include &lt;GraphicsDefs.h&gt;
 #include &lt;Rect.h&gt;
 #include &lt;OS.h&gt;

Modified: haiku/trunk/src/servers/app/ServerPicture.cpp
===================================================================
--- haiku/trunk/src/servers/app/ServerPicture.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/ServerPicture.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -548,7 +548,7 @@
 static void
 set_fore_color(ViewLayer *view, rgb_color color)
 {
-	view-&gt;CurrentState()-&gt;SetHighColor(RGBColor(color));
+	view-&gt;CurrentState()-&gt;SetHighColor(color);
 	view-&gt;Window()-&gt;GetDrawingEngine()-&gt;SetHighColor(color);
 }
 
@@ -556,7 +556,7 @@
 static void
 set_back_color(ViewLayer *view, rgb_color color)
 {
-	view-&gt;CurrentState()-&gt;SetLowColor(RGBColor(color));
+	view-&gt;CurrentState()-&gt;SetLowColor(color);
 	view-&gt;Window()-&gt;GetDrawingEngine()-&gt;SetLowColor(color);
 }
 
@@ -823,8 +823,8 @@
 	//WriteSetPattern(*view-&gt;CurrentState()-&gt;GetPattern().GetInt8());
 	WriteSetDrawingMode(view-&gt;CurrentState()-&gt;GetDrawingMode());
 	
-	WriteSetHighColor(view-&gt;CurrentState()-&gt;HighColor().GetColor32());
-	WriteSetLowColor(view-&gt;CurrentState()-&gt;LowColor().GetColor32());
+	WriteSetHighColor(view-&gt;CurrentState()-&gt;HighColor());
+	WriteSetLowColor(view-&gt;CurrentState()-&gt;LowColor());
 
 	ExitStateChange();
 }

Modified: haiku/trunk/src/servers/app/ServerWindow.cpp
===================================================================
--- haiku/trunk/src/servers/app/ServerWindow.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/ServerWindow.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -1586,7 +1586,7 @@
 			
 			link.Read(&amp;c, sizeof(rgb_color));
 
-			fCurrentLayer-&gt;SetViewColor(RGBColor(c));
+			fCurrentLayer-&gt;SetViewColor(c);
 			break;
 		}
 
@@ -1595,7 +1595,7 @@
 				Title(), fCurrentLayer-&gt;Name()));
 
 			fLink.StartMessage(B_OK);
-			fLink.Attach&lt;rgb_color&gt;(fCurrentLayer-&gt;CurrentState()-&gt;HighColor().GetColor32());
+			fLink.Attach&lt;rgb_color&gt;(fCurrentLayer-&gt;CurrentState()-&gt;HighColor());
 			fLink.Flush();
 			break;
 
@@ -1604,7 +1604,7 @@
 				Title(), fCurrentLayer-&gt;Name()));
 
 			fLink.StartMessage(B_OK);
-			fLink.Attach&lt;rgb_color&gt;(fCurrentLayer-&gt;CurrentState()-&gt;LowColor().GetColor32());
+			fLink.Attach&lt;rgb_color&gt;(fCurrentLayer-&gt;CurrentState()-&gt;LowColor());
 			fLink.Flush();
 			break;
 
@@ -1613,7 +1613,7 @@
 				Title(), fCurrentLayer-&gt;Name()));
 
 			fLink.StartMessage(B_OK);
-			fLink.Attach&lt;rgb_color&gt;(fCurrentLayer-&gt;ViewColor().GetColor32());
+			fLink.Attach&lt;rgb_color&gt;(fCurrentLayer-&gt;ViewColor());
 			fLink.Flush();
 			break;
 
@@ -1699,7 +1699,7 @@
 
 					if (bitmap != NULL &amp;&amp; bitmap-&gt;Overlay() != NULL) {
 						bitmap-&gt;Overlay()-&gt;SetFlags(options);
-						colorKey = bitmap-&gt;Overlay()-&gt;Color().GetColor32();
+						colorKey = bitmap-&gt;Overlay()-&gt;Color();
 					}
 				} else
 					status = B_BAD_VALUE;
@@ -1849,7 +1849,7 @@
 			rgb_color c;
 			link.Read(&amp;c, sizeof(rgb_color));
 			
-			fCurrentLayer-&gt;CurrentState()-&gt;SetHighColor(RGBColor(c));
+			fCurrentLayer-&gt;CurrentState()-&gt;SetHighColor(c);
 			fWindowLayer-&gt;GetDrawingEngine()-&gt;SetHighColor(c);
 			break;
 		}
@@ -1860,7 +1860,7 @@
 			rgb_color c;
 			link.Read(&amp;c, sizeof(rgb_color));
 
-			fCurrentLayer-&gt;CurrentState()-&gt;SetLowColor(RGBColor(c));
+			fCurrentLayer-&gt;CurrentState()-&gt;SetLowColor(c);
 			fWindowLayer-&gt;GetDrawingEngine()-&gt;SetLowColor(c);
 			break;
 		}

Modified: haiku/trunk/src/servers/app/ViewLayer.cpp
===================================================================
--- haiku/trunk/src/servers/app/ViewLayer.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/ViewLayer.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -80,7 +80,7 @@
 	fFrame(frame),
 	fScrollingOffset(scrollingOffset),
 
-	fViewColor(RGBColor(255, 255, 255)),
+	fViewColor((rgb_color){ 255, 255, 255, 255 }),
 	fDrawState(new (nothrow) DrawState),
 	fViewBitmap(NULL),
 
@@ -1175,7 +1175,7 @@
 		return;
 	}
 
-	if (fViewBitmap != NULL || !fViewColor.IsTransparentMagic()) {
+	if (fViewBitmap != NULL || fViewColor != B_TRANSPARENT_COLOR) {
 		// we can only draw within our own area
 		BRegion* redraw = fWindow-&gt;GetRegion(ScreenClipping(windowContentClipping));
 		if (!redraw)
@@ -1265,7 +1265,7 @@
 
 		}
 
-		if (!fViewColor.IsTransparentMagic()) {
+		if (fViewColor != B_TRANSPARENT_COLOR) {
 			// fill visible region with view color,
 			// this version of FillRegion ignores any
 			// clipping, that's why &quot;redraw&quot; needs to

Modified: haiku/trunk/src/servers/app/ViewLayer.h
===================================================================
--- haiku/trunk/src/servers/app/ViewLayer.h	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/ViewLayer.h	2007-08-17 12:56:20 UTC (rev 22003)
@@ -13,7 +13,6 @@
 #define VIEW_LAYER_H
 
 
-#include &quot;RGBColor.h&quot;
 #include &quot;IntRect.h&quot;
 
 #include &lt;GraphicsDefs.h&gt;
@@ -157,10 +156,8 @@
 
 			const BRegion&amp;	LocalClipping() const { return fLocalClipping; }
 
-			const RGBColor&amp;	ViewColor() const
+			const rgb_color&amp; ViewColor() const
 								{ return fViewColor; }
-			void			SetViewColor(const RGBColor&amp; color)
-								{ fViewColor = color; }
 			void			SetViewColor(const rgb_color&amp; color)
 								{ fViewColor = color; }
 
@@ -246,7 +243,7 @@
 			// scrolling offset
 			IntPoint		fScrollingOffset;
 
-			RGBColor		fViewColor;
+			rgb_color		fViewColor;
 			DrawState*		fDrawState;
 			ServerBitmap*	fViewBitmap;
 			IntRect			fBitmapSource;
@@ -256,10 +253,10 @@
 
 			uint32			fResizeMode;
 			uint32			fFlags;
-			bool			fHidden;
-			bool			fVisible;
-			bool			fBackgroundDirty;
-			bool			fIsDesktopBackground;
+			bool			fHidden : 1;
+			bool			fVisible : 1;
+			bool			fBackgroundDirty : 1;
+			bool			fIsDesktopBackground : 1;
 
 			uint32			fEventMask;
 			uint32			fEventOptions;

Modified: haiku/trunk/src/servers/app/WindowLayer.cpp
===================================================================
--- haiku/trunk/src/servers/app/WindowLayer.cpp	2007-08-17 12:13:32 UTC (rev 22002)
+++ haiku/trunk/src/servers/app/WindowLayer.cpp	2007-08-17 12:56:20 UTC (rev 22003)
@@ -374,7 +374,7 @@
 	if (fDecorator) {
 		fDecorator-&gt;ResizeBy(x, y, dirtyRegion);
 //if (dirtyRegion) {
-//fDrawingEngine-&gt;FillRegion(*dirtyRegion, RGBColor(255, 255, 0, 255));
+//fDrawingEngine-&gt;FillRegion(*dirtyRegion, (rgb_color){ 255, 255, 0, 255 });
 //snooze(40000);
 //}
 	}
@@ -385,7 +385,7 @@
 	}
 
 //if (dirtyRegion)
-//fDrawingEngine-&gt;FillRegion(*dirtyRegion, RGBColor(0, 255, 255, 255));
+//fDrawingEngine-&gt;FillRegion(*dirtyRegion, (rgb_color){ 0, 255, 255, 255 });
 
 	// send a message to the client informing about the changed size
 	BRect frame(Frame());
@@ -412,7 +412,7 @@
 
 	view-&gt;ScrollBy(dx, dy, dirty);
 
-//fDrawingEngine-&gt;FillRegion(dirty, RGBColor(255, 0, 255, 255));
+//fDrawingEngine-&gt;FillRegion(dirty, rgb_color{ 255, 0, 255, 255 });
 //snooze(2000);
 
 	if (IsVisible() &amp;&amp; view-&gt;IsVisible()) {
@@ -715,7 +715,7 @@
 		if (layerRegion.CountRects() &gt; 0) {
 			layerRegion.IntersectWith(&amp;layer-&gt;ScreenClipping(&amp;fContentRegion));
 
-//fDrawingEngine-&gt;FillRegion(layerRegion, RGBColor(0, 255, 0, 255));
+//fDrawingEngine-&gt;FillRegion(layerRegion, rgb_color{ 0, 255, 0, 255 });
 //snooze(10000);
 			fDirtyCause |= UPDATE_REQUEST;
 			_TriggerContentRedraw(layerRegion);
@@ -1817,7 +1817,7 @@

[... truncated: 1845 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003613.html">[Haiku-commits] r22002 - haiku/trunk/src/preferences/fonts
</A></li>
	<LI>Next message: <A HREF="003615.html">[Haiku-commits] r22004 - in haiku/trunk/src: apps/terminal	system/kernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3614">[ date ]</a>
              <a href="thread.html#3614">[ thread ]</a>
              <a href="subject.html#3614">[ subject ]</a>
              <a href="author.html#3614">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
