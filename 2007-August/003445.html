<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r21879 - in haiku/trunk:	headers/libs/freetype2/freetype	headers/libs/freetype2/freetype/config	headers/libs/freetype2/freetype/internal	headers/libs/freetype2/freetype/internal/services	src/libs/freetype2/autofit src/libs/freetype2/base	src/libs/freetype2/bdf src/libs/freetype2/cache	src/libs/freetype2/cff src/libs/freetype2/cid	src/libs/freetype2/gzip src/libs/freetype2/lzw	src/libs/freetype2/pfr src/libs/freetype2/psaux	src/libs/freetype2/pshinter src/libs/freetype2/psnames	src/libs/freetype2/sfnt src/libs/freetype2/smooth	src/libs/freetype2/truetype src/libs/freetype2/type1	src/libs/freetype2/type42 src/libs/freetype2/winfonts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r21879%20-%20in%20haiku/trunk%3A%0A%09headers/libs/freetype2/freetype%0A%09headers/libs/freetype2/freetype/config%0A%09headers/libs/freetype2/freetype/internal%0A%09headers/libs/freetype2/freetype/internal/services%0A%09src/libs/freetype2/autofit%20src/libs/freetype2/base%0A%09src/libs/freetype2/bdf%20src/libs/freetype2/cache%0A%09src/libs/freetype2/cff%20src/libs/freetype2/cid%0A%09src/libs/freetype2/gzip%20src/libs/freetype2/lzw%0A%09src/libs/freetype2/pfr%20src/libs/freetype2/psaux%0A%09src/libs/freetype2/pshinter%20src/libs/freetype2/psnames%0A%09src/libs/freetype2/sfnt%20src/libs/freetype2/smooth%0A%09src/libs/freetype2/truetype%20src/libs/freetype2/type1%0A%09src/libs/freetype2/type42%20src/libs/freetype2/winfonts&In-Reply-To=%3C200708092133.l79LXWos006784%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003444.html">
   <LINK REL="Next"  HREF="003446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r21879 - in haiku/trunk:	headers/libs/freetype2/freetype	headers/libs/freetype2/freetype/config	headers/libs/freetype2/freetype/internal	headers/libs/freetype2/freetype/internal/services	src/libs/freetype2/autofit src/libs/freetype2/base	src/libs/freetype2/bdf src/libs/freetype2/cache	src/libs/freetype2/cff src/libs/freetype2/cid	src/libs/freetype2/gzip src/libs/freetype2/lzw	src/libs/freetype2/pfr src/libs/freetype2/psaux	src/libs/freetype2/pshinter src/libs/freetype2/psnames	src/libs/freetype2/sfnt src/libs/freetype2/smooth	src/libs/freetype2/truetype src/libs/freetype2/type1	src/libs/freetype2/type42 src/libs/freetype2/winfonts</H1>
    <B>korli at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r21879%20-%20in%20haiku/trunk%3A%0A%09headers/libs/freetype2/freetype%0A%09headers/libs/freetype2/freetype/config%0A%09headers/libs/freetype2/freetype/internal%0A%09headers/libs/freetype2/freetype/internal/services%0A%09src/libs/freetype2/autofit%20src/libs/freetype2/base%0A%09src/libs/freetype2/bdf%20src/libs/freetype2/cache%0A%09src/libs/freetype2/cff%20src/libs/freetype2/cid%0A%09src/libs/freetype2/gzip%20src/libs/freetype2/lzw%0A%09src/libs/freetype2/pfr%20src/libs/freetype2/psaux%0A%09src/libs/freetype2/pshinter%20src/libs/freetype2/psnames%0A%09src/libs/freetype2/sfnt%20src/libs/freetype2/smooth%0A%09src/libs/freetype2/truetype%20src/libs/freetype2/type1%0A%09src/libs/freetype2/type42%20src/libs/freetype2/winfonts&In-Reply-To=%3C200708092133.l79LXWos006784%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r21879 - in haiku/trunk:	headers/libs/freetype2/freetype	headers/libs/freetype2/freetype/config	headers/libs/freetype2/freetype/internal	headers/libs/freetype2/freetype/internal/services	src/libs/freetype2/autofit src/libs/freetype2/base	src/libs/freetype2/bdf src/libs/freetype2/cache	src/libs/freetype2/cff src/libs/freetype2/cid	src/libs/freetype2/gzip src/libs/freetype2/lzw	src/libs/freetype2/pfr src/libs/freetype2/psaux	src/libs/freetype2/pshinter src/libs/freetype2/psnames	src/libs/freetype2/sfnt src/libs/freetype2/smooth	src/libs/freetype2/truetype src/libs/freetype2/type1	src/libs/freetype2/type42 src/libs/freetype2/winfonts">korli at mail.berlios.de
       </A><BR>
    <I>Thu Aug  9 23:33:32 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003444.html">[Haiku-commits] r21878 - in haiku/trunk: headers/os/opengl/GL	src/kits/opengl/glu/libnurbs/interface	src/kits/opengl/glu/libnurbs/nurbtess	src/kits/opengl/glu/libutil src/kits/opengl/mesa/glapi	src/kits/opengl/mesa/main src/kits/opengl/mesa/shader	src/kits/opengl/mesa/shader/slang	src/kits/opengl/mesa/shader/slang/library	src/kits/opengl/mesa/sparc src/kits/opengl/mesa/swrast	src/kits/opengl/mesa/tnl src/kits/opengl/mesa/vbo	src/kits/opengl/mesa/x86 src/kits/opengl/mesa/x86-64
</A></li>
        <LI>Next message: <A HREF="003446.html">[Haiku-commits] r21880 - haiku/trunk/src/servers/app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3445">[ date ]</a>
              <a href="thread.html#3445">[ thread ]</a>
              <a href="subject.html#3445">[ subject ]</a>
              <a href="author.html#3445">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: korli
Date: 2007-08-09 23:33:28 +0200 (Thu, 09 Aug 2007)
New Revision: 21879
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=21879&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=21879&amp;view=rev</A>

Added:
   haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttglyf.h
   haiku/trunk/src/libs/freetype2/autofit/afindic.c
   haiku/trunk/src/libs/freetype2/autofit/afindic.h
   haiku/trunk/src/libs/freetype2/autofit/aflatin2.c
   haiku/trunk/src/libs/freetype2/autofit/aflatin2.h
   haiku/trunk/src/libs/freetype2/base/ftpatent.c
Modified:
   haiku/trunk/headers/libs/freetype2/freetype/config/ftoption.h
   haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h
   haiku/trunk/headers/libs/freetype2/freetype/freetype.h
   haiku/trunk/headers/libs/freetype2/freetype/ftcache.h
   haiku/trunk/headers/libs/freetype2/freetype/fterrdef.h
   haiku/trunk/headers/libs/freetype2/freetype/ftmodapi.h
   haiku/trunk/headers/libs/freetype2/freetype/ftstroke.h
   haiku/trunk/headers/libs/freetype2/freetype/fttypes.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/ftobjs.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/ftserv.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttcmap.h
   haiku/trunk/headers/libs/freetype2/freetype/tttables.h
   haiku/trunk/src/libs/freetype2/autofit/Jamfile
   haiku/trunk/src/libs/freetype2/autofit/afcjk.c
   haiku/trunk/src/libs/freetype2/autofit/afglobal.c
   haiku/trunk/src/libs/freetype2/autofit/afglobal.h
   haiku/trunk/src/libs/freetype2/autofit/afhints.c
   haiku/trunk/src/libs/freetype2/autofit/afhints.h
   haiku/trunk/src/libs/freetype2/autofit/aflatin.c
   haiku/trunk/src/libs/freetype2/autofit/afloader.c
   haiku/trunk/src/libs/freetype2/autofit/aftypes.h
   haiku/trunk/src/libs/freetype2/autofit/autofit.c
   haiku/trunk/src/libs/freetype2/autofit/rules.mk
   haiku/trunk/src/libs/freetype2/base/Jamfile
   haiku/trunk/src/libs/freetype2/base/ftcalc.c
   haiku/trunk/src/libs/freetype2/base/ftglyph.c
   haiku/trunk/src/libs/freetype2/base/ftmac.c
   haiku/trunk/src/libs/freetype2/base/ftobjs.c
   haiku/trunk/src/libs/freetype2/base/ftoutln.c
   haiku/trunk/src/libs/freetype2/bdf/bdflib.c
   haiku/trunk/src/libs/freetype2/cache/ftcbasic.c
   haiku/trunk/src/libs/freetype2/cache/ftccache.c
   haiku/trunk/src/libs/freetype2/cache/ftccache.h
   haiku/trunk/src/libs/freetype2/cache/ftccmap.c
   haiku/trunk/src/libs/freetype2/cache/ftcglyph.h
   haiku/trunk/src/libs/freetype2/cff/cffgload.c
   haiku/trunk/src/libs/freetype2/cff/cffgload.h
   haiku/trunk/src/libs/freetype2/cid/cidgload.c
   haiku/trunk/src/libs/freetype2/cid/cidparse.c
   haiku/trunk/src/libs/freetype2/gzip/adler32.c
   haiku/trunk/src/libs/freetype2/gzip/zconf.h
   haiku/trunk/src/libs/freetype2/gzip/zutil.h
   haiku/trunk/src/libs/freetype2/lzw/ftzopen.c
   haiku/trunk/src/libs/freetype2/lzw/ftzopen.h
   haiku/trunk/src/libs/freetype2/pfr/pfrcmap.c
   haiku/trunk/src/libs/freetype2/pfr/pfrgload.c
   haiku/trunk/src/libs/freetype2/pfr/pfrtypes.h
   haiku/trunk/src/libs/freetype2/psaux/afmparse.c
   haiku/trunk/src/libs/freetype2/psaux/psobjs.c
   haiku/trunk/src/libs/freetype2/psaux/t1decode.c
   haiku/trunk/src/libs/freetype2/pshinter/pshmod.c
   haiku/trunk/src/libs/freetype2/pshinter/pshrec.c
   haiku/trunk/src/libs/freetype2/psnames/psmodule.c
   haiku/trunk/src/libs/freetype2/sfnt/sfobjs.c
   haiku/trunk/src/libs/freetype2/sfnt/ttcmap.c
   haiku/trunk/src/libs/freetype2/sfnt/ttkern.c
   haiku/trunk/src/libs/freetype2/sfnt/ttmtx.c
   haiku/trunk/src/libs/freetype2/sfnt/ttsbit0.c
   haiku/trunk/src/libs/freetype2/smooth/ftgrays.c
   haiku/trunk/src/libs/freetype2/truetype/ttdriver.c
   haiku/trunk/src/libs/freetype2/truetype/ttgload.c
   haiku/trunk/src/libs/freetype2/truetype/ttinterp.c
   haiku/trunk/src/libs/freetype2/truetype/ttobjs.c
   haiku/trunk/src/libs/freetype2/truetype/ttobjs.h
   haiku/trunk/src/libs/freetype2/type1/t1load.c
   haiku/trunk/src/libs/freetype2/type1/t1objs.c
   haiku/trunk/src/libs/freetype2/type42/t42objs.c
   haiku/trunk/src/libs/freetype2/type42/t42parse.c
   haiku/trunk/src/libs/freetype2/winfonts/winfnt.c
   haiku/trunk/src/libs/freetype2/winfonts/winfnt.h
Log:
updated freetype to 2.3.5


Modified: haiku/trunk/headers/libs/freetype2/freetype/config/ftoption.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/config/ftoption.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/config/ftoption.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -302,7 +302,9 @@
   /* The size in bytes of the render pool used by the scan-line converter  */
   /* to do all of its work.                                                */
   /*                                                                       */
-  /* This must be greater than 4KByte.                                     */
+  /* This must be greater than 4KByte if you use FreeType to rasterize     */
+  /* glyphs; otherwise, you may set it to zero to avoid unnecessary        */
+  /* allocation of the render pool.                                        */
   /*                                                                       */
 #define FT_RENDER_POOL_SIZE  16384L
 
@@ -461,13 +463,48 @@
 
   /*************************************************************************/
   /*                                                                       */
-  /* Define TT_CONFIG_OPTION_UNPATENTED_HINTING (in addition to            */
-  /* TT_CONFIG_OPTION_BYTECODE_INTERPRETER) to compile the unpatented      */
-  /* work-around hinting system.  Note that for the moment, the algorithm  */
-  /* is only used when selected at runtime through the parameter tag       */
-  /* FT_PARAM_TAG_UNPATENTED_HINTING; or when the debug hook               */
-  /* FT_DEBUG_HOOK_UNPATENTED_HINTING is globally activated.               */
+  /* If you define TT_CONFIG_OPTION_UNPATENTED_HINTING, a special version  */
+  /* of the TrueType bytecode interpreter is used that doesn't implement   */
+  /* any of the patented opcodes and algorithms.  Note that the            */
+  /* the TT_CONFIG_OPTION_UNPATENTED_HINTING macro is *ignored* if you     */
+  /* define TT_CONFIG_OPTION_BYTECODE_INTERPRETER; with other words,       */
+  /* either define TT_CONFIG_OPTION_BYTECODE_INTERPRETER or                */
+  /* TT_CONFIG_OPTION_UNPATENTED_HINTING but not both at the same time.    */
   /*                                                                       */
+  /* This macro is only useful for a small number of font files (mostly    */
+  /* for Asian scripts) that require bytecode interpretation to properly   */
+  /* load glyphs.  For all other fonts, this produces unpleasant results,  */
+  /* thus the unpatented interpreter is never used to load glyphs from     */
+  /* TrueType fonts unless one of the following two options is used.       */
+  /*                                                                       */
+  /*   - The unpatented interpreter is explicitly activated by the user    */
+  /*     through the FT_PARAM_TAG_UNPATENTED_HINTING parameter tag         */
+  /*     when opening the FT_Face.                                         */
+  /*                                                                       */
+  /*   - FreeType detects that the FT_Face corresponds to one of the       */
+  /*     `trick' fonts (e.g., `Mingliu') it knows about.  The font engine  */
+  /*     contains a hard-coded list of font names and other matching       */
+  /*     parameters (see function `tt_face_init' in file                   */
+  /*     `src/truetype/ttobjs.c').                                         */
+  /*                                                                       */
+  /* Here a sample code snippet for using FT_PARAM_TAG_UNPATENTED_HINTING. */
+  /*                                                                       */
+  /*   {                                                                   */
+  /*     FT_Parameter  parameter;                                          */
+  /*     FT_Open_Args  open_args;                                          */
+  /*                                                                       */
+  /*                                                                       */
+  /*     parameter.tag = FT_PARAM_TAG_UNPATENTED_HINTING;                  */
+  /*                                                                       */
+  /*     open_args.flags      = FT_OPEN_PATHNAME | FT_OPEN_PARAMS;         */
+  /*     open_args.pathname   = my_font_pathname;                          */
+  /*     open_args.num_params = 1;                                         */
+  /*     open_args.params     = &parameter;                                */
+  /*                                                                       */
+  /*     error = FT_Open_Face( library, &amp;open_args, index, &amp;face );        */
+  /*     ...                                                               */
+  /*   }                                                                   */
+  /*                                                                       */
 #define TT_CONFIG_OPTION_UNPATENTED_HINTING
 
 
@@ -591,6 +628,11 @@
   /*                                                                       */
 #define AF_CONFIG_OPTION_CJK
 
+  /*************************************************************************/
+  /*                                                                       */
+  /* Compile autofit module with Indic script support.                     */
+  /*                                                                       */
+#define AF_CONFIG_OPTION_INDIC
 
   /* */
 

Modified: haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -78,15 +78,6 @@
   /**********************************************************************/
 
 
-#include &lt;ctype.h&gt;
-
-#define ft_isalnum   isalnum
-#define ft_isdigit   isdigit
-#define ft_islower   islower
-#define ft_isupper   isupper
-#define ft_isxdigit  isxdigit
-
-
 #include &lt;string.h&gt;
 
 #define ft_memchr   memchr

Modified: haiku/trunk/headers/libs/freetype2/freetype/freetype.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/freetype.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/freetype.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -648,8 +648,8 @@
   {
     FT_ENC_TAG( FT_ENCODING_NONE, 0, 0, 0, 0 ),
 
-    FT_ENC_TAG( FT_ENCODING_MS_SYMBOL,  's', 'y', 'm', 'b' ),
-    FT_ENC_TAG( FT_ENCODING_UNICODE,    'u', 'n', 'i', 'c' ),
+    FT_ENC_TAG( FT_ENCODING_MS_SYMBOL, 's', 'y', 'm', 'b' ),
+    FT_ENC_TAG( FT_ENCODING_UNICODE,   'u', 'n', 'i', 'c' ),
 
     FT_ENC_TAG( FT_ENCODING_SJIS,    's', 'j', 'i', 's' ),
     FT_ENC_TAG( FT_ENCODING_GB2312,  'g', 'b', ' ', ' ' ),
@@ -2111,9 +2111,16 @@
   /*    FreeType error code.  0 means success.                             */
   /*                                                                       */
   /* &lt;Note&gt;                                                                */
+  /*    If either the character width or height is zero, it is set equal   */
+  /*    to the other value.                                                */
+  /*                                                                       */
   /*    If either the horizontal or vertical resolution is zero, it is set */
-  /*    to a default value of 72dpi.                                       */
+  /*    equal to the other value.                                          */
   /*                                                                       */
+  /*    A character width or height smaller than 1pt is set to 1pt; if     */
+  /*    both resolution values are zero, they are set to 72dpi.            */
+  /*                                                                       */
+
   FT_EXPORT( FT_Error )
   FT_Set_Char_Size( FT_Face     face,
                     FT_F26Dot6  char_width,
@@ -2731,8 +2738,7 @@
   /*                                                                       */
   /* &lt;Description&gt;                                                         */
   /*    Retrieve the ASCII name of a given glyph in a face.  This only     */
-  /*    works for those faces where @FT_HAS_GLYPH_NAMES(face) returns      */
-  /*    TRUE.                                                              */
+  /*    works for those faces where @FT_HAS_GLYPH_NAMES(face) returns 1.   */
   /*                                                                       */
   /* &lt;Input&gt;                                                               */
   /*    face        :: A handle to a source face object.                   */
@@ -3323,7 +3329,7 @@
    */
 #define FREETYPE_MAJOR  2
 #define FREETYPE_MINOR  3
-#define FREETYPE_PATCH  4
+#define FREETYPE_PATCH  5
 
 
   /*************************************************************************/
@@ -3361,6 +3367,62 @@
                       FT_Int      *aminor,
                       FT_Int      *apatch );
 
+
+  /*************************************************************************/
+  /*                                                                       */
+  /* &lt;Function&gt;                                                            */
+  /*    FT_Face_CheckTrueTypePatents                                       */
+  /*                                                                       */
+  /* &lt;Description&gt;                                                         */
+  /*    Parse all bytecode instructions of a TrueType font file to check   */
+  /*    whether any of the patented opcodes are used.  This is only useful */
+  /*    if you want to be able to use the unpatented hinter with           */
+  /*    fonts that do *not* use these opcodes.                             */
+  /*                                                                       */
+  /*    Note that this function parses *all* glyph instructions in the     */
+  /*    font file, which may be slow.                                      */
+  /*                                                                       */
+  /* &lt;Input&gt;                                                               */
+  /*    face :: A face handle.                                             */
+  /*                                                                       */
+  /* &lt;Return&gt;                                                              */
+  /*    1 if this is a TrueType font that uses one of the patented         */
+  /*    opcodes, 0 otherwise.                                              */
+  /*                                                                       */
+  /* &lt;Since&gt;                                                               */
+  /*    2.3.5                                                              */
+  /*                                                                       */
+  FT_EXPORT( FT_Bool )
+  FT_Face_CheckTrueTypePatents( FT_Face  face );
+
+
+  /*************************************************************************/
+  /*                                                                       */
+  /* &lt;Function&gt;                                                            */
+  /*    FT_Face_SetUnpatentedHinting                                       */
+  /*                                                                       */
+  /* &lt;Description&gt;                                                         */
+  /*    Enable or disable the unpatented hinter for a given face.          */
+  /*    Only enable it if you have determined that the face doesn't        */
+  /*    use any patented opcodes (see @FT_Face_CheckTrueTypePatents).      */
+  /*                                                                       */
+  /* &lt;Input&gt;                                                               */
+  /*    face  :: A face handle.                                            */
+  /*                                                                       */
+  /*    value :: New boolean setting.                                      */
+  /*                                                                       */
+  /* &lt;Return&gt;                                                              */
+  /*    The old setting value.  This will always be false if this is not   */
+  /*    a SFNT font, or if the unpatented hinter is not compiled in this   */
+  /*    instance of the library.                                           */
+  /*                                                                       */
+  /* &lt;Since&gt;                                                               */
+  /*    2.3.5                                                              */
+  /*                                                                       */
+  FT_EXPORT( FT_Bool )
+  FT_Face_SetUnpatentedHinting( FT_Face  face,
+                                FT_Bool  value );
+
   /* */
 
 

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftcache.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftcache.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftcache.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    FreeType Cache subsystem (specification).                            */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2003, 2004, 2005, 2006 by                   */
+/*  Copyright 1996-2001, 2002, 2003, 2004, 2005, 2006, 2007 by             */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -411,14 +411,14 @@
   /*                                                                       */
   /*    height  :: The character height.                                   */
   /*                                                                       */
-  /*    pixel   :: A Boolean.  If TRUE, the `width' and `height' fields    */
-  /*               are interpreted as integer pixel character sizes.       */
+  /*    pixel   :: A Boolean.  If 1, the `width' and `height' fields are   */
+  /*               interpreted as integer pixel character sizes.           */
   /*               Otherwise, they are expressed as 1/64th of points.      */
   /*                                                                       */
-  /*    x_res   :: Only used when `pixel' is FALSE to indicate the         */
+  /*    x_res   :: Only used when `pixel' is value 0 to indicate the       */
   /*               horizontal resolution in dpi.                           */
   /*                                                                       */
-  /*    y_res   :: Only used when `pixel' is FALSE to indicate the         */
+  /*    y_res   :: Only used when `pixel' is value 0 to indicate the       */
   /*               vertical resolution in dpi.                             */
   /*                                                                       */
   /* &lt;Note&gt;                                                                */
@@ -778,6 +778,60 @@
 
   /*************************************************************************/
   /*                                                                       */
+  /* &lt;Function&gt;                                                            */
+  /*    FTC_ImageCache_LookupScaler                                        */
+  /*                                                                       */
+  /* &lt;Description&gt;                                                         */
+  /*    A variant of @FTC_ImageCache_Lookup that uses an @FTC_ScalerRec    */
+  /*    to specify the face ID and its size.                               */
+  /*                                                                       */
+  /* &lt;Input&gt;                                                               */
+  /*    cache      :: A handle to the source glyph image cache.            */
+  /*                                                                       */
+  /*    scaler     :: A pointer to a scaler descriptor.                    */
+  /*                                                                       */
+  /*    load_flags :: The corresponding load flags.                        */
+  /*                                                                       */
+  /*    gindex     :: The glyph index to retrieve.                         */
+  /*                                                                       */
+  /* &lt;Output&gt;                                                              */
+  /*    aglyph     :: The corresponding @FT_Glyph object.  0 in case of    */
+  /*                  failure.                                             */
+  /*                                                                       */
+  /*    anode      :: Used to return the address of of the corresponding   */
+  /*                  cache node after incrementing its reference count    */
+  /*                  (see note below).                                    */
+  /*                                                                       */
+  /* &lt;Return&gt;                                                              */
+  /*    FreeType error code.  0 means success.                             */
+  /*                                                                       */
+  /* &lt;Note&gt;                                                                */
+  /*    The returned glyph is owned and managed by the glyph image cache.  */
+  /*    Never try to transform or discard it manually!  You can however    */
+  /*    create a copy with @FT_Glyph_Copy and modify the new one.          */
+  /*                                                                       */
+  /*    If `anode' is _not_ NULL, it receives the address of the cache     */
+  /*    node containing the glyph image, after increasing its reference    */
+  /*    count.  This ensures that the node (as well as the @FT_Glyph) will */
+  /*    always be kept in the cache until you call @FTC_Node_Unref to      */
+  /*    `release' it.                                                      */
+  /*                                                                       */
+  /*    If `anode' is NULL, the cache node is left unchanged, which means  */
+  /*    that the @FT_Glyph could be flushed out of the cache on the next   */
+  /*    call to one of the caching sub-system APIs.  Don't assume that it  */
+  /*    is persistent!                                                     */
+  /*                                                                       */
+  FT_EXPORT( FT_Error )
+  FTC_ImageCache_LookupScaler( FTC_ImageCache  cache,
+                               FTC_Scaler      scaler,
+                               FT_ULong        load_flags,
+                               FT_UInt         gindex,
+                               FT_Glyph       *aglyph,
+                               FTC_Node       *anode );
+
+
+  /*************************************************************************/
+  /*                                                                       */
   /* &lt;Type&gt;                                                                */
   /*    FTC_SBit                                                           */
   /*                                                                       */
@@ -930,6 +984,62 @@
                         FTC_Node        *anode );
 
 
+  /*************************************************************************/
+  /*                                                                       */
+  /* &lt;Function&gt;                                                            */
+  /*    FTC_SBitCache_LookupScaler                                         */
+  /*                                                                       */
+  /* &lt;Description&gt;                                                         */
+  /*    A variant of @FTC_SBitCache_Lookup that uses an @FTC_ScalerRec     */
+  /*    to specify the face ID and its size.                               */
+  /*                                                                       */
+  /* &lt;Input&gt;                                                               */
+  /*    cache      :: A handle to the source sbit cache.                   */
+  /*                                                                       */
+  /*    scaler     :: A pointer to the scaler descriptor.                  */
+  /*                                                                       */
+  /*    load_flags :: The corresponding load flags.                        */
+  /*                                                                       */
+  /*    gindex     :: The glyph index.                                     */
+  /*                                                                       */
+  /* &lt;Output&gt;                                                              */
+  /*    sbit       :: A handle to a small bitmap descriptor.               */
+  /*                                                                       */
+  /*    anode      :: Used to return the address of of the corresponding   */
+  /*                  cache node after incrementing its reference count    */
+  /*                  (see note below).                                    */
+  /*                                                                       */
+  /* &lt;Return&gt;                                                              */
+  /*    FreeType error code.  0 means success.                             */
+  /*                                                                       */
+  /* &lt;Note&gt;                                                                */
+  /*    The small bitmap descriptor and its bit buffer are owned by the    */
+  /*    cache and should never be freed by the application.  They might    */
+  /*    as well disappear from memory on the next cache lookup, so don't   */
+  /*    treat them as persistent data.                                     */
+  /*                                                                       */
+  /*    The descriptor's `buffer' field is set to 0 to indicate a missing  */
+  /*    glyph bitmap.                                                      */
+  /*                                                                       */
+  /*    If `anode' is _not_ NULL, it receives the address of the cache     */
+  /*    node containing the bitmap, after increasing its reference count.  */
+  /*    This ensures that the node (as well as the image) will always be   */
+  /*    kept in the cache until you call @FTC_Node_Unref to `release' it.  */
+  /*                                                                       */
+  /*    If `anode' is NULL, the cache node is left unchanged, which means  */
+  /*    that the bitmap could be flushed out of the cache on the next      */
+  /*    call to one of the caching sub-system APIs.  Don't assume that it  */
+  /*    is persistent!                                                     */
+  /*                                                                       */
+  FT_EXPORT( FT_Error )
+  FTC_SBitCache_LookupScaler( FTC_SBitCache  cache,
+                              FTC_Scaler     scaler,
+                              FT_ULong       load_flags,
+                              FT_UInt        gindex,
+                              FTC_SBit      *sbit,
+                              FTC_Node      *anode );
+
+
  /* */
 
 #ifdef FT_CONFIG_OPTION_OLD_INTERNALS

Modified: haiku/trunk/headers/libs/freetype2/freetype/fterrdef.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/fterrdef.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/fterrdef.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    FreeType error codes (specification).                                */
 /*                                                                         */
-/*  Copyright 2002, 2004, 2006 by                                          */
+/*  Copyright 2002, 2004, 2006, 2007 by                                    */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -230,6 +230,10 @@
                 &quot;`BBX' field missing&quot; )
   FT_ERRORDEF_( Bbx_Too_Big,                                 0xB7, \
                 &quot;`BBX' too big&quot; )
+  FT_ERRORDEF_( Corrupted_Font_Header,                       0xB8, \
+                &quot;Font header corrupted or missing fields&quot; )
+  FT_ERRORDEF_( Corrupted_Font_Glyphs,                       0xB9, \
+                &quot;Font glyphs corrupted or missing fields&quot; )
 
 
 /* END */

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftmodapi.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftmodapi.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftmodapi.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -316,7 +316,7 @@
   /**************************************************************************
    *
    * @section:
-   *   ttengine
+   *   truetype_engine
    *
    * @title:
    *   The TrueType Engine

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftstroke.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftstroke.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftstroke.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -297,8 +297,8 @@
    *     The source outline.
    *
    *   opened ::
-   *     A boolean.  If TRUE, the outline is treated as an open path
-   *     instead of a closed one.
+   *     A boolean.  If 1, the outline is treated as an open path instead
+   *     of a closed one.
    *
    * @return:
    *   FreeType error code.  0 means success.
@@ -334,7 +334,7 @@
    *     A pointer to the start vector.
    *
    *   open ::
-   *     A boolean.  If TRUE, the sub-path is treated as an open one.
+   *     A boolean.  If 1, the sub-path is treated as an open one.
    *
    * @return:
    *   FreeType error code.  0 means success.
@@ -649,7 +649,7 @@
    *     A stroker handle.
    *
    *   destroy ::
-   *     A Boolean.  If TRUE, the source glyph object is destroyed
+   *     A Boolean.  If 1, the source glyph object is destroyed
    *     on success.
    *
    * @return:
@@ -682,11 +682,11 @@
    *     A stroker handle.
    *
    *   inside ::
-   *     A Boolean.  If TRUE, return the inside border, otherwise
+   *     A Boolean.  If 1, return the inside border, otherwise
    *     the outside border.
    *
    *   destroy ::
-   *     A Boolean.  If TRUE, the source glyph object is destroyed
+   *     A Boolean.  If 1, the source glyph object is destroyed
    *     on success.
    *
    * @return:

Modified: haiku/trunk/headers/libs/freetype2/freetype/fttypes.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/fttypes.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/fttypes.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    FreeType simple types definitions (specification only).              */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2004, 2006 by                               */
+/*  Copyright 1996-2001, 2002, 2004, 2006, 2007 by                         */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -94,7 +94,8 @@
   /*    FT_Bool                                                            */
   /*                                                                       */
   /* &lt;Description&gt;                                                         */
-  /*    A typedef of unsigned char, used for simple booleans.              */
+  /*    A typedef of unsigned char, used for simple booleans.  As usual,   */
+  /*    values 1 and 0 represent true and false, respectively.             */
   /*                                                                       */
   typedef unsigned char  FT_Bool;
 
@@ -384,7 +385,7 @@
   /*************************************************************************/
   /*                                                                       */
   /* &lt;Struct&gt;                                                              */
-  /*    FT_Data	                                                           */
+  /*    FT_Data                                                            */
   /*                                                                       */
   /* &lt;Description&gt;                                                         */
   /*    Read-only binary data represented as a pointer and a length.       */

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/ftobjs.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/ftobjs.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/ftobjs.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -89,6 +89,25 @@
   ft_highpow2( FT_UInt32  value );
 
 
+  /*
+   *  character classification functions -- since these are used to parse
+   *  font files, we must not use those in &lt;ctypes.h&gt; which are
+   *  locale-dependent
+   */
+#define  ft_isdigit( x )   ( ( (unsigned)(x) - '0' ) &lt; 10U )
+
+#define  ft_isxdigit( x )  ( ( (unsigned)(x) - '0' ) &lt; 10U || \
+                             ( (unsigned)(x) - 'a' ) &lt; 6U  || \
+                             ( (unsigned)(x) - 'A' ) &lt; 6U  )
+
+  /* the next two macros assume ASCII representation */
+#define  ft_isupper( x )  ( ( (unsigned)(x) - 'A' ) &lt; 26U )
+#define  ft_islower( x )  ( ( (unsigned)(x) - 'a' ) &lt; 26U )
+
+#define  ft_isalpha( x )  ( ft_isupper( x ) || ft_islower( x ) )
+#define  ft_isalnum( x )  ( ft_isdigit( x ) || ft_isalpha( x ) )
+
+
   /*************************************************************************/
   /*************************************************************************/
   /*************************************************************************/

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/ftserv.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/ftserv.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/ftserv.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    The FreeType services (specification only).                          */
 /*                                                                         */
-/*  Copyright 2003, 2004, 2005, 2006 by                                    */
+/*  Copyright 2003, 2004, 2005, 2006, 2007 by                              */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -315,6 +315,7 @@
 #define FT_SERVICE_TT_CMAP_H            &lt;freetype/internal/services/svttcmap.h&gt;
 #define FT_SERVICE_WINFNT_H             &lt;freetype/internal/services/svwinfnt.h&gt;
 #define FT_SERVICE_XFREE86_NAME_H       &lt;freetype/internal/services/svxf86nm.h&gt;
+#define FT_SERVICE_TRUETYPE_GLYF_H      &lt;freetype/internal/services/svttglyf.h&gt;
 
  /* */
 

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttcmap.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttcmap.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttcmap.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -52,6 +52,7 @@
   typedef struct  TT_CMapInfo_
   {
     FT_ULong language;
+    FT_Long  format;
 
   } TT_CMapInfo;
 

Added: haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttglyf.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttglyf.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/services/svttglyf.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -0,0 +1,48 @@
+/***************************************************************************/
+/*                                                                         */
+/*  svttglyf.h                                                             */
+/*                                                                         */
+/*    The FreeType TrueType glyph service.                                 */
+/*                                                                         */
+/*  Copyright 2007 by David Turner.                                        */
+/*                                                                         */
+/*  This file is part of the FreeType project, and may only be used,       */
+/*  modified, and distributed under the terms of the FreeType project      */
+/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
+/*  this file you indicate that you have read the license and              */
+/*  understand and accept it fully.                                        */
+/*                                                                         */
+/***************************************************************************/
+
+#ifndef __SVTTGLYF_H__
+#define __SVTTGLYF_H__
+
+#include FT_INTERNAL_SERVICE_H
+#include FT_TRUETYPE_TABLES_H
+
+
+FT_BEGIN_HEADER
+
+
+#define FT_SERVICE_ID_TT_GLYF &quot;tt-glyf&quot;
+
+
+  typedef FT_ULong
+  (*TT_Glyf_GetLocationFunc)( FT_Face    face,
+                              FT_UInt    gindex,
+                              FT_ULong  *psize );
+
+  FT_DEFINE_SERVICE( TTGlyf )
+  {
+    TT_Glyf_GetLocationFunc  get_location;
+  };
+
+  /* */
+
+
+FT_END_HEADER
+
+#endif /* __SVTTGLYF_H__ */
+
+
+/* END */

Modified: haiku/trunk/headers/libs/freetype2/freetype/tttables.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/tttables.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/headers/libs/freetype2/freetype/tttables.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -595,7 +595,7 @@
   /*                                                                       */
   /*    This function is only useful to access SFNT tables that are loaded */
   /*    by the sfnt, truetype, and opentype drivers.  See @FT_Sfnt_Tag for */
-  /*    a list.                                                             */
+  /*    a list.                                                            */
   /*                                                                       */
   FT_EXPORT( void* )
   FT_Get_Sfnt_Table( FT_Face      face,
@@ -725,6 +725,26 @@
   FT_EXPORT( FT_ULong )
   FT_Get_CMap_Language_ID( FT_CharMap  charmap );
 
+
+  /*************************************************************************/
+  /*                                                                       */
+  /* &lt;Function&gt;                                                            */
+  /*    FT_Get_CMap_Format                                                 */
+  /*                                                                       */
+  /* &lt;Description&gt;                                                         */
+  /*    Return TrueType/sfnt specific cmap format.                         */
+  /*                                                                       */
+  /* &lt;Input&gt;                                                               */
+  /*    charmap ::                                                         */
+  /*      The target charmap.                                              */
+  /*                                                                       */
+  /* &lt;Return&gt;                                                              */
+  /*    The format of `charmap'.  If `charmap' doesn't belong to a         */
+  /*    TrueType/sfnt face, return -1.                                     */
+  /*                                                                       */
+  FT_EXPORT( FT_Long )
+  FT_Get_CMap_Format( FT_CharMap  charmap );
+
   /* */
 
 

Modified: haiku/trunk/src/libs/freetype2/autofit/Jamfile
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/Jamfile	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/src/libs/freetype2/autofit/Jamfile	2007-08-09 21:33:28 UTC (rev 21879)
@@ -21,7 +21,7 @@
 
   if $(FT2_MULTI)
   {
-    _sources = afangles afglobal afhints aflatin afloader afmodule afdummy afwarp ;
+    _sources = afangles afglobal afhints aflatin afcjk afindic afloader afmodule afdummy afwarp ;
   }
   else
   {

Modified: haiku/trunk/src/libs/freetype2/autofit/afcjk.c
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/afcjk.c	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/src/libs/freetype2/autofit/afcjk.c	2007-08-09 21:33:28 UTC (rev 21879)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    Auto-fitter hinting routines for CJK script (body).                  */
 /*                                                                         */
-/*  Copyright 2006 by                                                      */
+/*  Copyright 2006, 2007 by                                                */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -332,7 +332,6 @@
     AF_Segment    segment_limit = segments + axis-&gt;num_segments;
     AF_Segment    seg;
 
-    AF_Direction  up_dir;
     FT_Fixed      scale;
     FT_Pos        edge_distance_threshold;
 
@@ -342,9 +341,6 @@
     scale = ( dim == AF_DIMENSION_HORZ ) ? hints-&gt;x_scale
                                          : hints-&gt;y_scale;
 
-    up_dir = ( dim == AF_DIMENSION_HORZ ) ? AF_DIR_UP
-                                          : AF_DIR_RIGHT;
-
     /*********************************************************************/
     /*                                                                   */
     /* We begin by generating a sorted table of edges for the current    */
@@ -431,7 +427,7 @@
 
         /* insert a new edge in the list and */
         /* sort according to the position    */
-        error = af_axis_hints_new_edge( axis, seg-&gt;pos, memory, &amp;edge );
+        error = af_axis_hints_new_edge( axis, seg-&gt;pos, seg-&gt;dir, memory, &amp;edge );
         if ( error )
           goto Exit;
 
@@ -1365,7 +1361,7 @@
     FT_UNUSED( metrics );
 
 
-    error = af_glyph_hints_reload( hints, outline );
+    error = af_glyph_hints_reload( hints, outline, 0 );
     if ( error )
       goto Exit;
 

Modified: haiku/trunk/src/libs/freetype2/autofit/afglobal.c
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/afglobal.c	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/src/libs/freetype2/autofit/afglobal.c	2007-08-09 21:33:28 UTC (rev 21879)
@@ -20,21 +20,29 @@
 #include &quot;afdummy.h&quot;
 #include &quot;aflatin.h&quot;
 #include &quot;afcjk.h&quot;
+#include &quot;afindic.h&quot;
+
 #include &quot;aferrors.h&quot;
 
+#ifdef FT_OPTION_AUTOFIT2
+#include &quot;aflatin2.h&quot;
+#endif
 
   /* populate this list when you add new scripts */
   static AF_ScriptClass const  af_script_classes[] =
   {
     &amp;af_dummy_script_class,
+#ifdef FT_OPTION_AUTOFIT2
+    &amp;af_latin2_script_class,
+#endif
     &amp;af_latin_script_class,
     &amp;af_cjk_script_class,
-
+    &amp;af_indic_script_class, 
     NULL  /* do not remove */
   };
 
   /* index of default script in `af_script_classes' */
-#define AF_SCRIPT_LIST_DEFAULT  1
+#define AF_SCRIPT_LIST_DEFAULT  2
   /* indicates an uncovered glyph                   */
 #define AF_SCRIPT_LIST_NONE   255
 
@@ -217,12 +225,16 @@
   FT_LOCAL_DEF( FT_Error )
   af_face_globals_get_metrics( AF_FaceGlobals     globals,
                                FT_UInt            gindex,
+                               FT_UInt            options,
                                AF_ScriptMetrics  *ametrics )
   {
     AF_ScriptMetrics  metrics = NULL;
     FT_UInt           gidx;
     AF_ScriptClass    clazz;
-    FT_Error          error = AF_Err_Ok;
+    FT_UInt           script     = options &amp; 15;
+    const FT_UInt     script_max = sizeof ( af_script_classes ) /
+                                     sizeof ( af_script_classes[0] );
+    FT_Error          error      = AF_Err_Ok;
 
 
     if ( gindex &gt;= globals-&gt;glyph_count )
@@ -231,8 +243,14 @@
       goto Exit;
     }
 
-    gidx    = globals-&gt;glyph_scripts[gindex];
-    clazz   = af_script_classes[gidx];
+    gidx = script;
+    if ( gidx == 0 || gidx + 1 &gt;= script_max )
+      gidx = globals-&gt;glyph_scripts[gindex];
+
+    clazz = af_script_classes[gidx];
+    if ( script == 0 )
+      script = clazz-&gt;script;
+
     metrics = globals-&gt;metrics[clazz-&gt;script];
     if ( metrics == NULL )
     {

Modified: haiku/trunk/src/libs/freetype2/autofit/afglobal.h
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/afglobal.h	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/src/libs/freetype2/autofit/afglobal.h	2007-08-09 21:33:28 UTC (rev 21879)
@@ -5,7 +5,7 @@
 /*    Auto-fitter routines to compute global hinting values                */
 /*    (specification).                                                     */
 /*                                                                         */
-/*  Copyright 2003, 2004, 2005 by                                          */
+/*  Copyright 2003, 2004, 2005, 2007 by                                    */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -50,6 +50,7 @@
   FT_LOCAL( FT_Error )
   af_face_globals_get_metrics( AF_FaceGlobals     globals,
                                FT_UInt            gindex,
+                               FT_UInt            options,
                                AF_ScriptMetrics  *ametrics );
 
   FT_LOCAL( void )

Modified: haiku/trunk/src/libs/freetype2/autofit/afhints.c
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/afhints.c	2007-08-09 21:12:30 UTC (rev 21878)
+++ haiku/trunk/src/libs/freetype2/autofit/afhints.c	2007-08-09 21:33:28 UTC (rev 21879)
@@ -54,9 +54,6 @@
     }
 
     segment = axis-&gt;segments + axis-&gt;num_segments++;
-#if 0
-    FT_ZERO( segment );
-#endif
 
   Exit:
     *asegment = segment;
@@ -67,6 +64,7 @@
   FT_LOCAL( FT_Error )
   af_axis_hints_new_edge( AF_AxisHints  axis,
                           FT_Int        fpos,
+                          AF_Direction  dir,
                           FT_Memory     memory,
                           AF_Edge      *aedge )
   {
@@ -101,8 +99,16 @@
     edges = axis-&gt;edges;
     edge  = edges + axis-&gt;num_edges;
 
-    while ( edge &gt; edges &amp;&amp; edge[-1].fpos &gt; fpos )
+    while ( edge &gt; edges )
     {
+      if ( edge[-1].fpos &lt; fpos )
+        break;
+
+      /* we want the edge with same position and minor direction */
+      /* to appear before those in the major one in the list     */
+      if ( edge[-1].fpos == fpos &amp;&amp; dir == axis-&gt;major_dir )
+        break;
+
       edge[0] = edge[-1];
       edge--;
     }
@@ -111,6 +117,7 @@
 
     FT_ZERO( edge );
     edge-&gt;fpos = (FT_Short)fpos;
+    edge-&gt;dir  = (FT_Char)dir;
 
   Exit:
     *aedge = edge;
@@ -187,6 +194,34 @@
   }
 
 
+  static const char*
+  af_edge_flags_to_string( AF_Edge_Flags  flags )
+  {
+    static char  temp[32];
+    int          pos = 0;
+
+
+    if ( flags &amp; AF_EDGE_ROUND )
+    {
+      memcpy( temp + pos, &quot;round&quot;, 5 );
+      pos += 5;
+    }
+    if ( flags &amp; AF_EDGE_SERIF )
+    {
+      if ( pos &gt; 0 )
+        temp[pos++] = ' ';
+      memcpy( temp + pos, &quot;serif&quot;, 5 );
+      pos += 5;
+    }
+    if ( pos == 0 )
+      return &quot;normal&quot;;
+
+    temp[pos] = 0;
+
+    return temp;
+  }
+
+
   /* A function to dump the array of linked segments. */
   void
   af_glyph_hints_dump_segments( AF_GlyphHints  hints )
@@ -204,19 +239,21 @@
 
       printf ( &quot;Table of %s segments:\n&quot;,
                dimension == AF_DIMENSION_HORZ ? &quot;vertical&quot; : &quot;horizontal&quot; );
-      printf ( &quot;  [ index |  pos |  dir  | link | serif |&quot;
-               &quot; height  | extra ]\n&quot; );
+      printf ( &quot;  [ index |  pos  |  dir  | link | serif |&quot;
+               &quot; height  | extra | flags    ]\n&quot; );
 
       for ( seg = segments; seg &lt; limit; seg++ )
       {
-        printf ( &quot;  [ %5d | %4d | %5s | %4d | %5d | %5d | %5d ]\n&quot;,
+        printf ( &quot;  [ %5d | %5.2g | %5s | %4d | %5d | %5d | %5d | %s ]\n&quot;,
                  seg - segments,
-                 (int)seg-&gt;pos,
+                 dimension == AF_DIMENSION_HORZ ? (int)seg-&gt;first-&gt;ox / 64.0
+                                                : (int)seg-&gt;first-&gt;oy / 64.0,
                  af_dir_str( (AF_Direction)seg-&gt;dir ),
                  AF_INDEX_NUM( seg-&gt;link, segments ),
                  AF_INDEX_NUM( seg-&gt;serif, segments ),
                  seg-&gt;height,
-                 seg-&gt;height - ( seg-&gt;max_coord - seg-&gt;min_coord ) );
+                 seg-&gt;height - ( seg-&gt;max_coord - seg-&gt;min_coord ),
+                 af_edge_flags_to_string( seg-&gt;flags ) );
       }
       printf( &quot;\n&quot; );
     }
@@ -243,21 +280,22 @@
        */
       printf ( &quot;Table of %s edges:\n&quot;,
                dimension == AF_DIMENSION_HORZ ? &quot;vertical&quot; : &quot;horizontal&quot; );
-      printf ( &quot;  [ index |  pos |  dir  | link |&quot;
-               &quot; serif | blue | opos  |  pos  ]\n&quot; );
+      printf ( &quot;  [ index |  pos  |  dir  | link |&quot;
+               &quot; serif | blue | opos  |  pos  | flags   ]\n&quot; );
 
       for ( edge = edges; edge &lt; limit; edge++ )
       {
-        printf ( &quot;  [ %5d | %4d | %5s | %4d |&quot;
-                 &quot; %5d |   %c  | %5.2f | %5.2f ]\n&quot;,
+        printf ( &quot;  [ %5d | %5.2g | %5s | %4d |&quot;
+                 &quot; %5d |   %c  | %5.2f | %5.2f | %s ]\n&quot;,
                  edge - edges,
-                 (int)edge-&gt;fpos,
+                 (int)edge-&gt;opos / 64.0,
                  af_dir_str( (AF_Direction)edge-&gt;dir ),
                  AF_INDEX_NUM( edge-&gt;link, edges ),
                  AF_INDEX_NUM( edge-&gt;serif, edges ),
                  edge-&gt;blue_edge ? 'y' : 'n',
                  edge-&gt;opos / 64.0,
-                 edge-&gt;pos / 64.0 );
+                 edge-&gt;pos / 64.0,
+                 af_edge_flags_to_string( edge-&gt;flags ) );
       }
       printf( &quot;\n&quot; );
     }
@@ -296,9 +334,6 @@
   af_direction_compute( FT_Pos  dx,
                         FT_Pos  dy )
   {
-
-#if 1
-
     FT_Pos        ll, ss;  /* long and short arm lengths */
     AF_Direction  dir;     /* candidate direction        */
 
@@ -334,45 +369,16 @@
       }
     }
 
-    ss *= 12;
-    if ( FT_ABS(ll) &lt;= FT_ABS(ss) )
+    ss *= 14;
+    if ( FT_ABS( ll ) &lt;= FT_ABS( ss ) )
       dir = AF_DIR_NONE;
 
     return dir;
-
-#else /* 0 */
-
-    AF_Direction  dir;
-    FT_Pos        ax = FT_ABS( dx );
-    FT_Pos        ay = FT_ABS( dy );
-
-
-    dir = AF_DIR_NONE;
-
-    /* atan(1/12) == 4.7 degrees */
-
-    /* test for vertical direction */
-    if ( ax * 12 &lt; ay )
-    {
-      dir = dy &gt; 0 ? AF_DIR_UP : AF_DIR_DOWN;
-    }
-    /* test for horizontal direction */
-    else if ( ay * 12 &lt; ax )
-    {
-      dir = dx &gt; 0 ? AF_DIR_RIGHT : AF_DIR_LEFT;
-    }
-
-    return dir;

[... truncated: 7636 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003444.html">[Haiku-commits] r21878 - in haiku/trunk: headers/os/opengl/GL	src/kits/opengl/glu/libnurbs/interface	src/kits/opengl/glu/libnurbs/nurbtess	src/kits/opengl/glu/libutil src/kits/opengl/mesa/glapi	src/kits/opengl/mesa/main src/kits/opengl/mesa/shader	src/kits/opengl/mesa/shader/slang	src/kits/opengl/mesa/shader/slang/library	src/kits/opengl/mesa/sparc src/kits/opengl/mesa/swrast	src/kits/opengl/mesa/tnl src/kits/opengl/mesa/vbo	src/kits/opengl/mesa/x86 src/kits/opengl/mesa/x86-64
</A></li>
	<LI>Next message: <A HREF="003446.html">[Haiku-commits] r21880 - haiku/trunk/src/servers/app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3445">[ date ]</a>
              <a href="thread.html#3445">[ thread ]</a>
              <a href="subject.html#3445">[ subject ]</a>
              <a href="author.html#3445">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
