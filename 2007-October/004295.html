<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r22568 - in haiku/trunk: headers/private/media	src/kits/media
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-October/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22568%20-%20in%20haiku/trunk%3A%20headers/private/media%0A%09src/kits/media&In-Reply-To=%3C200710151409.l9FE9Eg6008580%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004294.html">
   <LINK REL="Next"  HREF="004296.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r22568 - in haiku/trunk: headers/private/media	src/kits/media</H1>
    <B>axeld at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22568%20-%20in%20haiku/trunk%3A%20headers/private/media%0A%09src/kits/media&In-Reply-To=%3C200710151409.l9FE9Eg6008580%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r22568 - in haiku/trunk: headers/private/media	src/kits/media">axeld at mail.berlios.de
       </A><BR>
    <I>Mon Oct 15 16:09:14 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="004294.html">[Haiku-commits] r22567 - in haiku/trunk/src/add-ons/kernel:	bus_managers/agp bus_managers/ide bus_managers/ps2	generic/locked_pool
</A></li>
        <LI>Next message: <A HREF="004296.html">[Haiku-commits] r22569 - haiku/trunk/src/apps/packageinstaller
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4295">[ date ]</a>
              <a href="thread.html#4295">[ thread ]</a>
              <a href="subject.html#4295">[ subject ]</a>
              <a href="author.html#4295">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: axeld
Date: 2007-10-15 16:09:14 +0200 (Mon, 15 Oct 2007)
New Revision: 22568
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=22568&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=22568&amp;view=rev</A>

Modified:
   haiku/trunk/headers/private/media/DefaultMediaTheme.h
   haiku/trunk/src/kits/media/DefaultMediaTheme.cpp
Log:
Some cleanup.


Modified: haiku/trunk/headers/private/media/DefaultMediaTheme.h
===================================================================
--- haiku/trunk/headers/private/media/DefaultMediaTheme.h	2007-10-15 12:48:22 UTC (rev 22567)
+++ haiku/trunk/headers/private/media/DefaultMediaTheme.h	2007-10-15 14:09:14 UTC (rev 22568)
@@ -1,32 +1,34 @@
-/* 
-** Copyright 2003, Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de.</A> All rights reserved.
-** Distributed under the terms of the OpenBeOS License.
-*/
+/*
+ * Copyright 2003-2007, Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de.</A> All rights reserved.
+ * Distributed under the terms of the MIT License.
+ */
 #ifndef DEFAULT_MEDIA_THEME_H
 #define DEFAULT_MEDIA_THEME_H
 
 
 #include &lt;MediaTheme.h&gt;
 
+class BParameterGroup;
 
+
 namespace BPrivate {
 
 class DefaultMediaTheme : public BMediaTheme {
 	public:
 		DefaultMediaTheme();
 
-		virtual	BControl *MakeControlFor(BParameter *parameter);
+		virtual	BControl* MakeControlFor(BParameter* parameter);
 
-		static BControl *MakeViewFor(BParameter *parameter, const BRect *hintRect = NULL);
+		static BControl* MakeViewFor(BParameter* parameter, const BRect* hintRect = NULL);
 			// this is also called by the BMediaTheme::MakeFallbackViewFor()
 			// method - that's why it's a static.
 
 	protected:
-		virtual	BView *MakeViewFor(BParameterWeb *web, const BRect *hintRect = NULL);
+		virtual	BView* MakeViewFor(BParameterWeb* web, const BRect* hintRect = NULL);
 
 	private:
-		BView *MakeViewFor(BParameterGroup &amp;group, const BRect &amp;hintRect);
-		BView *MakeSelfHostingViewFor(BParameter &amp;parameter, const BRect &amp;hintRect);
+		BView* MakeViewFor(BParameterGroup&amp; group, const BRect* hintRect);
+		BView* MakeSelfHostingViewFor(BParameter&amp; parameter, const BRect* hintRect);
 };
 
 }	// namespace BPrivate

Modified: haiku/trunk/src/kits/media/DefaultMediaTheme.cpp
===================================================================
--- haiku/trunk/src/kits/media/DefaultMediaTheme.cpp	2007-10-15 12:48:22 UTC (rev 22567)
+++ haiku/trunk/src/kits/media/DefaultMediaTheme.cpp	2007-10-15 14:09:14 UTC (rev 22568)
@@ -1,7 +1,7 @@
-/* 
-** Copyright 2003-2004, Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de.</A> All rights reserved.
-** Distributed under the terms of the OpenBeOS License.
-*/
+/*
+ * Copyright 2003-2007, Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de.</A> All rights reserved.
+ * Distributed under the terms of the MIT License.
+ */
 
 
 #include &quot;DefaultMediaTheme.h&quot;
@@ -108,7 +108,8 @@
 
 class ContinuousMessageFilter : public MessageFilter {
 	public:
-		ContinuousMessageFilter(BControl *control, BContinuousParameter &amp;parameter);
+		ContinuousMessageFilter(BControl *control,
+			BContinuousParameter &amp;parameter);
 		virtual ~ContinuousMessageFilter();
 
 		virtual filter_result Filter(BMessage *message, BHandler **target);
@@ -254,7 +255,8 @@
 		if (vertical || fIsDocumentScroller)
 			rect.right -= B_V_SCROLL_BAR_WIDTH;
 
-		fHorizontalScrollBar = new BScrollBar(rect, &quot;horizontal&quot;, fTarget, 0, width, B_HORIZONTAL);
+		fHorizontalScrollBar = new BScrollBar(rect, &quot;horizontal&quot;, fTarget, 0,
+			width, B_HORIZONTAL);
 		fTarget-&gt;ResizeBy(0, -B_H_SCROLL_BAR_HEIGHT);
 		AddChild(fHorizontalScrollBar);
 		horizontalChanged = true;
@@ -266,7 +268,8 @@
 		if (horizontal || fIsDocumentScroller)
 			rect.bottom -= B_H_SCROLL_BAR_HEIGHT;
 
-		fVerticalScrollBar = new BScrollBar(rect, &quot;vertical&quot;, fTarget, 0, height, B_VERTICAL);
+		fVerticalScrollBar = new BScrollBar(rect, &quot;vertical&quot;, fTarget, 0,
+			height, B_VERTICAL);
 		fTarget-&gt;ResizeBy(-B_V_SCROLL_BAR_WIDTH, 0);
 		AddChild(fVerticalScrollBar);
 		verticalChanged = true;
@@ -274,10 +277,14 @@
 
 	// adapt the scroll bars, so that they don't overlap each other
 	if (!fIsDocumentScroller) {
-		if (horizontalChanged &amp;&amp; !verticalChanged &amp;&amp; vertical)
-			fVerticalScrollBar-&gt;ResizeBy(0, (horizontal ? -1 : 1) * B_H_SCROLL_BAR_HEIGHT);
-		if (verticalChanged &amp;&amp; !horizontalChanged &amp;&amp; horizontal)
-			fHorizontalScrollBar-&gt;ResizeBy((vertical ? -1 : 1) * B_V_SCROLL_BAR_WIDTH, 0);
+		if (horizontalChanged &amp;&amp; !verticalChanged &amp;&amp; vertical) {
+			fVerticalScrollBar-&gt;ResizeBy(0, (horizontal ? -1 : 1)
+				* B_H_SCROLL_BAR_HEIGHT);
+		}
+		if (verticalChanged &amp;&amp; !horizontalChanged &amp;&amp; horizontal) {
+			fHorizontalScrollBar-&gt;ResizeBy((vertical ? -1 : 1)
+				* B_V_SCROLL_BAR_WIDTH, 0);
+		}
 	}
 
 	// update the scroll bar range &amp; proportions
@@ -481,7 +488,8 @@
 		font_height fontHeight;
 		GetFontHeight(&amp;fontHeight);
 
-		*_height = fontHeight.ascent + fontHeight.descent + fontHeight.leading + 8;
+		*_height = fontHeight.ascent + fontHeight.descent + fontHeight.leading
+			+ 8;
 	}
 }
 
@@ -504,11 +512,13 @@
 
 	switch (parameter.Type()) {
 		case BParameter::B_CONTINUOUS_PARAMETER:
-			return new ContinuousMessageFilter(control, static_cast&lt;BContinuousParameter &amp;&gt;(parameter));
+			return new ContinuousMessageFilter(control,
+				static_cast&lt;BContinuousParameter &amp;&gt;(parameter));
 
 		case BParameter::B_DISCRETE_PARAMETER:
-			return new DiscreteMessageFilter(control, static_cast&lt;BDiscreteParameter &amp;&gt;(parameter));
-			
+			return new DiscreteMessageFilter(control,
+				static_cast&lt;BDiscreteParameter &amp;&gt;(parameter));
+
 		case BParameter::B_NULL_PARAMETER: /* fall through */
 		default:
 			return NULL;
@@ -519,7 +529,8 @@
 //	#pragma mark -
 
 
-ContinuousMessageFilter::ContinuousMessageFilter(BControl *control, BContinuousParameter &amp;parameter)
+ContinuousMessageFilter::ContinuousMessageFilter(BControl *control,
+		BContinuousParameter &amp;parameter)
 	: MessageFilter(),
 	fParameter(parameter)
 {
@@ -589,7 +600,8 @@
 //	#pragma mark -
 
 
-DiscreteMessageFilter::DiscreteMessageFilter(BControl *control, BDiscreteParameter &amp;parameter)
+DiscreteMessageFilter::DiscreteMessageFilter(BControl *control,
+		BDiscreteParameter &amp;parameter)
 	: MessageFilter(),
 	fParameter(parameter)
 {
@@ -653,7 +665,7 @@
 
 
 DefaultMediaTheme::DefaultMediaTheme()
-	: BMediaTheme(&quot;BeOS Theme&quot;, &quot;BeOS built-in theme version 0.1&quot;)
+	: BMediaTheme(&quot;Haiku Theme&quot;, &quot;Haiku built-in theme version 0.1&quot;)
 {
 	CALLED();
 }
@@ -698,7 +710,7 @@
 		if (group == NULL)
 			continue;
 
-		BView *groupView = MakeViewFor(*group, rect);
+		BView *groupView = MakeViewFor(*group, hintRect ? &amp;rect : NULL);
 		if (groupView == NULL)
 			continue;
 
@@ -706,7 +718,8 @@
 			// the top-level group views must not be larger than their hintRect,
 			// but unlike their children, they should follow all sides when
 			// their parent is resized
-			view-&gt;ResizeTo(rect.Width() - 10, rect.Height() - 10);
+			if (hintRect != NULL)
+				view-&gt;ResizeTo(rect.Width() - 10, rect.Height() - 10);
 			view-&gt;SetResizingMode(B_FOLLOW_ALL);
 		}
 
@@ -728,14 +741,17 @@
 
 
 BView *
-DefaultMediaTheme::MakeViewFor(BParameterGroup &amp;group, const BRect &amp;hintRect)
+DefaultMediaTheme::MakeViewFor(BParameterGroup&amp; group, const BRect* hintRect)
 {
 	CALLED();
 
 	if (group.Flags() &amp; B_HIDDEN_PARAMETER)
 		return NULL;
 
-	BRect rect(hintRect);
+	BRect rect;
+	if (hintRect != NULL)
+		rect = *hintRect;
+
 	GroupView *view = new GroupView(rect, group.Name());
 
 	// Create the parameter views - but don't add them yet
@@ -749,7 +765,8 @@
 		if (parameter == NULL)
 			continue;
 
-		BView *parameterView = MakeSelfHostingViewFor(*parameter, rect);
+		BView *parameterView = MakeSelfHostingViewFor(*parameter,
+			hintRect ? &amp;rect : NULL);
 		if (parameterView == NULL)
 			continue;
 
@@ -779,7 +796,7 @@
 		if (subGroup == NULL)
 			continue;
 
-		BView *groupView = MakeViewFor(*subGroup, rect);
+		BView *groupView = MakeViewFor(*subGroup, &amp;rect);
 		if (groupView == NULL)
 			continue;
 
@@ -864,18 +881,18 @@
 }
 
 
-/** This creates a view that handles all incoming messages itself - that's
- *	what is meant with self-hosting.
- */
-
+/*!	This creates a view that handles all incoming messages itself - that's
+	what is meant with self-hosting.
+*/
 BView *
-DefaultMediaTheme::MakeSelfHostingViewFor(BParameter &amp;parameter, const BRect &amp;hintRect)
+DefaultMediaTheme::MakeSelfHostingViewFor(BParameter&amp; parameter,
+	const BRect* hintRect)
 {
 	if (parameter.Flags() &amp; B_HIDDEN_PARAMETER
 		|| parameter_should_be_hidden(parameter))
 		return NULL;
 
-	BView *view = MakeViewFor(&amp;parameter, &amp;hintRect);
+	BView *view = MakeViewFor(&amp;parameter, hintRect);
 	if (view == NULL) {
 		// The MakeViewFor() method above returns a BControl - which we
 		// don't need for a null parameter; that's why it returns NULL.
@@ -886,12 +903,13 @@
 				// this is the first parameter in this group, so
 				// let's use a nice title view
 
-				TitleView *titleView = new TitleView(hintRect, parameter.Name());
+				TitleView *titleView = new TitleView(BRect(0, 0, 10, 10), parameter.Name());
 				titleView-&gt;ResizeToPreferred();
 
 				return titleView;
 			}
-			BStringView *stringView = new BStringView(hintRect, parameter.Name(), parameter.Name());
+			BStringView *stringView = new BStringView(BRect(0, 0, 10, 10),
+				parameter.Name(), parameter.Name());
 			stringView-&gt;SetAlignment(B_ALIGN_CENTER);
 			stringView-&gt;ResizeToPreferred();
 
@@ -932,14 +950,15 @@
 				|| discrete.CountItems() == 0) {
 				// create a checkbox item
 
-				BCheckBox *checkBox = new BCheckBox(rect, discrete.Name(), discrete.Name(), NULL);
+				BCheckBox *checkBox = new BCheckBox(rect, discrete.Name(),
+					discrete.Name(), NULL);
 				checkBox-&gt;ResizeToPreferred();
 
 				return checkBox;
 			} else {
 				// create a pop up menu field
 
-				// ToDo: replace BOptionPopUp (or fix it in OpenBeOS...)
+				// ToDo: replace BOptionPopUp (or fix it in Haiku...)
 				// this is a workaround for a bug in BOptionPopUp - you need to
 				// know the actual width before creating the object - very nice...
 
@@ -953,7 +972,8 @@
 				width += font.StringWidth(discrete.Name()) + 55;
 				rect.right = rect.left + width;
 
-				BOptionPopUp *popUp = new BOptionPopUp(rect, discrete.Name(), discrete.Name(), NULL);
+				BOptionPopUp *popUp = new BOptionPopUp(rect, discrete.Name(),
+					discrete.Name(), NULL);
 
 				for (int32 i = 0; i &lt; discrete.CountItems(); i++) {
 					popUp-&gt;AddOption(discrete.ItemNameAt(i), discrete.ItemValueAt(i));
@@ -970,8 +990,7 @@
 			BContinuousParameter &amp;continuous = static_cast&lt;BContinuousParameter &amp;&gt;(*parameter);
 
 			if (!strcmp(continuous.Kind(), B_MASTER_GAIN)
-				|| !strcmp(continuous.Kind(), B_GAIN))
-			{
+				|| !strcmp(continuous.Kind(), B_GAIN)) {
 				BChannelSlider *slider = new BChannelSlider(rect, continuous.Name(),
 					continuous.Name(), NULL, B_VERTICAL, continuous.CountChannels());
 
@@ -994,8 +1013,10 @@
 
 				// ToDo: take BContinuousParameter::GetResponse() &amp; ValueStep() into account!
 
-				for (int32 i = 0; i &lt; continuous.CountChannels(); i++)
-					slider-&gt;SetLimitsFor(i, int32(continuous.MinValue() * 1000), int32(continuous.MaxValue() * 1000));
+				for (int32 i = 0; i &lt; continuous.CountChannels(); i++) {
+					slider-&gt;SetLimitsFor(i, int32(continuous.MinValue() * 1000),
+						int32(continuous.MaxValue() * 1000));
+				}
 
 				return slider;
 			}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004294.html">[Haiku-commits] r22567 - in haiku/trunk/src/add-ons/kernel:	bus_managers/agp bus_managers/ide bus_managers/ps2	generic/locked_pool
</A></li>
	<LI>Next message: <A HREF="004296.html">[Haiku-commits] r22569 - haiku/trunk/src/apps/packageinstaller
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4295">[ date ]</a>
              <a href="thread.html#4295">[ thread ]</a>
              <a href="subject.html#4295">[ subject ]</a>
              <a href="author.html#4295">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
