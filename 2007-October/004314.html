<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r22587 - in haiku/trunk: headers/private/storage	src/kits/storage
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-October/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22587%20-%20in%20haiku/trunk%3A%20headers/private/storage%0A%09src/kits/storage&In-Reply-To=%3C200710160032.l9G0WhLP020935%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004313.html">
   <LINK REL="Next"  HREF="004315.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r22587 - in haiku/trunk: headers/private/storage	src/kits/storage</H1>
    <B>bonefish at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22587%20-%20in%20haiku/trunk%3A%20headers/private/storage%0A%09src/kits/storage&In-Reply-To=%3C200710160032.l9G0WhLP020935%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r22587 - in haiku/trunk: headers/private/storage	src/kits/storage">bonefish at mail.berlios.de
       </A><BR>
    <I>Tue Oct 16 02:32:43 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="004313.html">[Haiku-commits] r22586 - haiku/trunk/src/add-ons/accelerants/radeon
</A></li>
        <LI>Next message: <A HREF="004315.html">[Haiku-commits] r22588 - haiku/trunk/src/add-ons/accelerants/radeon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4314">[ date ]</a>
              <a href="thread.html#4314">[ thread ]</a>
              <a href="subject.html#4314">[ subject ]</a>
              <a href="author.html#4314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2007-10-16 02:32:41 +0200 (Tue, 16 Oct 2007)
New Revision: 22587
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=22587&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=22587&amp;view=rev</A>

Modified:
   haiku/trunk/headers/private/storage/Partition.h
   haiku/trunk/src/kits/storage/Partition.cpp
Log:
Coding style cleanup.


Modified: haiku/trunk/headers/private/storage/Partition.h
===================================================================
--- haiku/trunk/headers/private/storage/Partition.h	2007-10-16 00:00:09 UTC (rev 22586)
+++ haiku/trunk/headers/private/storage/Partition.h	2007-10-16 00:32:41 UTC (rev 22587)
@@ -1,8 +1,7 @@
-//----------------------------------------------------------------------
-//  This software is part of the Haiku distribution and is covered 
-//  by the MIT license.
-//---------------------------------------------------------------------
-
+/*
+ * Copyright 2003-2007, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at cs.tu-berlin.de.</A>
+ * Distributed under the terms of the MIT License.
+ */
 #ifndef _PARTITION_H
 #define _PARTITION_H
 
@@ -11,6 +10,7 @@
 #include &lt;Mime.h&gt;
 #include &lt;ObjectList.h&gt;
 
+
 class BBitmap;
 class BDiskDevice;
 class BDiskDeviceParameterEditor;
@@ -22,166 +22,187 @@
 class BVolume;
 struct user_partition_data;
 
+
 class BPartition {
 public:
 	// Partition Info
 
-	off_t Offset() const;		// 0 for devices
-	off_t Size() const;
-	off_t ContentSize() const;	// 0 if uninitialized
-	uint32 BlockSize() const;
-	int32 Index() const;		// 0 for devices
-	uint32 Status() const;
+			off_t				Offset() const;		// 0 for devices
+			off_t				Size() const;
+			off_t				ContentSize() const;	// 0 if uninitialized
+			uint32				BlockSize() const;
+			int32				Index() const;		// 0 for devices
+			uint32				Status() const;
 	
-	bool ContainsFileSystem() const;
-	bool ContainsPartitioningSystem() const;
+			bool				ContainsFileSystem() const;
+			bool				ContainsPartitioningSystem() const;
 
-	bool IsDevice() const;
-	bool IsReadOnly() const;
-	bool IsMounted() const;
-	bool IsBusy() const;
+			bool				IsDevice() const;
+			bool				IsReadOnly() const;
+			bool				IsMounted() const;
+			bool				IsBusy() const;
 
-	uint32 Flags() const;		
+			uint32				Flags() const;		
 	
-	const char *Name() const;
-	const char *ContentName() const;
-	const char *Type() const;			// See DiskDeviceTypes.h
-	const char *ContentType() const;	// See DiskDeviceTypes.h
-	partition_id ID() const;
+			const char*			Name() const;
+			const char*			ContentName() const;
+			const char*			Type() const;			// See DiskDeviceTypes.h
+			const char*			ContentType() const;	// See DiskDeviceTypes.h
+			partition_id		ID() const;
+			const char*			Parameters() const;
+			const char*			ContentParameters() const;
 
-	const char* Parameters() const;
-	const char* ContentParameters() const;
-
-	status_t GetDiskSystem(BDiskSystem *diskSystem) const;
+			status_t			GetDiskSystem(BDiskSystem* diskSystem) const;
 	
-	virtual status_t GetPath(BPath *path) const;
-	status_t GetVolume(BVolume *volume) const;
-	status_t GetIcon(BBitmap *icon, icon_size which) const;
-	status_t GetMountPoint(BPath *mountPoint) const;
+	virtual	status_t			GetPath(BPath* path) const;
+			status_t			GetVolume(BVolume* volume) const;
+			status_t			GetIcon(BBitmap* icon, icon_size which) const;
+			status_t			GetMountPoint(BPath* mountPoint) const;
 
-	dev_t Mount(const char *mountPoint = NULL, uint32 mountFlags = 0,
-		const char *parameters = NULL);
-	status_t Unmount(uint32 unmountFlags = 0);
+			dev_t				Mount(const char* mountPoint = NULL,
+									uint32 mountFlags = 0,
+									const char* parameters = NULL);
+			status_t			Unmount(uint32 unmountFlags = 0);
 
 	// Hierarchy Info
 
-	BDiskDevice *Device() const;
-	BPartition *Parent() const;
-	BPartition *ChildAt(int32 index) const;
-	int32 CountChildren() const;
-	BPartition *FindDescendant(partition_id id) const;
+			BDiskDevice*		Device() const;
+			BPartition*			Parent() const;
+			BPartition*			ChildAt(int32 index) const;
+			int32				CountChildren() const;
+			BPartition*			FindDescendant(partition_id id) const;
 
-	status_t GetPartitioningInfo(BPartitioningInfo *info) const;
+			status_t			GetPartitioningInfo(
+									BPartitioningInfo* info) const;
 	
-	BPartition *VisitEachChild(BDiskDeviceVisitor *visitor);
-	virtual BPartition *VisitEachDescendant(BDiskDeviceVisitor *visitor);
+			BPartition*			VisitEachChild(BDiskDeviceVisitor* visitor);
+	virtual BPartition*			VisitEachDescendant(
+									BDiskDeviceVisitor* visitor);
 
 	// Self Modification
 
-	bool CanDefragment(bool *whileMounted = NULL) const;
-	status_t Defragment() const;
+			bool				CanDefragment(bool* whileMounted = NULL) const;
+			status_t			Defragment() const;
 	
-	bool CanRepair(bool checkOnly, bool *whileMounted = NULL) const;
-	status_t Repair(bool checkOnly) const;
+			bool				CanRepair(bool checkOnly,
+									bool* whileMounted = NULL) const;
+			status_t			Repair(bool checkOnly) const;
 
-	bool CanResize(bool *canResizeContents = NULL,
-				   bool *whileMounted = NULL) const;
-	status_t ValidateResize(off_t *size) const;
-	status_t Resize(off_t size);
+			bool				CanResize(bool* canResizeContents = NULL,
+									bool* whileMounted = NULL) const;
+			status_t			ValidateResize(off_t* size) const;
+			status_t			Resize(off_t size);
 
-	bool CanMove(BObjectList&lt;BPartition&gt; *unmovableDescendants = NULL,
-				 BObjectList&lt;BPartition&gt; *movableOnlyIfUnmounted = NULL) const;
-	status_t ValidateMove(off_t *newOffset) const;
-	status_t Move(off_t newOffset);
+			bool				CanMove(BObjectList&lt;BPartition&gt;*
+										unmovableDescendants = NULL,
+									BObjectList&lt;BPartition&gt;*
+										movableOnlyIfUnmounted = NULL) const;
+			status_t			ValidateMove(off_t* newOffset) const;
+			status_t			Move(off_t newOffset);
 
-	bool CanSetName() const;
-	status_t ValidateSetName(BString* name) const;
-		// adjusts name to be suitable
-	status_t SetName(const char *name);
+			bool				CanSetName() const;
+			status_t			ValidateSetName(BString* name) const;
+									// adjusts name to be suitable
+			status_t			SetName(const char* name);
 
-	bool CanSetContentName(bool *whileMounted = NULL) const;
-	status_t ValidateSetContentName(BString* name) const;
-		// adjusts name to be suitable
-	status_t SetContentName(const char *name);
+			bool				CanSetContentName(
+									bool* whileMounted = NULL) const;
+			status_t			ValidateSetContentName(BString* name) const;
+									// adjusts name to be suitable
+			status_t			SetContentName(const char* name);
 
-	bool CanSetType() const;
-	status_t ValidateSetType(const char *type) const;
-		// type must be one the parent disk system's GetNextSupportedType()
-		// returns.
-	status_t SetType(const char *type);
+			bool				CanSetType() const;
+			status_t			ValidateSetType(const char* type) const;
+									// type must be one the parent disk system's
+									// GetNextSupportedType() returns.
+			status_t			SetType(const char* type);
 
-	bool CanEditParameters() const;
-	status_t GetParameterEditor(BDiskDeviceParameterEditor **editor);
-    status_t SetParameters(const char *parameters);
+			bool				CanEditParameters() const;
+			status_t			GetParameterEditor(
+									BDiskDeviceParameterEditor** editor);
+			status_t			SetParameters(const char* parameters);
 
-	bool CanEditContentParameters(bool *whileMounted = NULL) const;
-	status_t GetContentParameterEditor(BDiskDeviceParameterEditor **editor);
-    status_t SetContentParameters(const char *parameters);
+			bool				CanEditContentParameters(
+									bool* whileMounted = NULL) const;
+			status_t			GetContentParameterEditor(
+									BDiskDeviceParameterEditor** editor);
+			status_t			SetContentParameters(const char* parameters);
 
-	bool CanInitialize(const char *diskSystem) const;
-	status_t GetInitializationParameterEditor(const char *system,       
-               BDiskDeviceParameterEditor **editor) const;
-	status_t ValidateInitialize(const char *diskSystem, BString* name,
-								const char *parameters);
-	status_t Initialize(const char *diskSystem, const char *name,
-						const char *parameters);
-	status_t Uninitialize();
+			bool				CanInitialize(const char* diskSystem) const;
+			status_t			GetInitializationParameterEditor(
+									const char* system,       
+									BDiskDeviceParameterEditor** editor) const;
+			status_t			ValidateInitialize(const char* diskSystem,
+									BString* name, const char* parameters);
+			status_t			Initialize(const char* diskSystem,
+									const char* name, const char* parameters);
+			status_t			Uninitialize();
 	
 	// Modification of child partitions
 
-	bool CanCreateChild() const;
-	status_t GetChildCreationParameterEditor(const char *type,
-               BDiskDeviceParameterEditor **editor) const;
-	status_t ValidateCreateChild(off_t* start, off_t* size,
-				const char* type, BString* name, const char* parameters) const;
-	status_t CreateChild(off_t start, off_t size, const char* type,
-		const char* name, const char* parameters, BPartition** child = NULL);
+			bool				CanCreateChild() const;
+			status_t			GetChildCreationParameterEditor(
+									const char* type,
+									BDiskDeviceParameterEditor** editor) const;
+			status_t			ValidateCreateChild(off_t* start, off_t* size,
+									const char* type, BString* name,
+									const char* parameters) const;
+			status_t			CreateChild(off_t start, off_t size,
+									const char* type, const char* name,
+									const char* parameters,
+									BPartition** child = NULL);
 	
-	bool CanDeleteChild(int32 index) const;
-	status_t DeleteChild(int32 index);
+			bool				CanDeleteChild(int32 index) const;
+			status_t			DeleteChild(int32 index);
 	
 private:
-	class Delegate;
+			class Delegate;
 
-	BPartition();
-	BPartition(const BPartition &amp;);
-	virtual ~BPartition();
-	BPartition &amp; operator=(const BPartition &amp;);
+								BPartition();
+								BPartition(const BPartition&amp;);
+	virtual						~BPartition();
 
-	status_t _SetTo(BDiskDevice *device, BPartition *parent,
-					user_partition_data *data);
-	void _Unset();
-	status_t _RemoveObsoleteDescendants(user_partition_data *data,
-										bool *updated);
-	status_t _Update(user_partition_data *data, bool *updated);
-	void _RemoveChild(int32 index);
+			BPartition&amp;			operator=(const BPartition&amp;);
 
-	bool _IsShadow() const;
-	partition_id _ShadowID() const;
-	disk_system_id _DiskSystem() const;
-	int32 _ChangeCounter() const;
+			status_t			_SetTo(BDiskDevice* device, BPartition* parent,
+									user_partition_data* data);
+			void				_Unset();
+			status_t			_RemoveObsoleteDescendants(
+									user_partition_data* data, bool* updated);
+			status_t			_Update(user_partition_data* data,
+									bool* updated);
+			void				_RemoveChild(int32 index);
 
-	int32 _CountDescendants() const;
-	int32 _Level() const;
-	virtual bool _AcceptVisitor(BDiskDeviceVisitor *visitor, int32 level);
-	BPartition *_VisitEachDescendant(BDiskDeviceVisitor *visitor,
-									 int32 level = -1);
+			bool				_IsShadow() const;
+			partition_id		_ShadowID() const;
+			disk_system_id		_DiskSystem() const;
+			int32				_ChangeCounter() const;
 
-	const user_partition_data* _PartitionData() const;
+			int32				_CountDescendants() const;
+			int32				_Level() const;
+			virtual	bool		_AcceptVisitor(BDiskDeviceVisitor* visitor,
+									int32 level);
+			BPartition*			_VisitEachDescendant(
+									BDiskDeviceVisitor* visitor,
+									int32 level = -1);
 
-	bool _HasContent() const;
-	bool _SupportsOperation(uint32 flag, uint32 whileMountedFlag,
-		bool* whileMounted) const;
-	bool _SupportsChildOperation(const BPartition* child, uint32 flag) const;
+			const user_partition_data* _PartitionData() const;
 
-	friend class BDiskDevice;
-	friend class BDiskSystem;
-	friend class BMutablePartition;
+			bool				_HasContent() const;
+			bool				_SupportsOperation(uint32 flag,
+									uint32 whileMountedFlag,
+									bool* whileMounted) const;
+			bool				_SupportsChildOperation(const BPartition* child,
+									uint32 flag) const;
 
-	BDiskDevice*			fDevice;
-	BPartition*				fParent;
-	user_partition_data*	fPartitionData;
-	Delegate*				fDelegate;
+			friend class BDiskDevice;
+			friend class BDiskSystem;
+			friend class BMutablePartition;
+
+			BDiskDevice*		fDevice;
+			BPartition*			fParent;
+			user_partition_data* fPartitionData;
+			Delegate*			fDelegate;
 };
 
 #endif	// _PARTITION_H

Modified: haiku/trunk/src/kits/storage/Partition.cpp
===================================================================
--- haiku/trunk/src/kits/storage/Partition.cpp	2007-10-16 00:00:09 UTC (rev 22586)
+++ haiku/trunk/src/kits/storage/Partition.cpp	2007-10-16 00:32:41 UTC (rev 22587)
@@ -1,9 +1,6 @@
 /*
- * Copyright 2003-2007, Haiku, Inc. All Rights Reserved.
+ * Copyright 2003-2007, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at cs.tu-berlin.de.</A>
  * Distributed under the terms of the MIT License.
- *
- * Authors:
- *		Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at cs.tu-berlin.de</A>
  */
 
 #include &lt;errno.h&gt;
@@ -57,9 +54,8 @@
 			0, if they are equal, or a value greater than 0, if
 			\a str1 is greater \a str2.
 */
-static inline
-int
-compare_string(const char *str1, const char *str2)
+static inline int
+compare_string(const char* str1, const char* str2)
 {
 	if (str1 == NULL) {
 		if (str2 == NULL)
@@ -236,7 +232,7 @@
 	\return The name of the partition, or \c NULL, if the partitioning system
 			does not support names.
 */
-const char *
+const char*
 BPartition::Name() const
 {
 	return _PartitionData()-&gt;name;
@@ -244,7 +240,7 @@
 
 
 // ContentName
-const char *
+const char*
 BPartition::ContentName() const
 {
 	return _PartitionData()-&gt;content_name;
@@ -255,7 +251,7 @@
 /*!	\brief Returns a human readable string for the type of the partition.
 	\return A human readable string for the type of the partition.
 */
-const char *
+const char*
 BPartition::Type() const
 {
 	return _PartitionData()-&gt;type;
@@ -263,7 +259,7 @@
 
 
 // ContentType
-const char *
+const char*
 BPartition::ContentType() const
 {
 	return _PartitionData()-&gt;content_type;
@@ -305,7 +301,7 @@
 
 // GetDiskSystem
 status_t
-BPartition::GetDiskSystem(BDiskSystem *diskSystem) const
+BPartition::GetDiskSystem(BDiskSystem* diskSystem) const
 {
 	const user_partition_data* data = _PartitionData();
 	if (!data || !diskSystem)
@@ -320,7 +316,7 @@
 
 // GetPath
 status_t
-BPartition::GetPath(BPath *path) const
+BPartition::GetPath(BPath* path) const
 {
 	// The path is constructed on the fly using our parent
 	if (path == NULL || Parent() == NULL || Index() &lt; 0)
@@ -335,7 +331,7 @@
 
 	if (Parent()-&gt;IsDevice()) {
 		// Our parent is a device, so we replace `raw' by our index.
-		const char *leaf = path-&gt;Leaf();
+		const char* leaf = path-&gt;Leaf();
 		if (!leaf || strcmp(leaf, &quot;raw&quot;) != B_OK)
 			return B_ERROR;
 
@@ -364,7 +360,7 @@
 			accordingly, another error code otherwise.
 */
 status_t
-BPartition::GetVolume(BVolume *volume) const
+BPartition::GetVolume(BVolume* volume) const
 {
 	if (volume)
 		return B_BAD_VALUE;
@@ -387,7 +383,7 @@
 	\return \c B_OK, if everything went fine, another error code otherwise.
 */
 status_t
-BPartition::GetIcon(BBitmap *icon, icon_size which) const
+BPartition::GetIcon(BBitmap* icon, icon_size which) const
 {
 /*
 	status_t error = (icon ? B_OK : B_BAD_VALUE);
@@ -400,7 +396,7 @@
 				error = volume.GetIcon(icon, which);
 		} else {
 			// not mounted: retrieve the icon ourselves
-			if (BDiskDevice *device = Device()) {
+			if (BDiskDevice* device = Device()) {
 				// get the icon
 				if (error == B_OK)
 					error = get_device_icon(device-&gt;Path(), icon, which);
@@ -430,7 +426,7 @@
 	\return \c B_OK, if everything went fine, an error code otherwise.
 */
 status_t
-BPartition::GetMountPoint(BPath *mountPoint) const
+BPartition::GetMountPoint(BPath* mountPoint) const
 {
 	if (!mountPoint || !ContainsFileSystem())
 		return B_BAD_VALUE;
@@ -447,7 +443,7 @@
 
 	// partition not mounted
 	// get the volume name
-	const char *volumeName = ContentName();
+	const char* volumeName = ContentName();
 	if (!volumeName || strlen(volumeName) == 0)
 		volumeName = Name();
 	if (!volumeName || strlen(volumeName) == 0)
@@ -498,8 +494,8 @@
 	\return \c B_OK, if everything went fine, another error code otherwise.
 */
 dev_t
-BPartition::Mount(const char *mountPoint, uint32 mountFlags,
-	const char *parameters)
+BPartition::Mount(const char* mountPoint, uint32 mountFlags,
+	const char* parameters)
 {
 	if (IsMounted() || !ContainsFileSystem())
 		return B_BAD_VALUE;
@@ -582,7 +578,7 @@
 /*!	\brief Returns the device this partition resides on.
 	\return The device this partition resides on.
 */
-BDiskDevice *
+BDiskDevice*
 BPartition::Device() const
 {
 	return fDevice;
@@ -590,7 +586,7 @@
 
 
 // Parent
-BPartition *
+BPartition*
 BPartition::Parent() const
 {
 	return fParent;
@@ -598,7 +594,7 @@
 
 
 // ChildAt
-BPartition *
+BPartition*
 BPartition::ChildAt(int32 index) const
 {
 	if (fDelegate) {
@@ -624,7 +620,7 @@
 
 
 // FindDescendant
-BPartition *
+BPartition*
 BPartition::FindDescendant(partition_id id) const
 {
 	IDFinderVisitor visitor(id);
@@ -634,7 +630,7 @@
 
 // GetPartitioningInfo
 status_t
-BPartition::GetPartitioningInfo(BPartitioningInfo *info) const
+BPartition::GetPartitioningInfo(BPartitioningInfo* info) const
 {
 	if (!fDelegate || !info)
 		return B_BAD_VALUE;
@@ -644,12 +640,12 @@
 
 
 // VisitEachChild
-BPartition *
-BPartition::VisitEachChild(BDiskDeviceVisitor *visitor)
+BPartition*
+BPartition::VisitEachChild(BDiskDeviceVisitor* visitor)
 {
 	if (visitor) {
 		int32 level = _Level();
-		for (int32 i = 0; BPartition *child = ChildAt(i); i++) {
+		for (int32 i = 0; BPartition* child = ChildAt(i); i++) {
 			if (child-&gt;_AcceptVisitor(visitor, level))
 				return child;
 		}
@@ -659,8 +655,8 @@
 
 
 // VisitEachDescendant
-BPartition *
-BPartition::VisitEachDescendant(BDiskDeviceVisitor *visitor)
+BPartition*
+BPartition::VisitEachDescendant(BDiskDeviceVisitor* visitor)
 {
 	if (visitor)
 		return _VisitEachDescendant(visitor);
@@ -670,7 +666,7 @@
 
 // CanDefragment
 bool
-BPartition::CanDefragment(bool *whileMounted) const
+BPartition::CanDefragment(bool* whileMounted) const
 {
 	return _SupportsOperation(B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING,
 		B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING_WHILE_MOUNTED, whileMounted);
@@ -690,7 +686,7 @@
 
 // CanRepair
 bool
-BPartition::CanRepair(bool checkOnly, bool *whileMounted) const
+BPartition::CanRepair(bool checkOnly, bool* whileMounted) const
 {
 	uint32 flag;
 	uint32 whileMountedFlag;
@@ -719,7 +715,7 @@
 
 // CanResize
 bool
-BPartition::CanResize(bool *canResizeContents, bool *whileMounted) const
+BPartition::CanResize(bool* canResizeContents, bool* whileMounted) const
 {
 	BPartition* parent = Parent();
 	if (!parent)
@@ -740,7 +736,7 @@
 
 // ValidateResize
 status_t
-BPartition::ValidateResize(off_t *size) const
+BPartition::ValidateResize(off_t* size) const
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -809,8 +805,8 @@
 
 // CanMove
 bool
-BPartition::CanMove(BObjectList&lt;BPartition&gt; *unmovableDescendants,
-					BObjectList&lt;BPartition&gt; *movableOnlyIfUnmounted) const
+BPartition::CanMove(BObjectList&lt;BPartition&gt;* unmovableDescendants,
+	BObjectList&lt;BPartition&gt;* movableOnlyIfUnmounted) const
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -823,7 +819,7 @@
 
 	bool whileMounted;
 	bool movable = _SupportsOperation(B_DISK_SYSTEM_SUPPORTS_MOVING,
-			B_DISK_SYSTEM_SUPPORTS_MOVING_WHILE_MOUNTED, &amp;whileMounted);
+		B_DISK_SYSTEM_SUPPORTS_MOVING_WHILE_MOUNTED, &amp;whileMounted);
 	if (!movable)
 		return false;
 
@@ -842,7 +838,7 @@
 
 // ValidateMove
 status_t
-BPartition::ValidateMove(off_t *offset) const
+BPartition::ValidateMove(off_t* offset) const
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -897,7 +893,7 @@
 		return false;
 
 	return parent-&gt;_SupportsChildOperation(this,
-			B_DISK_SYSTEM_SUPPORTS_SETTING_NAME);
+		B_DISK_SYSTEM_SUPPORTS_SETTING_NAME);
 }
 
 
@@ -915,7 +911,7 @@
 
 // SetName
 status_t
-BPartition::SetName(const char *name)
+BPartition::SetName(const char* name)
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -927,7 +923,7 @@
 
 // CanSetContentName
 bool
-BPartition::CanSetContentName(bool *whileMounted) const
+BPartition::CanSetContentName(bool* whileMounted) const
 {
 	return _SupportsOperation(B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_NAME,
 		B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_NAME_WHILE_MOUNTED,
@@ -948,7 +944,7 @@
 
 // SetContentName
 status_t
-BPartition::SetContentName(const char *name)
+BPartition::SetContentName(const char* name)
 {
 	if (!fDelegate)
 		return B_BAD_VALUE;
@@ -966,13 +962,13 @@
 		return false;
 
 	return parent-&gt;_SupportsChildOperation(this,
-			B_DISK_SYSTEM_SUPPORTS_SETTING_TYPE);
+		B_DISK_SYSTEM_SUPPORTS_SETTING_TYPE);
 }
 
 
 // ValidateSetType
 status_t
-BPartition::ValidateSetType(const char *type) const
+BPartition::ValidateSetType(const char* type) const
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -984,7 +980,7 @@
 
 // SetType
 status_t
-BPartition::SetType(const char *type)
+BPartition::SetType(const char* type)
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -1003,13 +999,13 @@
 		return false;
 
 	return parent-&gt;_SupportsChildOperation(this,
-			B_DISK_SYSTEM_SUPPORTS_SETTING_PARAMETERS);
+		B_DISK_SYSTEM_SUPPORTS_SETTING_PARAMETERS);
 }
 
 
 // GetParameterEditor
 status_t
-BPartition::GetParameterEditor(BDiskDeviceParameterEditor **editor)
+BPartition::GetParameterEditor(BDiskDeviceParameterEditor** editor)
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -1021,7 +1017,7 @@
 
 // SetParameters
 status_t
-BPartition::SetParameters(const char *parameters)
+BPartition::SetParameters(const char* parameters)
 {
 	BPartition* parent = Parent();
 	if (!parent || !fDelegate)
@@ -1033,7 +1029,7 @@
 
 // CanEditContentParameters
 bool
-BPartition::CanEditContentParameters(bool *whileMounted) const
+BPartition::CanEditContentParameters(bool* whileMounted) const
 {
 	return _SupportsOperation(B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_PARAMETERS,
 		B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_PARAMETERS_WHILE_MOUNTED,
@@ -1043,7 +1039,7 @@
 
 // GetContentParameterEditor
 status_t
-BPartition::GetContentParameterEditor(BDiskDeviceParameterEditor **editor)
+BPartition::GetContentParameterEditor(BDiskDeviceParameterEditor** editor)
 {
 	if (!fDelegate)
 		return B_BAD_VALUE;
@@ -1054,7 +1050,7 @@
 
 // SetContentParameters
 status_t
-BPartition::SetContentParameters(const char *parameters)
+BPartition::SetContentParameters(const char* parameters)
 {
 	if (!fDelegate)
 		return B_BAD_VALUE;
@@ -1065,7 +1061,7 @@
 
 // CanInitialize
 bool
-BPartition::CanInitialize(const char *diskSystem) const
+BPartition::CanInitialize(const char* diskSystem) const
 {
 	return fDelegate &amp;&amp; fDelegate-&gt;CanInitialize(diskSystem);
 }
@@ -1086,7 +1082,7 @@
 // ValidateInitialize
 status_t
 BPartition::ValidateInitialize(const char* diskSystem, BString* name,
-							   const char* parameters)
+	const char* parameters)
 {
 	if (!fDelegate)
 		return B_BAD_VALUE;
@@ -1097,8 +1093,8 @@
 
 // Initialize
 status_t
-BPartition::Initialize(const char *diskSystem, const char *name,
-					   const char *parameters)
+BPartition::Initialize(const char* diskSystem, const char* name,
+	const char* parameters)
 {
 	if (!fDelegate)
 		return B_BAD_VALUE;
@@ -1150,8 +1146,8 @@
 
 // CreateChild
 status_t
-BPartition::CreateChild(off_t offset, off_t size, const char *type,
-	const char* name, const char *parameters, BPartition **child)
+BPartition::CreateChild(off_t offset, off_t size, const char* type,
+	const char* name, const char* parameters, BPartition** child)
 {
 	if (!fDelegate)
 		return B_BAD_VALUE;
@@ -1205,8 +1201,8 @@
 
 // _SetTo
 status_t
-BPartition::_SetTo(BDiskDevice *device, BPartition *parent,
-				   user_partition_data *data)
+BPartition::_SetTo(BDiskDevice* device, BPartition* parent,
+	user_partition_data* data)
 {
 	_Unset();
 	if (!device || !data)
@@ -1215,10 +1211,11 @@
 	fDevice = device;
 	fParent = parent;
 	fPartitionData-&gt;user_data = this;
+
 	// create and init children
 	status_t error = B_OK;
 	for (int32 i = 0; error == B_OK &amp;&amp; i &lt; fPartitionData-&gt;child_count; i++) {
-		BPartition *child = new(nothrow) BPartition;
+		BPartition* child = new(nothrow) BPartition;
 		if (child) {
 			error = child-&gt;_SetTo(fDevice, this, fPartitionData-&gt;children[i]);
 			if (error != B_OK)
@@ -1226,6 +1223,7 @@
 		} else
 			error = B_NO_MEMORY;
 	}
+
 	// cleanup on error
 	if (error != B_OK)
 		_Unset();
@@ -1240,11 +1238,12 @@
 	// delete children
 	if (fPartitionData) {
 		for (int32 i = 0; i &lt; fPartitionData-&gt;child_count; i++) {
-			if (BPartition *child = ChildAt(i))
+			if (BPartition* child = ChildAt(i))
 				delete child;
 		}
 		fPartitionData-&gt;user_data = NULL;
 	}
+
 	fDevice = NULL;
 	fParent = NULL;
 	fPartitionData = NULL;
@@ -1253,8 +1252,7 @@
 
 // _RemoveObsoleteDescendants
 status_t
-BPartition::_RemoveObsoleteDescendants(user_partition_data *data,
-									   bool *updated)
+BPartition::_RemoveObsoleteDescendants(user_partition_data* data, bool* updated)
 {
 	// remove all children not longer persistent
 	// Not exactly efficient: O(n^2), considering BList::RemoveItem()
@@ -1263,7 +1261,7 @@
 	// BPartition to remove, which makes the list operation definitely O(n).
 	int32 count = CountChildren();
 	for (int32 i = count - 1; i &gt;= 0; i--) {
-		BPartition *child = ChildAt(i);
+		BPartition* child = ChildAt(i);
 		bool found = false;
 		for (int32 k = data-&gt;child_count - 1; k &gt;= 0; k--) {
 			if (data-&gt;children[k]-&gt;id == child-&gt;ID()) {
@@ -1273,12 +1271,14 @@
 					data-&gt;children[k], updated);
 				if (error != B_OK)
 					return error;
+
 				// set the user data to the BPartition object to find it
 				// quicker later
 				data-&gt;children[k]-&gt;user_data = child;
 				break;
 			}
 		}
+
 		// if partition is obsolete, remove it
 		if (!found) {
 			*updated = true;
@@ -1291,9 +1291,9 @@
 
 // _Update
 status_t
-BPartition::_Update(user_partition_data *data, bool *updated)
+BPartition::_Update(user_partition_data* data, bool* updated)
 {
-	user_partition_data *oldData = fPartitionData;
+	user_partition_data* oldData = fPartitionData;
 	fPartitionData = data;
 	// check for changes
 	if (data-&gt;offset != oldData-&gt;offset
@@ -1312,11 +1312,12 @@
 						  oldData-&gt;content_parameters)) {
 		*updated = true;
 	}
+
 	// add new children and update existing ones
 	status_t error = B_OK;
 	for (int32 i = 0; i &lt; data-&gt;child_count; i++) {
-		user_partition_data *childData = data-&gt;children[i];
-		BPartition *child = (BPartition*)childData-&gt;user_data;
+		user_partition_data* childData = data-&gt;children[i];
+		BPartition* child = (BPartition*)childData-&gt;user_data;
 		if (child) {
 			// old partition
 			error = child-&gt;_Update(childData, updated);
@@ -1326,12 +1327,15 @@
 			// new partition
 			*updated = true;
 			child = new(nothrow) BPartition;
-			if (child) {
-				error = child-&gt;_SetTo(fDevice, this, data-&gt;children[i]);
-				if (error != B_OK)
-					delete child;
-			} else
+			if (!child)
 				return B_NO_MEMORY;
+
+			error = child-&gt;_SetTo(fDevice, this, data-&gt;children[i]);
+			if (error != B_OK) {
+				delete child;
+				return error;
+			}
+
 			childData-&gt;user_data = child;
 		}
 	}
@@ -1346,8 +1350,10 @@
 	int32 count = CountChildren();
 	if (!fPartitionData || index &lt; 0 || index &gt;= count)
 		return;
+
 	// delete the BPartition and its children
 	delete ChildAt(index);
+
 	// compact the children array
 	for (int32 i = index + 1; i &lt; count; i++)
 		fPartitionData-&gt;children[i - 1] = fPartitionData-&gt;children[i];
@@ -1392,7 +1398,7 @@
 BPartition::_CountDescendants() const
 {
 	int32 count = 1;
-	for (int32 i = 0; BPartition *child = ChildAt(i); i++)
+	for (int32 i = 0; BPartition* child = ChildAt(i); i++)
 		count += child-&gt;_CountDescendants();
 	return count;
 }
@@ -1403,7 +1409,7 @@
 BPartition::_Level() const
 {
 	int32 level = 0;
-	const BPartition *ancestor = this;
+	const BPartition* ancestor = this;
 	while ((ancestor = ancestor-&gt;Parent()))
 		level++;
 	return level;
@@ -1412,23 +1418,23 @@
 
 // _AcceptVisitor
 bool
-BPartition::_AcceptVisitor(BDiskDeviceVisitor *visitor, int32 level)
+BPartition::_AcceptVisitor(BDiskDeviceVisitor* visitor, int32 level)
 {
 	return visitor-&gt;Visit(this, level);
 }
 
 
 // _VisitEachDescendant
-BPartition *
-BPartition::_VisitEachDescendant(BDiskDeviceVisitor *visitor, int32 level)
+BPartition*
+BPartition::_VisitEachDescendant(BDiskDeviceVisitor* visitor, int32 level)
 {
 	if (level &lt; 0)
 		level = _Level();
 	if (_AcceptVisitor(visitor, level))
 		return this;
-	for (int32 i = 0; BPartition *child = ChildAt(i); i++) {
-		if (BPartition *result = child-&gt;_VisitEachDescendant(visitor,
-															 level + 1)) {
+	for (int32 i = 0; BPartition* child = ChildAt(i); i++) {
+		if (BPartition* result = child-&gt;_VisitEachDescendant(visitor,
+				level + 1)) {
 			return result;
 		}
 	}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004313.html">[Haiku-commits] r22586 - haiku/trunk/src/add-ons/accelerants/radeon
</A></li>
	<LI>Next message: <A HREF="004315.html">[Haiku-commits] r22588 - haiku/trunk/src/add-ons/accelerants/radeon
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4314">[ date ]</a>
              <a href="thread.html#4314">[ thread ]</a>
              <a href="subject.html#4314">[ subject ]</a>
              <a href="author.html#4314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
