<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r21010 - in haiku/trunk: build/jam	headers/private/graphics/matrox headers/private/graphics/neomagic	headers/private/graphics/nvidia src/add-ons/accelerants/matrox	src/add-ons/accelerants/neomagic	src/add-ons/accelerants/nvidia src/add-ons/accelerants/radeon	src/add-ons/kernel/drivers/graphics/intel_extreme	src/add-ons/kernel/drivers/graphics/matrox	src/add-ons/kernel/drivers/graphics/neomagic	src/add-ons/kernel/drivers/graphics/nvidia	src/add-ons/kernel/drivers/graphics/radeon
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r21010%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/graphics/matrox%20headers/private/graphics/neomagic%0A%09headers/private/graphics/nvidia%20src/add-ons/accelerants/matrox%0A%09src/add-ons/accelerants/neomagic%0A%09src/add-ons/accelerants/nvidia%20src/add-ons/accelerants/radeon%0A%09src/add-ons/kernel/drivers/graphics/intel_extreme%0A%09src/add-ons/kernel/drivers/graphics/matrox%0A%09src/add-ons/kernel/drivers/graphics/neomagic%0A%09src/add-ons/kernel/drivers/graphics/nvidia%0A%09src/add-ons/kernel/drivers/graphics/radeon&In-Reply-To=%3C200705040749.l447nw5E018588%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002092.html">
   <LINK REL="Next"  HREF="002094.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r21010 - in haiku/trunk: build/jam	headers/private/graphics/matrox headers/private/graphics/neomagic	headers/private/graphics/nvidia src/add-ons/accelerants/matrox	src/add-ons/accelerants/neomagic	src/add-ons/accelerants/nvidia src/add-ons/accelerants/radeon	src/add-ons/kernel/drivers/graphics/intel_extreme	src/add-ons/kernel/drivers/graphics/matrox	src/add-ons/kernel/drivers/graphics/neomagic	src/add-ons/kernel/drivers/graphics/nvidia	src/add-ons/kernel/drivers/graphics/radeon</H1>
    <B>axeld at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r21010%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/graphics/matrox%20headers/private/graphics/neomagic%0A%09headers/private/graphics/nvidia%20src/add-ons/accelerants/matrox%0A%09src/add-ons/accelerants/neomagic%0A%09src/add-ons/accelerants/nvidia%20src/add-ons/accelerants/radeon%0A%09src/add-ons/kernel/drivers/graphics/intel_extreme%0A%09src/add-ons/kernel/drivers/graphics/matrox%0A%09src/add-ons/kernel/drivers/graphics/neomagic%0A%09src/add-ons/kernel/drivers/graphics/nvidia%0A%09src/add-ons/kernel/drivers/graphics/radeon&In-Reply-To=%3C200705040749.l447nw5E018588%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r21010 - in haiku/trunk: build/jam	headers/private/graphics/matrox headers/private/graphics/neomagic	headers/private/graphics/nvidia src/add-ons/accelerants/matrox	src/add-ons/accelerants/neomagic	src/add-ons/accelerants/nvidia src/add-ons/accelerants/radeon	src/add-ons/kernel/drivers/graphics/intel_extreme	src/add-ons/kernel/drivers/graphics/matrox	src/add-ons/kernel/drivers/graphics/neomagic	src/add-ons/kernel/drivers/graphics/nvidia	src/add-ons/kernel/drivers/graphics/radeon">axeld at mail.berlios.de
       </A><BR>
    <I>Fri May  4 09:49:58 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="002092.html">[Haiku-commits] r21009 -	haiku/trunk/src/add-ons/opengl/mesa_software_renderer
</A></li>
        <LI>Next message: <A HREF="002094.html">[Haiku-commits] r21011 - haiku/trunk/headers/posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2093">[ date ]</a>
              <a href="thread.html#2093">[ thread ]</a>
              <a href="subject.html#2093">[ subject ]</a>
              <a href="author.html#2093">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: axeld
Date: 2007-05-04 09:49:53 +0200 (Fri, 04 May 2007)
New Revision: 21010
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=21010&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=21010&amp;view=rev</A>

Added:
   haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/matrox.settings
   haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/neomagic.settings
   haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/nvidia.settings
Removed:
   haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/mga.settings
   haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/nm.settings
   haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/nv.settings
Modified:
   haiku/trunk/build/jam/HaikuImage
   haiku/trunk/headers/private/graphics/matrox/DriverInterface.h
   haiku/trunk/headers/private/graphics/neomagic/DriverInterface.h
   haiku/trunk/headers/private/graphics/nvidia/DriverInterface.h
   haiku/trunk/src/add-ons/accelerants/matrox/Jamfile
   haiku/trunk/src/add-ons/accelerants/matrox/Overlay.c
   haiku/trunk/src/add-ons/accelerants/neomagic/Jamfile
   haiku/trunk/src/add-ons/accelerants/nvidia/Jamfile
   haiku/trunk/src/add-ons/accelerants/radeon/Jamfile
   haiku/trunk/src/add-ons/kernel/drivers/graphics/intel_extreme/driver.cpp
   haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/Jamfile
   haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/Jamfile
   haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/Jamfile
   haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/driver.c
   haiku/trunk/src/add-ons/kernel/drivers/graphics/radeon/Jamfile
Log:
* Renamed nv.driver to &quot;nvidia&quot;, nm.driver to &quot;neomagic&quot;, and mga.driver to &quot;matrox&quot;;
  also renamed their accelerants and settings files accordingly.
* Added Mandelbrot and GLDirectMode as demo applications.
* Moved CortexAddOnHost to /bin.


Modified: haiku/trunk/build/jam/HaikuImage
===================================================================
--- haiku/trunk/build/jam/HaikuImage	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/build/jam/HaikuImage	2007-05-04 07:49:53 UTC (rev 21010)
@@ -22,6 +22,7 @@
 
 BEOS_BIN = &quot;[&quot; addattr alert arp basename bc beep bzip2 cat cardctl catattr chgrp
 	chmod chop chown cksum clear clockconfig cmp comm compress cp copyattr
+	$(X86_ONLY)CortexAddOnHost
 	csplit ctags cut date dc dd desklink df diff diff3 dircolors dirname
 	driveinfo dstcheck du dump_cis dump_cisreg echo eject env error expand
 	expr factor false fdinfo ffm find finddir fmt fold fortune frcode ftp funzip gawk
@@ -44,7 +45,7 @@
 
 BEOS_APPS = Terminal Expander People ShowImage Pulse ProcessController
 	SoundRecorder Magnify DiskProbe AboutHaiku StyledEdit Installer Workspaces
-	$(X86_ONLY)Cortex $(X86_ONLY)CortexAddOnHost MediaPlayer DeskCalc MidiPlayer
+	$(X86_ONLY)Cortex MediaPlayer DeskCalc MidiPlayer
 	Icon-O-Matic Mail CDPlayer NetworkStatus TV
 ;
 BEOS_PREFERENCES = Appearance Backgrounds DataTranslations E-mail FileTypes
@@ -52,7 +53,7 @@
 	Time VirtualMemory
 ;
 BEOS_DEMOS = BitmapDrawing Chart Clock FontDemo $(X86_ONLY)GLTeapot PictureTest
-	Playground
+	Playground Mandelbrot GLDirectMode
 ;
 BEOS_SYSTEM_LIB = libbe.so $(HAIKU_LIBSTDC++) libmedia.so libtracker.so
 	libtranslation.so libnetwork.so libdebug.so libbsd.so libmail.so
@@ -70,8 +71,8 @@
 #BEOS_NETWORK_PPP = ipcp modem pap pppoe ;
 BEOS_NETWORK_PROTOCOLS = ipv4 tcp udp icmp ;
 
-BEOS_ADD_ONS_ACCELERANTS = $(X86_ONLY)radeon.accelerant $(X86_ONLY)nv.accelerant
-	$(X86_ONLY)mga.accelerant $(X86_ONLY)nm.accelerant
+BEOS_ADD_ONS_ACCELERANTS = $(X86_ONLY)radeon.accelerant $(X86_ONLY)nvidia.accelerant
+	$(X86_ONLY)matrox.accelerant $(X86_ONLY)neomagic.accelerant
 	$(X86_ONLY)intel_extreme.accelerant vesa.accelerant
 	#$(X86_ONLY)vmware.accelerant
 ;
@@ -103,8 +104,8 @@
 ;
 BEOS_ADD_ONS_SCREENSAVERS = Haiku IFS ;
 BEOS_ADD_ONS_DRIVERS_AUDIO = auich auvia emuxki ;
-BEOS_ADD_ONS_DRIVERS_GRAPHICS = $(X86_ONLY)radeon.driver $(X86_ONLY)nv.driver
-	$(X86_ONLY)nm.driver $(X86_ONLY)mga.driver $(X86_ONLY)intel_extreme vesa
+BEOS_ADD_ONS_DRIVERS_GRAPHICS = $(X86_ONLY)radeon $(X86_ONLY)nvidia
+	$(X86_ONLY)neomagic $(X86_ONLY)matrox $(X86_ONLY)intel_extreme vesa
 	#$(X86_ONLY)vmware
 ;
 BEOS_ADD_ONS_DRIVERS_MIDI = emuxki ;

Modified: haiku/trunk/headers/private/graphics/matrox/DriverInterface.h
===================================================================
--- haiku/trunk/headers/private/graphics/matrox/DriverInterface.h	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/headers/private/graphics/matrox/DriverInterface.h	2007-05-04 07:49:53 UTC (rev 21010)
@@ -17,7 +17,7 @@
 #include &lt;PCI.h&gt;
 #include &lt;OS.h&gt;
 
-#define DRIVER_PREFIX &quot;mga&quot; // apsed
+#define DRIVER_PREFIX &quot;matrox&quot; // apsed
 #define DEVICE_FORMAT &quot;%04x_%04x_%02x%02x%02x&quot; // apsed
 
 /*

Modified: haiku/trunk/headers/private/graphics/neomagic/DriverInterface.h
===================================================================
--- haiku/trunk/headers/private/graphics/neomagic/DriverInterface.h	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/headers/private/graphics/neomagic/DriverInterface.h	2007-05-04 07:49:53 UTC (rev 21010)
@@ -15,7 +15,7 @@
 #include &lt;PCI.h&gt;
 #include &lt;OS.h&gt;
 
-#define DRIVER_PREFIX &quot;nm&quot; // apsed
+#define DRIVER_PREFIX &quot;neomagic&quot;
 
 /*
 	Internal driver state (also for sharing info between driver and accelerant)

Modified: haiku/trunk/headers/private/graphics/nvidia/DriverInterface.h
===================================================================
--- haiku/trunk/headers/private/graphics/nvidia/DriverInterface.h	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/headers/private/graphics/nvidia/DriverInterface.h	2007-05-04 07:49:53 UTC (rev 21010)
@@ -18,7 +18,7 @@
 #include &lt;OS.h&gt;
 #include &quot;AGP.h&quot;
 
-#define DRIVER_PREFIX &quot;nv&quot; // apsed
+#define DRIVER_PREFIX &quot;nvidia&quot; // apsed
 #define DEVICE_FORMAT &quot;%04x_%04x_%02x%02x%02x&quot; // apsed
 
 /*

Modified: haiku/trunk/src/add-ons/accelerants/matrox/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/accelerants/matrox/Jamfile	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/accelerants/matrox/Jamfile	2007-05-04 07:49:53 UTC (rev 21010)
@@ -6,7 +6,7 @@
 UsePrivateHeaders [ FDirName graphics matrox ] ;
 UseHeaders [ FDirName $(SUBDIR) engine ] ;
 
-Addon mga.accelerant :
+Addon matrox.accelerant :
 	Cursor.c
 	EngineManagment.c
 	GetAccelerantHook.c
@@ -21,9 +21,9 @@
 ;
 
 Package haiku-matrox-cvs :
-	mga.accelerant :
+	matrox.accelerant :
 	boot home config add-ons accelerants ;
 
-Depends mga.accelerant : mga.driver ;
+Depends matrox.accelerant : matrox ;
 
 SubInclude HAIKU_TOP src add-ons accelerants matrox engine ;

Modified: haiku/trunk/src/add-ons/accelerants/matrox/Overlay.c
===================================================================
--- haiku/trunk/src/add-ons/accelerants/matrox/Overlay.c	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/accelerants/matrox/Overlay.c	2007-05-04 07:49:53 UTC (rev 21010)
@@ -238,7 +238,7 @@
 		/* NOTE to app programmers:
 		 * For testing app behaviour regarding workspace switches or screen prefs changes to settings
 		 * that do not have enough cardRAM left for allocation of overlay bitmaps, you need a card with
-		 * a low amount of RAM. Or you can set in the file mga.settings for example:
+		 * a low amount of RAM. Or you can set in the file matrox.settings for example:
 		 * memory 8 #8Mb RAM on card
 		 * and reboot (this simulates 8Mb RAM on the card).
 		 *
@@ -332,7 +332,7 @@
 		/* NOTE to app programmers:
 		 * For testing app behaviour regarding workspace switches or screen prefs changes to settings
 		 * that do not have enough cardRAM left for allocation of overlay bitmaps, you need a card with
-		 * a low amount of RAM. Or you can set in the file mga.settings for example:
+		 * a low amount of RAM. Or you can set in the file matrox.settings for example:
 		 * memory 8 #8Mb RAM on card
 		 * and reboot (this simulates 8Mb RAM on the card).
 		 *

Modified: haiku/trunk/src/add-ons/accelerants/neomagic/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/accelerants/neomagic/Jamfile	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/accelerants/neomagic/Jamfile	2007-05-04 07:49:53 UTC (rev 21010)
@@ -6,7 +6,7 @@
 UsePrivateHeaders [ FDirName graphics neomagic ] ;
 UseHeaders [ FDirName $(SUBDIR) engine ] ;
 
-Addon nm.accelerant :
+Addon neomagic.accelerant :
 	Acceleration.c
 	Cursor.c
 	EngineManagment.c
@@ -22,9 +22,9 @@
 ;
 
 Package haiku-neomagic-cvs :
-	nm.accelerant :
+	neomagic.accelerant :
 	boot home config add-ons accelerants ;
 
-Depends nm.accelerant : nm.driver ;
+Depends neomagic.accelerant : neomagic ;
 
 SubInclude HAIKU_TOP src add-ons accelerants neomagic engine ;

Modified: haiku/trunk/src/add-ons/accelerants/nvidia/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/accelerants/nvidia/Jamfile	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/accelerants/nvidia/Jamfile	2007-05-04 07:49:53 UTC (rev 21010)
@@ -6,7 +6,7 @@
 UsePrivateHeaders [ FDirName graphics nvidia ] ;
 UseHeaders [ FDirName $(SUBDIR) engine ] ;
 
-Addon nv.accelerant :
+Addon nvidia.accelerant :
 	Acceleration.c
 	Cursor.c
 	EngineManagment.c
@@ -22,9 +22,9 @@
 ;
 
 Package haiku-nvidia-cvs :
-	nv.accelerant : 
+	nvidia.accelerant : 
 	boot home config add-ons accelerants ;
 
-Depends nv.accelerant : nv.driver ;
+Depends nvidia.accelerant : nvidia ;
 
 SubInclude HAIKU_TOP src add-ons accelerants nvidia engine ;

Modified: haiku/trunk/src/add-ons/accelerants/radeon/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/accelerants/radeon/Jamfile	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/accelerants/radeon/Jamfile	2007-05-04 07:49:53 UTC (rev 21010)
@@ -40,4 +40,4 @@
 	radeon.accelerant : 
 	boot home config add-ons accelerants ;
 
-Depends radeon.accelerant : radeon.driver ;
+Depends radeon.accelerant : radeon ;

Modified: haiku/trunk/src/add-ons/kernel/drivers/graphics/intel_extreme/driver.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/graphics/intel_extreme/driver.cpp	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/kernel/drivers/graphics/intel_extreme/driver.cpp	2007-05-04 07:49:53 UTC (rev 21010)
@@ -42,7 +42,7 @@
 	{0x2572, INTEL_TYPE_8xx | INTEL_TYPE_85x, &quot;i865G&quot;},
 	{0x3582, INTEL_TYPE_8xx | INTEL_TYPE_85x, &quot;i855G&quot;},
 
-#if 0
+#if 1
 	{0x2792, INTEL_TYPE_9xx, &quot;i910&quot;},
 	{0x258a, INTEL_TYPE_9xx, &quot;i915&quot;},
 	{0x2582, INTEL_TYPE_9xx, &quot;i915G&quot;},

Modified: haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/Jamfile	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/Jamfile	2007-05-04 07:49:53 UTC (rev 21010)
@@ -5,17 +5,16 @@
 UsePrivateHeaders graphics ;
 UsePrivateHeaders [ FDirName graphics matrox ] ;
 
-KernelAddon mga.driver :
+KernelAddon matrox :
 	driver.c
 ;
 
 Package haiku-matrox-cvs :
 	README.html UPDATE.html ;
 Package haiku-matrox-cvs :
-	mga.driver : 
+	matrox : 
 	boot home config add-ons kernel drivers bin ;
-PackageDriverSymLink haiku-matrox-cvs : graphics mga.driver ;
+PackageDriverSymLink haiku-matrox-cvs : graphics matrox ;
 Package haiku-matrox-cvs :
-	mga.settings :
+	matrox.settings :
 	boot home config settings kernel drivers ;
-

Copied: haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/matrox.settings (from rev 21007, haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/mga.settings)

Deleted: haiku/trunk/src/add-ons/kernel/drivers/graphics/matrox/mga.settings

Modified: haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/Jamfile	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/Jamfile	2007-05-04 07:49:53 UTC (rev 21010)
@@ -5,17 +5,17 @@
 UsePrivateHeaders graphics ;
 UsePrivateHeaders [ FDirName graphics neomagic ] ;
 
-KernelAddon nm.driver :
+KernelAddon neomagic :
 	driver.c
 ;
 
 Package haiku-neomagic-cvs :
 	README.html UPDATE.html ;
 Package haiku-neomagic-cvs :
-	nm.driver : 
+	neomagic : 
 	boot home config add-ons kernel drivers bin ;
-PackageDriverSymLink haiku-neomagic-cvs : graphics nm.driver ;
+PackageDriverSymLink haiku-neomagic-cvs : graphics neomagic ;
 Package haiku-neomagic-cvs :
-	nm.settings :
+	neomagic.settings :
 	boot home config settings kernel drivers ;
 

Copied: haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/neomagic.settings (from rev 21007, haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/nm.settings)
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/nm.settings	2007-05-03 21:42:09 UTC (rev 21007)
+++ haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/neomagic.settings	2007-05-04 07:49:53 UTC (rev 21010)
@@ -0,0 +1,49 @@
+# Settings file for the neomagic driver and accelerant
+#
+# This file should be moved to the directory
+# ~/config/settings/kernel/drivers/
+#
+
+# neomagic parameters
+# accelerant &quot;neomagic.accelerant&quot;
+
+# nm.accelerant parameters
+usebios     true			# if true rely on bios to coldstart the card instead of driver (not functional)
+#memory  2048			# in Kb, override builtin memory size detection
+hardcursor true			# if true use on-chip cursor capabilities
+#logmask   0x00000000	# nothing logged, except errors, is default
+#logmask   0x80000000	# log card physical features
+#logmask   0x80000000	# log following mask
+#logmask   0x08000604	# log overlay use in full
+#logmask 	0xffffffff		# log everything
+dumprom    false        		# dump bios rom in ~/neomagic.rom
+
+#--------- that's all.
+
+
+#logmask setup info:
+#log level select:
+#logmask   0x0000000x	# lowest digit: bitmask to select logging level.
+
+#log modules select:
+#logmask   0xxxxxxxx0	# highest 7 digits: bitmask to select individual modules to log.
+
+#log modules:
+#logmask   0x00000200	# engine: bes
+#logmask   0x00000400	# overlay
+#logmask   0x00000800	# engine: support
+#logmask   0x00002000	# engine: info
+#logmask   0x00008000	# engine: general
+#logmask   0x00010000	# engine: dac
+#logmask   0x00040000	# engine: crtc
+#logmask   0x00080000	# engine: acc
+#logmask   0x00200000	# set displaymode
+#logmask   0x00400000	# propose displaymode
+#logmask   0x00800000	# init accelerant
+#logmask   0x01000000	# get timing constraints
+#logmask   0x02000000	# get mode info
+#logmask   0x04000000	# get device info
+#logmask   0x08000000	# get accelerant hook
+#logmask   0x10000000	# engine management
+#logmask   0x20000000	# cursor
+#logmask   0x40000000	# acceleration

Deleted: haiku/trunk/src/add-ons/kernel/drivers/graphics/neomagic/nm.settings

Modified: haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/Jamfile	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/Jamfile	2007-05-04 07:49:53 UTC (rev 21010)
@@ -5,17 +5,17 @@
 UsePrivateHeaders graphics ;
 UsePrivateHeaders [ FDirName graphics nvidia ] ;
 
-KernelAddon nv.driver :
+KernelAddon nvidia :
 	driver.c
 ;
 
 Package haiku-nvidia-cvs :
 	README.html UPDATE.html ;
 Package haiku-nvidia-cvs :
-	nv.driver : 
+	nvidia : 
 	boot home config add-ons kernel drivers bin ;
-PackageDriverSymLink haiku-nvidia-cvs : graphics nv.driver ;
+PackageDriverSymLink haiku-nvidia-cvs : graphics nvidia ;
 Package haiku-nvidia-cvs :
-	nv.settings :
+	nvidia.settings :
 	boot home config settings kernel drivers ;
 

Modified: haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/driver.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/driver.c	2007-05-04 07:39:01 UTC (rev 21009)
+++ haiku/trunk/src/add-ons/kernel/drivers/graphics/nvidia/driver.c	2007-05-04 07:49:53 UTC (rev 21010)
@@ -7,30 +7,22 @@
 	Rudolf Cornelissen 3/2002-4/2006.
 */
 
-/* standard kernel driver stuff */
+
+#include &quot;AGP.h&quot;
+#include &quot;DriverInterface.h&quot;
+#include &quot;nv_macros.h&quot;
+
+#include &lt;graphic_driver.h&gt;
 #include &lt;KernelExport.h&gt;
 #include &lt;ISA.h&gt;
 #include &lt;PCI.h&gt;
 #include &lt;OS.h&gt;
 #include &lt;driver_settings.h&gt;
-#include &lt;malloc.h&gt;
-#include &lt;stdlib.h&gt; // for strtoXX
-#include &quot;AGP.h&quot;
 
-/* this is for the standardized portion of the driver API */
-/* currently only one operation is defined: B_GET_ACCELERANT_SIGNATURE */
-#include &lt;graphic_driver.h&gt;
-
-/* this is for sprintf() */
+#include &lt;stdlib.h&gt;
 #include &lt;stdio.h&gt;
-
-/* this is for string compares */
 #include &lt;string.h&gt;
 
-/* The private interface between the accelerant and the kernel driver. */
-#include &quot;DriverInterface.h&quot;
-#include &quot;nv_macros.h&quot;
-
 #define get_pci(o, s) (*pci_bus-&gt;read_pci_config)(pcii-&gt;bus, pcii-&gt;device, pcii-&gt;function, (o), (s))
 #define set_pci(o, s, v) (*pci_bus-&gt;write_pci_config)(pcii-&gt;bus, pcii-&gt;device, pcii-&gt;function, (o), (s), (v))
 
@@ -42,7 +34,7 @@
 #endif
 
 /* Tell the kernel what revision of the driver API we support */
-int32	api_version = B_CUR_DRIVER_API_VERSION; // apsed, was 2, is 2 in R5
+int32 api_version = B_CUR_DRIVER_API_VERSION;
 
 /* these structures are private to the kernel driver */
 typedef struct device_info device_info;
@@ -70,12 +62,12 @@
 } DeviceData;
 
 /* prototypes for our private functions */
-static status_t open_hook (const char* name, uint32 flags, void** cookie);
-static status_t close_hook (void* dev);
-static status_t free_hook (void* dev);
-static status_t read_hook (void* dev, off_t pos, void* buf, size_t* len);
-static status_t write_hook (void* dev, off_t pos, const void* buf, size_t* len);
-static status_t control_hook (void* dev, uint32 msg, void *buf, size_t len);
+static status_t open_hook(const char* name, uint32 flags, void** cookie);
+static status_t close_hook(void* dev);
+static status_t free_hook(void* dev);
+static status_t read_hook(void* dev, off_t pos, void* buf, size_t* len);
+static status_t write_hook(void* dev, off_t pos, const void* buf, size_t* len);
+static status_t control_hook(void* dev, uint32 msg, void *buf, size_t len);
 static status_t map_device(device_info *di);
 static void unmap_device(device_info *di);
 static void probe_devices(void);
@@ -363,7 +355,7 @@
 	{0x0000, NULL}
 };
 
-static nv_settings current_settings = { // see comments in nv.settings 
+static nv_settings sSettings = { // see comments in nvidia.settings 
 	/* for driver */
 	DRIVER_PREFIX &quot;.accelerant&quot;,
 	&quot;none&quot;,					// primary
@@ -386,7 +378,9 @@
 	0,						// ram_clk
 };
 
-static void dumprom (void *rom, uint32 size, pci_info pcii)
+
+static void
+dumprom(void *rom, uint32 size, pci_info pcii)
 {
 	int fd;
 	uint32 cnt;
@@ -406,19 +400,25 @@
 	close (fd);
 }
 
-/* return 1 if vblank interrupt has occured */
-static int caused_vbi_crtc1(vuint32 * regs)
+
+/*! return 1 if vblank interrupt has occured */
+static int
+caused_vbi_crtc1(vuint32 * regs)
 {
 	return (NV_REG32(NV32_CRTC_INTS) &amp; 0x00000001);
 }
 
-/* clear the vblank interrupt */
-static void clear_vbi_crtc1(vuint32 * regs)
+
+/*! clear the vblank interrupt */
+static void
+clear_vbi_crtc1(vuint32 * regs)
 {
 	NV_REG32(NV32_CRTC_INTS) = 0x00000001;
 }
 
-static void enable_vbi_crtc1(vuint32 * regs)
+
+static void
+enable_vbi_crtc1(vuint32 * regs)
 {
 	/* clear the vblank interrupt */
 	NV_REG32(NV32_CRTC_INTS) = 0x00000001;
@@ -428,7 +428,9 @@
 	NV_REG32(NV32_MAIN_INTE) = 0x00000001;
 }
 
-static void disable_vbi_crtc1(vuint32 * regs)
+
+static void
+disable_vbi_crtc1(vuint32 * regs)
 {
 	/* disable nVidia interrupt source vblank */
 	NV_REG32(NV32_CRTC_INTE) &amp;= 0xfffffffe;
@@ -436,19 +438,25 @@
 	NV_REG32(NV32_CRTC_INTS) = 0x00000001;
 }
 
-/* return 1 if vblank interrupt has occured */
-static int caused_vbi_crtc2(vuint32 * regs)
+
+/*! return 1 if vblank interrupt has occured */
+static int
+caused_vbi_crtc2(vuint32 * regs)
 {
 	return (NV_REG32(NV32_CRTC2_INTS) &amp; 0x00000001);
 }
 
-/* clear the vblank interrupt */
-static void clear_vbi_crtc2(vuint32 * regs)
+
+/*! clear the vblank interrupt */
+static void
+clear_vbi_crtc2(vuint32 * regs)
 {
 	NV_REG32(NV32_CRTC2_INTS) = 0x00000001;
 }
 
-static void enable_vbi_crtc2(vuint32 * regs)
+
+static void
+enable_vbi_crtc2(vuint32 * regs)
 {
 	/* clear the vblank interrupt */
 	NV_REG32(NV32_CRTC2_INTS) = 0x00000001;
@@ -458,7 +466,9 @@
 	NV_REG32(NV32_MAIN_INTE) = 0x00000001;
 }
 
-static void disable_vbi_crtc2(vuint32 * regs)
+
+static void
+disable_vbi_crtc2(vuint32 * regs)
 {
 	/* disable nVidia interrupt source vblank */
 	NV_REG32(NV32_CRTC2_INTE) &amp;= 0xfffffffe;
@@ -466,13 +476,15 @@
 	NV_REG32(NV32_CRTC2_INTS) = 0x00000001;
 }
 
+
 //fixme:
 //dangerous code, on singlehead cards better not try accessing secondary head
 //registers (card might react in unpredictable ways, though there's only a small
 //chance we actually run into this).
 //fix requires (some) card recognition code to be moved from accelerant to
 //kerneldriver...
-static void disable_vbi_all(vuint32 * regs)
+static void
+disable_vbi_all(vuint32 * regs)
 {
 	/* disable nVidia interrupt source vblank */
 	NV_REG32(NV32_CRTC_INTE) &amp;= 0xfffffffe;
@@ -488,177 +500,9 @@
 	NV_REG32(NV32_MAIN_INTE) = 0x00000000;
 }
 
-/*
-	init_hardware() - Returns B_OK if one is
-	found, otherwise returns B_ERROR so the driver will be unloaded.
-*/
-status_t
-init_hardware(void) {
-	long		pci_index = 0;
-	pci_info	pcii;
-	bool		found_one = false;
-	
-	/* choke if we can't find the PCI bus */
-	if (get_module(B_PCI_MODULE_NAME, (module_info **)&amp;pci_bus) != B_OK)
-		return B_ERROR;
 
-	/* choke if we can't find the ISA bus */
-	if (get_module(B_ISA_MODULE_NAME, (module_info **)&amp;isa_bus) != B_OK)
-	{
-		put_module(B_PCI_MODULE_NAME);
-		return B_ERROR;
-	}
-
-	/* while there are more pci devices */
-	while ((*pci_bus-&gt;get_nth_pci_info)(pci_index, &amp;pcii) == B_NO_ERROR) {
-		int vendor = 0;
-		
-		/* if we match a supported vendor */
-		while (SupportedDevices[vendor].vendor) {
-			if (SupportedDevices[vendor].vendor == pcii.vendor_id) {
-				uint16 *devices = SupportedDevices[vendor].devices;
-				/* while there are more supported devices */
-				while (*devices) {
-					/* if we match a supported device */
-					if (*devices == pcii.device_id ) {
-						
-						found_one = true;
-						goto done;
-					}
-					/* next supported device */
-					devices++;
-				}
-			}
-			vendor++;
-		}
-		/* next pci_info struct, please */
-		pci_index++;
-	}
-
-done:
-	/* put away the module manager */
-	put_module(B_PCI_MODULE_NAME);
-	return (found_one ? B_OK : B_ERROR);
-}
-
-status_t
-init_driver(void) {
-	void *settings_handle;
-
-	// get driver/accelerant settings, apsed
-	settings_handle  = load_driver_settings (DRIVER_PREFIX &quot;.settings&quot;);
-	if (settings_handle != NULL) {
-		const char *item;
-		char       *end;
-		uint32      value;
-		
-		// for driver
-		item = get_driver_parameter (settings_handle, &quot;accelerant&quot;, &quot;&quot;, &quot;&quot;);
-		if ((strlen (item) &gt; 0) &amp;&amp; (strlen (item) &lt; sizeof (current_settings.accelerant) - 1)) {
-			strcpy (current_settings.accelerant, item);
-		}
-		item = get_driver_parameter (settings_handle, &quot;primary&quot;, &quot;&quot;, &quot;&quot;);
-		if ((strlen (item) &gt; 0) &amp;&amp; (strlen (item) &lt; sizeof (current_settings.primary) - 1)) {
-			strcpy (current_settings.primary, item);
-		}
-		current_settings.dumprom = get_driver_boolean_parameter (settings_handle, &quot;dumprom&quot;, false, false);
-
-		// for accelerant
-		item = get_driver_parameter (settings_handle, &quot;logmask&quot;, &quot;0x00000000&quot;, &quot;0x00000000&quot;);
-		value = strtoul (item, &amp;end, 0);
-		if (*end == '\0') current_settings.logmask = value;
-
-		item = get_driver_parameter (settings_handle, &quot;memory&quot;, &quot;0&quot;, &quot;0&quot;);
-		value = strtoul (item, &amp;end, 0);
-		if (*end == '\0') current_settings.memory = value;
-
-		item = get_driver_parameter (settings_handle, &quot;tv_output&quot;, &quot;0&quot;, &quot;0&quot;);
-		value = strtoul (item, &amp;end, 0);
-		if (*end == '\0') current_settings.tv_output = value;
-
-		current_settings.hardcursor = get_driver_boolean_parameter (settings_handle, &quot;hardcursor&quot;, false, false);
-		current_settings.usebios = get_driver_boolean_parameter (settings_handle, &quot;usebios&quot;, false, false);
-		current_settings.switchhead = get_driver_boolean_parameter (settings_handle, &quot;switchhead&quot;, false, false);
-		current_settings.force_pci = get_driver_boolean_parameter (settings_handle, &quot;force_pci&quot;, false, false);
-		current_settings.unhide_fw = get_driver_boolean_parameter (settings_handle, &quot;unhide_fw&quot;, false, false);
-		current_settings.pgm_panel = get_driver_boolean_parameter (settings_handle, &quot;pgm_panel&quot;, false, false);
-		current_settings.dma_acc = get_driver_boolean_parameter (settings_handle, &quot;dma_acc&quot;, false, false);
-		current_settings.vga_on_tv = get_driver_boolean_parameter (settings_handle, &quot;vga_on_tv&quot;, false, false);
-		current_settings.force_sync = get_driver_boolean_parameter (settings_handle, &quot;force_sync&quot;, false, false);
-		current_settings.force_ws = get_driver_boolean_parameter (settings_handle, &quot;force_ws&quot;, false, false);
-
-		item = get_driver_parameter (settings_handle, &quot;gpu_clk&quot;, &quot;0&quot;, &quot;0&quot;);
-		value = strtoul (item, &amp;end, 0);
-		if (*end == '\0') current_settings.gpu_clk = value;
-
-		item = get_driver_parameter (settings_handle, &quot;ram_clk&quot;, &quot;0&quot;, &quot;0&quot;);
-		value = strtoul (item, &amp;end, 0);
-		if (*end == '\0') current_settings.ram_clk = value;
-
-		unload_driver_settings (settings_handle);
-	}
-
-	/* get a handle for the pci bus */
-	if (get_module(B_PCI_MODULE_NAME, (module_info **)&amp;pci_bus) != B_OK)
-		return B_ERROR;
-
-	/* get a handle for the isa bus */
-	if (get_module(B_ISA_MODULE_NAME, (module_info **)&amp;isa_bus) != B_OK)
-	{
-		put_module(B_PCI_MODULE_NAME);
-		return B_ERROR;
-	}
-
-	/* get a handle for the agp bus if it exists */
-	get_module(B_AGP_MODULE_NAME, (module_info **)&amp;agp_bus);
-
-	/* driver private data */
-	pd = (DeviceData *)calloc(1, sizeof(DeviceData));
-	if (!pd) {
-		put_module(B_PCI_MODULE_NAME);
-		return B_ERROR;
-	}
-	/* initialize the benaphore */
-	INIT_BEN(pd-&gt;kernel);
-	/* find all of our supported devices */
-	probe_devices();
-	return B_OK;
-}
-
-const char **
-publish_devices(void) {
-	/* return the list of supported devices */
-	return (const char **)pd-&gt;device_names;
-}
-
-device_hooks *
-find_device(const char *name) {
-	int index = 0;
-	while (pd-&gt;device_names[index]) {
-		if (strcmp(name, pd-&gt;device_names[index]) == 0)
-			return &amp;graphics_device_hooks;
-		index++;
-	}
-	return NULL;
-
-}
-
-void uninit_driver(void) {
-
-	/* free the driver data */
-	DELETE_BEN(pd-&gt;kernel);
-	free(pd);
-	pd = NULL;
-
-	/* put the pci module away */
-	put_module(B_PCI_MODULE_NAME);
-	put_module(B_ISA_MODULE_NAME);
-
-	/* put the agp module away if it's there */
-	if (agp_bus) put_module(B_AGP_MODULE_NAME);
-}
-
-static status_t map_device(device_info *di)
+static status_t
+map_device(device_info *di)
 {
 	char buffer[B_OS_NAME_LENGTH]; /*memory for device name*/
 	shared_info *si = di-&gt;si;
@@ -735,8 +579,7 @@
 	//having the ROM mapped on PCI and PCIe cards. Falling back to fetching from ISA
 	//legacy space will get us into trouble if we aren't the primary graphics card!!
 	//(as legacy space always has the primary card's ROM 'mapped'!)
-	if (tmpUlong)
-	{
+	if (tmpUlong) {
 		/* ROM was assigned an adress, so enable ROM decoding - see PCI standard */
 		tmpUlong |= 0x00000001;
 		set_pci(PCI_rom_base, 4, tmpUlong);
@@ -751,35 +594,24 @@
 		);
 
 		/* check if we got the BIOS and signature (might fail on laptops..) */
-		if (rom_area &gt;= 0)
-		{
-			if ((rom_temp[0] != 0x55) || (rom_temp[1] != 0xaa))
-			{
+		if (rom_area &gt;= 0) {
+			if ((rom_temp[0] != 0x55) || (rom_temp[1] != 0xaa)) {
 				/* apparantly no ROM is mapped here */
 				delete_area(rom_area);
 				rom_area = -1;
 				/* force using ISA legacy map as fall-back */
 				tmpUlong = 0x00000000;
 			}
-		}
-		else
-		{
+		} else {
 			/* mapping failed: force using ISA legacy map as fall-back */
 			tmpUlong = 0x00000000;
 		}
 	}
 
-	if (!tmpUlong)
-	{
+	if (!tmpUlong) {
 		/* ROM was not assigned an adress, fetch it from ISA legacy memory map! */
-		rom_area = map_physical_memory(
-			buffer,
-			(void *)0x000c0000,
-			65536,
-			B_ANY_KERNEL_ADDRESS,
-			B_READ_AREA,
-			(void **)&amp;(rom_temp)
-		);
+		rom_area = map_physical_memory(buffer, (void *)0x000c0000,
+			65536, B_ANY_KERNEL_ADDRESS, B_READ_AREA, (void **)&amp;(rom_temp));
 	}
 
 	/* if mapping ROM to vmem failed then clean up and pass on error */
@@ -789,11 +621,13 @@
 		return rom_area;
 	}
 
-	/* dump ROM to file if selected in nv.settings
+	/* dump ROM to file if selected in nvidia.settings
 	 * (ROM always fits in 64Kb: checked TNT1 - FX5950) */
-	if (current_settings.dumprom) dumprom (rom_temp, 65536, di-&gt;pcii);
+	if (sSettings.dumprom)
+		dumprom(rom_temp, 65536, di-&gt;pcii);
+
 	/* make a copy of ROM for future reference */
-	memcpy (si-&gt;rom_mirror, rom_temp, 65536);
+	memcpy(si-&gt;rom_mirror, rom_temp, 65536);
 
 	/* disable ROM decoding - this is defined in the PCI standard, and delete the area */
 	tmpUlong = get_pci(PCI_rom_base, 4);
@@ -810,8 +644,7 @@
 		di-&gt;pcii.bus, di-&gt;pcii.device, di-&gt;pcii.function);
 
 	/* map the framebuffer into vmem, using Write Combining*/
-	si-&gt;fb_area = map_physical_memory(
-		buffer,
+	si-&gt;fb_area = map_physical_memory(buffer,
 		/* WARNING: Nvidia needs to map framebuffer as viewed from PCI space! */
 		(void *) di-&gt;pcii.u.h0.base_registers_pci[frame_buffer],
 		di-&gt;pcii.u.h0.base_register_sizes[frame_buffer],
@@ -821,8 +654,7 @@
 
 	/*if failed with write combining try again without*/
 	if (si-&gt;fb_area &lt; 0) {
-		si-&gt;fb_area = map_physical_memory(
-			buffer,
+		si-&gt;fb_area = map_physical_memory(buffer,
 			/* WARNING: Nvidia needs to map framebuffer as viewed from PCI space! */
 			(void *) di-&gt;pcii.u.h0.base_registers_pci[frame_buffer],
 			di-&gt;pcii.u.h0.base_register_sizes[frame_buffer],
@@ -830,26 +662,29 @@
 			B_READ_AREA | B_WRITE_AREA,
 			&amp;(si-&gt;framebuffer));
 	}
-		
+
 	/* if there was an error, delete our other areas and pass on error*/
-	if (si-&gt;fb_area &lt; 0)
-	{
+	if (si-&gt;fb_area &lt; 0) {
 		delete_area(si-&gt;regs_area);
 		si-&gt;regs_area = -1;
 		return si-&gt;fb_area;
 	}
-//fixme: retest for card coldstart and PCI/virt_mem mapping!!
+
+	//fixme: retest for card coldstart and PCI/virt_mem mapping!!
 	/* remember the DMA address of the frame buffer for BDirectWindow?? purposes */
 	si-&gt;framebuffer_pci = (void *) di-&gt;pcii.u.h0.base_registers_pci[frame_buffer];
 
 	// remember settings for use here and in accelerant
-	si-&gt;settings = current_settings; 
+	si-&gt;settings = sSettings; 
 
 	/* in any case, return the result */
 	return si-&gt;fb_area;
 }
 
-static void unmap_device(device_info *di) {
+
+static void
+unmap_device(device_info *di)
+{
 	shared_info *si = di-&gt;si;
 	uint32	tmpUlong;
 	pci_info *pcii = &amp;(di-&gt;pcii);
@@ -859,23 +694,29 @@
 	tmpUlong &amp;= 0xfffffffc;
 	set_pci(PCI_command, 4, tmpUlong);
 	/* delete the areas */
-	if (si-&gt;regs_area &gt;= 0) delete_area(si-&gt;regs_area);
-	if (si-&gt;fb_area &gt;= 0) delete_area(si-&gt;fb_area);
+	if (si-&gt;regs_area &gt;= 0)
+		delete_area(si-&gt;regs_area);
+	if (si-&gt;fb_area &gt;= 0)
+		delete_area(si-&gt;fb_area);
 	si-&gt;regs_area = si-&gt;fb_area = -1;
 	si-&gt;framebuffer = NULL;
 	di-&gt;regs = NULL;
 }
 
-static void probe_devices(void) {
+
+static void
+probe_devices(void)
+{
 	uint32 pci_index = 0;
 	uint32 count = 0;
 	device_info *di = pd-&gt;di;
 	char tmp_name[B_OS_NAME_LENGTH];
 
 	/* while there are more pci devices */
-	while ((count &lt; MAX_DEVICES) &amp;&amp; ((*pci_bus-&gt;get_nth_pci_info)(pci_index, &amp;(di-&gt;pcii)) == B_NO_ERROR)) {
+	while (count &lt; MAX_DEVICES
+		&amp;&amp; (*pci_bus-&gt;get_nth_pci_info)(pci_index, &amp;(di-&gt;pcii)) == B_OK) {
 		int vendor = 0;
-		
+
 		/* if we match a supported vendor */
 		while (SupportedDevices[vendor].vendor) {
 			if (SupportedDevices[vendor].vendor == di-&gt;pcii.vendor_id) {
@@ -890,9 +731,9 @@
 							di-&gt;pcii.bus, di-&gt;pcii.device, di-&gt;pcii.function);
 						/* tweak the exported name to show first in the alphabetically ordered /dev/
 						 * hierarchy folder, so the system will use it as primary adaptor if requested
-						 * via nv.settings. */
-						if (strcmp(tmp_name, current_settings.primary) == 0)
-							sprintf(tmp_name, &quot;-%s&quot;, current_settings.primary);
+						 * via nvidia.settings. */
+						if (strcmp(tmp_name, sSettings.primary) == 0)
+							sprintf(tmp_name, &quot;-%s&quot;, sSettings.primary);
 						/* add /dev/ hierarchy path */
 						sprintf(di-&gt;name, &quot;graphics/%s&quot;, tmp_name);
 						/* remember the name */
@@ -926,7 +767,10 @@
 	pd-&gt;device_names[pd-&gt;count] = NULL;
 }
 
-static uint32 thread_interrupt_work(int32 *flags, vuint32 *regs, shared_info *si) {
+
+static uint32
+thread_interrupt_work(int32 *flags, vuint32 *regs, shared_info *si)
+{
 	uint32 handled = B_HANDLED_INTERRUPT;
 	/* release the vblank semaphore */
 	if (si-&gt;vblank &gt;= 0) {
@@ -939,6 +783,7 @@
 	return handled;
 }
 
+
 static int32
 nv_interrupt(void *data)
 {
@@ -956,23 +801,18 @@
 
 	/* was it a VBI? */
 	/* note: si-&gt;ps.secondary_head was cleared by kerneldriver earlier! (at least) */
-	if (si-&gt;ps.secondary_head)
-	{
+	if (si-&gt;ps.secondary_head) {
 		//fixme:
 		//rewrite once we use one driver instance 'per head' (instead of 'per card')
-		if (caused_vbi_crtc1(regs) || caused_vbi_crtc2(regs))
-		{
+		if (caused_vbi_crtc1(regs) || caused_vbi_crtc2(regs)) {
 			/* clear the interrupt(s) */
 			clear_vbi_crtc1(regs);
 			clear_vbi_crtc2(regs);
 			/* release the semaphore */
 			handled = thread_interrupt_work(flags, regs, si);
 		}
-	}
-	else
-	{
-		if (caused_vbi_crtc1(regs))
-		{
+	} else {
+		if (caused_vbi_crtc1(regs)) {
 			/* clear the interrupt */
 			clear_vbi_crtc1(regs);
 			/* release the semaphore */
@@ -987,7 +827,13 @@
 	return handled;				
 }
 
-static status_t open_hook (const char* name, uint32 flags, void** cookie) {
+
+//	#pragma mark - device hooks
+
+
+static status_t
+open_hook(const char* name, uint32 flags, void** cookie)
+{
 	int32 index = 0;
 	device_info *di;
 	shared_info *si;
@@ -1001,7 +847,9 @@
 
 	/* find the device name in the list of devices */
 	/* we're never passed a name we didn't publish */
-	while (pd-&gt;device_names[index] &amp;&amp; (strcmp(name, pd-&gt;device_names[index]) != 0)) index++;
+	while (pd-&gt;device_names[index]
+		&amp;&amp; (strcmp(name, pd-&gt;device_names[index]) != 0))
+		index++;
 
 	/* for convienience */
 	di = &amp;(pd-&gt;di[index]);
@@ -1203,41 +1051,34 @@
 	return result;
 }
 
-/* ----------
-	read_hook - does nothing, gracefully
------ */
+
 static status_t
-read_hook (void* dev, off_t pos, void* buf, size_t* len)
+read_hook(void* dev, off_t pos, void* buf, size_t* len)
 {
 	*len = 0;
 	return B_NOT_ALLOWED;
 }
 
-/* ----------
-	write_hook - does nothing, gracefully
------ */

[... truncated: 430 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002092.html">[Haiku-commits] r21009 -	haiku/trunk/src/add-ons/opengl/mesa_software_renderer
</A></li>
	<LI>Next message: <A HREF="002094.html">[Haiku-commits] r21011 - haiku/trunk/headers/posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2093">[ date ]</a>
              <a href="thread.html#2093">[ thread ]</a>
              <a href="subject.html#2093">[ subject ]</a>
              <a href="author.html#2093">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
