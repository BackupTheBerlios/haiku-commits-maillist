<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r22792 - in	haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces:	. difftime kill sigignore sigprocmask sigsuspend
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-November/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22792%20-%20in%0A%09haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces%3A%0A%09.%20difftime%20kill%20sigignore%20sigprocmask%20sigsuspend&In-Reply-To=%3C200711011812.lA1ICu6t018856%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004565.html">
   <LINK REL="Next"  HREF="004568.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r22792 - in	haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces:	. difftime kill sigignore sigprocmask sigsuspend</H1>
    <B>bonefish at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r22792%20-%20in%0A%09haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces%3A%0A%09.%20difftime%20kill%20sigignore%20sigprocmask%20sigsuspend&In-Reply-To=%3C200711011812.lA1ICu6t018856%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r22792 - in	haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces:	. difftime kill sigignore sigprocmask sigsuspend">bonefish at mail.berlios.de
       </A><BR>
    <I>Thu Nov  1 19:12:56 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="004565.html">[Haiku-commits] r22791 -	haiku/trunk/src/add-ons/media/media-add-ons/multi_audio
</A></li>
        <LI>Next message: <A HREF="004568.html">[Haiku-commits] r22793 - haiku/trunk/src/system/libroot/os/arch/ppc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4566">[ date ]</a>
              <a href="thread.html#4566">[ thread ]</a>
              <a href="subject.html#4566">[ subject ]</a>
              <a href="author.html#4566">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2007-11-01 19:12:55 +0100 (Thu, 01 Nov 2007)
New Revision: 22792
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=22792&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=22792&amp;view=rev</A>

Added:
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/1-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/4-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/5-core-buildonly.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-2.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/Jamfile
Modified:
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/Jamfile
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/difftime/Jamfile
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/kill/Jamfile
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigprocmask/Jamfile
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigsuspend/Jamfile
Log:
Patch by Vasilis Kaoutsis:
* Added sigignore() tests.
* Renamed names of the test executables to avoid clashes in the build system.


Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/Jamfile
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/Jamfile	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/Jamfile	2007-11-01 18:12:55 UTC (rev 22792)
@@ -7,5 +7,6 @@
 SubInclude HAIKU_TOP src tests system libroot posix posixtestsuite conformance interfaces pthread_key_delete ;
 SubInclude HAIKU_TOP src tests system libroot posix posixtestsuite conformance interfaces pthread_getspecific ;
 SubInclude HAIKU_TOP src tests system libroot posix posixtestsuite conformance interfaces pthread_setspecific ;
+SubInclude HAIKU_TOP src tests system libroot posix posixtestsuite conformance interfaces sigignore ;
 SubInclude HAIKU_TOP src tests system libroot posix posixtestsuite conformance interfaces sigprocmask ;
 SubInclude HAIKU_TOP src tests system libroot posix posixtestsuite conformance interfaces sigsuspend ;

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/difftime/Jamfile
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/difftime/Jamfile	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/difftime/Jamfile	2007-11-01 18:12:55 UTC (rev 22792)
@@ -2,5 +2,5 @@
 
 SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) $(DOTDOT) include ] ;
 
-SimpleTest 1-1.test : 1-1.c ;
+SimpleTest difftime_1-1 : 1-1.c ;
 

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/kill/Jamfile
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/kill/Jamfile	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/kill/Jamfile	2007-11-01 18:12:55 UTC (rev 22792)
@@ -2,5 +2,4 @@
 
 SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) $(DOTDOT) include ] ;
 
-SimpleTest 2-1.test : 2-1.c ;
-
+SimpleTest kill_2-1 : 2-1.c ;

Added: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/1-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/1-1.c	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/1-1.c	2007-11-01 18:12:55 UTC (rev 22792)
@@ -0,0 +1,57 @@
+/*
+ * Copyright (c) 2003, Intel Corporation. All rights reserved.
+ * Created by:  salwan.searty REMOVE-THIS AT intel DOT com
+ * This file is licensed under the GPL license.  For the full content
+ * of this license, see the COPYING file at the top level of this 
+ * source tree.
+
+ Steps:
+ 1. Set up a handler for signal SIGABRT, such that it is called if 
+signal is ever raised.
+ 2. Call sigignore on SIGABRT.
+ 3. Raise a SIGABRT and verify that the signal handler was not called. 
+
+*/
+
+#define _XOPEN_SOURCE 600
+
+#include &lt;signal.h&gt;
+#include &lt;stdio.h&gt;
+#include &quot;posixtest.h&quot;
+
+int handler_called = 0;
+
+void handler(int signo)
+{
+	handler_called = 1;
+}
+
+int main()
+{
+	struct sigaction act;
+	
+	act.sa_handler = handler;
+	act.sa_flags = 0;
+	sigemptyset(&amp;act.sa_mask);
+	if (sigaction(SIGABRT,  &amp;act, 0) == -1) {
+		perror(&quot;Unexpected error while attempting to setup test &quot;
+		       &quot;pre-conditions&quot;);
+		return PTS_UNRESOLVED;
+	}
+
+	sigignore(SIGABRT);
+
+	if (raise(SIGABRT) == -1) {
+		perror(&quot;Unexpected error while attempting to setup test &quot;
+		       &quot;pre-conditions&quot;);
+		return PTS_UNRESOLVED;
+	}
+
+	if (handler_called) {
+		printf(&quot;FAIL: Signal was not ignored\n&quot;);
+		return PTS_FAIL;
+	} 
+	printf(&quot;PASS\n&quot;);
+	return PTS_PASS;
+}
+

Added: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/4-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/4-1.c	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/4-1.c	2007-11-01 18:12:55 UTC (rev 22792)
@@ -0,0 +1,27 @@
+/*   
+ * Copyright (c) 2003, Intel Corporation. All rights reserved.
+ * Created by:  salwan.searty REMOVE-THIS AT intel DOT com
+ * This file is licensed under the GPL license.  For the full content
+ * of this license, see the COPYING file at the top level of this 
+ * source tree.
+
+ Simply, if sigignore returns a 0 here, test passes.
+ 
+*/
+
+#define _XOPEN_SOURCE 600
+
+#include &lt;stdio.h&gt;
+#include &lt;signal.h&gt;
+#include &quot;posixtest.h&quot;
+
+int main()
+{
+
+	if (sigignore(SIGABRT) != 0) {
+		perror(&quot;sigignore failed -- returned -- test aborted&quot;);
+		return PTS_UNRESOLVED;
+	} 
+	printf(&quot;sigignore passed\n&quot;);
+	return PTS_PASS;
+}

Added: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/5-core-buildonly.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/5-core-buildonly.c	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/5-core-buildonly.c	2007-11-01 18:12:55 UTC (rev 22792)
@@ -0,0 +1,66 @@
+/*   
+ * Copyright (c) 2003, Intel Corporation. All rights reserved.
+ * Created by:  salwan.searty REMOVE-THIS AT intel DOT com
+ * This file is licensed under the GPL license.  For the full content
+ * of this license, see the COPYING file at the top level of this 
+ * source tree.
+
+   Testing passing an invalid signals to sighold().
+   After sighold is called on an invalid signal, sigignore() should 
+return -1 and set errno to EINVAL
+   
+   The invalid signal passed to sigignore() depends on the argument 
+passed to this program. There are currently 4 invalid signals.
+ */
+
+#define _XOPEN_SOURCE 600
+
+#include &lt;stdio.h&gt;
+#include &lt;signal.h&gt;
+#include &lt;errno.h&gt;
+#include &lt;stdint.h&gt;
+#include &quot;posixtest.h&quot;
+
+int main(int argc, char *argv[])
+{
+	int signo;
+
+	if (argc &lt; 2) {
+        	printf(&quot;Usage:  %s [1|2|3|4]\n&quot;, argv[0]);
+		return PTS_UNRESOLVED;
+	}
+
+	/*
+		Various error conditions
+	*/
+	switch (argv[1][0]) {
+		case '1':
+			signo=-1;
+			break;
+		case '2':
+			signo=-10000;
+			break;
+		case '3':
+			signo=INT32_MIN+1;
+			break;
+		case '4':
+			signo=INT32_MIN;
+			break;
+		default:
+			printf(&quot;Usage:  %s [1|2|3|4]\n&quot;, argv[0]);
+			return PTS_UNRESOLVED;
+	}
+
+	if (sigignore(signo) == -1) {
+		if (EINVAL == errno) {
+			printf (&quot;errno set to EINVAL\n&quot;);
+			return PTS_PASS;
+		} else {
+			printf (&quot;errno not set to EINVAL\n&quot;);
+			return PTS_FAIL;
+		}
+	}
+	
+	printf(&quot;sighold did not return -1\n&quot;);
+	return PTS_FAIL;
+}

Added: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-1.c	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-1.c	2007-11-01 18:12:55 UTC (rev 22792)
@@ -0,0 +1,36 @@
+/*   
+ * Copyright (c) 2003, Intel Corporation. All rights reserved.
+ * Created by:  salwan.searty REMOVE-THIS AT intel DOT com
+ * This file is licensed under the GPL license.  For the full content
+ * of this license, see the COPYING file at the top level of this 
+ * source tree.
+
+   Testing trying to ignore a signal that cannot be ignored.
+   Line 1264 in Issue 6 of the Posix System Interfaces document says that 
+   the system shall not allow the signals SIGKILL or SIGSTOP
+   to be ignored.
+ */
+
+#define _XOPEN_SOURCE 600
+
+#include &lt;stdio.h&gt;
+#include &lt;signal.h&gt;
+#include &lt;errno.h&gt;
+#include &lt;stdint.h&gt;
+#include &quot;posixtest.h&quot;
+
+int main()
+{
+	if (sigignore(SIGKILL) == -1) {
+		if (EINVAL == errno) {
+			printf (&quot;errno set to EINVAL\n&quot;);
+			return PTS_PASS;
+		} else {
+			printf (&quot;errno not set to EINVAL\n&quot;);
+			return PTS_FAIL;
+		}
+	}
+	
+	printf(&quot;sigignore did not return -1\n&quot;);
+	return PTS_FAIL;
+}

Added: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-2.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-2.c	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/6-2.c	2007-11-01 18:12:55 UTC (rev 22792)
@@ -0,0 +1,36 @@
+/*   
+ * Copyright (c) 2003, Intel Corporation. All rights reserved.
+ * Created by:  salwan.searty REMOVE-THIS AT intel DOT com
+ * This file is licensed under the GPL license.  For the full content
+ * of this license, see the COPYING file at the top level of this 
+ * source tree.
+
+   Testing trying to ignore a signal that cannot be ignored.
+   Line 1264 in Issue 6 of the Posix System Interfaces document says that 
+   the system shall not allow the signals SIGKILL or SIGSTOP
+   to be ignored.
+ */
+
+#define _XOPEN_SOURCE 600
+
+#include &lt;stdio.h&gt;
+#include &lt;signal.h&gt;
+#include &lt;errno.h&gt;
+#include &lt;stdint.h&gt;
+#include &quot;posixtest.h&quot;
+
+int main()
+{
+	if (sigignore(SIGSTOP) == -1) {
+		if (EINVAL == errno) {
+			printf (&quot;errno set to EINVAL\n&quot;);
+			return PTS_PASS;
+		} else {
+			printf (&quot;errno not set to EINVAL\n&quot;);
+			return PTS_FAIL;
+		}
+	}
+	
+	printf(&quot;sigignore did not return -1\n&quot;);
+	return PTS_FAIL;
+}

Added: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/Jamfile
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/Jamfile	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigignore/Jamfile	2007-11-01 18:12:55 UTC (rev 22792)
@@ -0,0 +1,9 @@
+SubDir HAIKU_TOP src tests system libroot posix posixtestsuite conformance interfaces sigignore ;
+
+SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) $(DOTDOT) include ] ;
+
+SimpleTest sigignore_1-1 : 1-1.c ;
+SimpleTest sigignore_4-1 : 4-1.c ;
+SimpleTest sigignore_5-core-buildonly : 5-core-buildonly.c ;
+SimpleTest sigignore_6-1 : 6-1.c ;
+SimpleTest sigignore_6-2 : 6-2.c ;

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigprocmask/Jamfile
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigprocmask/Jamfile	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigprocmask/Jamfile	2007-11-01 18:12:55 UTC (rev 22792)
@@ -2,8 +2,7 @@
 
 SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) $(DOTDOT) include ] ;
 
-SimpleTest 8-1.test : 8-1.c ;
-SimpleTest 8-2.test : 8-2.c ;
-SimpleTest 8-3.test : 8-3.c ;
-SimpleTest 12-1.test : 12-1.c ;
-
+SimpleTest sigprocmask_8-1 : 8-1.c ;
+SimpleTest sigprocmask_8-2 : 8-2.c ;
+SimpleTest sigprocmask_8-3 : 8-3.c ;
+SimpleTest sigprocmask_12-1 : 12-1.c ;

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigsuspend/Jamfile
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigsuspend/Jamfile	2007-11-01 18:08:42 UTC (rev 22791)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/sigsuspend/Jamfile	2007-11-01 18:12:55 UTC (rev 22792)
@@ -2,5 +2,4 @@
 
 SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) $(DOTDOT) include ] ;
 
-SimpleTest 6-1.test : 6-1.c ;
-
+SimpleTest sigsuspend_6-1 : 6-1.c ;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004565.html">[Haiku-commits] r22791 -	haiku/trunk/src/add-ons/media/media-add-ons/multi_audio
</A></li>
	<LI>Next message: <A HREF="004568.html">[Haiku-commits] r22793 - haiku/trunk/src/system/libroot/os/arch/ppc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4566">[ date ]</a>
              <a href="thread.html#4566">[ thread ]</a>
              <a href="subject.html#4566">[ subject ]</a>
              <a href="author.html#4566">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
