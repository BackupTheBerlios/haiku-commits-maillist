<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r23002 - in haiku/trunk: build/jam	src/tests/system/libroot/posix/posixtestsuite	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-November/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r23002%20-%20in%20haiku/trunk%3A%20build/jam%0A%09src/tests/system/libroot/posix/posixtestsuite%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific&In-Reply-To=%3C200711262326.lAQNQ0xZ002207%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004859.html">
   <LINK REL="Next"  HREF="004862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r23002 - in haiku/trunk: build/jam	src/tests/system/libroot/posix/posixtestsuite	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific</H1>
    <B>bonefish at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r23002%20-%20in%20haiku/trunk%3A%20build/jam%0A%09src/tests/system/libroot/posix/posixtestsuite%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete%0A%09src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific&In-Reply-To=%3C200711262326.lAQNQ0xZ002207%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r23002 - in haiku/trunk: build/jam	src/tests/system/libroot/posix/posixtestsuite	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete	src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific">bonefish at mail.berlios.de
       </A><BR>
    <I>Tue Nov 27 00:26:00 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="004859.html">[Haiku-commits] r23001 - haiku/trunk/src/libs/compat/freebsd_network
</A></li>
        <LI>Next message: <A HREF="004862.html">[Haiku-commits] r23003 - in haiku/trunk: headers/private/kernel/boot	src/system/boot/platform/bios_ia32 src/system/kernel/debug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4861">[ date ]</a>
              <a href="thread.html#4861">[ thread ]</a>
              <a href="subject.html#4861">[ subject ]</a>
              <a href="author.html#4861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2007-11-27 00:25:59 +0100 (Tue, 27 Nov 2007)
New Revision: 23002
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=23002&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=23002&amp;view=rev</A>

Modified:
   haiku/trunk/build/jam/HaikuImage
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/1-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/3-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-2.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/2-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/3-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-2.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/2-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-1.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-2.c
   haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/run_posix_tests.sh
Log:
Patch by Vasilis Kaoutsis:
* Added pthreads posix test suite tests to run script and image.
* Improved output for said tests.


Modified: haiku/trunk/build/jam/HaikuImage
===================================================================
--- haiku/trunk/build/jam/HaikuImage	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/build/jam/HaikuImage	2007-11-26 23:25:59 UTC (rev 23002)
@@ -446,6 +446,17 @@
 	AddFilesToHaikuImage home posixtestsuite conformance interfaces sigset
 		: sigset_1-1 sigset_2-1 sigset_3-1 sigset_4-1 sigset_5-1 sigset_6-1
 		  sigset_7-1 sigset_8-1 sigset_9-1 sigset_10-1 ;
+
+	# add pthreads tests
+	AddFilesToHaikuImage home posixtestsuite conformance interfaces pthread_getspecific
+		: pthread_getspecific_1-1 pthread_getspecific_3-1 ;
+	AddFilesToHaikuImage home posixtestsuite conformance interfaces pthread_key_create
+		: pthread_key_create_1-1 pthread_key_create_1-2 pthread_key_create_2-1
+		  pthread_key_create_3-1 ;
+	AddFilesToHaikuImage home posixtestsuite conformance interfaces pthread_key_delete
+		: pthread_key_delete_1-1 pthread_key_delete_1-2 pthread_key_delete_2-1 ;
+	AddFilesToHaikuImage home posixtestsuite conformance interfaces pthread_setspecific
+		: pthread_setspecific_1-1 pthread_setspecific_1-2 ;
 }
 
 

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/1-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/1-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/1-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -37,13 +37,13 @@
 	{
 		if(pthread_key_create(&amp;keys[i], NULL) != 0)
 		{
-			printf(&quot;Error: pthread_key_create() failed\n&quot;);
+			printf(&quot;pthread_getspecific_1-1 Error: pthread_key_create() failed\n&quot;);
 			return PTS_UNRESOLVED;
 		} else
 		{
 			if(pthread_setspecific(keys[i], (void *)(long)(i + KEY_VALUE)) != 0)
 			{
-				printf(&quot;Error: pthread_setspecific() failed\n&quot;);
+				printf(&quot;pthread_getspecific_1-1 Error: pthread_setspecific() failed\n&quot;);
 				return PTS_UNRESOLVED;
 			}
 			
@@ -55,18 +55,18 @@
 		rc = pthread_getspecific(keys[i]);
 		if(rc != (void *)(long)(i + KEY_VALUE))
 		{
-			printf(&quot;Test FAILED: Did not return correct value of thread-specific key, expected %d, but got %ld\n&quot;, (i + KEY_VALUE), (long)rc);
+			printf(&quot;pthread_getspecific_1-1 Test FAILED: Did not return correct value of thread-specific key, expected %d, but got %ld\n&quot;, (i + KEY_VALUE), (long)rc);
 			return PTS_FAIL;
 		} else
 		{
 			if(pthread_key_delete(keys[i]) != 0)
 			{
-				printf(&quot;Error: pthread_key_delete() failed\n&quot;);
+				printf(&quot;pthread_getspecific_1-1 Error: pthread_key_delete() failed\n&quot;);
 				return PTS_UNRESOLVED;
 			}
 		}
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_getspecific_1-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/3-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/3-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_getspecific/3-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -30,23 +30,23 @@
 
 	if(pthread_key_create(&amp;key, NULL) != 0)
 	{
-		printf(&quot;Error: pthread_key_create() failed\n&quot;);
+		printf(&quot;pthread_getspecific_3-1 Error: pthread_key_create() failed\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 
 	rc = pthread_getspecific(key);
 	if(rc != NULL)
 	{
-		printf(&quot;Test FAILED: Did not return correct value, expected NULL, but got %ld\n&quot;, (long)rc);
+		printf(&quot;pthread_getspecific_3-1 Test FAILED: Did not return correct value, expected NULL, but got %ld\n&quot;, (long)rc);
 		return PTS_FAIL;
 	}
 		
 	if(pthread_key_delete(key) != 0)
 	{
-		printf(&quot;Error: pthread_key_delete() failed\n&quot;);
+		printf(&quot;pthread_getspecific_3-1 Error: pthread_key_delete() failed\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 		
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_getspecific_3-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -40,13 +40,13 @@
 	{
 		if(pthread_key_create(&amp;keys[i], NULL) != 0)
 		{
-			printf(&quot;Error: pthread_key_create() failed\n&quot;);
+			printf(&quot;pthread_key_create_1-1 Error: pthread_key_create() failed\n&quot;);
 			return PTS_UNRESOLVED;
 		} else
 		{
 			if(pthread_setspecific(keys[i], (void *)(long)(i + KEY_VALUE)) != 0)
 			{
-				printf(&quot;Error: pthread_setspecific() failed\n&quot;);
+				printf(&quot;pthread_key_create_1-1 Error: pthread_setspecific() failed\n&quot;);
 				return PTS_UNRESOLVED;
 			}
 			
@@ -58,18 +58,18 @@
 		rc = pthread_getspecific(keys[i]);
 		if(rc != (void *)(long)(i + KEY_VALUE))
 		{
-			printf(&quot;Test FAILED: Did not return correct value of thread-specific key, expected %ld, but got %ld\n&quot;, (long)(i + KEY_VALUE), (long)rc);
+			printf(&quot;pthread_key_create_1-1 Test FAILED: Did not return correct value of thread-specific key, expected %ld, but got %ld\n&quot;, (long)(i + KEY_VALUE), (long)rc);
 			return PTS_FAIL;
 		} else
 		{
 			if(pthread_key_delete(keys[i]) != 0)
 			{
-				printf(&quot;Error: pthread_key_delete() failed\n&quot;);
+				printf(&quot;pthread_key_create_1-1 Error: pthread_key_delete() failed\n&quot;);
 				return PTS_UNRESOLVED;
 			}
 		}
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_key_create_1-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-2.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-2.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/1-2.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -36,7 +36,7 @@
 	/* Set the key to KEY_VALUE */
 	if(pthread_setspecific(keys[i], (void *)(KEY_VALUE)) != 0)
 	{
-		printf(&quot;Error: pthread_setspecific() failed\n&quot;);
+		printf(&quot;pthread_key_create_1-2 Error: pthread_setspecific() failed\n&quot;);
 		pthread_exit((void*)PTS_FAIL);
 	}
 
@@ -53,7 +53,7 @@
 	{
 		if(pthread_key_create(&amp;keys[i], NULL) != 0)
 		{
-			printf(&quot;Error: pthread_key_create() failed\n&quot;);
+			printf(&quot;pthread_key_create_1-2 Error: pthread_key_create() failed\n&quot;);
 			return PTS_UNRESOLVED;
 		}
 	}
@@ -65,24 +65,24 @@
 		/* Create a thread */
 		if(pthread_create(&amp;new_th, NULL, a_thread_func, NULL) != 0)
 		{
-			perror(&quot;Error creating thread\n&quot;);
+			perror(&quot;pthread_key_create_1-2 Error creating thread\n&quot;);
 			return PTS_UNRESOLVED;
 		}		
 		
 		/* Wait for thread to end */
 		if(pthread_join(new_th, &amp;value_ptr) != 0)
 		{
-			perror(&quot;Error in pthread_join\n&quot;);
+			perror(&quot;pthread_key_create_1-2 Error in pthread_join\n&quot;);
 			return PTS_UNRESOLVED;
 		}
 
 		if(value_ptr == (void*) PTS_FAIL)
 		{
-			printf(&quot;Test FAILED: Could not use a certain key value to set for many keys\n&quot;);
+			printf(&quot;pthread_key_create_1-2: Test FAILED: Could not use a certain key value to set for many keys\n&quot;);
 			return PTS_FAIL;
 		}
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_key_create_1-2: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/2-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/2-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/2-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -33,13 +33,13 @@
 	rc = pthread_getspecific(key);
 	if(rc != NULL)
 	{
-		printf(&quot;Test FAILED\n&quot;);
+		printf(&quot;pthread_key_create_2-1 Test FAILED\n&quot;);
 		return PTS_FAIL;
 	}
 
 	if(pthread_key_create(&amp;key, NULL) != 0)
 	{
-		printf(&quot;Error: pthread_key_create() failed\n&quot;);
+		printf(&quot;pthread_key_create_2-1 pthread_key_create_2-1 Error: pthread_key_create() failed\n&quot;);
 		return PTS_UNRESOLVED;
 	} else
 	{
@@ -48,12 +48,12 @@
 		rc = pthread_getspecific(key);
 		if(rc != NULL)
 		{
-			printf(&quot;Test FAILED\n&quot;);
+			printf(&quot;pthread_key_create_2-1 Test FAILED\n&quot;);
 			return PTS_FAIL;
 		}
 		
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_key_create_2-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/3-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/3-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_create/3-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -44,7 +44,7 @@
 	/* Set the value of the key to a value */	
 	if(pthread_setspecific(key, (void *)(KEY_VALUE)) != 0)
 	{
-		printf(&quot;Error: pthread_setspecific() failed\n&quot;);
+		printf(&quot;pthread_key_create_3-1 Error: pthread_setspecific() failed\n&quot;);
 		pthread_exit((void*) PTS_UNRESOLVED);
 	}
 	
@@ -62,31 +62,31 @@
 	/* Create a key with a destructor function */
 	if(pthread_key_create(&amp;key, dest_func) != 0)
 	{
-		printf(&quot;Error: pthread_key_create() failed\n&quot;);
+		printf(&quot;pthread_key_create_3-1 Error: pthread_key_create() failed\n&quot;);
 		pthread_exit((void*) PTS_UNRESOLVED);
 	}
 
 	/* Create a thread */
 	if(pthread_create(&amp;new_th, NULL, a_thread_func, NULL) != 0)
 	{	
-		perror(&quot;Error creating thread\n&quot;);
+		perror(&quot;pthread_key_create_3-1 Error creating thread\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 
 	/* Wait for the thread's return */
 	if(pthread_join(new_th, NULL) != 0)
 	{
-		perror(&quot;Error in pthread_join()\n&quot;);
+		perror(&quot;pthread_key_create_3-1 Error in pthread_join()\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 
 	/* Check if the destructor was called */
 	if(dest_cnt == 0)
 	{
-		printf(&quot;Test FAILED: Destructor not called\n&quot;);
+		printf(&quot;pthread_key_create_3-1 Test FAILED: Destructor not called\n&quot;);
 		return PTS_FAIL;
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_key_create_3-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -39,18 +39,18 @@
 	{
 		if(pthread_key_create(&amp;keys[i], NULL) != 0)
 		{
-			printf(&quot;Error: pthread_key_create() failed\n&quot;);
+			printf(&quot;pthread_key_delete_1-1 Error: pthread_key_create() failed\n&quot;);
 			return PTS_UNRESOLVED;
 		}
 
 		if(pthread_key_delete(keys[i]) != 0)
 		{
-			printf(&quot;Test FAILED\n&quot;);
+			printf(&quot;pthread_key_delete_1-1 Test FAILED\n&quot;);
 			return PTS_FAIL;
 		}
 	}
 
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_key_delete_1-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-2.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-2.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/1-2.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -40,23 +40,23 @@
 	{
 		if(pthread_key_create(&amp;keys[i], NULL) != 0)
 		{
-			printf(&quot;Error: pthread_key_create() failed\n&quot;);
+			printf(&quot;pthread_key_delete_1-2 Error: pthread_key_create() failed\n&quot;);
 			return PTS_UNRESOLVED;
 		}
 
 		if(pthread_setspecific(keys[i], (void*)(long)(KEY_VALUE + i)) != 0)
 		{
-			printf(&quot;Error: pthread_setspecific failed\n&quot;);
+			printf(&quot;pthread_key_delete_1-2 Error: pthread_setspecific failed\n&quot;);
 			return PTS_UNRESOLVED;
 		}
 
 		if(pthread_key_delete(keys[i]) != 0)
 		{
-			printf(&quot;Test FAILED\n&quot;);
+			printf(&quot;pthread_key_delete_1-2 Test FAILED\n&quot;);
 			return PTS_FAIL;
 		}
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_key_delete_1-2: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/2-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/2-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_key_delete/2-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -47,7 +47,7 @@
 	/* Set the value of the key to a value */	
 	if(pthread_setspecific(key, (void *)(KEY_VALUE)) != 0)
 	{
-		printf(&quot;Error: pthread_setspecific() failed\n&quot;);
+		printf(&quot;pthread_key_delete_2-1 Error: pthread_setspecific() failed\n&quot;);
 		pthread_exit((void*) PTS_UNRESOLVED);
 	}
 	
@@ -65,21 +65,21 @@
 	/* Create a key with a destructor function */
 	if(pthread_key_create(&amp;key, dest_func) != 0)
 	{
-		printf(&quot;Error: pthread_key_create() failed\n&quot;);
+		printf(&quot;pthread_key_delete_2-1 Error: pthread_key_create() failed\n&quot;);
 		pthread_exit((void*) PTS_UNRESOLVED);
 	}
 
 	/* Create a thread */
 	if(pthread_create(&amp;new_th, NULL, a_thread_func, NULL) != 0)
 	{	
-		perror(&quot;Error creating thread\n&quot;);
+		perror(&quot;pthread_key_delete_2-1 Error creating thread\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 
 	/* Wait for the thread's return */
 	if(pthread_join(new_th, NULL) != 0)
 	{
-		perror(&quot;Error in pthread_join()\n&quot;);
+		perror(&quot;pthread_key_delete_2-1 Error in pthread_join()\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 
@@ -89,15 +89,15 @@
 	{
 		if(dest_cnt == 0)
 		{
-			printf(&quot;Error calling the key destructor function\n&quot;);
+			printf(&quot;pthread_key_delete_2-1 Error calling the key destructor function\n&quot;);
 			return PTS_UNRESOLVED;		
 		} else
 		{
-			printf(&quot;Test FAILED: pthread_key_delete failed to be called from the destructor function\n&quot;);
+			printf(&quot;pthread_key_delete_2-1 Test FAILED: pthread_key_delete failed to be called from the destructor function\n&quot;);
 			return PTS_FAIL;
 		}
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_key_delete_2-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-1.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-1.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-1.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -38,13 +38,13 @@
 	{
 		if(pthread_key_create(&amp;keys[i], NULL) != 0)
 		{
-			printf(&quot;Error: pthread_key_create() failed\n&quot;);
+			printf(&quot;pthread_setspecific_1-1 Error: pthread_key_create() failed\n&quot;);
 			return PTS_UNRESOLVED;
 		} else
 		{
 			if(pthread_setspecific(keys[i], (void *)(long)(i + KEY_VALUE)) != 0)
 			{
-				printf(&quot;Test FAILED: Could not set the value of the key to %d\n&quot;, (i + KEY_VALUE));
+				printf(&quot;pthread_setspecific_1-1 Test FAILED: Could not set the value of the key to %d\n&quot;, (i + KEY_VALUE));
 				return PTS_FAIL;
 			}
 			
@@ -56,18 +56,18 @@
 		rc = pthread_getspecific(keys[i]);
 		if(rc != (void *)(long)(i + KEY_VALUE))
 		{
-			printf(&quot;Test FAILED: Did not return correct value of thread-specific key, expected %ld, but got %ld\n&quot;, (long)(i + KEY_VALUE), (long)rc);
+			printf(&quot;pthread_setspecific_1-1 Test FAILED: Did not return correct value of thread-specific key, expected %ld, but got %ld\n&quot;, (long)(i + KEY_VALUE), (long)rc);
 			return PTS_FAIL;
 		} else
 		{
 			if(pthread_key_delete(keys[i]) != 0)
 			{
-				printf(&quot;Error: pthread_key_delete() failed\n&quot;);
+				printf(&quot;pthread_setspecific_1-1 Error: pthread_key_delete() failed\n&quot;);
 				return PTS_UNRESOLVED;
 			}
 		}
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_setspecific_1-1: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-2.c
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-2.c	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/conformance/interfaces/pthread_setspecific/1-2.c	2007-11-26 23:25:59 UTC (rev 23002)
@@ -40,7 +40,7 @@
 	 * that we bind for the main thread) */
 	if(pthread_setspecific(key, (void *)(KEY_VALUE_2)) != 0)
 	{
-		printf(&quot;Test FAILED: Could not set the value of the key to %d\n&quot;, (KEY_VALUE_2));
+		printf(&quot;pthread_setspecific_1-2 Test FAILED: Could not set the value of the key to %d\n&quot;, (KEY_VALUE_2));
 		pthread_exit((void*)PTS_FAIL);
 		return NULL;
 	}
@@ -60,21 +60,21 @@
 	/* Create the key */	
 	if(pthread_key_create(&amp;key, NULL) != 0)
 	{
-		printf(&quot;Error: pthread_key_create() failed\n&quot;);
+		printf(&quot;pthread_setspecific_1-2 Error: pthread_key_create() failed\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 	
 	/* Bind a value for this main thread */
 	if(pthread_setspecific(key, (void *)(KEY_VALUE_1)) != 0)
 	{
-		printf(&quot;Test FAILED: Could not set the value of the key to %d\n&quot;, (KEY_VALUE_1));
+		printf(&quot;pthread_setspecific_1-2 Test FAILED: Could not set the value of the key to %d\n&quot;, (KEY_VALUE_1));
 		return PTS_FAIL;
 	}
 
 	/* Create another thread.  This thread will also bind a value to the key */
 	if(pthread_create(&amp;new_th, NULL, a_thread_func, NULL) != 0)
 	{
-		printf(&quot;Error: in pthread_create()\n&quot;);
+		printf(&quot;pthread_setspecific_1-2 Error: in pthread_create()\n&quot;);
 		return PTS_UNRESOLVED;
 	}
 			
@@ -88,16 +88,16 @@
 	 * thread, they should be different. */
 	if(rc1 != (void *)(KEY_VALUE_1))
 	{
-		printf(&quot;Test FAILED: Incorrect value bound to key, expected %d, got %ld\n&quot;, KEY_VALUE_1, (long)rc1);
+		printf(&quot;pthread_setspecific_1-2 Test FAILED: Incorrect value bound to key, expected %d, got %ld\n&quot;, KEY_VALUE_1, (long)rc1);
 		return PTS_FAIL;
 	}
 
 	if(rc2 != (void *)(KEY_VALUE_2))
 	{
-		printf(&quot;Test FAILED: Incorrect value bound to key, expected %d, got %ld\n&quot;, KEY_VALUE_2, (long)rc2);
+		printf(&quot;pthread_setspecific_1-2 Test FAILED: Incorrect value bound to key, expected %d, got %ld\n&quot;, KEY_VALUE_2, (long)rc2);
 		return PTS_FAIL;
 	}
 
-	printf(&quot;Test PASSED\n&quot;);
+	printf(&quot;pthread_setspecific_1-2: Test PASSED\n&quot;);
 	return PTS_PASS;
 }

Modified: haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/run_posix_tests.sh
===================================================================
--- haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/run_posix_tests.sh	2007-11-26 21:47:22 UTC (rev 23001)
+++ haiku/trunk/src/tests/system/libroot/posix/posixtestsuite/run_posix_tests.sh	2007-11-26 23:25:59 UTC (rev 23002)
@@ -30,7 +30,8 @@
 	conformance/interfaces/difftime/difftime_1-1
 	echo &quot;&quot;
 	echo &quot;fork()&quot;
-	conformance/interfaces/fork/fork_3-1
+#	conformance/interfaces/fork/fork_3-1
+	echo &quot;fork_3-1: FIXME : test sometimes fails, see bug #1639&quot;
 	conformance/interfaces/fork/fork_4-1
 	conformance/interfaces/fork/fork_6-1
 	conformance/interfaces/fork/fork_8-1
@@ -46,6 +47,32 @@
 }
 
 
+threads_tests()
+{
+	echo &quot;pthread_getspecific()&quot;
+	conformance/interfaces/pthread_getspecific/pthread_getspecific_1-1
+	conformance/interfaces/pthread_getspecific/pthread_getspecific_3-1
+	echo &quot;&quot;
+	echo &quot;pthread_key_create()&quot;
+	conformance/interfaces/pthread_key_create/pthread_key_create_1-1
+#	conformance/interfaces/pthread_key_create/pthread_key_create_1-2
+	echo &quot;pthread_key_create_1-2: FIXME: test fails, see bug #1644&quot;
+#	conformance/interfaces/pthread_key_create/pthread_key_create_2-1
+	echo &quot;pthread_key_create_2-1: FIXME: test invokes the debugger, see bug #1646&quot;
+	conformance/interfaces/pthread_key_create/pthread_key_create_3-1
+	echo &quot;&quot;
+	echo &quot;pthread_key_delete()&quot;
+	conformance/interfaces/pthread_key_delete/pthread_key_delete_1-1
+	conformance/interfaces/pthread_key_delete/pthread_key_delete_1-2
+#	conformance/interfaces/pthread_key_delete/pthread_key_delete_2-1
+	echo &quot;pthread_key_delete_2-1: FIXME: test blocks, see bug #1642&quot;
+	echo &quot;&quot;
+	echo &quot;pthread_setspecific()&quot;
+	conformance/interfaces/pthread_setspecific/pthread_setspecific_1-1
+	conformance/interfaces/pthread_setspecific/pthread_setspecific_1-2
+}
+
+
 signals_tests()
 {
 	echo &quot;kill()&quot;
@@ -112,6 +139,7 @@
 	standard_tests
 	asynchronous_input_output_tests
 	signals_tests
+	threads_tests
 }
 
 
@@ -135,7 +163,7 @@
 	#TODO sem*
 	;;
   THR) echo &quot;Executing threads tests&quot;
-	#TODO pthread_*
+	threads_tests
 	;;
   TMR) echo &quot;Executing timers and clocks tests&quot;
 	#TODO time* *time clock* nanosleep
@@ -155,4 +183,4 @@
 esac
 
 
-echo &quot;**** Tests Complete ****&quot;
+echo &quot;**** Tests Completed ****&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004859.html">[Haiku-commits] r23001 - haiku/trunk/src/libs/compat/freebsd_network
</A></li>
	<LI>Next message: <A HREF="004862.html">[Haiku-commits] r23003 - in haiku/trunk: headers/private/kernel/boot	src/system/boot/platform/bios_ia32 src/system/kernel/debug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4861">[ date ]</a>
              <a href="thread.html#4861">[ thread ]</a>
              <a href="subject.html#4861">[ subject ]</a>
              <a href="author.html#4861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
