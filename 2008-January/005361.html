<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r23399 -	haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-January/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r23399%20-%0A%09haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki&In-Reply-To=%3C200801111417.m0BEHIkk001984%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005360.html">
   <LINK REL="Next"  HREF="005364.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r23399 -	haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki</H1>
    <B>korli at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r23399%20-%0A%09haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki&In-Reply-To=%3C200801111417.m0BEHIkk001984%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r23399 -	haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki">korli at mail.berlios.de
       </A><BR>
    <I>Fri Jan 11 15:17:18 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="005360.html">[Haiku-commits] r23398 - haiku/trunk/src/servers/app
</A></li>
        <LI>Next message: <A HREF="005364.html">[Haiku-commits] r23400 - in haiku/trunk/src/apps: . login
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5361">[ date ]</a>
              <a href="thread.html#5361">[ thread ]</a>
              <a href="subject.html#5361">[ subject ]</a>
              <a href="author.html#5361">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: korli
Date: 2008-01-11 15:17:17 +0100 (Fri, 11 Jan 2008)
New Revision: 23399
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=23399&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=23399&amp;view=rev</A>

Modified:
   haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/config.h
   haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c
   haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.h
   haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/multi.c
Log:
style cleanup
should fix detection of Audigy2 Value (it was trying to check the revision id instead of the device id)


Modified: haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/config.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/config.h	2008-01-11 14:04:53 UTC (rev 23398)
+++ haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/config.h	2008-01-11 14:17:17 UTC (rev 23399)
@@ -49,9 +49,11 @@
 
 #define TYPE_AUDIGY			0x01
 #define TYPE_AUDIGY2		0x02
-#define TYPE_LIVE_5_1		0x04
+#define TYPE_AUDIGY2_VALUE	0x04
+#define TYPE_LIVE_5_1		0x08
 
 #define IS_AUDIGY(x) ((x)-&gt;type &amp; TYPE_AUDIGY)
 #define IS_AUDIGY2(x) ((x)-&gt;type &amp; TYPE_AUDIGY2)
+#define IS_AUDIGY2_VALUE(x) ((x)-&gt;type &amp; TYPE_AUDIGY2_VALUE)
 #define IS_LIVE_5_1(x) ((x)-&gt;type &amp; TYPE_LIVE_5_1)
 #endif

Modified: haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c	2008-01-11 14:04:53 UTC (rev 23398)
+++ haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c	2008-01-11 14:17:17 UTC (rev 23399)
@@ -50,6 +50,7 @@
 #include &lt;math.h&gt;
 #include &lt;midi_driver.h&gt;
 #include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 #include &quot;emuxki.h&quot;
@@ -227,7 +228,7 @@
 static void
 emuxki_mem_delete(emuxki_mem *mem)
 {
-	if(mem-&gt;area &gt; B_OK)
+	if (mem-&gt;area &gt; B_OK)
 		delete_area(mem-&gt;area);
 	free(mem);
 }
@@ -472,7 +473,7 @@
 	emuxki_dev   	*card = chan-&gt;voice-&gt;stream-&gt;card;
 	uint8			chano = chan-&gt;num;
 	
-	if(IS_AUDIGY(&amp;card-&gt;config)) {
+	if (IS_AUDIGY(&amp;card-&gt;config)) {
 		emuxki_chan_write(&amp;card-&gt;config, chano, 0x4c, 0);
 		emuxki_chan_write(&amp;card-&gt;config, chano, 0x4d, 0);
 		emuxki_chan_write(&amp;card-&gt;config, chano, 0x4e, 0);
@@ -645,7 +646,7 @@
 	LOG((&quot;voice-&gt;b16 = %#u\n&quot;, voice-&gt;b16));
 	LOG((&quot;voice-&gt;sample_rate = %#lu\n&quot;, voice-&gt;sample_rate));
 	LOG((&quot;voice-&gt;buffer = %#08x\n&quot;, voice-&gt;buffer));
-	if(voice-&gt;buffer) {
+	if (voice-&gt;buffer) {
 		LOG((&quot;voice-&gt;buffer-&gt;ptbidx = %#u\n&quot;, voice-&gt;buffer-&gt;ptbidx));
 		LOG((&quot;voice-&gt;buffer-&gt;log_base = %#08x\n&quot;, voice-&gt;buffer-&gt;log_base));
 		LOG((&quot;voice-&gt;buffer-&gt;phy_base = %#08x\n&quot;, voice-&gt;buffer-&gt;phy_base));
@@ -773,16 +774,16 @@
 		if (voice-&gt;stereo) {
 			switch(voice-&gt;stream-&gt;card-&gt;play_mode) {
 				case 2:
-					if(voice-&gt;stream-&gt;nstereo == 1) {
+					if (voice-&gt;stream-&gt;nstereo == 1) {
 						fxsend.a.dest = voice-&gt;voicenum * 2;
 						fxsend.a.level = maxlevel;
-					} else if((voice-&gt;stream-&gt;nstereo == 2) || 
+					} else if ((voice-&gt;stream-&gt;nstereo == 2) || 
 						((voice-&gt;stream-&gt;nstereo == 3)&amp;&amp;(voice-&gt;voicenum &lt; 2))) {
 						fxsend.a.dest = voice-&gt;voicenum * 2;
 						fxsend.a.level = maxlevel;
-						if(voice-&gt;voicenum &gt; 1 - 1)
+						if (voice-&gt;voicenum &gt; 1 - 1)
 							fxsend.a.dest-=2;
-					} else if(voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
+					} else if (voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
 							fxsend.a.dest = 0x0;
 							fxsend.a.level = maxlevel / 2;
 							fxsend.b.dest = 0x1;
@@ -792,16 +793,16 @@
 					}
 					break;
 				case 4:
-					if(voice-&gt;stream-&gt;nstereo == 1) {
+					if (voice-&gt;stream-&gt;nstereo == 1) {
 						fxsend.a.dest = voice-&gt;voicenum * 2;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum * 2 + 2;
 						fxsend.b.level = maxlevel;
-					} else if((voice-&gt;stream-&gt;nstereo == 2) || 
+					} else if ((voice-&gt;stream-&gt;nstereo == 2) || 
 						((voice-&gt;stream-&gt;nstereo == 3)&amp;&amp;(voice-&gt;voicenum &lt; 2))) {
 						fxsend.a.dest = voice-&gt;voicenum * 2;
 						fxsend.a.level = maxlevel;
-					} else if(voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
+					} else if (voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
 						fxsend.a.dest = 0x0;
 						fxsend.a.level = maxlevel / 2;
 						fxsend.b.dest = 0x1;
@@ -811,7 +812,7 @@
 					}
 					break;
 				case 6: // only on audigy
-					if(voice-&gt;stream-&gt;nstereo == 1) {
+					if (voice-&gt;stream-&gt;nstereo == 1) {
 						fxsend.a.dest = voice-&gt;voicenum * 2;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum * 2 + 2;
@@ -820,16 +821,16 @@
 						fxsend.c.level = maxlevel / 2;
 						fxsend.d.dest = 0x5;
 						fxsend.d.level = maxlevel / 2;
-					} else if(voice-&gt;stream-&gt;nstereo == 2) {
+					} else if (voice-&gt;stream-&gt;nstereo == 2) {
 						fxsend.a.dest = voice-&gt;voicenum * 2;
 						fxsend.a.level = maxlevel;
-						if(voice-&gt;voicenum &lt; 1) {
+						if (voice-&gt;voicenum &lt; 1) {
 							fxsend.b.dest = 0x4;
 							fxsend.b.level = maxlevel / 2;
 							fxsend.c.dest = 0x5;
 							fxsend.c.level = maxlevel / 2;
 						}
-					} else if(voice-&gt;stream-&gt;nstereo == 3) {
+					} else if (voice-&gt;stream-&gt;nstereo == 3) {
 						fxsend.a.dest = voice-&gt;voicenum * 2;
 						fxsend.a.level = maxlevel;
 					} else {
@@ -843,16 +844,16 @@
 			
 			switch(voice-&gt;stream-&gt;card-&gt;play_mode) {
 				case 2:
-					if(voice-&gt;stream-&gt;nstereo == 1) {
+					if (voice-&gt;stream-&gt;nstereo == 1) {
 						fxsend.a.dest = voice-&gt;voicenum * 2 + 1;
 						fxsend.a.level = maxlevel;
-					} else if((voice-&gt;stream-&gt;nstereo == 2) || 
+					} else if ((voice-&gt;stream-&gt;nstereo == 2) || 
 						((voice-&gt;stream-&gt;nstereo == 3)&amp;&amp;(voice-&gt;voicenum &lt; 2))) {
 						fxsend.a.dest = voice-&gt;voicenum * 2 + 1;
 						fxsend.a.level = maxlevel;
-						if(voice-&gt;voicenum &gt; 1 - 1)
+						if (voice-&gt;voicenum &gt; 1 - 1)
 							fxsend.a.dest-=2;
-					} else if(voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
+					} else if (voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
 							fxsend.a.dest = 0x0;
 							fxsend.a.level = maxlevel / 2;
 							fxsend.b.dest = 0x1;
@@ -862,16 +863,16 @@
 					}
 					break;
 				case 4:
-					if(voice-&gt;stream-&gt;nstereo == 1) {
+					if (voice-&gt;stream-&gt;nstereo == 1) {
 						fxsend.a.dest = voice-&gt;voicenum * 2 + 1;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum * 2 + 3;
 						fxsend.b.level = maxlevel;
-					} else if((voice-&gt;stream-&gt;nstereo == 2) || 
+					} else if ((voice-&gt;stream-&gt;nstereo == 2) || 
 						((voice-&gt;stream-&gt;nstereo == 3)&amp;&amp;(voice-&gt;voicenum &lt; 2))) {
 						fxsend.a.dest = voice-&gt;voicenum * 2 + 1;
 						fxsend.a.level = maxlevel;
-					} else if(voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
+					} else if (voice-&gt;stream-&gt;nstereo == 3 &amp;&amp; voice-&gt;voicenum &gt; 1) {
 						fxsend.a.dest = 0x0;
 						fxsend.a.level = maxlevel / 2;
 						fxsend.b.dest = 0x1;
@@ -881,7 +882,7 @@
 					}
 					break;
 				case 6: // only on audigy
-					if(voice-&gt;stream-&gt;nstereo == 1) {
+					if (voice-&gt;stream-&gt;nstereo == 1) {
 						fxsend.a.dest = voice-&gt;voicenum * 2 + 1;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum * 2 + 3;
@@ -890,16 +891,16 @@
 						fxsend.c.level = maxlevel / 2;
 						fxsend.d.dest = 0x5;
 						fxsend.d.level = maxlevel / 2;
-					} else if(voice-&gt;stream-&gt;nstereo == 2) {
+					} else if (voice-&gt;stream-&gt;nstereo == 2) {
 						fxsend.a.dest = voice-&gt;voicenum * 2 + 1;
 						fxsend.a.level = maxlevel;
-						if(voice-&gt;voicenum &lt; 1) {
+						if (voice-&gt;voicenum &lt; 1) {
 							fxsend.b.dest = 0x4;
 							fxsend.b.level = maxlevel / 2;
 							fxsend.c.dest = 0x5;
 							fxsend.c.level = maxlevel / 2;
 						}
-					} else if(voice-&gt;stream-&gt;nstereo == 3) {
+					} else if (voice-&gt;stream-&gt;nstereo == 3) {
 						fxsend.a.dest = voice-&gt;voicenum * 2 + 1;
 						fxsend.a.level = maxlevel;
 					} else {
@@ -913,21 +914,21 @@
 		} else {
 			switch(voice-&gt;stream-&gt;card-&gt;play_mode) {
 				case 2:
-					if(voice-&gt;stream-&gt;nmono == 1) {
+					if (voice-&gt;stream-&gt;nmono == 1) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum + 1;
 						fxsend.b.level = maxlevel;
-					} else if(voice-&gt;stream-&gt;nmono == 2) {
+					} else if (voice-&gt;stream-&gt;nmono == 2) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
-					} else if((voice-&gt;stream-&gt;nmono == 4) || 
+					} else if ((voice-&gt;stream-&gt;nmono == 4) || 
 						((voice-&gt;stream-&gt;nmono == 6)&amp;&amp;(voice-&gt;voicenum &lt; 4))) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
-						if(voice-&gt;voicenum &gt; 2 - 1)
+						if (voice-&gt;voicenum &gt; 2 - 1)
 							fxsend.a.dest-=2;
-					} else if(voice-&gt;stream-&gt;nmono == 6 &amp;&amp; voice-&gt;voicenum &gt; 3) {
+					} else if (voice-&gt;stream-&gt;nmono == 6 &amp;&amp; voice-&gt;voicenum &gt; 3) {
 							fxsend.a.dest = 0x0;
 							fxsend.a.level = maxlevel / 2;
 							fxsend.b.dest = 0x1;
@@ -937,7 +938,7 @@
 					}
 					break;
 				case 4:
-					if(voice-&gt;stream-&gt;nmono == 1) {
+					if (voice-&gt;stream-&gt;nmono == 1) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum + 1;
@@ -946,16 +947,16 @@
 						fxsend.c.level = maxlevel;
 						fxsend.d.dest = voice-&gt;voicenum + 3;
 						fxsend.d.level = maxlevel;
-					} else if(voice-&gt;stream-&gt;nmono == 2) {
+					} else if (voice-&gt;stream-&gt;nmono == 2) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum + 2;
 						fxsend.b.level = maxlevel;
-					} else if((voice-&gt;stream-&gt;nmono == 4) || 
+					} else if ((voice-&gt;stream-&gt;nmono == 4) || 
 						((voice-&gt;stream-&gt;nmono == 6)&amp;&amp;(voice-&gt;voicenum &lt; 4))) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
-					} else if(voice-&gt;stream-&gt;nmono == 6 &amp;&amp; voice-&gt;voicenum &gt; 3) {
+					} else if (voice-&gt;stream-&gt;nmono == 6 &amp;&amp; voice-&gt;voicenum &gt; 3) {
 							fxsend.a.dest = 0x0;
 							fxsend.a.level = maxlevel / 2;
 							fxsend.b.dest = 0x1;
@@ -965,7 +966,7 @@
 					}
 					break;
 				case 6: // only on audigy
-					if(voice-&gt;stream-&gt;nmono == 1) {
+					if (voice-&gt;stream-&gt;nmono == 1) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum + 1;
@@ -978,7 +979,7 @@
 						fxsend.e.level = maxlevel;
 						fxsend.f.dest = voice-&gt;voicenum + 5;
 						fxsend.f.level = maxlevel;
-					} else if(voice-&gt;stream-&gt;nmono == 2) {
+					} else if (voice-&gt;stream-&gt;nmono == 2) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
 						fxsend.b.dest = voice-&gt;voicenum + 2;
@@ -987,16 +988,16 @@
 						fxsend.c.level = maxlevel / 2;
 						fxsend.d.dest = 0x5;
 						fxsend.d.level = maxlevel / 2;
-					} else if(voice-&gt;stream-&gt;nmono == 4) {
+					} else if (voice-&gt;stream-&gt;nmono == 4) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
-						if(voice-&gt;voicenum &lt; 2) {
+						if (voice-&gt;voicenum &lt; 2) {
 							fxsend.b.dest = 0x4;
 							fxsend.b.level = maxlevel / 2;
 							fxsend.c.dest = 0x5;
 							fxsend.c.level = maxlevel / 2;
 						}
-					} else if(voice-&gt;stream-&gt;nmono == 6) {
+					} else if (voice-&gt;stream-&gt;nmono == 6) {
 						fxsend.a.dest = voice-&gt;voicenum;
 						fxsend.a.level = maxlevel;
 					} else {
@@ -1063,14 +1064,14 @@
 emuxki_voice_set_recparms(emuxki_voice *voice, emuxki_recsrc_t recsrc,
 			     	emuxki_recparams *recparams)
 {
-	if(voice-&gt;use &amp; EMU_USE_RECORD) {
+	if (voice-&gt;use &amp; EMU_USE_RECORD) {
 		switch(recsrc) {
 			case EMU_RECSRC_MIC:
 				break;
 			case EMU_RECSRC_ADC:
 				break;
 			case EMU_RECSRC_FX:
-				if(!recparams)
+				if (!recparams)
 					return B_ERROR;
 				voice-&gt;recparams.efx_voices[0] = recparams-&gt;efx_voices[0];
 				voice-&gt;recparams.efx_voices[1] = recparams-&gt;efx_voices[1];
@@ -1166,7 +1167,7 @@
 		LOG((&quot;emuxki_voice_commit_parms idx_reg : %u\n&quot;, idx_reg));
 		
 		idx_reg = EMU_RECIDX(idx_reg);
-		while(emuxki_chan_read(&amp;voice-&gt;stream-&gt;card-&gt;config, 0, idx_reg))
+		while (emuxki_chan_read(&amp;voice-&gt;stream-&gt;card-&gt;config, 0, idx_reg))
 			snooze(5);
 	}
 	return B_OK;
@@ -1227,7 +1228,7 @@
 	if (timerate &amp; ~EMU_TIMER_RATE_MASK)
 		timerate = 0;
 	
-	if(card-&gt;timerate &gt; timerate) {
+	if (card-&gt;timerate &gt; timerate) {
 		LOG((&quot;emuxki_resched_timer written (old %u, new %u)\n&quot;, card-&gt;timerate, timerate));
 		card-&gt;timerate = timerate;
 		emuxki_reg_write_16(&amp;card-&gt;config, EMU_TIMER, timerate);
@@ -1269,19 +1270,19 @@
 			return EMU_ADCCR_SAMPLERATE_16;
 			break;
 		case 12000:
-			if(IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config))
+			if (IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config))
 				return EMU_A_ADCCR_SAMPLERATE_12;
 			else
 				PRINT((&quot;recording sample_rate not supported : %lu\n&quot;, voice-&gt;sample_rate));
 			break;
 		case 11000:
-			if(IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config))
+			if (IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config))
 				return EMU_A_ADCCR_SAMPLERATE_11;
 			else
 				return EMU_ADCCR_SAMPLERATE_11;
 			break;
 		case 8000:
-			if(IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config))
+			if (IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config))
 				return EMU_A_ADCCR_SAMPLERATE_8;
 			else
 				return EMU_ADCCR_SAMPLERATE_8;
@@ -1312,7 +1313,7 @@
 				uint32 adccr_value = 0;
 				adccr_value = emuxki_voice_adc_rate(voice);
 				LOG((&quot;emuxki_voice_start adccr_value : %u\n&quot;, adccr_value));
-				if(voice-&gt;stereo)
+				if (voice-&gt;stereo)
 					adccr_value |= ( (IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config) ? EMU_A_ADCCR_LCHANENABLE : EMU_ADCCR_LCHANENABLE )
 						| ( IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config) ? EMU_A_ADCCR_RCHANENABLE : EMU_ADCCR_RCHANENABLE ));
 				else
@@ -1325,7 +1326,7 @@
 				}
 				break;
 			case EMU_RECSRC_FX:
-				if(IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config)) {
+				if (IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config)) {
 					emuxki_chan_write(&amp;voice-&gt;stream-&gt;card-&gt;config, 0, EMU_A_FXWC1, 
 						voice-&gt;recparams.efx_voices[0]);
 					emuxki_chan_write(&amp;voice-&gt;stream-&gt;card-&gt;config, 0, EMU_A_FXWC2, 
@@ -1366,7 +1367,7 @@
 				emuxki_inte_disable(&amp;voice-&gt;stream-&gt;card-&gt;config, EMU_INTE_ADCBUFENABLE);
 				break;
 			case EMU_RECSRC_FX:
-				if(IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config)) {
+				if (IS_AUDIGY(&amp;voice-&gt;stream-&gt;card-&gt;config)) {
 					emuxki_chan_write(&amp;voice-&gt;stream-&gt;card-&gt;config, 0, EMU_A_FXWC1, 0);
 					emuxki_chan_write(&amp;voice-&gt;stream-&gt;card-&gt;config, 0, EMU_A_FXWC2, 0);
 				} else
@@ -1442,7 +1443,7 @@
 		return B_OK;
 	
 	LIST_FOREACH(voice, &amp;stream-&gt;voices, next) {
-		if(voice-&gt;buffer)
+		if (voice-&gt;buffer)
 			emuxki_mem_free(stream-&gt;card, voice-&gt;buffer-&gt;log_base);
 		emuxki_voice_delete(voice);
 	}
@@ -1452,7 +1453,7 @@
 	stream-&gt;b16 = b16;
 	stream-&gt;sample_rate = sample_rate;
 	
-	if(stereo &amp;&amp; (channels % 2 == 0)) {
+	if (stereo &amp;&amp; (channels % 2 == 0)) {
 		stream-&gt;stereo = true;
 		stream-&gt;nstereo = channels / 2;
 		stream-&gt;nmono = 0;
@@ -1467,10 +1468,10 @@
 	sample_size = stream-&gt;b16 + 1;
 	frame_size = sample_size * (stream-&gt;stereo ? 2 : 1);
 	
-	for(i=0; i&lt;nvoices; i++) {
+	for (i=0; i&lt;nvoices; i++) {
 		voice = emuxki_voice_new(stream, stream-&gt;use, i);
-		if(voice) {
-			if(!stream-&gt;first_voice)
+		if (voice) {
+			if (!stream-&gt;first_voice)
 				stream-&gt;first_voice = voice;
 			LIST_INSERT_HEAD((&amp;stream-&gt;voices), voice, next);
 			if ((error = emuxki_voice_set_audioparms(voice, stream-&gt;stereo, stream-&gt;b16, stream-&gt;sample_rate)))
@@ -1497,14 +1498,14 @@
 	emuxki_voice *voice;
 	LOG((&quot;emuxki_stream_set_recparms\n&quot;));
 	
-	if(stream-&gt;use &amp; EMU_USE_RECORD) {
+	if (stream-&gt;use &amp; EMU_USE_RECORD) {
 		switch(recsrc) {
 			case EMU_RECSRC_MIC:
 				break;
 			case EMU_RECSRC_ADC:
 				break;
 			case EMU_RECSRC_FX:
-				if(!recparams)
+				if (!recparams)
 					return B_ERROR;
 				LIST_FOREACH(voice, &amp;stream-&gt;voices, next) {
 					voice-&gt;recparams.efx_voices[0] = recparams-&gt;efx_voices[0];
@@ -1544,35 +1545,35 @@
 	LOG((&quot;emuxki_stream_get_nth_buffer\n&quot;));
 	
 	sample_size = stream-&gt;b16 + 1;
-	if(buf &gt;= stream-&gt;bufcount)
+	if (buf &gt;= stream-&gt;bufcount)
 		return B_BAD_INDEX;
 	
-	if(stream-&gt;stereo) {
+	if (stream-&gt;stereo) {
 		i = stream-&gt;nstereo - 1;
-		if(chan/2 &gt; i)
+		if (chan/2 &gt; i)
 			return B_BAD_INDEX;
 		LIST_FOREACH(voice, &amp;stream-&gt;voices, next)
-			if(i != chan/2)
+			if (i != chan/2)
 				i--;
 			else 
 				break;
-		if(voice) {
+		if (voice) {
 			*buffer = (char*)voice-&gt;buffer-&gt;log_base + (buf * stream-&gt;bufframes * sample_size * 2);
-			if(chan % 2 == 1)
+			if (chan % 2 == 1)
 				*buffer += sample_size;
 			*stride = sample_size * 2;
 		} else
 			return B_ERROR;
 	} else {
 		i = stream-&gt;nmono - 1;
-		if(chan &gt; i)
+		if (chan &gt; i)
 			return B_BAD_INDEX;
 		LIST_FOREACH(voice, &amp;stream-&gt;voices, next)
-			if(i != chan)
+			if (i != chan)
 				i--;
 			else 
 				break;
-		if(voice) {
+		if (voice) {
 			*buffer = (char*)voice-&gt;buffer-&gt;log_base + (buf * stream-&gt;bufframes * sample_size);
 			*stride = sample_size;
 		} else
@@ -1660,10 +1661,10 @@
 	LIST_REMOVE(stream, next);
 	unlock(status);
 	
-	while(!LIST_EMPTY(&amp;stream-&gt;voices)) {
+	while (!LIST_EMPTY(&amp;stream-&gt;voices)) {
 		voice = LIST_FIRST(&amp;stream-&gt;voices);
 		LIST_REMOVE(voice, next);
-		if(voice-&gt;buffer)
+		if (voice-&gt;buffer)
 			emuxki_mem_free(stream-&gt;card, voice-&gt;buffer-&gt;log_base);
 		emuxki_voice_delete(voice);
 	}
@@ -1701,27 +1702,27 @@
 	switch(type) {
 		case EMU_MIX_MUTE:
 			gpr-&gt;mute = (values[0] == 1.0);
-			if(gpr-&gt;mute) {
-				for(i=0; i&lt;count; i++)
+			if (gpr-&gt;mute) {
+				for (i=0; i&lt;count; i++)
 					emuxki_write_gpr(&amp;card-&gt;config, gpr-&gt;gpr + i, 0);
 				break;
 			}
-			for(i=0; i&lt;count; i++) {
+			for (i=0; i&lt;count; i++) {
 				values[i] = gpr-&gt;current[i];
 			}	
 		case EMU_MIX_GAIN:
-			for(i=0; i&lt;count; i++) {
-				if(values[i]&gt;gpr-&gt;max_gain || values[i]&lt;gpr-&gt;min_gain)
+			for (i=0; i&lt;count; i++) {
+				if (values[i]&gt;gpr-&gt;max_gain || values[i]&lt;gpr-&gt;min_gain)
 					return;
 				index = (int32)(values[i] / gpr-&gt;granularity);
-				if(index &gt; sizeof(db_table)/sizeof(db_table[0]))
+				if (index &gt; sizeof(db_table)/sizeof(db_table[0]))
 					index = sizeof(db_table)/sizeof(db_table[0]);
-				else if(index &lt; 0)
+				else if (index &lt; 0)
 					index = 0;
 				LOG((&quot;emuxki_set_gpr gpr: %d \n&quot;, gpr-&gt;gpr + i));
 				LOG((&quot;emuxki_set_gpr values[i]: %g \n&quot;, values[i]));
 				LOG((&quot;emuxki_set_gpr index: %u \n&quot;, index));
-				if(!gpr-&gt;mute)
+				if (!gpr-&gt;mute)
 					emuxki_write_gpr(&amp;card-&gt;config, gpr-&gt;gpr + i, db_table[index]);
 				gpr-&gt;current[i] = index * gpr-&gt;granularity;
 			}
@@ -1739,7 +1740,7 @@
 	
 	switch(type) {
 		case EMU_MIX_GAIN:
-			for(i=0; i&lt;count; i++) {
+			for (i=0; i&lt;count; i++) {
 				values[i] = gpr-&gt;current[i];
 			}
 			break;
@@ -1757,7 +1758,7 @@
 	
 	LOG((&quot;emuxki_dump_gprs\n&quot;));
 
-	for(pc = 0; pc &lt; count; pc++) {
+	for (pc = 0; pc &lt; count; pc++) {
 		value = emuxki_read_gpr(&amp;card-&gt;config, pc);
 		LOG((&quot;dsp_gpr pc=%x, value=%x\n&quot;, pc, value));
 	}
@@ -1782,16 +1783,16 @@
 	gpr-&gt;granularity = granularity;
 	gpr-&gt;mute = false;
 	(*gpr_num)++;
-	if(gpr-&gt;type &amp; EMU_MIX_STEREO)
+	if (gpr-&gt;type &amp; EMU_MIX_STEREO)
 		(*gpr_num)++;
 	
-	if(default_mute == 1.0) {
+	if (default_mute == 1.0) {
 		values[0] = default_mute;
 		emuxki_gpr_set(card, gpr, EMU_MIX_MUTE, values);
 	}
 	
 	values[0] = gpr-&gt;default_value;
-	if(gpr-&gt;type &amp; EMU_MIX_STEREO)
+	if (gpr-&gt;type &amp; EMU_MIX_STEREO)
 		values[1] = gpr-&gt;default_value;
 	emuxki_gpr_set(card, gpr, EMU_MIX_GAIN, values);
 	
@@ -1811,8 +1812,8 @@
 	switch(type) {
 		case EMU_DIGITAL_MODE:
 			card-&gt;digital_enabled = *value == 1;
-			if(IS_AUDIGY(&amp;card-&gt;config))
-				if(IS_AUDIGY2(&amp;card-&gt;config)) {
+			if (IS_AUDIGY(&amp;card-&gt;config))
+				if (IS_AUDIGY2(&amp;card-&gt;config)) {
 					// this disables analog, not enough
 					emuxki_reg_write_32(&amp;card-&gt;config, EMU_A_IOCFG, 
 						(card-&gt;digital_enabled ? 0 : EMU_A_IOCFG_GPOUT0) | 
@@ -1834,7 +1835,7 @@
 			
 			break;
 		case EMU_AUDIO_MODE:
-			if(*value!=0 &amp;&amp; *value!=1 &amp;&amp; *value!=2) {
+			if (*value!=0 &amp;&amp; *value!=1 &amp;&amp; *value!=2) {
 				PRINT((&quot;emuxki_parameter_set error value unexpected\n&quot;));
 				return;
 			}
@@ -1901,7 +1902,7 @@
 					//trace_hardware_regs(&amp;card-&gt;config);
 					//TRACE((&quot;voice pointer %p\n&quot;, voice));
 														
-					if(stream-&gt;inth)
+					if (stream-&gt;inth)
 						stream-&gt;inth(stream-&gt;inthparam);
 
 					voice-&gt;trigblk++;
@@ -1915,7 +1916,7 @@
 		}
         
 		if (ipr &amp; (EMU_IPR_MIDITRANSBUFE)) {
-			if(!midi_interrupt(card)) {
+			if (!midi_interrupt(card)) {
 				emuxki_inte_disable(&amp;card-&gt;config, EMU_INTE_MIDITXENABLE);
 				TRACE((&quot;EMU_INTE_MIDITXENABLE disabled\n&quot;));
 			}
@@ -1941,7 +1942,7 @@
 					//dump_voice(voice);
 					//trace_hardware_regs(&amp;card-&gt;config);
 														
-					if(stream-&gt;inth)
+					if (stream-&gt;inth)
 						stream-&gt;inth(stream-&gt;inthparam);
 
 					voice-&gt;trigblk++;
@@ -1975,13 +1976,13 @@
 		emuxki_reg_write_32(&amp;card-&gt;config, EMU_IPR, ipr);
 	}
 
-	if(IS_AUDIGY2(&amp;card-&gt;config)) {
+	if (IS_AUDIGY2(&amp;card-&gt;config)) {
 		while ((ipr = emuxki_reg_read_32(&amp;card-&gt;config, EMU_A2_IPR2))) {
 			emuxki_reg_write_32(&amp;card-&gt;config, EMU_A2_IPR2, ipr);
 			break;	// avoid loop
 		}
 
-		if (card-&gt;info.revision == 4) {
+		if (!IS_AUDIGY2_VALUE(&amp;card-&gt;config)) {
 			while ((ipr = emuxki_reg_read_32(&amp;card-&gt;config, EMU_A2_IPR3))) {
 				emuxki_reg_write_32(&amp;card-&gt;config, EMU_A2_IPR3, ipr);
 				break; // avoid loop
@@ -1989,7 +1990,7 @@
 		}
 	}
 
-	if(gotone)
+	if (gotone)
 		return B_INVOKE_SCHEDULER;
 
 	TRACE((&quot;Got unhandled interrupt\n&quot;));
@@ -2021,6 +2022,7 @@
 			(info.device_id == CREATIVELABS_SBLIVE_DEVICE_ID
 #if AUDIGY
 			|| info.device_id == CREATIVELABS_AUDIGY_DEVICE_ID
+			|| info.device_id == CREATIVELABS_AUDIGY2_VALUE_DEVICE_ID
 #endif
 			)) {
 			err = B_OK;
@@ -2062,10 +2064,12 @@
 	card-&gt;config.nabmbar = card-&gt;info.u.h0.base_registers[0];
 	card-&gt;config.irq = card-&gt;info.u.h0.interrupt_line;
 	card-&gt;config.type = 0;
-	if(card-&gt;info.device_id == CREATIVELABS_AUDIGY_DEVICE_ID)
+	if (card-&gt;info.device_id == CREATIVELABS_AUDIGY_DEVICE_ID) {
 		card-&gt;config.type |= TYPE_AUDIGY;
-	if(IS_AUDIGY(&amp;card-&gt;config) &amp;&amp; (card-&gt;info.revision == 4 || card-&gt;info.revision == 8))
-		card-&gt;config.type |= TYPE_AUDIGY2;
+		if (card-&gt;info.revision == 4)
+			card-&gt;config.type |= TYPE_AUDIGY2;
+	} else if (card-&gt;info.device_id == CREATIVELABS_AUDIGY2_VALUE_DEVICE_ID)
+		card-&gt;config.type |= TYPE_AUDIGY | TYPE_AUDIGY2 | TYPE_AUDIGY2_VALUE;
 	
 	PRINT((&quot;%s deviceid = %#04x chiprev = %x model = %x enhanced at %lx\n&quot;, card-&gt;name, card-&gt;info.device_id,
 		card-&gt;info.revision, card-&gt;info.u.h0.subsystem_id, card-&gt;config.nabmbar));
@@ -2104,7 +2108,7 @@
 	PRINT((&quot;codec description     = %s\n&quot;,ac97_get_vendor_id_description(&amp;card-&gt;config)));
 	PRINT((&quot;codec 3d enhancement = %s\n&quot;,ac97_get_3d_stereo_enhancement(&amp;card-&gt;config)));
 	
-	if(IS_AUDIGY2(&amp;card-&gt;config)) {
+	if (IS_AUDIGY2(&amp;card-&gt;config)) {
 		emuxki_reg_write_32(&amp;card-&gt;config, EMU_A_IOCFG, 
 			EMU_A_IOCFG_GPOUT0 | emuxki_reg_read_32(&amp;card-&gt;config, EMU_A_IOCFG));
 	}
@@ -2167,16 +2171,16 @@
 	if ((err = emuxki_init(card)))
 		return (err);
 	
-	if(IS_AUDIGY(&amp;card-&gt;config) || IS_LIVE_5_1(&amp;card-&gt;config)) {
+	if (IS_AUDIGY(&amp;card-&gt;config) || IS_LIVE_5_1(&amp;card-&gt;config)) {
 		card-&gt;play_mode = 6;	// mode 5.1
 	} else {
 		card-&gt;play_mode = 4;	// mode 4.0
 	}
 	
 	emuxki_reg_write_32(&amp;card-&gt;config, EMU_INTE, EMU_INTE_SAMPLERATER | EMU_INTE_PCIERRENABLE);
-	if(IS_AUDIGY2(&amp;card-&gt;config)) {
+	if (IS_AUDIGY2(&amp;card-&gt;config)) {
 		emuxki_reg_write_32(&amp;card-&gt;config, EMU_A2_INTE2, 0);
-		if (card-&gt;info.revision == 4) {
+		if (!IS_AUDIGY2_VALUE(&amp;card-&gt;config)) {
 			emuxki_reg_write_32(&amp;card-&gt;config, EMU_A2_INTE3, 0);
 		}
 	}
@@ -2186,11 +2190,11 @@
 
 	emuxki_inte_enable(&amp;card-&gt;config, EMU_INTE_VOLINCRENABLE | EMU_INTE_VOLDECRENABLE
 		| EMU_INTE_MUTEENABLE | EMU_INTE_FXDSPENABLE);
-	if(IS_AUDIGY2(&amp;card-&gt;config)) {
+	if (IS_AUDIGY2(&amp;card-&gt;config)) {
 		emuxki_reg_write_32(&amp;card-&gt;config, EMU_HCFG, EMU_HCFG_AUDIOENABLE |
 			EMU_HCFG_AC3ENABLE_CDSPDIF | EMU_HCFG_AC3ENABLE_GPSPDIF|
 			EMU_HCFG_JOYENABLE | EMU_HCFG_AUTOMUTE);
-	} else if(IS_AUDIGY(&amp;card-&gt;config)) {
+	} else if (IS_AUDIGY(&amp;card-&gt;config)) {
 		emuxki_reg_write_32(&amp;card-&gt;config, EMU_HCFG, EMU_HCFG_AUDIOENABLE |
 			EMU_HCFG_JOYENABLE | EMU_HCFG_AUTOMUTE);
 	} else {
@@ -2216,7 +2220,7 @@
 	
 	while (pc &lt; 512) {
 		emuxki_dsp_getop(&amp;card-&gt;config, &amp;pc, &amp;op, &amp;r, &amp;a, &amp;x, &amp;y);
-		if(op!=EMU_DSP_OP_ACC3 || r!=zero || a!=zero || x!=zero || y!=zero) {
+		if (op!=EMU_DSP_OP_ACC3 || r!=zero || a!=zero || x!=zero || y!=zero) {
 			LOG((&quot;dsp_op pc=%u, op=%x, r=%x, a=%x, x=%x, y=%x\n&quot;,
 				pc, op, r, a, x, y));
 		}
@@ -2256,7 +2260,7 @@
 			EMU_MIX_GAIN|EMU_MIX_STEREO|EMU_MIX_MUTE|EMU_MIX_PLAYBACK, &amp;gpr, 0.0, 0.0, -46.5, 0.0, -0.75);
 	a_rear_gpr = emuxki_gpr_new(card, &quot;Analog Rear&quot;, 
 			EMU_MIX_GAIN|EMU_MIX_STEREO|EMU_MIX_MUTE|EMU_MIX_PLAYBACK, &amp;gpr, 0.0, 0.0, -46.5, 0.0, -0.75);
-	if(IS_AUDIGY(&amp;card-&gt;config) || IS_LIVE_5_1(&amp;card-&gt;config))
+	if (IS_AUDIGY(&amp;card-&gt;config) || IS_LIVE_5_1(&amp;card-&gt;config))
 		a_center_sub_gpr = emuxki_gpr_new(card, &quot;Analog Center/Sub&quot;, 
 			EMU_MIX_GAIN|EMU_MIX_STEREO|EMU_MIX_MUTE|EMU_MIX_PLAYBACK, &amp;gpr, 0.0, 0.0, -46.5, 0.0, -0.75);
 	
@@ -2283,7 +2287,7 @@
 		
 	card-&gt;gpr_count = gpr;
 			
-	if(IS_AUDIGY(&amp;card-&gt;config)) {
+	if (IS_AUDIGY(&amp;card-&gt;config)) {
 		/* DSP_IN_GPR(l/r) = 0 + AC97In(l/r) * P_AC97_IN_GPR(l/r) */
 		emuxki_dsp_addop(&amp;card-&gt;config, &amp;pc, EMU_DSP_OP_MACS,
 				  EMU_A_DSP_GPR(EMU_DSP_TMPGPR_DSP_IN_L),
@@ -2516,7 +2520,7 @@
 				  EMU_DSP_GPR(EMU_DSP_TMPGPR_REAR_RIGHT), EMU_DSP_GPR(a_rear_gpr-&gt;gpr+1));
 		
 		/* Analog Center/Sub = 0 + Center/Sub GPR(l/r) * A_CENTER_GPR(l/r) */
-		if(IS_LIVE_5_1(&amp;card-&gt;config)) {
+		if (IS_LIVE_5_1(&amp;card-&gt;config)) {
 			emuxki_dsp_addop(&amp;card-&gt;config, &amp;pc, EMU_DSP_OP_MACS,
 					  EMU_DSP_OUT_A_CENTER,
 					  EMU_DSP_CST(0),
@@ -2630,7 +2634,7 @@
 	emuxki_chan_write(&amp;card-&gt;config, 0, EMU_ADCBS, EMU_RECBS_BUFSIZE_NONE);
 	emuxki_chan_write(&amp;card-&gt;config, 0, EMU_ADCBA, 0);
 	
-	if(IS_AUDIGY(&amp;card-&gt;config)) {
+	if (IS_AUDIGY(&amp;card-&gt;config)) {
 		emuxki_chan_write(&amp;card-&gt;config, 0, EMU_SPBYPASS, EMU_SPBYPASS_24_BITS);
 		emuxki_chan_write(&amp;card-&gt;config, 0, EMU_AC97SLOT, EMU_AC97SLOT_CENTER | EMU_AC97SLOT_LFE);
 	}
@@ -2676,21 +2680,21 @@
 	emuxki_chan_write(&amp;card-&gt;config, 0, EMU_SPCS1, spcs);
 	emuxki_chan_write(&amp;card-&gt;config, 0, EMU_SPCS2, spcs);
 	
-	if(IS_AUDIGY2(&amp;card-&gt;config)) {
+	if (IS_AUDIGY2(&amp;card-&gt;config)) {
 		emuxki_chan_write(&amp;card-&gt;config, 0, EMU_A2_SPDIF_SAMPLERATE, EMU_A2_SPDIF_UNKNOWN);
 		
 		emuxki_p16v_write(&amp;card-&gt;config, 0, EMU_A2_SRCSEL, 
 			EMU_A2_SRCSEL_ENABLE_SPDIF | EMU_A2_SRCSEL_ENABLE_SRCMULTI);
 		
-		if (card-&gt;info.revision == 4) {
-			emuxki_p16v_write(&amp;card-&gt;config, 0, EMU_A2_SRCMULTI, EMU_A2_SRCMULTI_ENABLE_INPUT);
-		} else {
+		if (IS_AUDIGY2_VALUE(&amp;card-&gt;config)) {
 			emuxki_p16v_write(&amp;card-&gt;config, 0, EMU_A2_P17V_I2S, EMU_A2_P17V_I2S_ENABLE);
 			emuxki_p16v_write(&amp;card-&gt;config, 0, EMU_A2_P17V_SPDIF, EMU_A2_P17V_SPDIF_ENABLE);
 
 			emuxki_reg_write_32(&amp;card-&gt;config, EMU_A_IOCFG, 
 				emuxki_reg_read_32(&amp;card-&gt;config, EMU_A_IOCFG) &amp; ~0x8);
-		}
+		} else {
+			emuxki_p16v_write(&amp;card-&gt;config, 0, EMU_A2_SRCMULTI, EMU_A2_SRCMULTI_ENABLE_INPUT);
+		}		
 	}
 	
 	/* Let's play with sound processor */
@@ -2823,6 +2827,7 @@
 			(info.device_id == CREATIVELABS_SBLIVE_DEVICE_ID 
 #if AUDIGY
 			|| info.device_id == CREATIVELABS_AUDIGY_DEVICE_ID
+			|| info.device_id == CREATIVELABS_AUDIGY2_VALUE_DEVICE_ID
 #endif
 			)) {
 			if (num_cards == NUM_CARDS) {
@@ -2891,7 +2896,7 @@
 	emuxki_chan_write(&amp;card-&gt;config, 0, EMU_MICBA, 0);
 	emuxki_chan_write(&amp;card-&gt;config, 0, EMU_FXBS, EMU_RECBS_BUFSIZE_NONE);
 	emuxki_chan_write(&amp;card-&gt;config, 0, EMU_FXBA, 0);
-	if(IS_AUDIGY(&amp;card-&gt;config)) {
+	if (IS_AUDIGY(&amp;card-&gt;config)) {
 		emuxki_chan_write(&amp;card-&gt;config, 0, EMU_A_FXWC1, 0);
 		emuxki_chan_write(&amp;card-&gt;config, 0, EMU_A_FXWC2, 0);
 	} else {

Modified: haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.h	2008-01-11 14:04:53 UTC (rev 23398)
+++ haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/emuxki.h	2008-01-11 14:17:17 UTC (rev 23399)
@@ -53,6 +53,7 @@
 #define CREATIVELABS_VENDOR_ID	0x1102	/* Creative Labs */
 #define CREATIVELABS_SBLIVE_DEVICE_ID	0x0002	/* Creative Labs SoundBlaster Live */
 #define CREATIVELABS_AUDIGY_DEVICE_ID	0x0004	/* Creative Labs Audigy and Audigy 2 */
+#define CREATIVELABS_AUDIGY2_VALUE_DEVICE_ID	0x0008	/* Creative Labs Audigy 2 Value */
 
 #define AUDIGY 1	// Audigy seems to work
 #ifdef __HAIKU__
@@ -68,6 +69,7 @@
 #define FRIENDLY_NAME_LIVE_5_1 FRIENDLY_NAME_LIVE&quot; 5.1&quot;
 #define FRIENDLY_NAME_AUDIGY FRIENDLY_NAME&quot; Audigy&quot;
 #define FRIENDLY_NAME_AUDIGY2 FRIENDLY_NAME_AUDIGY&quot; 2&quot;
+#define FRIENDLY_NAME_AUDIGY2_VALUE FRIENDLY_NAME_AUDIGY2&quot; Value&quot;
 #define AUTHOR &quot;J&#233;r&#244;me Duval&quot;
 
 /*

Modified: haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/multi.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/multi.c	2008-01-11 14:04:53 UTC (rev 23398)
+++ haiku/trunk/src/add-ons/kernel/drivers/audio/emuxki/multi.c	2008-01-11 14:17:17 UTC (rev 23399)
@@ -51,24 +51,24 @@
 		case B_MIX_GAIN:
 			value = emuxki_codec_read(&amp;dev-&gt;config, info-&gt;reg);
 			//PRINT((&quot;B_MIX_GAIN value : %u\n&quot;, value));
-			if(info-&gt;type &amp; B_MIX_STEREO) {
+			if (info-&gt;type &amp; B_MIX_STEREO) {
 				mask = ((1 &lt;&lt; (info-&gt;bits + 1)) - 1) &lt;&lt; 8;
 				gain = ((value &amp; mask) &gt;&gt; 8) * info-&gt;granularity;
-				if(info-&gt;polarity == 1)
+				if (info-&gt;polarity == 1)
 					values[0] = info-&gt;max_gain - gain;
 				else
 					values[0] = gain - info-&gt;min_gain;
 				
 				mask = ((1 &lt;&lt; (info-&gt;bits + 1)) - 1);
 				gain = (value &amp; mask) * info-&gt;granularity;
-				if(info-&gt;polarity == 1)
+				if (info-&gt;polarity == 1)
 					values[1] = info-&gt;max_gain - gain;
 				else
 					values[1] = gain - info-&gt;min_gain;
 			} else {
 				mask = ((1 &lt;&lt; (info-&gt;bits + 1)) - 1);
 				gain = (value &amp; mask) * info-&gt;granularity;
-				if(info-&gt;polarity == 1)
+				if (info-&gt;polarity == 1)
 					values[0] = info-&gt;max_gain - gain;
 				else
 					values[0] = gain - info-&gt;min_gain;
@@ -108,11 +108,11 @@
 	switch(type) {
 		case B_MIX_GAIN:
 			value = emuxki_codec_read(&amp;dev-&gt;config, info-&gt;reg);
-			if(info-&gt;type &amp; B_MIX_STEREO) {
+			if (info-&gt;type &amp; B_MIX_STEREO) {
 				mask = ((1 &lt;&lt; (info-&gt;bits + 1)) - 1) &lt;&lt; 8;
 				value &amp;= ~mask;
 				
-				if(info-&gt;polarity == 1)
+				if (info-&gt;polarity == 1)
 					gain = info-&gt;max_gain - values[0];
 				else
 					gain =  values[0] - info-&gt;min_gain;
@@ -120,7 +120,7 @@
 				
 				mask = ((1 &lt;&lt; (info-&gt;bits + 1)) - 1);
 				value &amp;= ~mask;
-				if(info-&gt;polarity == 1)
+				if (info-&gt;polarity == 1)
 					gain = info-&gt;max_gain - values[1];
 				else
 					gain =  values[1] - info-&gt;min_gain;
@@ -128,7 +128,7 @@
 			} else {
 				mask = ((1 &lt;&lt; (info-&gt;bits + 1)) - 1);
 				value &amp;= ~mask;
-				if(info-&gt;polarity == 1)
+				if (info-&gt;polarity == 1)
 					gain = info-&gt;max_gain - values[0];
 				else
 					gain =  values[0] - info-&gt;min_gain;
@@ -142,7 +142,7 @@
 			value = emuxki_codec_read(&amp;dev-&gt;config, info-&gt;reg);
 			value &amp;= ~mask;
 			value |= ((values[0] == 1.0 ? 1 : 0 ) &lt;&lt; 15 &amp; mask);
-			if(info-&gt;reg == AC97_SURROUND_VOLUME) {
+			if (info-&gt;reg == AC97_SURROUND_VOLUME) {
 				// there is a independent mute for each channel
 				mask = ((1 &lt;&lt; 1) - 1) &lt;&lt; 7;
 				value &amp;= ~mask;
@@ -204,7 +204,7 @@
 	multi-&gt;controls[i].mix_control.flags = B_MULTI_MIX_GROUP;
 	multi-&gt;controls[i].mix_control.master = EMU_MULTI_CONTROL_MASTERID;
 	multi-&gt;controls[i].mix_control.string = string;
-	if(name)
+	if (name)
 		strcpy(multi-&gt;controls[i].mix_control.name, name);
 		
 	return multi-&gt;controls[i].mix_control.id;
@@ -225,8 +225,8 @@
 	control.mix_control.u.gain.max_gain = gpr-&gt;max_gain;
 	control.mix_control.u.gain.granularity = gpr-&gt;granularity;
 		
-	if(gpr-&gt;type &amp; EMU_MIX_GAIN) {
-		if(gpr-&gt;type &amp; EMU_MIX_MUTE) {
+	if (gpr-&gt;type &amp; EMU_MIX_GAIN) {
+		if (gpr-&gt;type &amp; EMU_MIX_MUTE) {
 			control.mix_control.id = EMU_MULTI_CONTROL_FIRSTID + i;
 			control.mix_control.flags = B_MULTI_MIX_ENABLE;
 			control.mix_control.string = S_MUTE;
@@ -243,7 +243,7 @@
 		id = control.mix_control.id;
 		i++;
 					
-		if(gpr-&gt;type &amp; EMU_MIX_STEREO) {			
+		if (gpr-&gt;type &amp; EMU_MIX_STEREO) {			
 			control.mix_control.id = EMU_MULTI_CONTROL_FIRSTID + i;
 			control.mix_control.master = id;
 			multi-&gt;controls[i] = control;
@@ -262,28 +262,28 @@
 			
 	parent = emuxki_create_group_control(multi, &amp;index, 0, 0, &quot;Playback&quot;);
 		
-	for(i=EMU_GPR_FIRST_MIX; i&lt;card-&gt;gpr_count; i++) {
+	for (i=EMU_GPR_FIRST_MIX; i&lt;card-&gt;gpr_count; i++) {
 		const emuxki_gpr *gpr = &amp;card-&gt;gpr[i];
-		if((gpr-&gt;type &amp; EMU_MIX_PLAYBACK) == 0)
+		if ((gpr-&gt;type &amp; EMU_MIX_PLAYBACK) == 0)
 			continue;
 		
 		parent2 = emuxki_create_group_control(multi, &amp;index, parent, 0, gpr-&gt;name);
 				
 		emuxki_create_gpr_control(multi, &amp;index, parent2, 0, gpr);
-		if(gpr-&gt;type &amp; EMU_MIX_GAIN &amp;&amp; gpr-&gt;type &amp; EMU_MIX_STEREO)
+		if (gpr-&gt;type &amp; EMU_MIX_GAIN &amp;&amp; gpr-&gt;type &amp; EMU_MIX_STEREO)
 			i++;
 	}
 	
 	parent = emuxki_create_group_control(multi, &amp;index, 0, 0, &quot;Record&quot;);
 		
-	for(i=EMU_GPR_FIRST_MIX; i&lt;card-&gt;gpr_count; i++) {
+	for (i=EMU_GPR_FIRST_MIX; i&lt;card-&gt;gpr_count; i++) {
 		const emuxki_gpr *gpr = &amp;card-&gt;gpr[i];
-		if((gpr-&gt;type &amp; EMU_MIX_RECORD) == 0)
+		if ((gpr-&gt;type &amp; EMU_MIX_RECORD) == 0)
 			continue;
 		parent2 = emuxki_create_group_control(multi, &amp;index, parent, 0, gpr-&gt;name);
 		
 		emuxki_create_gpr_control(multi, &amp;index, parent2, 0, gpr);
-		if(gpr-&gt;type &amp; EMU_MIX_GAIN &amp;&amp; gpr-&gt;type &amp; EMU_MIX_STEREO)
+		if (gpr-&gt;type &amp; EMU_MIX_GAIN &amp;&amp; gpr-&gt;type &amp; EMU_MIX_STEREO)
 			i++;
 	}
 	
@@ -293,8 +293,8 @@
 	
 	parent2 = emuxki_create_group_control(multi, &amp;index, parent, 0, info-&gt;name);
 		
-	if(info-&gt;type &amp; B_MIX_GAIN) {
-		if(info-&gt;type &amp; B_MIX_MUTE) {
+	if (info-&gt;type &amp; B_MIX_GAIN) {
+		if (info-&gt;type &amp; B_MIX_MUTE) {
 			multi-&gt;controls[index].mix_control.id = EMU_MULTI_CONTROL_FIRSTID + index;
 			multi-&gt;controls[index].mix_control.flags = B_MULTI_MIX_ENABLE;
 			multi-&gt;controls[index].mix_control.master = EMU_MULTI_CONTROL_MASTERID;
@@ -322,7 +322,7 @@
 		id = multi-&gt;controls[index].mix_control.id;
 		index++;
 		
-		if(info-&gt;type &amp; B_MIX_STEREO) {
+		if (info-&gt;type &amp; B_MIX_STEREO) {
 			multi-&gt;controls[index].mix_control.id = EMU_MULTI_CONTROL_FIRSTID + index;
 			multi-&gt;controls[index].mix_control.flags = B_MULTI_MIX_GAIN;
 			multi-&gt;controls[index].mix_control.master = id;
@@ -338,7 +338,7 @@
 			index++;
 		}
 	
-		if(info-&gt;type &amp; B_MIX_RECORDMUX) {
+		if (info-&gt;type &amp; B_MIX_RECORDMUX) {
 			multi-&gt;controls[index].mix_control.id = EMU_MULTI_CONTROL_FIRSTID + index;
 			multi-&gt;controls[index].mix_control.flags = B_MULTI_MIX_MUX;
 			multi-&gt;controls[index].mix_control.parent = parent2;
@@ -396,19 +396,19 @@
 	parent = emuxki_create_group_control(multi, &amp;index, 0, 0, &quot;AC97 Mixer&quot;);
 	
 	count = source_info_size;
-	if(IS_AUDIGY2(&amp;card-&gt;config))
+	if (IS_AUDIGY2(&amp;card-&gt;config))
 		count = 1;
-	if(!IS_LIVE_5_1(&amp;card-&gt;config) &amp;&amp; !IS_AUDIGY(&amp;card-&gt;config))
+	if (!IS_LIVE_5_1(&amp;card-&gt;config) &amp;&amp; !IS_AUDIGY(&amp;card-&gt;config))
 		count--;
 		
-	for(i=1; i &lt; count ; i++) {
+	for (i=1; i &lt; count ; i++) {
 		info = &amp;source_info[i];
 		PRINT((&quot;name : %s\n&quot;, info-&gt;name));
 			
 		parent2 = emuxki_create_group_control(multi, &amp;index, parent, 0, info-&gt;name);
 				
-		if(info-&gt;type &amp; B_MIX_GAIN) {
-			if(info-&gt;type &amp; B_MIX_MUTE) {
+		if (info-&gt;type &amp; B_MIX_GAIN) {
+			if (info-&gt;type &amp; B_MIX_MUTE) {
 				multi-&gt;controls[index].mix_control.id = EMU_MULTI_CONTROL_FIRSTID + index;
 				multi-&gt;controls[index].mix_control.flags = B_MULTI_MIX_ENABLE;
 				multi-&gt;controls[index].mix_control.master = EMU_MULTI_CONTROL_MASTERID;
@@ -436,7 +436,7 @@

[... truncated: 318 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005360.html">[Haiku-commits] r23398 - haiku/trunk/src/servers/app
</A></li>
	<LI>Next message: <A HREF="005364.html">[Haiku-commits] r23400 - in haiku/trunk/src/apps: . login
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5361">[ date ]</a>
              <a href="thread.html#5361">[ thread ]</a>
              <a href="subject.html#5361">[ subject ]</a>
              <a href="author.html#5361">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
