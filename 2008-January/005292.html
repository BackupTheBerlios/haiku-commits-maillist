<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r23332 -	haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-January/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r23332%20-%0A%09haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid&In-Reply-To=%3C200801092200.m09M0p3C026284%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005291.html">
   <LINK REL="Next"  HREF="005293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r23332 -	haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid</H1>
    <B>mmlr at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r23332%20-%0A%09haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid&In-Reply-To=%3C200801092200.m09M0p3C026284%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r23332 -	haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid">mmlr at mail.berlios.de
       </A><BR>
    <I>Wed Jan  9 23:00:51 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="005291.html">[Haiku-commits] r23331 -	haiku/trunk/src/add-ons/kernel/bus_managers/ata
</A></li>
        <LI>Next message: <A HREF="005293.html">[Haiku-commits] r23333 -	haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5292">[ date ]</a>
              <a href="thread.html#5292">[ thread ]</a>
              <a href="subject.html#5292">[ subject ]</a>
              <a href="author.html#5292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mmlr
Date: 2008-01-09 23:00:51 +0100 (Wed, 09 Jan 2008)
New Revision: 23332
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=23332&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=23332&amp;view=rev</A>

Modified:
   haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid/hid.c
Log:
Clean out some of the spurious whitespace.

Modified: haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid/hid.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid/hid.c	2008-01-09 21:58:23 UTC (rev 23331)
+++ haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid/hid.c	2008-01-09 22:00:51 UTC (rev 23332)
@@ -64,18 +64,18 @@
 	0x50,	// B
 	0x4e,	// C
 	0x3e,	// D
-	0x29, 	// E
-	0x3f, 	// F
-	0x40, 	// G
-	0x41, 	// H
-	0x2e, 	// I
+	0x29,	// E
+	0x3f,	// F
+	0x40,	// G
+	0x41,	// H
+	0x2e,	// I
 	0x42,	// J
-	0x43, 	// K
-	0x44, 	// L
+	0x43,	// K
+	0x44,	// L
 	0x52,	// M
-	0x51, 	// N
-	0x2f, 	// O
-	0x30, 	// P
+	0x51,	// N
+	0x2f,	// O
+	0x30,	// P
 	0x27,	// Q
 	0x2a,	// R
 	0x3d,	// S
@@ -85,12 +85,12 @@
 	0x28,	// W
 	0x4d,	// X
 	0x2c,	// Y
-	0x4c, 	// Z
-	0x12, 	// 1
+	0x4c,	// Z
+	0x12,	// 1
 	0x13,	// 2
 	0x14,	// 3
 	0x15,	// 4
-	0x16, 	// 5
+	0x16,	// 5
 	0x17,	// 6
 	0x18,	// 7
 	0x19,	// 8
@@ -105,8 +105,8 @@
 	0x1d,	// =
 	0x31,	// [
 	0x32,	// ]
-	0x00, 	// unmapped
-	0x33,	// \ 
+	0x00,	// unmapped
+	0x33,	// \
 	0x45,	// ;
 	0x46,	// '
 	0x11,	// `
@@ -128,7 +128,7 @@
 	0x0d,	// F12
 	0x0e,	// PrintScreen
 	KEY_Scroll,	// Scroll Lock
-	KEY_Pause, 	// Pause (0x7f with Ctrl)
+	KEY_Pause,	// Pause (0x7f with Ctrl)
 	0x1f,	// Insert
 	0x20,	// Home
 	0x21,	// Page up
@@ -146,7 +146,7 @@
 	0x3a,	// Pad +
 	0x5b,	// Pad Enter
 	0x58,	// Pad 1
-	0x59, 	// Pad 2
+	0x59,	// Pad 2
 	0x5a,	// Pad 3
 	0x48,	// Pad 4
 	0x49,	// Pad 5
@@ -156,7 +156,7 @@
 	0x39,	// Pad 9
 	0x64,	// Pad 0
 	0x65,	// Pad .
-	0x69, 	// &lt;
+	0x69,	// &lt;
 	KEY_Menu,	// Menu
 	KEY_Power,	// Power
 	KEY_NumEqual,	// Pad =
@@ -172,30 +172,30 @@
 	0x00,	// F22 unmapped
 	0x00,	// F23 unmapped
 	0x00,	// F24 unmapped
-	0x00, 	// Execute unmapped
-	0x00, 	// Help unmapped
-	0x00, 	// Menu unmapped
-	0x00, 	// Select unmapped
-	0x00, 	// Stop unmapped
-	0x00, 	// Again unmapped
-	0x00, 	// Undo unmapped
-	0x00, 	// Cut unmapped
-	0x00, 	// Copy unmapped
-	0x00, 	// Paste unmapped
-	0x00, 	// Find unmapped
-	0x00, 	// Mute unmapped
-	0x00, 	// Volume up unmapped
-	0x00, 	// Volume down unmapped
-	0x00, 	// CapsLock unmapped
-	0x00, 	// NumLock unmapped
-	0x00, 	// Scroll lock unmapped
-	0x70,   // Keypad . on Brazilian ABNT2
-	0x00, 	// = sign
-	0x6b,   // Ro (\\ key, japanese)
-	0x6e,   // Katakana/Hiragana, second key right to spacebar, japanese
-	0x6a,   // Yen (macron key, japanese)
-	0x6d,   // Henkan, first key right to spacebar, japanese
-	0x6c,   // Muhenkan, key left to spacebar, japanese
+	0x00,	// Execute unmapped
+	0x00,	// Help unmapped
+	0x00,	// Menu unmapped
+	0x00,	// Select unmapped
+	0x00,	// Stop unmapped
+	0x00,	// Again unmapped
+	0x00,	// Undo unmapped
+	0x00,	// Cut unmapped
+	0x00,	// Copy unmapped
+	0x00,	// Paste unmapped
+	0x00,	// Find unmapped
+	0x00,	// Mute unmapped
+	0x00,	// Volume up unmapped
+	0x00,	// Volume down unmapped
+	0x00,	// CapsLock unmapped
+	0x00,	// NumLock unmapped
+	0x00,	// Scroll lock unmapped
+	0x70,	// Keypad . on Brazilian ABNT2
+	0x00,	// = sign
+	0x6b,	// Ro (\\ key, japanese)
+	0x6e,	// Katakana/Hiragana, second key right to spacebar, japanese
+	0x6a,	// Yen (macron key, japanese)
+	0x6d,	// Henkan, first key right to spacebar, japanese
+	0x6c,	// Muhenkan, key left to spacebar, japanese
 	0x00,	// unmapped
 	0x00,	// unmapped
 	0x00,	// unmapped
@@ -291,17 +291,17 @@
 	sem_id sem;
 	char area_name[32];
 	const char *base_name;
-	
+
 	assert (usb != NULL &amp;&amp; dev != NULL);
 
-	if (isKeyboard) {	
+	if (isKeyboard) {
 		number = sKeyboardDeviceNumber++;
 		base_name = sKeyboardBaseName;
 	} else {
 		number = sMouseDeviceNumber++;
 		base_name = sMouseBaseName;
 	}
-	
+
 	device = malloc(sizeof(hid_device_info));
 	if (device == NULL)
 		return NULL;
@@ -487,23 +487,23 @@
 	uint8 leds = 0;
 	int report_id = 0;
 	if (data[0] == 1)
-		leds |= (1 &lt;&lt; 0); 
+		leds |= (1 &lt;&lt; 0);
 	if (data[1] == 1)
-		leds |= (1 &lt;&lt; 1); 
+		leds |= (1 &lt;&lt; 1);
 	if (data[2] == 1)
 		leds |= (1 &lt;&lt; 2);
-	
-	status = usb-&gt;send_request (device-&gt;dev, 
+
+	status = usb-&gt;send_request (device-&gt;dev,
 		USB_REQTYPE_INTERFACE_OUT | USB_REQTYPE_CLASS,
 		USB_REQUEST_HID_SET_REPORT,
-		0x200 | report_id, device-&gt;ifno, actual, 
+		0x200 | report_id, device-&gt;ifno, actual,
 		&amp;leds, actual, &amp;actual);
-	DPRINTF_INFO ((MY_ID &quot;set_leds: leds=0x%02x, status=%d, len=%d\n&quot;, 
+	DPRINTF_INFO ((MY_ID &quot;set_leds: leds=0x%02x, status=%d, len=%d\n&quot;,
 		leds, (int) status, (int)actual));
 }
 
 
-static int 
+static int
 sign_extend(int value, int size)
 {
 	if (value &amp; (1 &lt;&lt; (size - 1)))
@@ -523,9 +523,9 @@
 	memset(&amp;info, 0, sizeof(info));
 	for (i = 0; i &lt; device-&gt;num_insns; i++) {
 		const report_insn *insn = &amp;device-&gt;insns [i];
-		int32 value = 
-			(((report [insn-&gt;byte_idx + 1] &lt;&lt; 8) | 
-			   report [insn-&gt;byte_idx]) &gt;&gt; insn-&gt;bit_pos) 
+		int32 value =
+			(((report [insn-&gt;byte_idx + 1] &lt;&lt; 8) |
+				report [insn-&gt;byte_idx]) &gt;&gt; insn-&gt;bit_pos)
 			&amp; ((1 &lt;&lt; insn-&gt;num_bits) - 1);
 
 		if (insn-&gt;usage_page == USAGE_PAGE_BUTTON) {
@@ -574,7 +574,7 @@
 /*!
 	callback: got a report, issue next request
 */
-static void 
+static void
 usb_callback(void *cookie, status_t busStatus,
 	void *data, size_t actualLength)
 {
@@ -630,7 +630,7 @@
 		DPRINTF_INFO ((MY_ID &quot;input report: %s\n&quot;, linbuf));
 #endif
 		device-&gt;timestamp = system_time();
-		
+
 		if (device-&gt;is_keyboard) {
 			interpret_kb_buffer(device);
 			memcpy(device-&gt;last_buffer, device-&gt;buffer, device-&gt;total_report_size);
@@ -690,7 +690,7 @@
 		protocol = intf-&gt;descr-&gt;interface_protocol;
 		DPRINTF_INFO ((MY_ID &quot;interface %d: class %d, subclass %d, protocol %d\n&quot;,
 			ifno, class, subclass, protocol));
-		if (class == USB_HID_DEVICE_CLASS 
+		if (class == USB_HID_DEVICE_CLASS
 			&amp;&amp; subclass == USB_HID_INTERFACE_BOOT_SUBCLASS)
 			break;
 	}
@@ -704,12 +704,12 @@
 
 	desc_len = sizeof (usb_hid_descriptor);
 	hid_desc = malloc (desc_len);
-	status = usb-&gt;send_request(dev, 
+	status = usb-&gt;send_request(dev,
 		USB_REQTYPE_INTERFACE_IN | USB_REQTYPE_STANDARD,
 		USB_REQUEST_GET_DESCRIPTOR,
-		USB_HID_DESCRIPTOR_HID &lt;&lt; 8, ifno, desc_len, 
+		USB_HID_DESCRIPTOR_HID &lt;&lt; 8, ifno, desc_len,
 		hid_desc, desc_len, &amp;desc_len);
-	DPRINTF_INFO ((MY_ID &quot;get_hid_desc: status=%d, len=%d\n&quot;, 
+	DPRINTF_INFO ((MY_ID &quot;get_hid_desc: status=%d, len=%d\n&quot;,
 		(int) status, (int)desc_len));
 	if (status != B_OK)
 		desc_len = 256;		/* XXX */
@@ -726,9 +726,9 @@
 	status = usb-&gt;send_request(dev,
 		USB_REQTYPE_INTERFACE_IN | USB_REQTYPE_STANDARD,
 		USB_REQUEST_GET_DESCRIPTOR,
-		USB_HID_DESCRIPTOR_REPORT &lt;&lt; 8, ifno, desc_len, 
+		USB_HID_DESCRIPTOR_REPORT &lt;&lt; 8, ifno, desc_len,
 		rep_desc, desc_len, &amp;desc_len);
-	DPRINTF_INFO((MY_ID &quot;get_hid_rep_desc: status=%d, len=%d\n&quot;, 
+	DPRINTF_INFO((MY_ID &quot;get_hid_rep_desc: status=%d, len=%d\n&quot;,
 		(int) status, (int)desc_len));
 	if (status != B_OK) {
 		free(rep_desc);
@@ -744,9 +744,9 @@
 	}
 
 	/* Generic Desktop : Keyboard or Mouse */
-	
+
 	if (memcmp(rep_desc, &quot;\x05\x01\x09\x06&quot;, 4) != 0 &amp;&amp;
-	    memcmp(rep_desc, &quot;\x05\x01\x09\x02&quot;, 4) != 0) {
+		memcmp(rep_desc, &quot;\x05\x01\x09\x02&quot;, 4) != 0) {
 		DPRINTF_INFO((MY_ID &quot;not a keyboard or a mouse %08lx\n&quot;, *(uint32*)rep_desc));
 		free(rep_desc);
 		return B_ERROR;
@@ -790,7 +790,7 @@
 		return B_NO_MEMORY;
 	}
 
-	parse_report_descriptor (items, num_items, device-&gt;insns, 
+	parse_report_descriptor (items, num_items, device-&gt;insns,
 		&amp;device-&gt;num_insns, &amp;device-&gt;total_report_size, &amp;report_id);
 	free(items);
 
@@ -801,7 +801,7 @@
 		return B_NO_MEMORY;
 	}
 
-	DPRINTF_INFO ((MY_ID &quot;%d items, %d insns, %d bytes\n&quot;, 
+	DPRINTF_INFO ((MY_ID &quot;%d items, %d insns, %d bytes\n&quot;,
 		(int)num_items, (int)device-&gt;num_insns, (int)device-&gt;total_report_size));
 
 	/* count axes, hats and buttons */
@@ -847,7 +847,7 @@
 	assert (cookie != NULL);
 
 	DPRINTF_INFO((MY_ID &quot;device_removed(%s)\n&quot;, device-&gt;name));
-	
+
 	usb-&gt;cancel_queued_transfers (device-&gt;ept-&gt;handle);
 	remove_device_info(device);
 
@@ -864,7 +864,7 @@
 }
 
 
-static status_t 
+static status_t
 hid_device_open(const char *name, uint32 flags,
 	driver_cookie **out_cookie)
 {
@@ -893,7 +893,7 @@
 }
 
 
-static status_t 
+static status_t
 hid_device_read(driver_cookie *cookie, off_t position,
 	void *buf,	size_t *num_bytes)
 {
@@ -901,7 +901,7 @@
 }
 
 
-static status_t 
+static status_t
 hid_device_write(driver_cookie *cookie, off_t position,
 	const void *buf, size_t *num_bytes)
 {
@@ -909,7 +909,7 @@
 }
 
 
-static status_t 
+static status_t
 hid_device_control(driver_cookie *cookie, uint32 op,
 		void *arg, size_t len)
 {
@@ -938,25 +938,25 @@
 						// call_back function
 					}
 
-		    		err = acquire_sem_etc(device-&gt;sem_cb, 1,
-		    			B_CAN_INTERRUPT | B_RELATIVE_TIMEOUT,
-		    			device-&gt;repeat_timer.current_delay);
-		    		if (err == B_TIMED_OUT) {
-		    			// this case is for handling key repeats, it means
-		    			// no interrupt transfer has happened
-		    			write_key(device, device-&gt;repeat_timer.key, true);
-		    			// the next timeout is reduced to the repeat_rate
-		    			device-&gt;repeat_timer.current_delay = device-&gt;repeat_rate;
-		    		} else if (err == B_OK) {
-		    			// this case is for when an actual interrupt transfer
-		    			// happened, it is the only possible reason to be here
+					err = acquire_sem_etc(device-&gt;sem_cb, 1,
+						B_CAN_INTERRUPT | B_RELATIVE_TIMEOUT,
+						device-&gt;repeat_timer.current_delay);
+					if (err == B_TIMED_OUT) {
+						// this case is for handling key repeats, it means
+						// no interrupt transfer has happened
+						write_key(device, device-&gt;repeat_timer.key, true);
+						// the next timeout is reduced to the repeat_rate
+						device-&gt;repeat_timer.current_delay = device-&gt;repeat_rate;
+					} else if (err == B_OK) {
+						// this case is for when an actual interrupt transfer
+						// happened, it is the only possible reason to be here
 						device-&gt;transfer_scheduled = false;
 						err = handle_interrupt_transfer(device);
 						if (err != B_OK)
 							return err;
-		    		} else {
+					} else {
 						return err;
-		    		}
+					}
 				}
 
 				// process what is in the ring_buffer, it could be written
@@ -964,11 +964,11 @@
 				// we wrote the current repeat key
 				ring_buffer_user_read(device-&gt;rbuf, arg, sizeof(raw_key_info));
 				return B_OK;
-	    
+
 			case KB_SET_LEDS:
 				set_leds(device, (uint8 *)arg);
-				break; 
-		} 
+				break;
+		}
 	} else {
 		switch (op) {
 			case MS_READ:
@@ -979,11 +979,11 @@
 					// NOTE: this thread is now blocking until
 					// the semaphore will be released from the
 					// call_back function
-	
+
 					err = acquire_sem_etc(device-&gt;sem_cb, 1, B_CAN_INTERRUPT, 0LL);
-		    		if (err != B_OK)
+					if (err != B_OK)
 						return err;
-	
+
 					err = handle_interrupt_transfer(device);
 					if (err != B_OK)
 						return err;
@@ -992,9 +992,9 @@
 				ring_buffer_user_read(device-&gt;rbuf, arg, sizeof(mouse_movement));
 				return B_OK;
 
-	    	case MS_NUM_EVENTS:
-        		return (int32)(ring_buffer_readable(device-&gt;rbuf)
-        			/ sizeof(mouse_movement));
+			case MS_NUM_EVENTS:
+				return (int32)(ring_buffer_readable(device-&gt;rbuf)
+					/ sizeof(mouse_movement));
 
 			case MS_SET_CLICKSPEED:
 #ifdef __HAIKU__
@@ -1014,7 +1014,7 @@
 }
 
 
-static status_t 
+static status_t
 hid_device_close(driver_cookie *cookie)
 {
 	hid_device_info *device;
@@ -1044,7 +1044,7 @@
 }
 
 
-static status_t 
+static status_t
 hid_device_free(driver_cookie *cookie)
 {
 	hid_device_info *device;
@@ -1070,7 +1070,7 @@
 //	#pragma mark - driver API
 
 
-status_t 
+status_t
 init_hardware(void)
 {
 	DPRINTF_INFO((MY_ID &quot;init_hardware() &quot; __DATE__ &quot; &quot; __TIME__ &quot;\n&quot;));
@@ -1078,7 +1078,7 @@
 }
 
 
-status_t 
+status_t
 init_driver(void)
 {
 	DPRINTF_INFO((MY_ID &quot;init_driver() &quot; __DATE__ &quot; &quot; __TIME__ &quot;\n&quot;));
@@ -1092,7 +1092,7 @@
 		return gDeviceListLock;
 	}
 
-	usb-&gt;register_driver(kDriverName, sSupportedDevices, 
+	usb-&gt;register_driver(kDriverName, sSupportedDevices,
 		SUPPORTED_DEVICES, NULL);
 	usb-&gt;install_notify(kDriverName, &amp;sNotifyHooks);
 	DPRINTF_INFO((MY_ID &quot;init_driver() OK\n&quot;));


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005291.html">[Haiku-commits] r23331 -	haiku/trunk/src/add-ons/kernel/bus_managers/ata
</A></li>
	<LI>Next message: <A HREF="005293.html">[Haiku-commits] r23333 -	haiku/trunk/src/add-ons/kernel/drivers/input/usb_hid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5292">[ date ]</a>
              <a href="thread.html#5292">[ thread ]</a>
              <a href="subject.html#5292">[ subject ]</a>
              <a href="author.html#5292">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
