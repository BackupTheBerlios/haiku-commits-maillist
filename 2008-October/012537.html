<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r27947 - in haiku/trunk/src/system: boot	boot/arch/m68k boot/arch/ppc boot/arch/x86 kernel/arch/x86	kernel/lib kernel/lib/arch kernel/lib/arch/generic	kernel/lib/arch/m68k kernel/lib/arch/ppc kernel/lib/arch/x86	libroot/posix/string libroot/posix/string/arch	libroot/posix/string/arch/generic	libroot/posix/string/arch/m68k libroot/posix/string/arch/ppc	libroot/posix/string/arch/x86 runtime_loader	runtime_loader/arch/m68k runtime_loader/arch/ppc	runtime_loader/arch/x86
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r27947%20-%20in%20haiku/trunk/src/system%3A%20boot%0A%09boot/arch/m68k%20boot/arch/ppc%20boot/arch/x86%20kernel/arch/x86%0A%09kernel/lib%20kernel/lib/arch%20kernel/lib/arch/generic%0A%09kernel/lib/arch/m68k%20kernel/lib/arch/ppc%20kernel/lib/arch/x86%0A%09libroot/posix/string%20libroot/posix/string/arch%0A%09libroot/posix/string/arch/generic%0A%09libroot/posix/string/arch/m68k%20libroot/posix/string/arch/ppc%0A%09libroot/posix/string/arch/x86%20runtime_loader%0A%09runtime_loader/arch/m68k%20runtime_loader/arch/ppc%0A%09runtime_loader/arch/x86&In-Reply-To=%3C200810092347.m99Nl2Lb017594%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012529.html">
   <LINK REL="Next"  HREF="012538.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r27947 - in haiku/trunk/src/system: boot	boot/arch/m68k boot/arch/ppc boot/arch/x86 kernel/arch/x86	kernel/lib kernel/lib/arch kernel/lib/arch/generic	kernel/lib/arch/m68k kernel/lib/arch/ppc kernel/lib/arch/x86	libroot/posix/string libroot/posix/string/arch	libroot/posix/string/arch/generic	libroot/posix/string/arch/m68k libroot/posix/string/arch/ppc	libroot/posix/string/arch/x86 runtime_loader	runtime_loader/arch/m68k runtime_loader/arch/ppc	runtime_loader/arch/x86</H1>
    <B>bonefish at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r27947%20-%20in%20haiku/trunk/src/system%3A%20boot%0A%09boot/arch/m68k%20boot/arch/ppc%20boot/arch/x86%20kernel/arch/x86%0A%09kernel/lib%20kernel/lib/arch%20kernel/lib/arch/generic%0A%09kernel/lib/arch/m68k%20kernel/lib/arch/ppc%20kernel/lib/arch/x86%0A%09libroot/posix/string%20libroot/posix/string/arch%0A%09libroot/posix/string/arch/generic%0A%09libroot/posix/string/arch/m68k%20libroot/posix/string/arch/ppc%0A%09libroot/posix/string/arch/x86%20runtime_loader%0A%09runtime_loader/arch/m68k%20runtime_loader/arch/ppc%0A%09runtime_loader/arch/x86&In-Reply-To=%3C200810092347.m99Nl2Lb017594%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r27947 - in haiku/trunk/src/system: boot	boot/arch/m68k boot/arch/ppc boot/arch/x86 kernel/arch/x86	kernel/lib kernel/lib/arch kernel/lib/arch/generic	kernel/lib/arch/m68k kernel/lib/arch/ppc kernel/lib/arch/x86	libroot/posix/string libroot/posix/string/arch	libroot/posix/string/arch/generic	libroot/posix/string/arch/m68k libroot/posix/string/arch/ppc	libroot/posix/string/arch/x86 runtime_loader	runtime_loader/arch/m68k runtime_loader/arch/ppc	runtime_loader/arch/x86">bonefish at mail.berlios.de
       </A><BR>
    <I>Fri Oct 10 01:47:02 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="012529.html">[Haiku-commits] r27946 -	haiku/trunk/src/system/libroot/posix/glibc/ctype
</A></li>
        <LI>Next message: <A HREF="012538.html">[Haiku-commits] r27948 -	haiku/trunk/src/add-ons/media/plugins/wav_reader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12537">[ date ]</a>
              <a href="thread.html#12537">[ thread ]</a>
              <a href="subject.html#12537">[ subject ]</a>
              <a href="author.html#12537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2008-10-10 01:47:01 +0200 (Fri, 10 Oct 2008)
New Revision: 27947
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=27947&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=27947&amp;view=rev</A>

Added:
   haiku/trunk/src/system/kernel/lib/arch/
   haiku/trunk/src/system/kernel/lib/arch/generic/
   haiku/trunk/src/system/kernel/lib/arch/generic/kernel_longjmp_return.c
   haiku/trunk/src/system/kernel/lib/arch/generic/kernel_setjmp_save_sigs.c
   haiku/trunk/src/system/kernel/lib/arch/m68k/
   haiku/trunk/src/system/kernel/lib/arch/m68k/Jamfile
   haiku/trunk/src/system/kernel/lib/arch/ppc/
   haiku/trunk/src/system/kernel/lib/arch/ppc/Jamfile
   haiku/trunk/src/system/kernel/lib/arch/x86/
   haiku/trunk/src/system/kernel/lib/arch/x86/Jamfile
   haiku/trunk/src/system/kernel/lib/arch/x86/arch_string.S
   haiku/trunk/src/system/libroot/posix/string/arch/generic/
   haiku/trunk/src/system/libroot/posix/string/arch/generic/memcpy.c
   haiku/trunk/src/system/libroot/posix/string/arch/m68k/Jamfile
   haiku/trunk/src/system/libroot/posix/string/arch/ppc/Jamfile
   haiku/trunk/src/system/libroot/posix/string/arch/x86/Jamfile
   haiku/trunk/src/system/runtime_loader/arch/m68k/Jamfile
   haiku/trunk/src/system/runtime_loader/arch/ppc/Jamfile
   haiku/trunk/src/system/runtime_loader/arch/x86/Jamfile
Removed:
   haiku/trunk/src/system/kernel/arch/x86/arch_string.S
   haiku/trunk/src/system/kernel/lib/kernel_longjmp_return.c
   haiku/trunk/src/system/kernel/lib/kernel_setjmp_save_sigs.c
   haiku/trunk/src/system/libroot/posix/string/arch/ppc/arch_string.S
   haiku/trunk/src/system/libroot/posix/string/memcpy.c
Modified:
   haiku/trunk/src/system/boot/Jamfile
   haiku/trunk/src/system/boot/arch/m68k/Jamfile
   haiku/trunk/src/system/boot/arch/ppc/Jamfile
   haiku/trunk/src/system/boot/arch/x86/Jamfile
   haiku/trunk/src/system/kernel/arch/x86/Jamfile
   haiku/trunk/src/system/kernel/lib/Jamfile
   haiku/trunk/src/system/libroot/posix/string/Jamfile
   haiku/trunk/src/system/runtime_loader/Jamfile
Log:
* Moved the arch specific stuff in src/system/kernel/lib into arch/...
  subdirectories. Also moved the x86 kernel arch_string.S there.
* Moved memcpy.c from src/system/libroot/posix/string into the
  arch/generic subdirectory.
* Dealt with the consequences of moving things around. Affected are also
  the boot loader and runtime loader builds.

Adjust the m68k and ppc parts, too, but only the x86 build is tested.


Modified: haiku/trunk/src/system/boot/Jamfile
===================================================================
--- haiku/trunk/src/system/boot/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/boot/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -2,13 +2,11 @@
 
 local librootFunctions =
 	abs.o
-	byteorder.o
 	ctype.o
 	qsort.o
 	kernel_vsprintf.o
 	memset.o
 	memcmp.o
-	memcpy.o
 	memmove.o
 	strdup.o
 	strlen.o

Modified: haiku/trunk/src/system/boot/arch/m68k/Jamfile
===================================================================
--- haiku/trunk/src/system/boot/arch/m68k/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/boot/arch/m68k/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -2,15 +2,22 @@
 
 DEFINES += _BOOT_MODE ;
 
+# TODO: Is there any reason to recompile arch_string.S here?
 local librootArchObjects =
 #	&lt;src!system!libroot!posix!string!arch!$(TARGET_ARCH)&gt;arch_string.o
 	arch_string.S
 ;
 
-KernelMergeObject boot_arch_m68k.o :
+local kernelLibArchObjects =
+	&lt;src!system!kernel!lib!arch!$(TARGET_ARCH)&gt;byteorder.o
+;
+
+KernelMergeObject boot_arch_$(TARGET_ARCH).o :
 	arch_elf.cpp
 	$(librootArchObjects)
 	: -fno-pic
+	:
+	$(kernelLibArchObjects)
 ;
 
 SEARCH on [ FGristFiles arch_elf.cpp ]

Modified: haiku/trunk/src/system/boot/arch/ppc/Jamfile
===================================================================
--- haiku/trunk/src/system/boot/arch/ppc/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/boot/arch/ppc/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -2,13 +2,17 @@
 
 DEFINES += _BOOT_MODE ;
 
-#local librootArchObjects =
-#	&lt;src!system!libroot!posix!string!arch!$(TARGET_ARCH)&gt;arch_string.o
-#;
+local kernelLibArchObjects =
+	&lt;src!system!kernel!lib!arch!$(TARGET_ARCH)&gt;byteorder.o
+	&lt;src!system!kernel!lib!arch!$(TARGET_ARCH)&gt;memcpy.o
+;
 
-KernelMergeObject boot_arch_ppc.o :
+KernelMergeObject boot_arch_$(TARGET_ARCH).o :
 	arch_elf.cpp
-#	$(librootArchObjects)
+	: # additional flags
+	:
+	$(kernelArchObjects)
+	$(kernelLibArchObjects)
 ;
 
 SEARCH on [ FGristFiles arch_elf.cpp ]

Modified: haiku/trunk/src/system/boot/arch/x86/Jamfile
===================================================================
--- haiku/trunk/src/system/boot/arch/x86/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/boot/arch/x86/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -4,19 +4,30 @@
 
 local kernelArchSources =
 	arch_elf.c
-	arch_string.S
 ;
 
 local kernelArchObjects =
 	&lt;src!system!kernel!arch!$(TARGET_ARCH)&gt;cpuid.o
 ;
 
-KernelMergeObject boot_arch_x86.o :
+local kernelLibArchSources =
+	arch_string.S
+;
+
+local kernelLibArchObjects =
+	&lt;src!system!kernel!lib!arch!$(TARGET_ARCH)&gt;byteorder.o
+;
+
+KernelMergeObject boot_arch_$(TARGET_ARCH).o :
 	$(kernelArchSources)
+	$(kernelLibArchSources)
 	: # additional flags
 	:
 	$(kernelArchObjects)
+	$(kernelLibArchObjects)
 ;
 
 SEARCH on [ FGristFiles $(kernelArchSources) ]
     = [ FDirName $(HAIKU_TOP) src system kernel arch $(TARGET_ARCH) ] ;
+SEARCH on [ FGristFiles $(kernelLibArchSources) ]
+    = [ FDirName $(HAIKU_TOP) src system kernel lib arch $(TARGET_ARCH) ] ;

Modified: haiku/trunk/src/system/kernel/arch/x86/Jamfile
===================================================================
--- haiku/trunk/src/system/kernel/arch/x86/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/kernel/arch/x86/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -23,7 +23,6 @@
 #	arch_selector.c
 	arch_real_time_clock.c
 	arch_smp.c
-	arch_string.S
 	arch_thread.cpp
 	arch_timer.c
 	arch_vm.cpp
@@ -37,7 +36,7 @@
 	cpuid.S
 	syscall.S
 	vm86.cpp
-	
+
 	x86_pit.c
 	x86_apic.c
 	x86_hpet.c

Deleted: haiku/trunk/src/system/kernel/arch/x86/arch_string.S

Modified: haiku/trunk/src/system/kernel/lib/Jamfile
===================================================================
--- haiku/trunk/src/system/kernel/lib/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/kernel/lib/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -13,7 +13,7 @@
 SEARCH on [ FGristFiles
 	driver_settings.c
 	find_directory.c
-	fs_info.c 
+	fs_info.c
 	wait_for_objects.cpp
 	] = [ FDirName $(HAIKU_TOP) src system libroot os ] ;
 
@@ -85,7 +85,6 @@
 	# string
 	memchr.c
 	memcmp.c
-	memcpy.c
 	memmove.c
 	memset.c
 	strcasecmp.c
@@ -114,32 +113,8 @@
 	: $(TARGET_KERNEL_PIC_CCFLAGS)
 ;
 
-# TODO: Move the following arch specific part into arch/$(TARGET_ARCH) subdirs!
+# misc
 
-SEARCH_SOURCE += [ FDirName $(librootSources) os arch $(TARGET_ARCH) ] ;
-
-KernelMergeObject kernel_os_arch_$(TARGET_ARCH).o :
-	atomic.S
-	byteorder.S
-	system_time_asm.S
-	system_time.c
-
-	: $(TARGET_KERNEL_PIC_CCFLAGS)
-;
-
-SEARCH_SOURCE += [ FDirName $(posixSources) arch $(TARGET_ARCH) ] ;
-SEARCH_SOURCE += [ FDirName $(posixSources) string arch $(TARGET_ARCH) ] ;
-
-KernelMergeObject kernel_lib_posix_arch_$(TARGET_ARCH).o :
-	siglongjmp.S
-	sigsetjmp.S
-	kernel_longjmp_return.c
-	kernel_setjmp_save_sigs.c
-	arch_string.S				# TODO: Not needed for X86!
-
-	: $(TARGET_KERNEL_PIC_CCFLAGS)
-;
-
 UsePrivateHeaders shared ;
 
 SEARCH_SOURCE = [ FDirName $(HAIKU_TOP) src kits support ] ;
@@ -149,3 +124,5 @@
 
 	: $(TARGET_KERNEL_PIC_CCFLAGS)
 ;
+
+HaikuSubInclude arch $(TARGET_ARCH) ;

Copied: haiku/trunk/src/system/kernel/lib/arch/generic/kernel_longjmp_return.c (from rev 27946, haiku/trunk/src/system/kernel/lib/kernel_longjmp_return.c)

Copied: haiku/trunk/src/system/kernel/lib/arch/generic/kernel_setjmp_save_sigs.c (from rev 27946, haiku/trunk/src/system/kernel/lib/kernel_setjmp_save_sigs.c)

Added: haiku/trunk/src/system/kernel/lib/arch/m68k/Jamfile
===================================================================
--- haiku/trunk/src/system/kernel/lib/arch/m68k/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/kernel/lib/arch/m68k/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,32 @@
+SubDir HAIKU_TOP src system kernel lib arch m86k ;
+
+SEARCH_SOURCE += [ FDirName $(SUBDIR) $(DOTDOT) generic ] ;
+
+local librootSources = [ FDirName $(HAIKU_TOP) src system libroot ] ;
+local posixSources = [ FDirName $(librootSources) posix ] ;
+
+SEARCH_SOURCE += [ FDirName $(librootSources) os arch $(TARGET_ARCH) ] ;
+
+KernelMergeObject kernel_os_arch_$(TARGET_ARCH).o :
+	atomic.S
+	byteorder.S
+	system_time_asm.S
+	system_time.c
+
+	: $(TARGET_KERNEL_PIC_CCFLAGS)
+;
+
+SEARCH_SOURCE += [ FDirName $(posixSources) arch $(TARGET_ARCH) ] ;
+SEARCH_SOURCE += [ FDirName $(posixSources) string arch generic ] ;
+SEARCH_SOURCE += [ FDirName $(posixSources) string arch $(TARGET_ARCH) ] ;
+
+KernelMergeObject kernel_lib_posix_arch_$(TARGET_ARCH).o :
+	siglongjmp.S
+	sigsetjmp.S
+	kernel_longjmp_return.c
+	kernel_setjmp_save_sigs.c
+
+	arch_string.S
+
+	: $(TARGET_KERNEL_PIC_CCFLAGS)
+;

Added: haiku/trunk/src/system/kernel/lib/arch/ppc/Jamfile
===================================================================
--- haiku/trunk/src/system/kernel/lib/arch/ppc/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/kernel/lib/arch/ppc/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,31 @@
+SubDir HAIKU_TOP src system kernel lib arch ppc ;
+
+SEARCH_SOURCE += [ FDirName $(SUBDIR) $(DOTDOT) generic ] ;
+
+local librootSources = [ FDirName $(HAIKU_TOP) src system libroot ] ;
+local posixSources = [ FDirName $(librootSources) posix ] ;
+
+SEARCH_SOURCE += [ FDirName $(librootSources) os arch $(TARGET_ARCH) ] ;
+
+KernelMergeObject kernel_os_arch_$(TARGET_ARCH).o :
+	atomic.S
+	byteorder.S
+	system_time_asm.S
+	system_time.c
+
+	: $(TARGET_KERNEL_PIC_CCFLAGS)
+;
+
+SEARCH_SOURCE += [ FDirName $(posixSources) arch $(TARGET_ARCH) ] ;
+SEARCH_SOURCE += [ FDirName $(posixSources) string arch generic ] ;
+
+KernelMergeObject kernel_lib_posix_arch_$(TARGET_ARCH).o :
+	siglongjmp.S
+	sigsetjmp.S
+	kernel_longjmp_return.c
+	kernel_setjmp_save_sigs.c
+
+	memcpy.c
+
+	: $(TARGET_KERNEL_PIC_CCFLAGS)
+;

Added: haiku/trunk/src/system/kernel/lib/arch/x86/Jamfile
===================================================================
--- haiku/trunk/src/system/kernel/lib/arch/x86/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/kernel/lib/arch/x86/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,35 @@
+SubDir HAIKU_TOP src system kernel lib arch x86 ;
+
+# find the generated asm_offsets.h
+SubDirHdrs [ FDirName $(TARGET_COMMON_DEBUG_OBJECT_DIR) system kernel arch
+	$(TARGET_ARCH) ] ;
+
+SEARCH_SOURCE += [ FDirName $(SUBDIR) $(DOTDOT) generic ] ;
+
+local librootSources = [ FDirName $(HAIKU_TOP) src system libroot ] ;
+local posixSources = [ FDirName $(librootSources) posix ] ;
+
+SEARCH_SOURCE += [ FDirName $(librootSources) os arch $(TARGET_ARCH) ] ;
+
+KernelMergeObject kernel_os_arch_$(TARGET_ARCH).o :
+	atomic.S
+	byteorder.S
+	system_time_asm.S
+	system_time.c
+
+	: $(TARGET_KERNEL_PIC_CCFLAGS)
+;
+
+SEARCH_SOURCE += [ FDirName $(posixSources) arch $(TARGET_ARCH) ] ;
+SEARCH_SOURCE += [ FDirName $(posixSources) string arch generic ] ;
+
+KernelMergeObject kernel_lib_posix_arch_$(TARGET_ARCH).o :
+	siglongjmp.S
+	sigsetjmp.S
+	kernel_longjmp_return.c
+	kernel_setjmp_save_sigs.c
+
+	arch_string.S
+
+	: $(TARGET_KERNEL_PIC_CCFLAGS)
+;

Copied: haiku/trunk/src/system/kernel/lib/arch/x86/arch_string.S (from rev 27946, haiku/trunk/src/system/kernel/arch/x86/arch_string.S)

Deleted: haiku/trunk/src/system/kernel/lib/kernel_longjmp_return.c

Deleted: haiku/trunk/src/system/kernel/lib/kernel_setjmp_save_sigs.c

Modified: haiku/trunk/src/system/libroot/posix/string/Jamfile
===================================================================
--- haiku/trunk/src/system/libroot/posix/string/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/libroot/posix/string/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -8,7 +8,6 @@
 	memccpy.c
 	memchr.c
 	memcmp.c
-	memcpy.c
 	memmove.c
 	memset.c
 	stpcpy.c
@@ -39,11 +38,4 @@
 	strxfrm.c
 ;
 
-SubDir HAIKU_TOP src system libroot posix string arch $(TARGET_ARCH) ;
-
-UsePrivateSystemHeaders ;
-
-MergeObject posix_string_arch_$(TARGET_ARCH).o :
-	arch_string.S
-;
-
+HaikuSubInclude arch $(TARGET_ARCH) ;

Copied: haiku/trunk/src/system/libroot/posix/string/arch/generic/memcpy.c (from rev 27946, haiku/trunk/src/system/libroot/posix/string/memcpy.c)

Added: haiku/trunk/src/system/libroot/posix/string/arch/m68k/Jamfile
===================================================================
--- haiku/trunk/src/system/libroot/posix/string/arch/m68k/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/libroot/posix/string/arch/m68k/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,7 @@
+SubDir HAIKU_TOP src system libroot posix string arch m68k ;
+
+UsePrivateSystemHeaders ;
+
+MergeObject posix_string_arch_$(TARGET_ARCH).o :
+	arch_string.S
+;

Added: haiku/trunk/src/system/libroot/posix/string/arch/ppc/Jamfile
===================================================================
--- haiku/trunk/src/system/libroot/posix/string/arch/ppc/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/libroot/posix/string/arch/ppc/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,9 @@
+SubDir HAIKU_TOP src system libroot posix string arch ppc ;
+
+UsePrivateSystemHeaders ;
+
+SEARCH_SOURCE += [ FDirName $(SUBDIR) $(DOTDOT) generic ] ;
+
+MergeObject posix_string_arch_$(TARGET_ARCH).o :
+	memcpy.c
+;

Deleted: haiku/trunk/src/system/libroot/posix/string/arch/ppc/arch_string.S

Added: haiku/trunk/src/system/libroot/posix/string/arch/x86/Jamfile
===================================================================
--- haiku/trunk/src/system/libroot/posix/string/arch/x86/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/libroot/posix/string/arch/x86/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,8 @@
+SubDir HAIKU_TOP src system libroot posix string arch x86 ;
+
+UsePrivateSystemHeaders ;
+
+MergeObject posix_string_arch_$(TARGET_ARCH).o :
+	arch_string.S
+;
+

Deleted: haiku/trunk/src/system/libroot/posix/string/memcpy.c

Modified: haiku/trunk/src/system/runtime_loader/Jamfile
===================================================================
--- haiku/trunk/src/system/runtime_loader/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/runtime_loader/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -25,8 +25,6 @@
 	:
 	&lt;src!system!libroot!os&gt;syscalls.o
 	&lt;src!system!libroot!os&gt;sem.o
-	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;atomic.o
-	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;thread.o
 
 	&lt;src!system!libroot!posix&gt;errno.o
 
@@ -37,7 +35,6 @@
 
 	&lt;src!system!libroot!posix!string&gt;memchr.o
 	&lt;src!system!libroot!posix!string&gt;memcmp.o
-	&lt;src!system!libroot!posix!string&gt;memcpy.o
 	&lt;src!system!libroot!posix!string&gt;memmove.o
 	&lt;src!system!libroot!posix!string&gt;memset.o
 	&lt;src!system!libroot!posix!string&gt;strcasecmp.o
@@ -57,7 +54,6 @@
 	&lt;src!system!libroot!posix!string&gt;strrchr.o
 	&lt;src!system!libroot!posix!string&gt;strspn.o
 	&lt;src!system!libroot!posix!string&gt;strstr.o
-	&lt;src!system!libroot!posix!string!arch!$(TARGET_ARCH)&gt;arch_string.o
 
 	[ FGristFiles kernel_vsprintf.o ]
 ;
@@ -69,20 +65,20 @@
 SEARCH on [ FGristFiles KMessage.cpp ]
 	= [ FDirName $(HAIKU_TOP) src system kernel messaging ] ;
 
-SEARCH_SOURCE += [ FDirName $(SUBDIR) arch $(TARGET_ARCH) ] ;
-
 Objects
 	runtime_loader.c
 	elf.cpp
 	export.c
 	heap.cpp
 	utility.cpp
-	arch_relocate.c
 ;
 
 Ld runtime_loader :
-	[ FGristFiles runtime_loader.o elf.o export.o heap.o utility.o arch_relocate.o ]
+	[ FGristFiles runtime_loader.o elf.o export.o heap.o utility.o ]
 	libruntime_loader.a
+	libruntime_loader_$(TARGET_ARCH).a
 	$(TARGET_GCC_LIBGCC)
 	: $(HAIKU_TOP)/src/system/ldscripts/$(TARGET_ARCH)/runtime_loader.ld
 ;
+
+HaikuSubInclude arch $(TARGET_ARCH) ;

Added: haiku/trunk/src/system/runtime_loader/arch/m68k/Jamfile
===================================================================
--- haiku/trunk/src/system/runtime_loader/arch/m68k/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/runtime_loader/arch/m68k/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,15 @@
+SubDir HAIKU_TOP src system runtime_loader arch m68k ;
+
+UsePrivateHeaders runtime_loader ;
+UsePrivateSystemHeaders ;
+
+SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) ] ;
+
+StaticLibrary libruntime_loader_$(TARGET_ARCH).a :
+	arch_relocate.c
+	:
+	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;atomic.o
+	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;thread.o
+
+	&lt;src!system!libroot!posix!string!arch!$(TARGET_ARCH)&gt;arch_string.o
+;

Added: haiku/trunk/src/system/runtime_loader/arch/ppc/Jamfile
===================================================================
--- haiku/trunk/src/system/runtime_loader/arch/ppc/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/runtime_loader/arch/ppc/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,15 @@
+SubDir HAIKU_TOP src system runtime_loader arch ppc ;
+
+UsePrivateHeaders runtime_loader ;
+UsePrivateSystemHeaders ;
+
+SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) ] ;
+
+StaticLibrary libruntime_loader_$(TARGET_ARCH).a :
+	arch_relocate.c
+	:
+	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;atomic.o
+	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;thread.o
+
+	&lt;src!system!libroot!posix!string!arch!$(TARGET_ARCH)&gt;memcpy.o
+;

Added: haiku/trunk/src/system/runtime_loader/arch/x86/Jamfile
===================================================================
--- haiku/trunk/src/system/runtime_loader/arch/x86/Jamfile	2008-10-09 14:58:45 UTC (rev 27946)
+++ haiku/trunk/src/system/runtime_loader/arch/x86/Jamfile	2008-10-09 23:47:01 UTC (rev 27947)
@@ -0,0 +1,16 @@
+SubDir HAIKU_TOP src system runtime_loader arch x86 ;
+
+UsePrivateHeaders runtime_loader ;
+UsePrivateSystemHeaders ;
+
+SubDirHdrs [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) ] ;
+
+StaticLibrary libruntime_loader_$(TARGET_ARCH).a :
+	arch_relocate.c
+	:
+	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;atomic.o
+	&lt;src!system!libroot!os!arch!$(TARGET_ARCH)&gt;thread.o
+
+#	&lt;src!system!libroot!posix!string&gt;memcpy.o
+	&lt;src!system!libroot!posix!string!arch!$(TARGET_ARCH)&gt;arch_string.o
+;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012529.html">[Haiku-commits] r27946 -	haiku/trunk/src/system/libroot/posix/glibc/ctype
</A></li>
	<LI>Next message: <A HREF="012538.html">[Haiku-commits] r27948 -	haiku/trunk/src/add-ons/media/plugins/wav_reader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12537">[ date ]</a>
              <a href="thread.html#12537">[ thread ]</a>
              <a href="subject.html#12537">[ subject ]</a>
              <a href="author.html#12537">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
