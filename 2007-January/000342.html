<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r19882 - in haiku/trunk: headers/private/print	headers/private/print/libprint headers/private/print/utils	src/add-ons/print/drivers/canon_lips/lips3	src/add-ons/print/drivers/canon_lips/lips4	src/add-ons/print/drivers/pcl5 src/add-ons/print/drivers/pcl6	src/add-ons/print/drivers/pdf/source	src/add-ons/print/drivers/postscript	src/add-ons/print/drivers/preview src/add-ons/print/drivers/shared	src/add-ons/print/drivers/shared/libprint	src/add-ons/print/drivers/shared/utils	src/add-ons/print/shared src/add-ons/print/transports/lpr	src/servers/print src/servers/print/shared
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r19882%20-%20in%20haiku/trunk%3A%20headers/private/print%0A%09headers/private/print/libprint%20headers/private/print/utils%0A%09src/add-ons/print/drivers/canon_lips/lips3%0A%09src/add-ons/print/drivers/canon_lips/lips4%0A%09src/add-ons/print/drivers/pcl5%20src/add-ons/print/drivers/pcl6%0A%09src/add-ons/print/drivers/pdf/source%0A%09src/add-ons/print/drivers/postscript%0A%09src/add-ons/print/drivers/preview%20src/add-ons/print/drivers/shared%0A%09src/add-ons/print/drivers/shared/libprint%0A%09src/add-ons/print/drivers/shared/utils%0A%09src/add-ons/print/shared%20src/add-ons/print/transports/lpr%0A%09src/servers/print%20src/servers/print/shared&In-Reply-To=%3C200701201552.l0KFqxlX004857%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000341.html">
   <LINK REL="Next"  HREF="000343.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r19882 - in haiku/trunk: headers/private/print	headers/private/print/libprint headers/private/print/utils	src/add-ons/print/drivers/canon_lips/lips3	src/add-ons/print/drivers/canon_lips/lips4	src/add-ons/print/drivers/pcl5 src/add-ons/print/drivers/pcl6	src/add-ons/print/drivers/pdf/source	src/add-ons/print/drivers/postscript	src/add-ons/print/drivers/preview src/add-ons/print/drivers/shared	src/add-ons/print/drivers/shared/libprint	src/add-ons/print/drivers/shared/utils	src/add-ons/print/shared src/add-ons/print/transports/lpr	src/servers/print src/servers/print/shared</H1>
    <B>laplace at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r19882%20-%20in%20haiku/trunk%3A%20headers/private/print%0A%09headers/private/print/libprint%20headers/private/print/utils%0A%09src/add-ons/print/drivers/canon_lips/lips3%0A%09src/add-ons/print/drivers/canon_lips/lips4%0A%09src/add-ons/print/drivers/pcl5%20src/add-ons/print/drivers/pcl6%0A%09src/add-ons/print/drivers/pdf/source%0A%09src/add-ons/print/drivers/postscript%0A%09src/add-ons/print/drivers/preview%20src/add-ons/print/drivers/shared%0A%09src/add-ons/print/drivers/shared/libprint%0A%09src/add-ons/print/drivers/shared/utils%0A%09src/add-ons/print/shared%20src/add-ons/print/transports/lpr%0A%09src/servers/print%20src/servers/print/shared&In-Reply-To=%3C200701201552.l0KFqxlX004857%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r19882 - in haiku/trunk: headers/private/print	headers/private/print/libprint headers/private/print/utils	src/add-ons/print/drivers/canon_lips/lips3	src/add-ons/print/drivers/canon_lips/lips4	src/add-ons/print/drivers/pcl5 src/add-ons/print/drivers/pcl6	src/add-ons/print/drivers/pdf/source	src/add-ons/print/drivers/postscript	src/add-ons/print/drivers/preview src/add-ons/print/drivers/shared	src/add-ons/print/drivers/shared/libprint	src/add-ons/print/drivers/shared/utils	src/add-ons/print/shared src/add-ons/print/transports/lpr	src/servers/print src/servers/print/shared">laplace at mail.berlios.de
       </A><BR>
    <I>Sat Jan 20 16:52:59 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000341.html">[Haiku-commits] r19881 - haiku/trunk/build/jam
</A></li>
        <LI>Next message: <A HREF="000343.html">[Haiku-commits] r19883 - in haiku/trunk/src/bin: . network	network/mount_nfs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#342">[ date ]</a>
              <a href="thread.html#342">[ thread ]</a>
              <a href="subject.html#342">[ subject ]</a>
              <a href="author.html#342">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: laplace
Date: 2007-01-20 16:52:37 +0100 (Sat, 20 Jan 2007)
New Revision: 19882
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=19882&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=19882&amp;view=rev</A>

Added:
   haiku/trunk/headers/private/print/libprint/StatusWindow.h
   haiku/trunk/headers/private/print/utils/
   haiku/trunk/headers/private/print/utils/InterfaceUtils.h
   haiku/trunk/headers/private/print/utils/MarginView.h
   haiku/trunk/headers/private/print/utils/Utils.h
   haiku/trunk/src/add-ons/print/drivers/pdf/source/AboutText.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/PDFSystem.h
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/StatusWindow.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/utils/
   haiku/trunk/src/add-ons/print/drivers/shared/utils/InterfaceUtils.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/utils/Jamfile
   haiku/trunk/src/add-ons/print/drivers/shared/utils/MarginView.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/utils/Utils.cpp
Removed:
   haiku/trunk/headers/private/print/libprint/MarginView.h
   haiku/trunk/src/add-ons/print/drivers/pdf/source/InterfaceUtils.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/InterfaceUtils.h
   haiku/trunk/src/add-ons/print/drivers/pdf/source/Utils.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/Utils.h
   haiku/trunk/src/add-ons/print/drivers/preview/InterfaceUtils.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/InterfaceUtils.h
   haiku/trunk/src/add-ons/print/drivers/preview/MarginView.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/MarginView.h
   haiku/trunk/src/add-ons/print/drivers/preview/Utils.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/Utils.h
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/MarginView.cpp
Modified:
   haiku/trunk/headers/private/print/BeUtils.h
   haiku/trunk/headers/private/print/PrintJobReader.h
   haiku/trunk/headers/private/print/PrintTransport.h
   haiku/trunk/headers/private/print/PrintTransportAddOn.h
   haiku/trunk/headers/private/print/Template.h
   haiku/trunk/headers/private/print/libprint/GraphicsDriver.h
   haiku/trunk/headers/private/print/libprint/JobData.h
   haiku/trunk/headers/private/print/libprint/JobSetupDlg.h
   haiku/trunk/headers/private/print/libprint/Preview.h
   haiku/trunk/src/add-ons/print/drivers/canon_lips/lips3/Jamfile
   haiku/trunk/src/add-ons/print/drivers/canon_lips/lips4/Jamfile
   haiku/trunk/src/add-ons/print/drivers/pcl5/Jamfile
   haiku/trunk/src/add-ons/print/drivers/pcl6/Jamfile
   haiku/trunk/src/add-ons/print/drivers/pcl6/PCL6.cpp
   haiku/trunk/src/add-ons/print/drivers/pcl6/PCL6.h
   haiku/trunk/src/add-ons/print/drivers/pcl6/PCL6Cap.cpp
   haiku/trunk/src/add-ons/print/drivers/pcl6/PCL6Config.h
   haiku/trunk/src/add-ons/print/drivers/pcl6/PCL6Entry.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/Jamfile
   haiku/trunk/src/add-ons/print/drivers/pdf/source/JobSetupWindow.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/Link.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/Link.h
   haiku/trunk/src/add-ons/print/drivers/pdf/source/PDFWriter.h
   haiku/trunk/src/add-ons/print/drivers/pdf/source/PrinterDriver.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/PrinterDriver.h
   haiku/trunk/src/add-ons/print/drivers/pdf/source/PrinterSettings.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/StatusWindow.cpp
   haiku/trunk/src/add-ons/print/drivers/pdf/source/StatusWindow.h
   haiku/trunk/src/add-ons/print/drivers/postscript/Jamfile
   haiku/trunk/src/add-ons/print/drivers/preview/Driver.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/Driver.h
   haiku/trunk/src/add-ons/print/drivers/preview/Jamfile
   haiku/trunk/src/add-ons/print/drivers/preview/JobSetupWindow.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/JobSetupWindow.h
   haiku/trunk/src/add-ons/print/drivers/preview/PageSetupWindow.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/PageSetupWindow.h
   haiku/trunk/src/add-ons/print/drivers/preview/Preview.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/Preview.h
   haiku/trunk/src/add-ons/print/drivers/preview/PreviewDriver.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/PreviewDriver.h
   haiku/trunk/src/add-ons/print/drivers/preview/PrinterDriver.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/PrinterDriver.h
   haiku/trunk/src/add-ons/print/drivers/preview/PrinterSetupWindow.cpp
   haiku/trunk/src/add-ons/print/drivers/preview/PrinterSetupWindow.h
   haiku/trunk/src/add-ons/print/drivers/shared/Jamfile
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/GraphicsDriver.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/Jamfile
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/JobData.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/JobSetupDlg.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/PageSetupDlg.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/Preview.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/PrinterData.cpp
   haiku/trunk/src/add-ons/print/drivers/shared/libprint/PrinterDriver.cpp
   haiku/trunk/src/add-ons/print/shared/Jamfile
   haiku/trunk/src/add-ons/print/transports/lpr/LprSetupDlg.cpp
   haiku/trunk/src/servers/print/Jamfile
   haiku/trunk/src/servers/print/shared/BeUtils.cpp
   haiku/trunk/src/servers/print/shared/Jamfile
Log:
Some printing related improvements:
* libprint based drivers can now show a preview window and show progress
  window while printing contributed in part by Hartmut Reh.
* Libprint and PCL6 driver bug fixes.
* Code clean-up (removed code duplications, coding style, copyright text)

Builds under Linux. Not tested under BeOS.


Modified: haiku/trunk/headers/private/print/BeUtils.h
===================================================================
--- haiku/trunk/headers/private/print/BeUtils.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/BeUtils.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -36,8 +36,8 @@
 // DEALINGS IN THE SOFTWARE.
 /*****************************************************************************/
 
-#ifndef BEUTILS_H
-#define BEUTILS_H
+#ifndef _BE_UTILS_H
+#define _BE_UTILS_H
 
 #include &lt;FindDirectory.h&gt;
 #include &lt;Path.h&gt;
@@ -91,7 +91,7 @@
 // mimetype from sender
 bool MimeTypeForSender(BMessage* sender, BString&amp; mime);
 // adds fields to message or replaces existing fields
-void AddFields(BMessage* to, const BMessage* from, const char* excludeList[] = NULL, const char* includeList[] = NULL);
+void AddFields(BMessage* to, const BMessage* from, const char* excludeList[] = NULL, const char* includeList[] = NULL, bool overwrite = true);
 // load bitmap from application resources
 BBitmap* LoadBitmap(const char* name, uint32 type_code = B_TRANSLATOR_BITMAP);
 // convert bitmap to picture; view must be attached to a window!

Modified: haiku/trunk/headers/private/print/PrintJobReader.h
===================================================================
--- haiku/trunk/headers/private/print/PrintJobReader.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/PrintJobReader.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -27,6 +27,9 @@
 
 */
 
+#ifndef _PRINT_JOB_READER_H
+#define _PRINT_JOB_READER_H
+
 #include &lt;File.h&gt;
 #include &lt;Message.h&gt;
 
@@ -80,3 +83,5 @@
 	status_t GetPage(int no, PrintJobPage&amp; pjp);
 };
 
+#endif
+

Modified: haiku/trunk/headers/private/print/PrintTransport.h
===================================================================
--- haiku/trunk/headers/private/print/PrintTransport.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/PrintTransport.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -28,8 +28,8 @@
 
 */
 
-#ifndef PRINT_TRANSPORT_H
-#define PRINT_TRANSPORT_H
+#ifndef _PRINT_TRANSPORT_H
+#define _PRINT_TRANSPORT_H
 
 #include &lt;image.h&gt;
 #include &lt;DataIO.h&gt;

Modified: haiku/trunk/headers/private/print/PrintTransportAddOn.h
===================================================================
--- haiku/trunk/headers/private/print/PrintTransportAddOn.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/PrintTransportAddOn.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -27,8 +27,8 @@
 
 */
 
-#ifndef PRINT_TRANSPORT_ADD_ON_H
-#define PRINT_TRANSPORT_ADD_ON_H
+#ifndef _PRINT_TRANSPORT_ADD_ON_H
+#define _PRINT_TRANSPORT_ADD_ON_H
 
 #include &lt;image.h&gt;
 #include &lt;DataIO.h&gt;
@@ -38,4 +38,5 @@
 // to be implemented by the transport add-on
 extern &quot;C&quot; BDataIO* instantiate_transport(BDirectory* printer, BMessage* msg);
 
-#endif PRINT_TRANSPORT_ADD_ON_H
+#endif
+

Modified: haiku/trunk/headers/private/print/Template.h
===================================================================
--- haiku/trunk/headers/private/print/Template.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/Template.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -82,4 +82,4 @@
 		virtual void		SetFontFace(int32 flags);
 };
 
-#endif _TEMPLATE_H
+#endif // _TEMPLATE_H

Modified: haiku/trunk/headers/private/print/libprint/GraphicsDriver.h
===================================================================
--- haiku/trunk/headers/private/print/libprint/GraphicsDriver.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/libprint/GraphicsDriver.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -11,6 +11,7 @@
 #include &quot;PrintProcess.h&quot;
 #include &quot;SpoolMetaData.h&quot;
 #include &quot;Transport.h&quot;
+#include &quot;StatusWindow.h&quot;
 
 class BView;
 class BBitmap;
@@ -26,7 +27,11 @@
 public:
 	GraphicsDriver(BMessage *, PrinterData *, const PrinterCap *);
 	virtual ~GraphicsDriver();
+	const JobData *getJobData(BFile *spoolFile);
 	BMessage *takeJob(BFile *spool, uint32 flags = 0);
+	static BPoint getScale(int32 nup, BRect physicalRect, float scaling);
+	static BPoint getOffset(int32 nup, int index, JobData::Orientation orientation, const BPoint *scale, 
+		BRect scaledPhysicalRect, BRect scaledPrintableRect, BRect physicalRect);
 
 protected:
 	virtual bool startDoc();
@@ -58,7 +63,7 @@
 	GraphicsDriver &amp;operator = (const GraphicsDriver &amp;);
 
 private:
-	void setupData(BFile *file, long page_count);
+	bool setupData(BFile *file);
 	void setupBitmap();
 	void cleanupData();
 	void cleanupBitmap();
@@ -91,6 +96,9 @@
 	int fPixelDepth;
 	int fBandCount;
 	int fInternalCopies;
+	
+	uint32 fPageCount;
+	StatusWindow *fStatusWindow;
 };
 
 inline const JobData *GraphicsDriver::getJobData() const

Modified: haiku/trunk/headers/private/print/libprint/JobData.h
===================================================================
--- haiku/trunk/headers/private/print/libprint/JobData.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/libprint/JobData.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -206,7 +206,10 @@
 */
 	enum Color {
 		kMonochrome = 1,
-		kColor
+		kColor,
+		// Some PCL6 printers do not support compressed data
+		// in color mode.
+		kColorCompressionDisabled
 	};
 
 	enum Settings {
@@ -221,6 +224,7 @@
 	};
 
 private:
+	bool        fShowPreview;
 	Paper       fPaper;
 	int32       fXRes;
 	int32       fYRes;
@@ -261,6 +265,9 @@
 	void load(BMessage *msg, const PrinterCap *cap, Settings settings);
 	void save(BMessage *msg = NULL);
 
+	bool getShowPreview() const { return fShowPreview; }
+	void setShowPreview(bool showPreview) { fShowPreview = showPreview; }
+
 	Paper getPaper() const { return fPaper; }
 	void  setPaper(Paper paper) { fPaper = paper; }
 

Modified: haiku/trunk/headers/private/print/libprint/JobSetupDlg.h
===================================================================
--- haiku/trunk/headers/private/print/libprint/JobSetupDlg.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/libprint/JobSetupDlg.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -29,7 +29,7 @@
 	JobSetupView(BRect frame, JobData *job_data, PrinterData *printer_data, const PrinterCap *printer_cap);
 	virtual void AttachedToWindow();
 	virtual void MessageReceived(BMessage *msg);
-	bool UpdateJobData();
+	bool UpdateJobData(bool showPreview);
 
 private:
 	void UpdateButtonEnabledState();

Deleted: haiku/trunk/headers/private/print/libprint/MarginView.h

Modified: haiku/trunk/headers/private/print/libprint/Preview.h
===================================================================
--- haiku/trunk/headers/private/print/libprint/Preview.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/libprint/Preview.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -1,29 +1,139 @@
 /*
- * Preview.h
- * Copyright 1999-2000 Y.Takagi. All Rights Reserved.
- */
 
-//#define USE_PREVIEW_FOR_DEBUG
+Preview
 
-#ifdef USE_PREVIEW_FOR_DEBUG
-#ifndef __PREVIEW_H
-#define __PREVIEW_H
+Copyright (c) 2002, 2003 OpenBeOS. 
+Copyright (c) 2005 Haiku.
 
-#include &lt;Window.h&gt;
+Author: 
+	Michael Pfeiffer
+	Hartmut Reh
+	
+Permission is hereby granted, free of charge, to any person obtaining a copy of
+this software and associated documentation files (the &quot;Software&quot;), to deal in
+the Software without restriction, including without limitation the rights to
+use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
+of the Software, and to permit persons to whom the Software is furnished to do
+so, subject to the following conditions:
 
-class PreviewWindow : public BWindow {
+The above copyright notice and this permission notice shall be included in all
+copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+THE SOFTWARE.
+
+*/
+
+#include &lt;InterfaceKit.h&gt;
+#include &quot;PrintJobReader.h&quot;
+#include &quot;InterfaceUtils.h&quot;
+
+class PreviewPage {
+	int32 fPage;
+	int32 fNumberOfPictures;
+	BPicture* fPictures;
+	BPoint* fPoints;
+	BRect* fRects;
+	status_t fStatus;
+	
 public:
-	PreviewWindow(BRect, const char *, BBitmap *);
-	virtual bool QuitRequested();
-	int Go();
+	PreviewPage(int32 page, PrintJobPage* pjp);
+	~PreviewPage();
+	status_t InitCheck() const;
+	
+	int32 Page() const { return fPage; }
+	void Draw(BView* view);
+};
 
-protected:
-	PreviewWindow(const PreviewWindow &amp;);
-	PreviewWindow &amp;operator = (const PreviewWindow &amp;);
+class PreviewView : public BView {
+	int32 fPage;
+	int32 fZoom;
+	PrintJobReader fReader;
+	int32 fNumberOfPagesPerPage;
+	int32 fNumberOfPages;        // physical pages
+	bool fReverse;
+	BRect fPageRect;
+	JobData::Orientation fOrientation;
+	JobData::PageSelection fPageSelection;
+	PreviewPage* fCachedPage;
+	
+	float ZoomFactor() const;
+	BRect PageRect() const;
+	BRect PrintableRect() const;
+	int32 GetPageNumber(int32 index) const;
+	
+public:
+	PreviewView(BFile* jobFile, BRect rect);
+	~PreviewView();
+	status_t InitCheck() const;
+	
+	BRect ViewRect() const;
 
-private:
-	long fSemaphore;
+	bool IsPageLoaded(int32 page) const;
+	bool IsPageValid() const;
+	void LoadPage(int32 page);
+	void DrawPageFrame(BRect r);
+	void DrawPage(BRect r);
+	void Draw(BRect r);
+	void FrameResized(float width, float height);
+	
+	void FixScrollbars();
+	
+	bool ShowsFirstPage() const;
+	bool ShowsLastPage() const;
+	int CurrentPage() const { return fPage + 1; }
+	int NumberOfPages() const;
+	void ShowNextPage();
+	void ShowPrevPage();
+	void ShowFirstPage();
+	void ShowLastPage();
+	void ShowFindPage(int page);
+	
+	bool CanZoomIn() const;
+	bool CanZoomOut() const;
+	void ZoomIn();
+	void ZoomOut();
 };
 
-#endif	/* __PREVIEW_H */
-#endif	/* USE_PREVIEW_FOR_DEBUG */
+class PreviewWindow : public BlockingWindow {
+	BButton *fFirst;
+	BButton *fNext;
+	BButton *fPrev;
+	BButton *fLast;
+	BButton *fZoomIn;
+	BButton *fZoomOut;
+	BTextControl *fPageNumber;
+	BStringView *fPageText;
+	PreviewView *fPreview;
+	BScrollView *fPreviewScroller;
+	float fButtonBarHeight;
+	
+	enum {
+		MSG_FIRST_PAGE = 'pwfp',			
+		MSG_NEXT_PAGE  = 'pwnp',
+		MSG_PREV_PAGE  = 'pwpp',
+		MSG_LAST_PAGE  = 'pwlp',			
+		MSG_FIND_PAGE  = 'pwsp',
+		MSG_ZOOM_IN    = 'pwzi',
+		MSG_ZOOM_OUT   = 'pwzo',
+		MSG_PRINT_JOB  = 'pwpj',
+		MSG_CANCEL_JOB = 'pwcj',
+	};
+
+	void ResizeToPage(bool allowShrinking = false);
+	void UpdateControls();
+	
+	typedef BlockingWindow inherited; 
+	
+public:
+	PreviewWindow(BFile* jobFile, bool showOkAndCancelButtons = false);
+	status_t InitCheck() const { return fPreview-&gt;InitCheck(); }
+	void MessageReceived(BMessage* m);
+	status_t Go();
+};
+

Added: haiku/trunk/headers/private/print/libprint/StatusWindow.h
===================================================================
--- haiku/trunk/headers/private/print/libprint/StatusWindow.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/libprint/StatusWindow.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -0,0 +1,47 @@
+/*
+	StatusWindow.h
+  Copyright 2005 Dr.H.Reh. All Rights Reserved.
+*/
+
+
+#ifndef STATUS_WINDOW_H										
+#define STATUS_WINDOW_H										
+
+#ifndef _WINDOW_H													 
+#include &lt;Window.h&gt;												
+#endif
+
+#include &lt;String.h&gt;
+
+
+class StatusWindow : public BWindow 
+{
+	public:
+									StatusWindow(bool oddPages, bool evenPages,
+															 				uint32 firstPage, uint32 numPages, 
+															 				uint32 docCopies, uint32 nup);
+									~StatusWindow(void);
+
+		virtual void MessageReceived(BMessage *message);
+		
+		void ResetStatusBar(void);
+		bool UpdateStatusBar(uint32 page, uint32 copy);
+		void SetPageCopies(uint32 copies);
+		
+	private:
+		BView			 *fStatusView;
+		BStatusBar *fStatusBar;
+		BButton		 *fCancelButton;
+		BButton		 *fHideButton;
+		bool			 fCancelBar;
+		bool			 fDocumentCopy;
+		uint32		 fNops;
+		uint32		 fFirstPage;
+		uint32		 fCopies;
+		uint32		 fDocCopies;
+		float			 fStatusDelta;
+		float			 fDelta;
+};
+
+#endif
+

Added: haiku/trunk/headers/private/print/utils/InterfaceUtils.h
===================================================================
--- haiku/trunk/headers/private/print/utils/InterfaceUtils.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/utils/InterfaceUtils.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -0,0 +1,148 @@
+/*
+
+InterfaceUtils.cpp
+
+Copyright (c) 2002 OpenBeOS. 
+
+Author: 
+	Michael Pfeiffer
+
+Permission is hereby granted, free of charge, to any person obtaining a copy of
+this software and associated documentation files (the &quot;Software&quot;), to deal in
+the Software without restriction, including without limitation the rights to
+use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
+of the Software, and to permit persons to whom the Software is furnished to do
+so, subject to the following conditions:
+
+The above copyright notice and this permission notice shall be included in all
+copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+THE SOFTWARE.
+
+*/
+
+#ifndef _INTERFACE_UTILS_H
+#define _INTERFACE_UTILS_H
+
+#include &lt;InterfaceKit.h&gt;
+
+// --------------------------------------------------
+class HWindow : public BWindow
+{
+protected:
+	void Init(uint32 escape_msg);
+	
+public:
+	typedef BWindow 		inherited;
+
+	HWindow(BRect frame, const char *title, window_type type, uint32 flags, uint32 workspace = B_CURRENT_WORKSPACE, uint32 escape_msg = B_QUIT_REQUESTED);
+	HWindow(BRect frame, const char *title, window_look look, window_feel feel, uint32 flags, uint32 workspace = B_CURRENT_WORKSPACE, uint32 escape_msg = B_QUIT_REQUESTED);
+	
+	virtual void MessageReceived(BMessage* m);
+	virtual void AboutRequested();
+	virtual const char* AboutText() const { return NULL; }
+};
+
+// --------------------------------------------------
+class BlockingWindow : public HWindow
+{
+public:
+	BlockingWindow(BRect frame, const char *title, window_type type, uint32 flags, uint32 workspace = B_CURRENT_WORKSPACE, uint32 escape_msg = B_QUIT_REQUESTED);
+	BlockingWindow(BRect frame, const char *title, window_look look, window_feel feel, uint32 flags, uint32 workspace = B_CURRENT_WORKSPACE, uint32 escape_msg = B_QUIT_REQUESTED);
+	~BlockingWindow();
+	
+	bool QuitRequested();
+	// Quit() is called by child class with result code
+	void Quit(status_t result);
+	// Show window and wait for it to quit, returns result code
+	virtual status_t Go();
+	// Or quit window e.g. something went wrong in constructor
+	void Quit();
+	// Sets the result that is returned when the user closes the window.
+	// Default is B_OK.
+	void SetUserQuitResult(status_t result);
+	
+	typedef HWindow 		inherited;
+	
+private:
+	void Init(const char* title);
+	
+	status_t                fUserQuitResult;
+	bool                    fReadyToQuit;
+	sem_id 					fExitSem;
+	status_t* 				fResult;
+};
+
+// --------------------------------------------------
+class TextView : public BTextView
+{
+public:
+	typedef BTextView inherited;
+	
+	TextView(BRect frame,
+				const char *name,
+				BRect textRect,
+				uint32 rmask = B_FOLLOW_LEFT | B_FOLLOW_TOP,
+				uint32 flags = B_WILL_DRAW | B_NAVIGABLE);
+
+	TextView(BRect frame,
+				const char *name,
+				BRect textRect,
+				const BFont *font, const rgb_color *color,
+				uint32 rmask = B_FOLLOW_LEFT | B_FOLLOW_TOP,
+				uint32 flags = B_WILL_DRAW | B_NAVIGABLE);
+
+	void KeyDown(const char *bytes, int32 numBytes);
+	void MakeFocus(bool focus = true);
+	void Draw(BRect r);
+};
+
+
+// --------------------------------------------------
+class TextControl : public BView
+{
+	BStringView *fLabel;
+	TextView   *fText;
+public:
+	TextControl(BRect frame,
+				const char *name,
+				const char *label, 
+				const char *initial_text, 
+				BMessage *message,
+				uint32 rmask = B_FOLLOW_LEFT | B_FOLLOW_TOP,
+				uint32 flags = B_WILL_DRAW | B_NAVIGABLE); 
+	const char *Label() { return fLabel-&gt;Text(); }
+	const char *Text()  { return fText-&gt;Text(); }
+	void MakeFocus(bool focus = true) { fText-&gt;MakeFocus(focus); }	
+	void ConvertToParent(BView* parent, BView* child, BRect &amp;rect);
+	void FocusSetTo(BView* child);
+};
+
+
+// --------------------------------------------------
+class Table : public BView
+{
+public:
+	typedef BView inherited;
+	
+	Table(BRect frame, const char *name, uint32 rmode, uint32 flags);
+	void ScrollTo(BPoint p);
+};
+
+class DragListView : public BListView
+{
+public:
+	DragListView(BRect frame, const char *name,
+		list_view_type type = B_SINGLE_SELECTION_LIST,
+		uint32 resizingMode = B_FOLLOW_LEFT | B_FOLLOW_TOP, 
+		uint32 flags = B_WILL_DRAW | B_NAVIGABLE | B_FRAME_EVENTS);
+	bool InitiateDrag(BPoint point, int32 index, bool wasSelected);
+};
+
+#endif

Added: haiku/trunk/headers/private/print/utils/MarginView.h
===================================================================
--- haiku/trunk/headers/private/print/utils/MarginView.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/utils/MarginView.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -0,0 +1,225 @@
+/*
+
+MarginView.h
+
+Copyright (c) 2002 OpenBeOS.
+
+Authors: 
+	Philippe Houdoin
+	Simon Gauvin	
+	Michael Pfeiffer
+
+Permission is hereby granted, free of charge, to any person obtaining a copy of
+this software and associated documentation files (the &quot;Software&quot;), to deal in
+the Software without restriction, including without limitation the rights to
+use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
+of the Software, and to permit persons to whom the Software is furnished to do
+so, subject to the following conditions:
+
+The above copyright notice and this permission notice shall be included in all
+copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+THE SOFTWARE.
+
+	Documentation:
+	
+	The MarginView is designed to be a self contained component that manages
+	the display of a BBox control that shows a graphic of a page and its'
+	margings. The component also includes text fields that are used to mofify
+	the margin values and a popup to change the units used for the margins.
+
+	There are two interfaces for the MarginView component:
+	
+	1) Set methods:
+		- page size
+		- orientation
+	   
+	   Get methods to retrieve:
+		- margins
+		- page size
+		
+		The method interface is available for the parent Component to call on 
+		the MarginView in response to the Window receiveing messages from
+		other BControls that it contains, such as a Page Size popup. The
+		Get methods are used to extract the page size and margins so that 
+		the printer driver may put these values into a BMessage for printing.
+		
+	2) 'Optional' Message interface:
+		- Set Page Size
+		- Flip Orientation
+	
+		The message interface is available for GUI Controls, BPopupMenu to send 
+		messages to the MarginView if the parent Window is not used to handle
+		the messages. 
+
+	General Use of MarginView component:
+	
+		1) Simply construct a new MarginView object with the margins 
+			you want as defaults and add this view to the parent view 
+			of the dialog.
+
+			MarginView *mv;
+			mv = new MarginView(viewSizeRect, pageWidth, pageHeight);
+			parentView-&gt;AddChild(mv);
+
+			* you can also set the margins in the constructor, and the units:
+			
+			mv = new MarginView(viewSizeRect, pageWidth, pageHeight
+						marginRect, kUnitPointS);
+
+			! but remeber to have the marginRect values match the UNITS :-)
+			
+		2) Set Page Size with methods:
+
+			mv-SetPageSize( pageWidth, pageHeight );
+			mv-&gt;UpdateView();
+		
+		3) Set Page Size with BMessage:
+
+			BMessage* msg = new BMessage(CHANGE_PAGE_SIZE);
+			msg-&gt;AddFloat(&quot;width&quot;, pageWidth);
+			msg-&gt;AddFloat(&quot;height&quot;, pageHeight);
+			mv-&gt;PostMessage(msg);
+
+		4) Flip Page with methods:
+		
+			mv-SetPageSize( pageHeight, pageWidth );
+			mv-&gt;UpdateView();
+		
+		5) Flip Page with BMessage: 
+		
+			BMessage* msg = new BMessage(FLIP_PAGE);
+			mv-&gt;Looper()-&gt;PostMessage(msg);
+
+		Note: the MarginView DOES NOT keep track of the orientation. This
+				should be done by the code for the Page setup dialog.
+
+		6) Get Page Size
+
+			BPoint pageSize = mv-&gt;GetPageSize();
+			
+		7) Get Margins
+
+			BRect margins = mv-&gt;GetMargins();
+		
+		8) Get Units
+			
+			uint32 units = mv-&gt;GetUnits();
+
+			where units is one of: 
+				kUnitInch,  72 points/in
+				kUnitCM,    28.346 points/cm
+				kUnitPoint, 1 point/point
+*/
+
+#ifndef _MARGIN_VIEW_H
+#define _MARGIN_VIEW_H
+
+#include &lt;InterfaceKit.h&gt;
+#include &lt;Looper.h&gt;
+
+class MarginManager;
+
+// Messages that the MarginManager accepts
+const uint32 TOP_MARGIN_CHANGED    = 'tchg';
+const uint32 RIGHT_MARGIN_CHANGED  = 'rchg';
+const uint32 LEFT_MARGIN_CHANGED   = 'lchg';
+const uint32 BOTTOM_MARGIN_CHANGED = 'bchg';
+const uint32 MARGIN_CHANGED        = 'mchg';
+const uint32 CHANGE_PAGE_SIZE      = 'chps';
+const uint32 FLIP_PAGE             = 'flip';
+const uint32 MARGIN_UNIT_CHANGED   = 'mucg';
+
+enum MarginUnit {
+	kUnitInch = 0,
+	kUnitCM,
+	kUnitPoint
+};
+
+/**
+ * Class MarginView
+ */
+class MarginView : public BBox 
+{
+friend class MarginManager;
+
+private:
+
+	// GUI components
+	BTextControl *fTop, *fBottom, *fLeft, *fRight;
+
+	// rect that holds the margins for the page as a set of point offsets
+	BRect fMargins;
+
+	// the maximum size of the page view calculated from the view size
+	float fMaxPageWidth;
+	float fMaxPageHeight;
+
+	// the actual size of the page in points
+	float fPageHeight;
+	float fPageWidth;
+
+	// the units used to calculate the page size
+	MarginUnit fMarginUnit;
+	float fUnitValue;
+
+	// the size of the drawing area we have to draw the view in pixels
+	float fViewHeight;
+	float fViewWidth;
+
+	// Calculate the view size for the margins
+	void CalculateViewSize(uint32 msg);
+
+	// performed internally using the supplied popup
+	void  SetMarginUnit(MarginUnit unit);
+
+	// performed internally using text fields
+	void  SetMargin(BRect margin);
+
+	// utility method
+	void AllowOnlyNumbers(BTextControl *textControl, int maxNum);
+	
+public:
+	MarginView(BRect rect,
+		int32 pageWidth = 0,
+		int32 pageHeight = 0,
+		BRect margins = BRect(1, 1, 1, 1), // default to 1 inch
+		MarginUnit unit = kUnitInch);
+
+	~MarginView();
+
+	/// all the GUI construction code
+	void ConstructGUI();
+	
+	// page size
+	void SetPageSize(float pageWidth, float pageHeight);
+	// point.x = width, point.y = height
+	BPoint GetPageSize(void);
+
+	// margin
+	BRect GetMargin(void);
+
+	// orientation
+	// None, this state should be saved elsewhere in the page setup code
+	//	and not here. See the FLIP_PAGE message to perform this function.
+		
+	// units
+	MarginUnit GetMarginUnit(void);
+
+	// will cause a recalc and redraw
+	void UpdateView(uint32 msg);
+
+	// BeOS Hook methods
+	virtual void AttachedToWindow(void);
+	void Draw(BRect rect);
+	void FrameResized(float width, float height);
+	void MessageReceived(BMessage *msg);
+};
+
+#endif // _MARGIN_VIEW_H

Added: haiku/trunk/headers/private/print/utils/Utils.h
===================================================================
--- haiku/trunk/headers/private/print/utils/Utils.h	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/headers/private/print/utils/Utils.h	2007-01-20 15:52:37 UTC (rev 19882)
@@ -0,0 +1,132 @@
+/*
+
+PDF Writer printer driver.
+
+Copyright (c) 2001, 2002 OpenBeOS. 
+Copyright (c) 2005 Haiku.
+
+Authors: 
+	Philippe Houdoin
+	Simon Gauvin	
+	Michael Pfeiffer
+	
+Permission is hereby granted, free of charge, to any person obtaining a copy of
+this software and associated documentation files (the &quot;Software&quot;), to deal in
+the Software without restriction, including without limitation the rights to
+use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
+of the Software, and to permit persons to whom the Software is furnished to do
+so, subject to the following conditions:
+
+The above copyright notice and this permission notice shall be included in all
+copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+THE SOFTWARE.
+
+*/
+
+#ifndef _UTILS_H
+#define _UTILS_H
+
+#include &lt;Window.h&gt;
+#include &lt;Message.h&gt;
+#include &lt;MessageFilter.h&gt;
+
+
+void AddString(BMessage* m, const char* name, const char* value);
+
+// set or replace a value in a BMessage
+void SetRect(BMessage* msg, const char* name, BRect rect);
+void SetFloat(BMessage* msg, const char* name, float value);
+void SetInt32(BMessage* msg, const char* name, int32 value);
+
+class EscapeMessageFilter : public BMessageFilter 
+{
+private:
+	BWindow *fWindow;
+	int32    fWhat;
+		
+public:
+	EscapeMessageFilter(BWindow *window, int32 what);
+	filter_result Filter(BMessage *msg, BHandler **target);
+};
+
+
+#define BEGINS_CHAR(byte) ((byte &amp; 0xc0) != 0x80)
+
+
+template &lt;class T&gt;
+class TList {
+private:
+	BList fList;
+	typedef int (*sort_func)(const void*, const void*);
+	
+public:
+	virtual ~TList();
+	void     MakeEmpty();
+	int32    CountItems() const;
+	T*       ItemAt(int32 index) const;
+	void     AddItem(T* p);
+	T*       RemoveItem(int i);
+	T*       Items();
+	void     SortItems(int (*comp)(const T**, const T**));
+};
+
+// TList
+template&lt;class T&gt;
+TList&lt;T&gt;::~TList() {
+	MakeEmpty();
+}
+
+
+template&lt;class T&gt;
+void TList&lt;T&gt;::MakeEmpty() {
+	const int32 n = CountItems();
+	for (int i = 0; i &lt; n; i++) {
+		delete ItemAt(i);
+	}
+	fList.MakeEmpty();
+}
+
+
+template&lt;class T&gt;
+int32 TList&lt;T&gt;::CountItems() const {
+	return fList.CountItems();
+}
+
+
+template&lt;class T&gt;
+T* TList&lt;T&gt;::ItemAt(int32 index) const {
+	return (T*)fList.ItemAt(index);
+}
+
+
+template&lt;class T&gt;
+void TList&lt;T&gt;::AddItem(T* p) {
+	fList.AddItem(p);
+}
+
+template&lt;class T&gt;
+T* TList&lt;T&gt;::RemoveItem(int i) {
+	return (T*)fList.RemoveItem(i);
+}
+
+
+template&lt;class T&gt;
+T* TList&lt;T&gt;::Items() {
+	return (T*)fList.Items();
+}
+
+
+template&lt;class T&gt;
+void TList&lt;T&gt;::SortItems(int (*comp)(const T**, const T**)) {
+	sort_func sort = (sort_func)comp;
+	fList.SortItems(sort);
+}
+
+#endif

Modified: haiku/trunk/src/add-ons/print/drivers/canon_lips/lips3/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/print/drivers/canon_lips/lips3/Jamfile	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/src/add-ons/print/drivers/canon_lips/lips3/Jamfile	2007-01-20 15:52:37 UTC (rev 19882)
@@ -3,6 +3,7 @@
 SetSubDirSupportedPlatformsBeOSCompatible ;
 
 SubDirHdrs [ FDirName $(HAIKU_TOP) headers private print libprint ] ; 
+SubDirHdrs [ FDirName $(HAIKU_TOP) headers private print utils ] ; 
 
 AddResources Canon\ LIPS3\ Compatible : Lips3.rdef ;
 
@@ -13,7 +14,11 @@
 	Compress3.cpp
 ;
 
-LinkAgainst Canon\ LIPS3\ Compatible : be libprint.a $(TARGET_LIBSTDC++) ;
+LinkAgainst Canon\ LIPS3\ Compatible : 
+	be 
+	libprint.a 
+	libprintutils.a
+	$(TARGET_LIBSTDC++) ;
 
 Package haiku-printingkit-cvs :
 	Canon\ LIPS3\ Compatible :

Modified: haiku/trunk/src/add-ons/print/drivers/canon_lips/lips4/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/print/drivers/canon_lips/lips4/Jamfile	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/src/add-ons/print/drivers/canon_lips/lips4/Jamfile	2007-01-20 15:52:37 UTC (rev 19882)
@@ -3,6 +3,7 @@
 SetSubDirSupportedPlatformsBeOSCompatible ;
 
 SubDirHdrs [ FDirName $(HAIKU_TOP) headers private print libprint ] ; 
+SubDirHdrs [ FDirName $(HAIKU_TOP) headers private print utils ] ; 
 
 AddResources Canon\ LIPS4\ Compatible : Lips4.rdef ;
 
@@ -12,7 +13,11 @@
 	Lips4Cap.cpp
 ;
 
-LinkAgainst Canon\ LIPS4\ Compatible : be libprint.a $(TARGET_LIBSTDC++) ;
+LinkAgainst Canon\ LIPS4\ Compatible : 
+	be 
+	libprint.a 
+	libprintutils.a
+	$(TARGET_LIBSTDC++) ;
 
 Package haiku-printingkit-cvs :
 	Canon\ LIPS4\ Compatible :

Modified: haiku/trunk/src/add-ons/print/drivers/pcl5/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/print/drivers/pcl5/Jamfile	2007-01-20 14:15:40 UTC (rev 19881)
+++ haiku/trunk/src/add-ons/print/drivers/pcl5/Jamfile	2007-01-20 15:52:37 UTC (rev 19882)
@@ -3,6 +3,7 @@
 SetSubDirSupportedPlatformsBeOSCompatible ;
 
 SubDirHdrs [ FDirName $(HAIKU_TOP) headers private print libprint ] ; 
+SubDirHdrs [ FDirName $(HAIKU_TOP) headers private print utils ] ; 
 
 AddResources PCL5\ Compatible : PCL5.rsrc ;
 
@@ -12,7 +13,11 @@
 	PCL5Cap.cpp
 ;
 
-LinkAgainst PCL5\ Compatible : be libprint.a $(TARGET_LIBSTDC++) ;

[... truncated: 5015 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000341.html">[Haiku-commits] r19881 - haiku/trunk/build/jam
</A></li>
	<LI>Next message: <A HREF="000343.html">[Haiku-commits] r19883 - in haiku/trunk/src/bin: . network	network/mount_nfs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#342">[ date ]</a>
              <a href="thread.html#342">[ thread ]</a>
              <a href="subject.html#342">[ subject ]</a>
              <a href="author.html#342">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
