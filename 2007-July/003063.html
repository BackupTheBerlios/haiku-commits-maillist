<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r21622 - in haiku/trunk: headers/os/opengl/GL	src/kits/opengl/mesa/glapi src/kits/opengl/mesa/main	src/kits/opengl/mesa/shader src/kits/opengl/mesa/shader/slang	src/kits/opengl/mesa/shader/slang/library	src/kits/opengl/mesa/swrast src/kits/opengl/mesa/swrast_setup	src/kits/opengl/mesa/tnl src/kits/opengl/mesa/x86
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r21622%20-%20in%20haiku/trunk%3A%20headers/os/opengl/GL%0A%09src/kits/opengl/mesa/glapi%20src/kits/opengl/mesa/main%0A%09src/kits/opengl/mesa/shader%20src/kits/opengl/mesa/shader/slang%0A%09src/kits/opengl/mesa/shader/slang/library%0A%09src/kits/opengl/mesa/swrast%20src/kits/opengl/mesa/swrast_setup%0A%09src/kits/opengl/mesa/tnl%20src/kits/opengl/mesa/x86&In-Reply-To=%3C200707152228.l6FMSpo9008668%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003062.html">
   <LINK REL="Next"  HREF="003064.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r21622 - in haiku/trunk: headers/os/opengl/GL	src/kits/opengl/mesa/glapi src/kits/opengl/mesa/main	src/kits/opengl/mesa/shader src/kits/opengl/mesa/shader/slang	src/kits/opengl/mesa/shader/slang/library	src/kits/opengl/mesa/swrast src/kits/opengl/mesa/swrast_setup	src/kits/opengl/mesa/tnl src/kits/opengl/mesa/x86</H1>
    <B>korli at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r21622%20-%20in%20haiku/trunk%3A%20headers/os/opengl/GL%0A%09src/kits/opengl/mesa/glapi%20src/kits/opengl/mesa/main%0A%09src/kits/opengl/mesa/shader%20src/kits/opengl/mesa/shader/slang%0A%09src/kits/opengl/mesa/shader/slang/library%0A%09src/kits/opengl/mesa/swrast%20src/kits/opengl/mesa/swrast_setup%0A%09src/kits/opengl/mesa/tnl%20src/kits/opengl/mesa/x86&In-Reply-To=%3C200707152228.l6FMSpo9008668%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r21622 - in haiku/trunk: headers/os/opengl/GL	src/kits/opengl/mesa/glapi src/kits/opengl/mesa/main	src/kits/opengl/mesa/shader src/kits/opengl/mesa/shader/slang	src/kits/opengl/mesa/shader/slang/library	src/kits/opengl/mesa/swrast src/kits/opengl/mesa/swrast_setup	src/kits/opengl/mesa/tnl src/kits/opengl/mesa/x86">korli at mail.berlios.de
       </A><BR>
    <I>Mon Jul 16 00:28:51 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003062.html">[Haiku-commits] r21621 - haiku/vendor/mesa
</A></li>
        <LI>Next message: <A HREF="003064.html">[Haiku-commits] r21623 - haiku/trunk/src/system/kernel/fs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3063">[ date ]</a>
              <a href="thread.html#3063">[ thread ]</a>
              <a href="subject.html#3063">[ subject ]</a>
              <a href="author.html#3063">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: korli
Date: 2007-07-16 00:28:49 +0200 (Mon, 16 Jul 2007)
New Revision: 21622
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=21622&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=21622&amp;view=rev</A>

Added:
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_120_core.gc
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_builtin_120_common.gc
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_builtin_120_fragment.gc
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_common_builtin.gc
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_core.gc
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_fragment_builtin.gc
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_pp_directives.syn
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_pp_expression.syn
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_pp_version.syn
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_shader.syn
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_version.syn
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_vertex_builtin.gc
Removed:
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_builtin_120_common_gc.h
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_builtin_120_fragment_gc.h
Modified:
   haiku/trunk/headers/os/opengl/GL/gl.h
   haiku/trunk/src/kits/opengl/mesa/glapi/glapi.c
   haiku/trunk/src/kits/opengl/mesa/main/attrib.c
   haiku/trunk/src/kits/opengl/mesa/main/config.h
   haiku/trunk/src/kits/opengl/mesa/main/context.c
   haiku/trunk/src/kits/opengl/mesa/main/enable.c
   haiku/trunk/src/kits/opengl/mesa/main/fbobject.c
   haiku/trunk/src/kits/opengl/mesa/main/image.c
   haiku/trunk/src/kits/opengl/mesa/main/imports.c
   haiku/trunk/src/kits/opengl/mesa/main/light.c
   haiku/trunk/src/kits/opengl/mesa/main/points.c
   haiku/trunk/src/kits/opengl/mesa/main/teximage.c
   haiku/trunk/src/kits/opengl/mesa/main/texobj.c
   haiku/trunk/src/kits/opengl/mesa/main/texstate.c
   haiku/trunk/src/kits/opengl/mesa/main/version.h
   haiku/trunk/src/kits/opengl/mesa/shader/arbprogram.c
   haiku/trunk/src/kits/opengl/mesa/shader/prog_execute.c
   haiku/trunk/src/kits/opengl/mesa/shader/prog_execute.h
   haiku/trunk/src/kits/opengl/mesa/shader/prog_statevars.c
   haiku/trunk/src/kits/opengl/mesa/shader/shader_api.c
   haiku/trunk/src/kits/opengl/mesa/shader/slang/library/slang_common_builtin_gc.h
   haiku/trunk/src/kits/opengl/mesa/shader/slang/slang_codegen.c
   haiku/trunk/src/kits/opengl/mesa/shader/slang/slang_compile.c
   haiku/trunk/src/kits/opengl/mesa/shader/slang/slang_ir.c
   haiku/trunk/src/kits/opengl/mesa/swrast/s_aalinetemp.h
   haiku/trunk/src/kits/opengl/mesa/swrast/s_aatritemp.h
   haiku/trunk/src/kits/opengl/mesa/swrast/s_feedback.c
   haiku/trunk/src/kits/opengl/mesa/swrast/s_fragprog.c
   haiku/trunk/src/kits/opengl/mesa/swrast/s_pointtemp.h
   haiku/trunk/src/kits/opengl/mesa/swrast/s_span.c
   haiku/trunk/src/kits/opengl/mesa/swrast/s_tritemp.h
   haiku/trunk/src/kits/opengl/mesa/swrast_setup/ss_context.c
   haiku/trunk/src/kits/opengl/mesa/tnl/t_vb_points.c
   haiku/trunk/src/kits/opengl/mesa/tnl/t_vb_program.c
   haiku/trunk/src/kits/opengl/mesa/tnl/t_vertex.c
   haiku/trunk/src/kits/opengl/mesa/x86/3dnow_normal.S
   haiku/trunk/src/kits/opengl/mesa/x86/glapi_x86.S
Log:
updated mesa to 7.0


Modified: haiku/trunk/headers/os/opengl/GL/gl.h
===================================================================
--- haiku/trunk/headers/os/opengl/GL/gl.h	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/headers/os/opengl/GL/gl.h	2007-07-15 22:28:49 UTC (rev 21622)
@@ -1,8 +1,8 @@
 /*
  * Mesa 3-D graphics library
- * Version:  6.5.1
+ * Version:  7.0
  *
- * Copyright (C) 1999-2006  Brian Paul   All Rights Reserved.
+ * Copyright (C) 1999-2007  Brian Paul   All Rights Reserved.
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the &quot;Software&quot;),

Modified: haiku/trunk/src/kits/opengl/mesa/glapi/glapi.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/glapi/glapi.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/glapi/glapi.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -1028,22 +1028,24 @@
 #if defined(PTHREADS) || defined(GLX_USE_TLS)
 /**
  * Perform platform-specific GL API entry-point fixups.
- * 
- * 
  */
 static void
 init_glapi_relocs( void )
 {
-#if defined( USE_X86_ASM ) &amp;&amp; defined( GLX_USE_TLS )
-    extern void * _x86_get_dispatch(void);
-    const GLubyte * const get_disp = (const GLubyte *) _x86_get_dispatch;
+#if defined(USE_X86_ASM) &amp;&amp; defined(GLX_USE_TLS) &amp;&amp; !defined(GLX_X86_READONLY_TEXT)
+    extern unsigned long _x86_get_dispatch(void);
+    char run_time_patch[] = {
+       0x65, 0xa1, 0, 0, 0, 0 /* movl %gs:0,%eax */
+    };
+    GLuint *offset = (GLuint *) &amp;run_time_patch[2]; /* 32-bits for x86/32 */
+    const GLubyte * const get_disp = (const GLubyte *) run_time_patch;
     GLubyte * curr_func = (GLubyte *) gl_dispatch_functions_start;
 
-
+    *offset = _x86_get_dispatch();
     while ( curr_func != (GLubyte *) gl_dispatch_functions_end ) {
-	(void) memcpy( curr_func, get_disp, 6 );
+	(void) memcpy( curr_func, get_disp, sizeof(run_time_patch));
 	curr_func += DISPATCH_FUNCTION_SIZE;
     }
-#endif /* defined( USE_X86_ASM ) &amp;&amp; defined( GLX_USE_TLS ) */
+#endif
 }
-#endif
+#endif /* defined(PTHREADS) || defined(GLX_USE_TLS) */

Modified: haiku/trunk/src/kits/opengl/mesa/main/attrib.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/attrib.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/attrib.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -764,6 +764,7 @@
          _mesa_TexParameteri(target, GL_TEXTURE_MAG_FILTER, obj-&gt;MagFilter);
          _mesa_TexParameterf(target, GL_TEXTURE_MIN_LOD, obj-&gt;MinLod);
          _mesa_TexParameterf(target, GL_TEXTURE_MAX_LOD, obj-&gt;MaxLod);
+         _mesa_TexParameterf(target, GL_TEXTURE_LOD_BIAS, obj-&gt;LodBias);
          _mesa_TexParameteri(target, GL_TEXTURE_BASE_LEVEL, obj-&gt;BaseLevel);
          if (target != GL_TEXTURE_RECTANGLE_ARB)
             _mesa_TexParameteri(target, GL_TEXTURE_MAX_LEVEL, obj-&gt;MaxLevel);

Modified: haiku/trunk/src/kits/opengl/mesa/main/config.h
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/config.h	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/config.h	2007-07-15 22:28:49 UTC (rev 21622)
@@ -5,9 +5,9 @@
 
 /*
  * Mesa 3-D graphics library
- * Version:  6.5.2
+ * Version:  7.0
  *
- * Copyright (C) 1999-2006  Brian Paul   All Rights Reserved.
+ * Copyright (C) 1999-2007  Brian Paul   All Rights Reserved.
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the &quot;Software&quot;),
@@ -240,10 +240,7 @@
 
 
 /**
- * Bits per depth buffer value.  
- *
- * Any reasonable value up to 31 will work.  32 doesn't work because of integer
- * overflow problems in the rasterizer code.
+ * Bits per depth buffer value (max is 32).
  */
 #ifndef DEFAULT_SOFTWARE_DEPTH_BITS
 #define DEFAULT_SOFTWARE_DEPTH_BITS 16

Modified: haiku/trunk/src/kits/opengl/mesa/main/context.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/context.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/context.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -6,9 +6,9 @@
 
 /*
  * Mesa 3-D graphics library
- * Version:  6.5
+ * Version:  7.0
  *
- * Copyright (C) 1999-2006  Brian Paul   All Rights Reserved.
+ * Copyright (C) 1999-2007  Brian Paul   All Rights Reserved.
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the &quot;Software&quot;),
@@ -1382,8 +1382,11 @@
       return GL_FALSE;
    if (ctxvis-&gt;blueMask &amp;&amp; ctxvis-&gt;blueMask != bufvis-&gt;blueMask)
       return GL_FALSE;
+#if 0
+   /* disabled (see bug 11161) */
    if (ctxvis-&gt;depthBits &amp;&amp; ctxvis-&gt;depthBits != bufvis-&gt;depthBits)
       return GL_FALSE;
+#endif
    if (ctxvis-&gt;stencilBits &amp;&amp; ctxvis-&gt;stencilBits != bufvis-&gt;stencilBits)
       return GL_FALSE;
 

Modified: haiku/trunk/src/kits/opengl/mesa/main/enable.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/enable.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/enable.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -190,7 +190,26 @@
    }
 
 
+/**
+ * Helper function to enable or disable a texture target.
+ */
+static GLboolean
+enable_texture(GLcontext *ctx, GLboolean state, GLbitfield bit)
+{
+   const GLuint curr = ctx-&gt;Texture.CurrentUnit;
+   struct gl_texture_unit *texUnit = &amp;ctx-&gt;Texture.Unit[curr];
+   const GLuint newenabled = (!state)
+       ? (texUnit-&gt;Enabled &amp; ~bit) :  (texUnit-&gt;Enabled | bit);
 
+   if (!ctx-&gt;DrawBuffer-&gt;Visual.rgbMode || texUnit-&gt;Enabled == newenabled)
+       return GL_FALSE;
+
+   FLUSH_VERTICES(ctx, _NEW_TEXTURE);
+   texUnit-&gt;Enabled = newenabled;
+   return GL_TRUE;
+}
+
+
 /**
  * Helper function to enable or disable state.
  *
@@ -558,45 +577,21 @@
          FLUSH_VERTICES(ctx, _NEW_STENCIL);
          ctx-&gt;Stencil.Enabled = state;
          break;
-      case GL_TEXTURE_1D: {
-         const GLuint curr = ctx-&gt;Texture.CurrentUnit;
-         struct gl_texture_unit *texUnit = &amp;ctx-&gt;Texture.Unit[curr];
-         GLuint newenabled = texUnit-&gt;Enabled &amp; ~TEXTURE_1D_BIT;
-         if (state)
-            newenabled |= TEXTURE_1D_BIT;
-         if (!ctx-&gt;DrawBuffer-&gt;Visual.rgbMode
-             || texUnit-&gt;Enabled == newenabled)
+      case GL_TEXTURE_1D:
+         if (!enable_texture(ctx, state, TEXTURE_1D_BIT)) {
             return;
-         FLUSH_VERTICES(ctx, _NEW_TEXTURE);
-         texUnit-&gt;Enabled = newenabled;
+         }
          break;
-      }
-      case GL_TEXTURE_2D: {
-         const GLuint curr = ctx-&gt;Texture.CurrentUnit;
-         struct gl_texture_unit *texUnit = &amp;ctx-&gt;Texture.Unit[curr];
-         GLuint newenabled = texUnit-&gt;Enabled &amp; ~TEXTURE_2D_BIT;
-         if (state)
-            newenabled |= TEXTURE_2D_BIT;
-         if (!ctx-&gt;DrawBuffer-&gt;Visual.rgbMode
-             || texUnit-&gt;Enabled == newenabled)
+      case GL_TEXTURE_2D:
+         if (!enable_texture(ctx, state, TEXTURE_2D_BIT)) {
             return;
-         FLUSH_VERTICES(ctx, _NEW_TEXTURE);
-         texUnit-&gt;Enabled = newenabled;
+         }
          break;
-      }
-      case GL_TEXTURE_3D: {
-         const GLuint curr = ctx-&gt;Texture.CurrentUnit;
-         struct gl_texture_unit *texUnit = &amp;ctx-&gt;Texture.Unit[curr];
-         GLuint newenabled = texUnit-&gt;Enabled &amp; ~TEXTURE_3D_BIT;
-         if (state)
-            newenabled |= TEXTURE_3D_BIT;
-         if (!ctx-&gt;DrawBuffer-&gt;Visual.rgbMode
-             || texUnit-&gt;Enabled == newenabled)
+      case GL_TEXTURE_3D:
+         if (!enable_texture(ctx, state, TEXTURE_3D_BIT)) {
             return;
-         FLUSH_VERTICES(ctx, _NEW_TEXTURE);
-         texUnit-&gt;Enabled = newenabled;
+         }
          break;
-      }
       case GL_TEXTURE_GEN_Q: {
          GLuint unit = ctx-&gt;Texture.CurrentUnit;
          struct gl_texture_unit *texUnit = &amp;ctx-&gt;Texture.Unit[unit];
@@ -715,18 +710,9 @@
 
       /* GL_ARB_texture_cube_map */
       case GL_TEXTURE_CUBE_MAP_ARB:
-         {
-            const GLuint curr = ctx-&gt;Texture.CurrentUnit;
-            struct gl_texture_unit *texUnit = &amp;ctx-&gt;Texture.Unit[curr];
-            GLuint newenabled = texUnit-&gt;Enabled &amp; ~TEXTURE_CUBE_BIT;
-            CHECK_EXTENSION(ARB_texture_cube_map, cap);
-            if (state)
-               newenabled |= TEXTURE_CUBE_BIT;
-            if (!ctx-&gt;DrawBuffer-&gt;Visual.rgbMode
-                || texUnit-&gt;Enabled == newenabled)
-               return;
-            FLUSH_VERTICES(ctx, _NEW_TEXTURE);
-            texUnit-&gt;Enabled = newenabled;
+         CHECK_EXTENSION(ARB_texture_cube_map, cap);
+         if (!enable_texture(ctx, state, TEXTURE_CUBE_BIT)) {
+            return;
          }
          break;
 
@@ -879,18 +865,8 @@
       /* GL_NV_texture_rectangle */
       case GL_TEXTURE_RECTANGLE_NV:
          CHECK_EXTENSION(NV_texture_rectangle, cap);
-         {
-            const GLuint curr = ctx-&gt;Texture.CurrentUnit;
-            struct gl_texture_unit *texUnit = &amp;ctx-&gt;Texture.Unit[curr];
-            GLuint newenabled = texUnit-&gt;Enabled &amp; ~TEXTURE_RECT_BIT;
-            CHECK_EXTENSION(NV_texture_rectangle, cap);
-            if (state)
-               newenabled |= TEXTURE_RECT_BIT;
-            if (!ctx-&gt;DrawBuffer-&gt;Visual.rgbMode
-                || texUnit-&gt;Enabled == newenabled)
-               return;
-            FLUSH_VERTICES(ctx, _NEW_TEXTURE);
-            texUnit-&gt;Enabled = newenabled;
+         if (!enable_texture(ctx, state, TEXTURE_RECT_BIT)) {
+            return;
          }
          break;
 
@@ -1002,6 +978,18 @@
 
 
 /**
+ * Helper function to determine whether a texture target is enabled.
+ */
+static GLboolean
+is_texture_enabled(GLcontext *ctx, GLbitfield bit)
+{
+   const struct gl_texture_unit *const texUnit =
+       &amp;ctx-&gt;Texture.Unit[ctx-&gt;Texture.CurrentUnit];
+   return (texUnit-&gt;Enabled &amp; bit) ? GL_TRUE : GL_FALSE;
+}
+
+
+/**
  * Return simple enable/disable state.
  *
  * \param cap  state variable to query.
@@ -1117,23 +1105,11 @@
       case GL_STENCIL_TEST:
 	 return ctx-&gt;Stencil.Enabled;
       case GL_TEXTURE_1D:
-         {
-            const struct gl_texture_unit *texUnit;
-            texUnit = &amp;ctx-&gt;Texture.Unit[ctx-&gt;Texture.CurrentUnit];
-            return (texUnit-&gt;Enabled &amp; TEXTURE_1D_BIT) ? GL_TRUE : GL_FALSE;
-         }
+         return is_texture_enabled(ctx, TEXTURE_1D_BIT);
       case GL_TEXTURE_2D:
-         {
-            const struct gl_texture_unit *texUnit;
-            texUnit = &amp;ctx-&gt;Texture.Unit[ctx-&gt;Texture.CurrentUnit];
-            return (texUnit-&gt;Enabled &amp; TEXTURE_2D_BIT) ? GL_TRUE : GL_FALSE;
-         }
+         return is_texture_enabled(ctx, TEXTURE_2D_BIT);
       case GL_TEXTURE_3D:
-         {
-            const struct gl_texture_unit *texUnit;
-            texUnit = &amp;ctx-&gt;Texture.Unit[ctx-&gt;Texture.CurrentUnit];
-            return (texUnit-&gt;Enabled &amp; TEXTURE_3D_BIT) ? GL_TRUE : GL_FALSE;
-         }
+         return is_texture_enabled(ctx, TEXTURE_3D_BIT);
       case GL_TEXTURE_GEN_Q:
          {
             const struct gl_texture_unit *texUnit;
@@ -1219,11 +1195,7 @@
       /* GL_ARB_texture_cube_map */
       case GL_TEXTURE_CUBE_MAP_ARB:
          CHECK_EXTENSION(ARB_texture_cube_map);
-         {
-            const struct gl_texture_unit *texUnit;
-            texUnit = &amp;ctx-&gt;Texture.Unit[ctx-&gt;Texture.CurrentUnit];
-            return (texUnit-&gt;Enabled &amp; TEXTURE_CUBE_BIT) ? GL_TRUE : GL_FALSE;
-         }
+         return is_texture_enabled(ctx, TEXTURE_CUBE_BIT);
 
       /* GL_EXT_secondary_color */
       case GL_COLOR_SUM_EXT:
@@ -1343,11 +1315,7 @@
       /* GL_NV_texture_rectangle */
       case GL_TEXTURE_RECTANGLE_NV:
          CHECK_EXTENSION(NV_texture_rectangle);
-         {
-            const struct gl_texture_unit *texUnit;
-            texUnit = &amp;ctx-&gt;Texture.Unit[ctx-&gt;Texture.CurrentUnit];
-            return (texUnit-&gt;Enabled &amp; TEXTURE_RECT_BIT) ? GL_TRUE : GL_FALSE;
-         }
+         return is_texture_enabled(ctx, TEXTURE_RECT_BIT);
 
       /* GL_EXT_stencil_two_side */
       case GL_STENCIL_TEST_TWO_SIDE_EXT:

Modified: haiku/trunk/src/kits/opengl/mesa/main/fbobject.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/fbobject.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/fbobject.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -1144,20 +1144,19 @@
  * Common code called by glFramebufferTexture1D/2D/3DEXT().
  */
 static void
-framebuffer_texture(GLuint dims, GLenum target, GLenum attachment,
-                    GLenum textarget, GLuint texture,
+framebuffer_texture(GLcontext *ctx, const char *caller, GLenum target, 
+                    GLenum attachment, GLenum textarget, GLuint texture,
                     GLint level, GLint zoffset)
 {
    struct gl_renderbuffer_attachment *att;
    struct gl_texture_object *texObj = NULL;
    struct gl_framebuffer *fb;
-   GET_CURRENT_CONTEXT(ctx);
 
    ASSERT_OUTSIDE_BEGIN_END(ctx);
 
    if (target != GL_FRAMEBUFFER_EXT) {
       _mesa_error(ctx, GL_INVALID_ENUM,
-                  &quot;glFramebufferTexture%dDEXT(target)&quot;, dims);
+                  &quot;glFramebufferTexture%sEXT(target)&quot;, caller);
       return;
    }
 
@@ -1167,83 +1166,53 @@
    /* check framebuffer binding */
    if (fb-&gt;Name == 0) {
       _mesa_error(ctx, GL_INVALID_OPERATION,
-                  &quot;glFramebufferTexture%dDEXT&quot;, dims);
+                  &quot;glFramebufferTexture%sEXT&quot;, caller);
       return;
    }
 
+
+   /* The textarget, level, and zoffset parameters are only validated if
+    * texture is non-zero.
+    */
    if (texture) {
-      texObj = _mesa_lookup_texture(ctx, texture);
-   }
+      GLboolean err = GL_TRUE;
 
-   /* Check dimension-dependent things */
-   switch (dims) {
-   case 1:
-      if (textarget != GL_TEXTURE_1D) {
-         _mesa_error(ctx, GL_INVALID_ENUM,
-                     &quot;glFramebufferTexture1DEXT(textarget)&quot;);
-         return;
+      texObj = _mesa_lookup_texture(ctx, texture);
+      if (texObj != NULL) {
+         err = (texObj-&gt;Target == GL_TEXTURE_CUBE_MAP)
+             ? !IS_CUBE_FACE(textarget)
+             : (texObj-&gt;Target != textarget);
       }
-      if (texObj &amp;&amp; texObj-&gt;Target != GL_TEXTURE_1D) {
+
+      if (err) {
          _mesa_error(ctx, GL_INVALID_OPERATION,
-                     &quot;glFramebufferTexture1DEXT(texture target mismatch)&quot;);
+                     &quot;glFramebufferTexture%sEXT(texture target mismatch)&quot;,
+                     caller);
          return;
       }
-      break;
-   case 2:
-      if (textarget != GL_TEXTURE_2D &amp;&amp;
-          textarget != GL_TEXTURE_RECTANGLE_ARB &amp;&amp;
-          !IS_CUBE_FACE(textarget)) {
-         _mesa_error(ctx, GL_INVALID_ENUM,
-                     &quot;glFramebufferTexture2DEXT(textarget)&quot;);
-         return;
-      }
-      if (texObj) {
-         if ((texObj-&gt;Target == GL_TEXTURE_2D &amp;&amp; textarget != GL_TEXTURE_2D) ||
-             (texObj-&gt;Target == GL_TEXTURE_RECTANGLE_ARB
-              &amp;&amp; textarget != GL_TEXTURE_RECTANGLE_ARB) ||
-             (texObj-&gt;Target == GL_TEXTURE_CUBE_MAP
-              &amp;&amp; !IS_CUBE_FACE(textarget))) {
-            _mesa_error(ctx, GL_INVALID_OPERATION,
-                        &quot;glFramebufferTexture1DEXT(texture target mismatch)&quot;);
-            return;
-         }
-      }
-      break;
-   case 3:
-      if (textarget != GL_TEXTURE_3D) {
-         _mesa_error(ctx, GL_INVALID_ENUM,
-                     &quot;glFramebufferTexture3DEXT(textarget)&quot;);
-         return;
-      }
-      if (texObj &amp;&amp; texObj-&gt;Target != GL_TEXTURE_3D) {
-         _mesa_error(ctx, GL_INVALID_OPERATION,
-                     &quot;glFramebufferTexture3DEXT(texture target mismatch)&quot;);
-         return;
-      }
-      {
+
+      if (texObj-&gt;Target == GL_TEXTURE_3D) {
          const GLint maxSize = 1 &lt;&lt; (ctx-&gt;Const.Max3DTextureLevels - 1);
          if (zoffset &lt; 0 || zoffset &gt;= maxSize) {
             _mesa_error(ctx, GL_INVALID_VALUE,
-                        &quot;glFramebufferTexture3DEXT(zoffset)&quot;);
+                        &quot;glFramebufferTexture%sEXT(zoffset)&quot;, 
+                        caller);
             return;
          }
       }
-      break;
-   default:
-      _mesa_problem(ctx, &quot;Unexpected dims in error_check_framebuffer_texture&quot;);
-      return;
-   }
 
-   if ((level &lt; 0) || level &gt;= _mesa_max_texture_levels(ctx, textarget)) {
-      _mesa_error(ctx, GL_INVALID_VALUE,
-                  &quot;glFramebufferTexture%dDEXT(level)&quot;, dims);
-      return;
+      if ((level &lt; 0) || 
+          (level &gt;= _mesa_max_texture_levels(ctx, texObj-&gt;Target))) {
+         _mesa_error(ctx, GL_INVALID_VALUE,
+                     &quot;glFramebufferTexture%sEXT(level)&quot;, caller);
+         return;
+      }
    }
 
    att = _mesa_get_attachment(ctx, fb, attachment);
    if (att == NULL) {
       _mesa_error(ctx, GL_INVALID_ENUM,
-		  &quot;glFramebufferTexture%dDEXT(attachment)&quot;, dims);
+                  &quot;glFramebufferTexture%sEXT(attachment)&quot;, caller);
       return;
    }
 
@@ -1271,9 +1240,16 @@
 _mesa_FramebufferTexture1DEXT(GLenum target, GLenum attachment,
                               GLenum textarget, GLuint texture, GLint level)
 {
-   const GLint zoffset = 0;
-   framebuffer_texture(1, target, attachment, textarget, texture,
-                       level, zoffset);
+   GET_CURRENT_CONTEXT(ctx);
+
+   if ((texture != 0) &amp;&amp; (textarget != GL_TEXTURE_1D)) {
+      _mesa_error(ctx, GL_INVALID_ENUM,
+                  &quot;glFramebufferTexture1DEXT(textarget)&quot;);
+      return;
+   }
+
+   framebuffer_texture(ctx, &quot;1D&quot;, target, attachment, textarget, texture,
+                       level, 0);
 }
 
 
@@ -1281,9 +1257,19 @@
 _mesa_FramebufferTexture2DEXT(GLenum target, GLenum attachment,
                               GLenum textarget, GLuint texture, GLint level)
 {
-   const GLint zoffset = 0;
-   framebuffer_texture(2, target, attachment, textarget, texture,
-                       level, zoffset);
+   GET_CURRENT_CONTEXT(ctx);
+
+   if ((texture != 0) &amp;&amp;
+       (textarget != GL_TEXTURE_2D) &amp;&amp;
+       (textarget != GL_TEXTURE_RECTANGLE_ARB) &amp;&amp;
+       (!IS_CUBE_FACE(textarget))) {
+      _mesa_error(ctx, GL_INVALID_OPERATION,
+                  &quot;glFramebufferTexture2DEXT(textarget)&quot;);
+      return;
+   }
+
+   framebuffer_texture(ctx, &quot;2D&quot;, target, attachment, textarget, texture,
+                       level, 0);
 }
 
 
@@ -1292,12 +1278,19 @@
                               GLenum textarget, GLuint texture,
                               GLint level, GLint zoffset)
 {
-   framebuffer_texture(3, target, attachment, textarget, texture,
+   GET_CURRENT_CONTEXT(ctx);
+
+   if ((texture != 0) &amp;&amp; (textarget != GL_TEXTURE_3D)) {
+      _mesa_error(ctx, GL_INVALID_ENUM,
+                  &quot;glFramebufferTexture3DEXT(textarget)&quot;);
+      return;
+   }
+
+   framebuffer_texture(ctx, &quot;3D&quot;, target, attachment, textarget, texture,
                        level, zoffset);
 }
 
 
-
 void GLAPIENTRY
 _mesa_FramebufferRenderbufferEXT(GLenum target, GLenum attachment,
                                  GLenum renderbufferTarget,

Modified: haiku/trunk/src/kits/opengl/mesa/main/image.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/image.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/image.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -1,6 +1,6 @@
 /*
  * Mesa 3-D graphics library
- * Version:  6.5.3
+ * Version:  7.0
  *
  * Copyright (C) 1999-2007  Brian Paul   All Rights Reserved.
  *
@@ -64,27 +64,27 @@
  */
 static GLboolean
 _mesa_type_is_packed(GLenum type)
-    {
-        switch (type) {
-            case GL_UNSIGNED_BYTE_3_3_2:
-            case GL_UNSIGNED_BYTE_2_3_3_REV:
-            case GL_UNSIGNED_SHORT_5_6_5:
-            case GL_UNSIGNED_SHORT_5_6_5_REV:
-            case GL_UNSIGNED_SHORT_4_4_4_4:
-            case GL_UNSIGNED_SHORT_4_4_4_4_REV:
-            case GL_UNSIGNED_SHORT_5_5_5_1:
-            case GL_UNSIGNED_SHORT_1_5_5_5_REV:
-            case GL_UNSIGNED_INT_8_8_8_8:
-            case GL_UNSIGNED_INT_8_8_8_8_REV:
-            case GL_UNSIGNED_INT_10_10_10_2:
-            case GL_UNSIGNED_INT_2_10_10_10_REV:
-            case GL_UNSIGNED_SHORT_8_8_MESA:
-            case GL_UNSIGNED_SHORT_8_8_REV_MESA:
-            case GL_UNSIGNED_INT_24_8_EXT:
-                return GL_TRUE;
-         }
+{
+   switch (type) {
+   case GL_UNSIGNED_BYTE_3_3_2:
+   case GL_UNSIGNED_BYTE_2_3_3_REV:
+   case GL_UNSIGNED_SHORT_5_6_5:
+   case GL_UNSIGNED_SHORT_5_6_5_REV:
+   case GL_UNSIGNED_SHORT_4_4_4_4:
+   case GL_UNSIGNED_SHORT_4_4_4_4_REV:
+   case GL_UNSIGNED_SHORT_5_5_5_1:
+   case GL_UNSIGNED_SHORT_1_5_5_5_REV:
+   case GL_UNSIGNED_INT_8_8_8_8:
+   case GL_UNSIGNED_INT_8_8_8_8_REV:
+   case GL_UNSIGNED_INT_10_10_10_2:
+   case GL_UNSIGNED_INT_2_10_10_10_REV:
+   case GL_UNSIGNED_SHORT_8_8_MESA:
+   case GL_UNSIGNED_SHORT_8_8_REV_MESA:
+   case GL_UNSIGNED_INT_24_8_EXT:
+      return GL_TRUE;
+   }
 
-        return GL_FALSE;
+   return GL_FALSE;
 }
 
 /**
@@ -103,9 +103,8 @@
 static void
 flip_bytes( GLubyte *p, GLuint n )
 {
-   register GLuint i, a, b;
-
-   for (i=0;i&lt;n;i++) {
+   GLuint i, a, b;
+   for (i = 0; i &lt; n; i++) {
       b = (GLuint) p[i];        /* words are often faster than bytes */
       a = ((b &amp; 0x01) &lt;&lt; 7) |
 	  ((b &amp; 0x02) &lt;&lt; 5) |
@@ -129,9 +128,8 @@
 void
 _mesa_swap2( GLushort *p, GLuint n )
 {
-   register GLuint i;
-
-   for (i=0;i&lt;n;i++) {
+   GLuint i;
+   for (i = 0; i &lt; n; i++) {
       p[i] = (p[i] &gt;&gt; 8) | ((p[i] &lt;&lt; 8) &amp; 0xff00);
    }
 }
@@ -144,9 +142,8 @@
 void
 _mesa_swap4( GLuint *p, GLuint n )
 {
-   register GLuint i, a, b;
-
-   for (i=0;i&lt;n;i++) {
+   GLuint i, a, b;
+   for (i = 0; i &lt; n; i++) {
       b = p[i];
       a =  (b &gt;&gt; 24)
 	| ((b &gt;&gt; 8) &amp; 0xff00)
@@ -4263,60 +4260,68 @@
             const GLvoid *src = _mesa_image_address(dimensions, unpack, pixels,
                                width, height, format, type, img, row, 0);
 
-                if ((type == GL_BITMAP) &amp;&amp; (unpack-&gt;SkipPixels &amp; 0x7)) {
-                    GLint i;
-                    flipBytes = GL_FALSE;
-                    if (unpack-&gt;LsbFirst) {
-                            GLubyte srcMask = 1 &lt;&lt; (unpack-&gt;SkipPixels &amp; 0x7);
-                            GLubyte dstMask = 128;
-                            const GLubyte *s = src;
-                            GLubyte *d = dst;
-                            *d = 0;
-                            for (i = 0; i &lt; width; i++) {
-                                if (*s &amp; srcMask) {
-                                    *d |= dstMask;
-                                }      
-                                if (srcMask == 128) {
-                                    srcMask = 1;
-                                    s++;
-                                } else {
-                                    srcMask = srcMask &lt;&lt; 1;
-                                }
-                                if (dstMask == 1) {
-                                    dstMask = 128;
-                                    d++;
-                                    *d = 0;
-                                } else {
-                                    dstMask = dstMask &gt;&gt; 1;
-                                }
-                            }
-                    } else {
-                        GLubyte srcMask = 128 &gt;&gt; (unpack-&gt;SkipPixels &amp; 0x7);
-                        GLubyte dstMask = 128;
-                        const GLubyte *s = src;
-                        GLubyte *d = dst;
+            if ((type == GL_BITMAP) &amp;&amp; (unpack-&gt;SkipPixels &amp; 0x7)) {
+               GLint i;
+               flipBytes = GL_FALSE;
+               if (unpack-&gt;LsbFirst) {
+                  GLubyte srcMask = 1 &lt;&lt; (unpack-&gt;SkipPixels &amp; 0x7);
+                  GLubyte dstMask = 128;
+                  const GLubyte *s = src;
+                  GLubyte *d = dst;
+                  *d = 0;
+                  for (i = 0; i &lt; width; i++) {
+                     if (*s &amp; srcMask) {
+                        *d |= dstMask;
+                     }      
+                     if (srcMask == 128) {
+                        srcMask = 1;
+                        s++;
+                     }
+                     else {
+                        srcMask = srcMask &lt;&lt; 1;
+                     }
+                     if (dstMask == 1) {
+                        dstMask = 128;
+                        d++;
                         *d = 0;
-                        for (i = 0; i &lt; width; i++) {
-                            if (*s &amp; srcMask) {
-                                *d |= dstMask;
-                            }
-                            if (srcMask == 1) {
-                                srcMask = 128;
-                                s++;
-                            } else {
-                                srcMask = srcMask &gt;&gt; 1;
-                            }
-                            if (dstMask == 1) {
-                                dstMask = 128;
-                                d++;
-                                *d = 0;
-                            } else {
-                                dstMask = dstMask &gt;&gt; 1;
-                            }      
-                        }
-                    }
-                } else
-                    _mesa_memcpy(dst, src, bytesPerRow);
+                     }
+                     else {
+                        dstMask = dstMask &gt;&gt; 1;
+                     }
+                  }
+               }
+               else {
+                  GLubyte srcMask = 128 &gt;&gt; (unpack-&gt;SkipPixels &amp; 0x7);
+                  GLubyte dstMask = 128;
+                  const GLubyte *s = src;
+                  GLubyte *d = dst;
+                  *d = 0;
+                  for (i = 0; i &lt; width; i++) {
+                     if (*s &amp; srcMask) {
+                        *d |= dstMask;
+                     }
+                     if (srcMask == 1) {
+                        srcMask = 128;
+                        s++;
+                     }
+                     else {
+                        srcMask = srcMask &gt;&gt; 1;
+                     }
+                     if (dstMask == 1) {
+                        dstMask = 128;
+                        d++;
+                        *d = 0;
+                     }
+                     else {
+                        dstMask = dstMask &gt;&gt; 1;
+                     }      
+                  }
+               }
+            }
+            else {
+               _mesa_memcpy(dst, src, bytesPerRow);
+            }
+
             /* byte flipping/swapping */
             if (flipBytes) {
                flip_bytes((GLubyte *) dst, bytesPerRow);

Modified: haiku/trunk/src/kits/opengl/mesa/main/imports.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/imports.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/imports.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -20,9 +20,9 @@
 
 /*
  * Mesa 3-D graphics library
- * Version:  6.5
+ * Version:  7.0
  *
- * Copyright (C) 1999-2006  Brian Paul   All Rights Reserved.
+ * Copyright (C) 1999-2007  Brian Paul   All Rights Reserved.
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the &quot;Software&quot;),
@@ -921,14 +921,11 @@
 /*@{*/
 
 /**
- * Display a warning.
+ * Report a warning (a recoverable error condition) to stderr if
+ * either DEBUG is defined or the MESA_DEBUG env var is set.
  *
  * \param ctx GL context.
  * \param fmtString printf() alike format string.
- * 
- * If debugging is enabled (either at compile-time via the DEBUG macro, or
- * run-time via the MESA_DEBUG environment variable), prints the warning to
- * stderr via fprintf().
  */
 void
 _mesa_warning( GLcontext *ctx, const char *fmtString, ... )
@@ -951,13 +948,11 @@
 }
 
 /**
- * This function is called when the Mesa user has stumbled into a code
- * path which may not be implemented fully or correctly.
+ * Report an internla implementation problem.
+ * Prints the message to stderr via fprintf().
  *
  * \param ctx GL context.
  * \param s problem description string.
- *
- * Prints the message to stderr via fprintf().
  */
 void
 _mesa_problem( const GLcontext *ctx, const char *fmtString, ... )
@@ -975,18 +970,16 @@
 }
 
 /**
- * Display an error message.
+ * Record an OpenGL state error.  These usually occur when the users
+ * passes invalid parameters to a GL function.
  *
- * If in debug mode, print error message.
- * Also, record the error code by calling _mesa_record_error().
+ * If debugging is enabled (either at compile-time via the DEBUG macro, or
+ * run-time via the MESA_DEBUG environment variable), report the error with
+ * _mesa_debug().
  * 
  * \param ctx the GL context.
  * \param error the error value.
  * \param fmtString printf() style format string, followed by optional args
- *         
- * If debugging is enabled (either at compile-time via the DEBUG macro, or
- * run-time via the MESA_DEBUG environment variable), interperts the error code and 
- * prints the error message via _mesa_debug().
  */
 void
 _mesa_error( GLcontext *ctx, GLenum error, const char *fmtString, ... )
@@ -1056,12 +1049,11 @@
 }  
 
 /**
- * Report debug information.
+ * Report debug information.  Print error message to stderr via fprintf().
+ * No-op if DEBUG mode not enabled.
  * 
  * \param ctx GL context.
- * \param fmtString printf() alike format string.
- * 
- * Prints the message to stderr via fprintf().
+ * \param fmtString printf()-style format string, followed by optional args.
  */
 void
 _mesa_debug( const GLcontext *ctx, const char *fmtString, ... )

Modified: haiku/trunk/src/kits/opengl/mesa/main/light.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/light.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/light.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -1,8 +1,8 @@
 /*
  * Mesa 3-D graphics library
- * Version:  6.5.3
+ * Version:  7.0
  *
- * Copyright (C) 1999-2005  Brian Paul   All Rights Reserved.
+ * Copyright (C) 1999-2007  Brian Paul   All Rights Reserved.
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the &quot;Software&quot;),
@@ -1117,6 +1117,13 @@
 	 }
 	 light-&gt;_VP_inf_spot_attenuation = 1.0;
       }
+      else {
+         /* positional light w/ homogeneous coordinate, divide by W */
+         GLfloat wInv = 1.0 / light-&gt;_Position[3];
+         light-&gt;_Position[0] *= wInv;
+         light-&gt;_Position[1] *= wInv;
+         light-&gt;_Position[2] *= wInv;
+      }
 
       if (light-&gt;_Flags &amp; LIGHT_SPOT) {
 	 if (ctx-&gt;_NeedEyeCoords) {

Modified: haiku/trunk/src/kits/opengl/mesa/main/points.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/points.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/points.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -5,9 +5,9 @@
 
 /*
  * Mesa 3-D graphics library
- * Version:  6.5.1
+ * Version:  7.0
  *
- * Copyright (C) 1999-2006  Brian Paul   All Rights Reserved.
+ * Copyright (C) 1999-2007  Brian Paul   All Rights Reserved.
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the &quot;Software&quot;),
@@ -61,10 +61,6 @@
 			    ctx-&gt;Point.MinSize,
 			    ctx-&gt;Point.MaxSize);
 
-   ctx-&gt;Point._Attenuated = (ctx-&gt;Point.Params[0] != 1.0 ||
-                             ctx-&gt;Point.Params[1] != 0.0 ||
-                             ctx-&gt;Point.Params[2] != 0.0);
-
    if (ctx-&gt;Driver.PointSize)
       ctx-&gt;Driver.PointSize(ctx, size);
 }
@@ -122,6 +118,9 @@
 	       return;
 	    FLUSH_VERTICES(ctx, _NEW_POINT);
             COPY_3V(ctx-&gt;Point.Params, params);
+            ctx-&gt;Point._Attenuated = (ctx-&gt;Point.Params[0] != 1.0 ||
+                                      ctx-&gt;Point.Params[1] != 0.0 ||
+                                      ctx-&gt;Point.Params[2] != 0.0);
          }
          else {
             _mesa_error(ctx, GL_INVALID_ENUM,

Modified: haiku/trunk/src/kits/opengl/mesa/main/teximage.c
===================================================================
--- haiku/trunk/src/kits/opengl/mesa/main/teximage.c	2007-07-15 22:14:06 UTC (rev 21621)
+++ haiku/trunk/src/kits/opengl/mesa/main/teximage.c	2007-07-15 22:28:49 UTC (rev 21622)
@@ -1300,6 +1300,20 @@
 
 
 /**
+ * Helper function to determine whether a target supports compressed textures
+ */
+static GLboolean
+target_can_be_compressed(GLcontext *ctx, GLenum target)
+{
+   return (((target == GL_TEXTURE_2D || target == GL_PROXY_TEXTURE_2D))
+           || ((ctx-&gt;Extensions.ARB_texture_cube_map &amp;&amp;
+                (target == GL_PROXY_TEXTURE_CUBE_MAP ||
+                 (target &gt;= GL_TEXTURE_CUBE_MAP_POSITIVE_X &amp;&amp;
+                  target &lt;= GL_TEXTURE_CUBE_MAP_NEGATIVE_Z)))));
+}
+
+
+/**
  * Test the glTexImage[123]D() parameters for errors.
  * 
  * \param ctx GL context.
@@ -1329,8 +1343,9 @@
                      GLint depth, GLint border )
 {
    const GLboolean isProxy = _mesa_is_proxy_texture(target);
-   GLboolean sizeOK;
+   GLboolean sizeOK = GL_TRUE;
    GLboolean colorFormat, indexFormat;
+   GLenum proxy_target;
 
    /* Basic level check (more checking in ctx-&gt;Driver.TestProxyTexImage) */
    if (level &lt; 0 || level &gt;= MAX_TEXTURE_LEVELS) {
@@ -1365,10 +1380,9 @@
     */
    if (dimensions == 1) {
       if (target == GL_PROXY_TEXTURE_1D || target == GL_TEXTURE_1D) {
-         sizeOK = ctx-&gt;Driver.TestProxyTexImage(ctx, GL_PROXY_TEXTURE_1D,
-                                                level, internalFormat,
-                                                format, type,
-                                                width, 1, 1, border);
+         proxy_target = GL_PROXY_TEXTURE_1D;
+         height = 1;
+         width = 1;
       }
       else {
          _mesa_error( ctx, GL_INVALID_ENUM, &quot;glTexImage1D(target)&quot; );
@@ -1376,11 +1390,9 @@
       }
    }
    else if (dimensions == 2) {
+      depth = 1;
       if (target == GL_PROXY_TEXTURE_2D || target == GL_TEXTURE_2D) {
-         sizeOK = ctx-&gt;Driver.TestProxyTexImage(ctx, GL_PROXY_TEXTURE_2D,
-                                                level, internalFormat,
-                                                format, type,
-                                                width, height, 1, border);
+         proxy_target = GL_PROXY_TEXTURE_2D;
       }
       else if (target == GL_PROXY_TEXTURE_CUBE_MAP_ARB ||
                (target &gt;= GL_TEXTURE_CUBE_MAP_POSITIVE_X_ARB &amp;&amp;
@@ -1389,10 +1401,8 @@
             _mesa_error(ctx, GL_INVALID_ENUM, &quot;glTexImage2D(target)&quot;);
             return GL_TRUE;
          }
-         sizeOK = (width == height) &amp;&amp;
-            ctx-&gt;Driver.TestProxyTexImage(ctx, GL_PROXY_TEXTURE_CUBE_MAP_ARB,
-                                          level, internalFormat, format, type,
-                                          width, height, 1, border);
+         proxy_target = GL_PROXY_TEXTURE_CUBE_MAP_ARB;
+         sizeOK = (width == height);
       }
       else if (target == GL_PROXY_TEXTURE_RECTANGLE_NV ||
                target == GL_TEXTURE_RECTANGLE_NV) {
@@ -1400,11 +1410,7 @@
             _mesa_error(ctx, GL_INVALID_ENUM, &quot;glTexImage2D(target)&quot;);
             return GL_TRUE;
          }
-         sizeOK = ctx-&gt;Driver.TestProxyTexImage(ctx,
-                                                GL_PROXY_TEXTURE_RECTANGLE_NV,
-                                                level, internalFormat,
-                                                format, type,
-                                                width, height, 1, border);
+         proxy_target = GL_PROXY_TEXTURE_RECTANGLE_NV;
       }
       else {
          _mesa_error(ctx, GL_INVALID_ENUM, &quot;glTexImage2D(target)&quot;);
@@ -1413,10 +1419,7 @@

[... truncated: 2994 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003062.html">[Haiku-commits] r21621 - haiku/vendor/mesa
</A></li>
	<LI>Next message: <A HREF="003064.html">[Haiku-commits] r21623 - haiku/trunk/src/system/kernel/fs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3063">[ date ]</a>
              <a href="thread.html#3063">[ thread ]</a>
              <a href="subject.html#3063">[ subject ]</a>
              <a href="author.html#3063">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
