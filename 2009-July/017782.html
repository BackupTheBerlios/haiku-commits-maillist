<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r31442 - in haiku/branches/features/32bit-wchar_t:	docs/userguide/en docs/userguide/en/applications	src/add-ons/media/plugins/ffmpeg	src/add-ons/media/plugins/ffmpeg/libavcodec	src/add-ons/media/plugins/ffmpeg/libavcodec/ppc	src/add-ons/media/plugins/ffmpeg/libavcodec/sparc	src/add-ons/media/plugins/ffmpeg/libavcodec/x86 src/bin/bash	src/bin/bash/builtins src/bin/screen_blanker
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31442%20-%20in%20haiku/branches/features/32bit-wchar_t%3A%0A%09docs/userguide/en%20docs/userguide/en/applications%0A%09src/add-ons/media/plugins/ffmpeg%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec/ppc%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec/sparc%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec/x86%20src/bin/bash%0A%09src/bin/bash/builtins%20src/bin/screen_blanker&In-Reply-To=%3C200907070957.n679vdAj000490%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017781.html">
   <LINK REL="Next"  HREF="017783.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r31442 - in haiku/branches/features/32bit-wchar_t:	docs/userguide/en docs/userguide/en/applications	src/add-ons/media/plugins/ffmpeg	src/add-ons/media/plugins/ffmpeg/libavcodec	src/add-ons/media/plugins/ffmpeg/libavcodec/ppc	src/add-ons/media/plugins/ffmpeg/libavcodec/sparc	src/add-ons/media/plugins/ffmpeg/libavcodec/x86 src/bin/bash	src/bin/bash/builtins src/bin/screen_blanker</H1>
    <B>zooey at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31442%20-%20in%20haiku/branches/features/32bit-wchar_t%3A%0A%09docs/userguide/en%20docs/userguide/en/applications%0A%09src/add-ons/media/plugins/ffmpeg%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec/ppc%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec/sparc%0A%09src/add-ons/media/plugins/ffmpeg/libavcodec/x86%20src/bin/bash%0A%09src/bin/bash/builtins%20src/bin/screen_blanker&In-Reply-To=%3C200907070957.n679vdAj000490%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r31442 - in haiku/branches/features/32bit-wchar_t:	docs/userguide/en docs/userguide/en/applications	src/add-ons/media/plugins/ffmpeg	src/add-ons/media/plugins/ffmpeg/libavcodec	src/add-ons/media/plugins/ffmpeg/libavcodec/ppc	src/add-ons/media/plugins/ffmpeg/libavcodec/sparc	src/add-ons/media/plugins/ffmpeg/libavcodec/x86 src/bin/bash	src/bin/bash/builtins src/bin/screen_blanker">zooey at mail.berlios.de
       </A><BR>
    <I>Tue Jul  7 11:57:39 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="017781.html">[Haiku-commits] r31441 - haiku/trunk/src/bin/screen_blanker
</A></li>
        <LI>Next message: <A HREF="017783.html">[Haiku-commits] r31443 - buildtools/trunk/gcc/gcc/config buildtools/trunk/gcc/gcc/config/arm buildtools/trunk/gcc/gcc/config/i386 buildtools/trunk/gcc/gcc/config/m68k buildtools/trunk/gcc/gcc/config/mips buildtools/trunk/gcc/gcc/config/rs6000 buildtools/trunk/legacy/binutils/bfd buildtools/trunk/legacy/gcc/gcc buildtools/trunk/legacy/gcc/gcc/config/i386 haiku/trunk haiku/trunk/build/jam haiku/trunk/build/scripts haiku/trunk/data/system/boot haiku/trunk/headers/glibc haiku/trunk/src/add-ons/disk_systems/bfs haiku/trunk/src/add-ons/disk_systems/intel haiku/trunk/src/add-ons/input_server/devices/keyboard haiku/trunk/src/add-ons/input_server/devices/mouse haiku/trunk/src/add-ons/input_server/devices/wacom haiku/trunk/src/add-ons/input_server/filters/screen_saver haiku/trunk/src/add-ons/input_server/methods/canna haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos haiku/trunk/src/add-ons/kernel/file_systems/use! rlandfs/server/fuse haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku haiku/trunk/src/add-ons/locale/catalogs/zeta haiku/trunk/src/add-ons/locale/collators haiku/trunk/src/add-ons/mail_daemon/inbound_filters/match_header haiku/trunk/src/add-ons/mail_daemon/inbound_filters/r5_filter haiku/trunk/src/add-ons/mail_daemon/inbound_filters/spam_filter haiku/trunk/src/add-ons/mail_daemon/inbound_protocols/imap haiku/trunk/src/add-ons/mail_daemon/inbound_protocols/pop3 haiku/trunk/src/add-ons/mail_daemon/outbound_filters/fortune haiku/trunk/src/add-ons/mail_daemon/system_filters/inbox haiku/trunk/src/add-ons/mail_daemon/system_filters/notifier haiku/trunk/src/add-ons/mail_daemon/system_filters/outbox haiku/trunk/src/add-ons/mail_daemon/system_filters/parser haiku/trunk/src/add-ons/media/media-add-ons/dvb haiku/trunk/src/add-ons/media/media-add-ons/esound_sink haiku/trunk/src/add-ons/media/media-add-ons/firewire_dv haiku/trunk/src/add-ons/media/media-add-ons/legacy ! haiku/trunk/src/add-ons/media/media-add-ons/mixer haiku/trunk/! src/add-
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17782">[ date ]</a>
              <a href="thread.html#17782">[ thread ]</a>
              <a href="subject.html#17782">[ subject ]</a>
              <a href="author.html#17782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: zooey
Date: 2009-07-07 11:57:33 +0200 (Tue, 07 Jul 2009)
New Revision: 31442
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=31442&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=31442&amp;view=rev</A>

Modified:
   haiku/branches/features/32bit-wchar_t/docs/userguide/en/applications/apps-icon-o-matic.html
   haiku/branches/features/32bit-wchar_t/docs/userguide/en/twitcher.html
   haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/AVFormatReader.cpp
   haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/Jamfile
   haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/ppc/Jamfile
   haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/sparc/Jamfile
   haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/x86/Jamfile
   haiku/branches/features/32bit-wchar_t/src/bin/bash/Jamfile
   haiku/branches/features/32bit-wchar_t/src/bin/bash/builtins/Jamfile
   haiku/branches/features/32bit-wchar_t/src/bin/screen_blanker/ScreenSaverWindow.cpp
Log:
* merging changes from trunk up to r31441

Modified: haiku/branches/features/32bit-wchar_t/docs/userguide/en/applications/apps-icon-o-matic.html
===================================================================
--- haiku/branches/features/32bit-wchar_t/docs/userguide/en/applications/apps-icon-o-matic.html	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/docs/userguide/en/applications/apps-icon-o-matic.html	2009-07-07 09:57:33 UTC (rev 31442)
@@ -244,7 +244,7 @@
 &lt;/table&gt;
 &lt;p&gt;See how there are no numbers in the 16px version of the BeVexed icon? That's done with the &quot;Level of Detail&quot; setting of their shapes.&lt;br /&gt;
 With the LOD you control the visibility of a shape depending on its size. That way, you can leave away details of an icon that looks good on a bigger icon, but maybe not so much on its smaller version.&lt;/p&gt;
-&lt;p&gt;This is how it works: A LOD of 1.0 is defined as a 64px icon size. So, to get the LOD of a particular icon size you simply divide it by 64, e.g. a 16px icon has a LOD of 16/64 = 0,25. A shape won't be visible below its &lt;span class=&quot;menu&quot;&gt;Min LOD&lt;/span&gt; and above its &lt;span class=&quot;menu&quot;&gt;Max LOD&lt;/span&gt;.&lt;/p&gt;
+&lt;p&gt;This is how it works: A LOD of 1.0 is defined as a 64px icon size. So, to get the LOD of a particular icon size you simply divide it by 64, e.g. a 16px icon has a LOD of 16/64 = 0.25. A shape won't be visible below its &lt;span class=&quot;menu&quot;&gt;Min LOD&lt;/span&gt; and above its &lt;span class=&quot;menu&quot;&gt;Max LOD&lt;/span&gt;.&lt;/p&gt;
 &lt;p&gt;So, if you set a shape's &lt;span class=&quot;menu&quot;&gt;Min LOD&lt;/span&gt; to 0.0 and the &lt;span class=&quot;menu&quot;&gt;Max LOD&lt;/span&gt; to 0.5, this means that the shape will only be visible for icon sizes smaller or &lt;i&gt;equal&lt;/i&gt; to 32px. If you wanted to exclude the 32px icon size, you'd have to stay below 0.5, say 0.49.&lt;/p&gt;
 &lt;p&gt;The LOD is not only for leaving out detailing shapes, you can also use it to e.g. change the stroke width at different sizes, if you feel that's needed. Simply duplicate a shape, make your changes and set both of their LOD settings to show either one or the other. Here lies the only source of potential confusion, when you're unwittingly overlap LODs of shapes, and wonder why at some size both are visible...&lt;br /&gt;
 For example, if Shape 1 were to be shown below 48px and Shape 2 from 48px upward (LOD: 48/64 = 0.75):&lt;/p&gt;

Modified: haiku/branches/features/32bit-wchar_t/docs/userguide/en/twitcher.html
===================================================================
--- haiku/branches/features/32bit-wchar_t/docs/userguide/en/twitcher.html	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/docs/userguide/en/twitcher.html	2009-07-07 09:57:33 UTC (rev 31442)
@@ -42,9 +42,9 @@
 &lt;p&gt;It's also possible to invoke the Twitcher with &lt;span class=&quot;key&quot;&gt;CTRL&lt;/span&gt;&#160;&lt;span class=&quot;key&quot;&gt;TAB&lt;/span&gt; and then use the mouse to choose the application/window you'll jump to when releasing the &lt;span class=&quot;key&quot;&gt;CTRL&lt;/span&gt; key.&lt;/p&gt;
 &lt;p&gt;The Twitcher also offers a few more advanced keyboard shortcuts:&lt;/p&gt;
 &lt;table summary=&quot;more shortcuts&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;4&quot;&gt;
-&lt;tr&gt;&lt;td&gt;&lt;span class=&quot;key&quot;&gt;ESC&lt;/span&gt;&lt;/td&gt;&lt;td style=&quot;width:15px;&quot;&gt;&lt;/td&gt;&lt;td&gt;Aborts the twitching an returns the formerly active window.&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td&gt;&lt;span class=&quot;key&quot;&gt;ESC&lt;/span&gt;&lt;/td&gt;&lt;td style=&quot;width:15px;&quot;&gt;&lt;/td&gt;&lt;td&gt;Aborts the twitching and returns to the formerly active window.&lt;/td&gt;&lt;/tr&gt;
 &lt;tr&gt;&lt;td&gt;&lt;span class=&quot;key&quot;&gt;Q&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;Quits the selected application.&lt;/td&gt;&lt;/tr&gt;
-&lt;tr&gt;&lt;td&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;Hides all windows the selected application.&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td&gt;&lt;span class=&quot;key&quot;&gt;H&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;Hides all windows of the selected application.&lt;/td&gt;&lt;/tr&gt;
 &lt;/table&gt;
 
 &lt;/div&gt;

Modified: haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/AVFormatReader.cpp
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/AVFormatReader.cpp	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/AVFormatReader.cpp	2009-07-07 09:57:33 UTC (rev 31442)
@@ -31,10 +31,12 @@
 #ifdef TRACE_AVFORMAT_READER
 #	define TRACE printf
 #	define TRACE_IO(a...)
+#	define TRACE_SEEK(a...)
 #	define TRACE_PACKET(a...)
 #else
 #	define TRACE(a...)
 #	define TRACE_IO(a...)
+#	define TRACE_SEEK(a...)
 #	define TRACE_PACKET(a...)
 #endif
 
@@ -547,12 +549,12 @@
 		return B_NO_INIT;
 
 	if ((flags &amp; B_MEDIA_SEEK_CLOSEST_FORWARD) != 0) {
-		TRACE(&quot;  AVFormatReader::Seek() - B_MEDIA_SEEK_CLOSEST_FORWARD &quot;
+		TRACE_SEEK(&quot;  AVFormatReader::Seek() - B_MEDIA_SEEK_CLOSEST_FORWARD &quot;
 			&quot;not supported.\n&quot;);
 		return B_NOT_SUPPORTED;
 	}
 
-	TRACE(&quot;AVFormatReader::StreamCookie::Seek(%ld, %s %s %s %s, %lld, &quot;
+	TRACE_SEEK(&quot;AVFormatReader::StreamCookie::Seek(%ld, %s %s %s %s, %lld, &quot;
 		&quot;%lld)\n&quot;, Index(),
 		(flags &amp; B_MEDIA_SEEK_TO_FRAME) ? &quot;B_MEDIA_SEEK_TO_FRAME&quot; : &quot;&quot;,
 		(flags &amp; B_MEDIA_SEEK_TO_TIME) ? &quot;B_MEDIA_SEEK_TO_TIME&quot; : &quot;&quot;,
@@ -572,11 +574,11 @@
 	} else
 		timeStamp = (int64_t)(*time / timeBase / 1000000.0);
 
-	TRACE(&quot;  time: %.2fs -&gt; %lld, current DTS: %lld (time_base: %f)\n&quot;,
+	TRACE_SEEK(&quot;  time: %.2fs -&gt; %lld, current DTS: %lld (time_base: %f)\n&quot;,
 		*time / 1000000.0, timeStamp, fStream-&gt;cur_dts, timeBase);
 
 	if (av_seek_frame(fContext, Index(), timeStamp, 0) &lt; 0) {
-		TRACE(&quot;  av_seek_frame() failed.\n&quot;);
+		TRACE_SEEK(&quot;  av_seek_frame() failed.\n&quot;);
 		return B_ERROR;
 	}
 
@@ -595,8 +597,8 @@
 	if (fContext == NULL || fStream == NULL)
 		return B_NO_INIT;
 
-	TRACE(&quot;AVFormatReader::StreamCookie::FindKeyFrame(%ld, %s %s %s %s, %lld, &quot;
-		&quot;%lld)\n&quot;, Index(),
+	TRACE_SEEK(&quot;AVFormatReader::StreamCookie::FindKeyFrame(%ld, %s %s %s %s, &quot;
+		&quot;%lld, %lld)\n&quot;, Index(),
 		(flags &amp; B_MEDIA_SEEK_TO_FRAME) ? &quot;B_MEDIA_SEEK_TO_FRAME&quot; : &quot;&quot;,
 		(flags &amp; B_MEDIA_SEEK_TO_TIME) ? &quot;B_MEDIA_SEEK_TO_TIME&quot; : &quot;&quot;,
 		(flags &amp; B_MEDIA_SEEK_CLOSEST_BACKWARD) ? &quot;B_MEDIA_SEEK_CLOSEST_BACKWARD&quot; : &quot;&quot;,
@@ -616,7 +618,7 @@
 	} else
 		timeStamp = (int64_t)(*time / timeBase / 1000000.0);
 
-	TRACE(&quot;  time: %.2fs -&gt; %lld (time_base: %f)\n&quot;, *time / 1000000.0,
+	TRACE_SEEK(&quot;  time: %.2fs -&gt; %lld (time_base: %f)\n&quot;, *time / 1000000.0,
 		timeStamp, timeBase);
 
 	int searchFlags = AVSEEK_FLAG_BACKWARD;
@@ -625,7 +627,7 @@
 
 	int index = av_index_search_timestamp(fStream, timeStamp, searchFlags);
 	if (index &lt; 0) {
-		TRACE(&quot;  av_index_search_timestamp() failed.\n&quot;);
+		TRACE_SEEK(&quot;  av_index_search_timestamp() failed.\n&quot;);
 		// Just seek to the beginning of the stream and assume it is a
 		// keyframe...
 		*frame = 0;
@@ -637,10 +639,10 @@
 	timeStamp = entry.timestamp;
 	*time = (bigtime_t)(timeStamp * 1000000.0 * timeBase);
 
-	TRACE(&quot;  seeked time: %.2fs (%lld)\n&quot;, *time / 1000000.0, timeStamp);
+	TRACE_SEEK(&quot;  seeked time: %.2fs (%lld)\n&quot;, *time / 1000000.0, timeStamp);
 	if ((flags &amp; B_MEDIA_SEEK_TO_FRAME) != 0) {
 		*frame = timeStamp;//*time * frameRate / 1000000LL;
-		TRACE(&quot;  seeked frame: %lld\n&quot;, *frame);
+		TRACE_SEEK(&quot;  seeked frame: %lld\n&quot;, *frame);
 	}
 
 	return B_OK;
@@ -871,6 +873,10 @@
 	fStreams[0] = stream;
 	streamDeleter.Detach();
 
+	#ifdef TRACE_AVFORMAT_READER
+	dump_format(const_cast&lt;AVFormatContext*&gt;(stream-&gt;Context()), 0, &quot;&quot;, 0);
+	#endif
+
 	if (_streamCount != NULL)
 		*_streamCount = streamCount;
 
@@ -1046,7 +1052,7 @@
 AVFormatReader::Seek(void* _cookie, uint32 seekTo, int64* frame,
 	bigtime_t* time)
 {
-	TRACE(&quot;AVFormatReader::Seek()\n&quot;);
+	TRACE_SEEK(&quot;AVFormatReader::Seek()\n&quot;);
 
 	BAutolock _(fStreamLock);
 
@@ -1059,7 +1065,7 @@
 AVFormatReader::FindKeyFrame(void* _cookie, uint32 flags, int64* frame,
 	bigtime_t* time)
 {
-	TRACE(&quot;AVFormatReader::FindKeyFrame()\n&quot;);
+	TRACE_SEEK(&quot;AVFormatReader::FindKeyFrame()\n&quot;);
 
 	BAutolock _(fStreamLock);
 

Modified: haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/Jamfile
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/Jamfile	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/Jamfile	2009-07-07 09:57:33 UTC (rev 31442)
@@ -17,32 +17,39 @@
 	SubDirCcFlags -fomit-frame-pointer -DPIC ;
 }
 
-local defines ;
-defines = HAVE_AV_CONFIG_H=1 ;
+# NOTE: This is intentionally a global variable, so we can re-use it in
+# sub-folders.
+HAIKU_FFMPEG_DEFINES = HAVE_AV_CONFIG_H=1 ;
 
 if $(TARGET_ARCH) = x86 {
-    defines += ARCH_X86=1 ARCH_X86_32=1 ARCH_PPC=0 ARCH_SPARC=0 ;
-    defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-    defines += HAVE_MMX=1 HAVE_MMX2=1 HAVE_SSE=0 HAVE_SSE3=1 ; 
-    defines += HAVE_ALTIVEC=0 ;
-	defines += HAVE_VIS=0 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_X86=1 ARCH_X86_32=1 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_PPC=0 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_SPARC=0 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_MMX=1 HAVE_MMX2=1 HAVE_SSE=0 HAVE_SSE3=1 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_ALTIVEC=0 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_VIS=0 ;
 } else if $(TARGET_ARCH) = ppc {
-    defines += ARCH_X86=0 ARCH_X86_32=0 ARCH_PPC=1 ARCH_SPARC=0 ;
-    defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-    defines += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
-    defines += HAVE_ALTIVEC=1 ;
-	defines += HAVE_VIS=0 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_X86=0 ARCH_X86_32=0 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_PPC=1 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_SPARC=0 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
+	HAIKU_FFMPEG_DEFINES += HAVE_ALTIVEC=1 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_VIS=0 ;
 } else if $(TARGET_ARCH) = sparc {
-    defines += ARCH_X86=0 ARCH_X86_32=0 ARCH_PPC=0 ARCH_SPARC=1 ;
-    defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-    defines += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
-    defines += HAVE_ALTIVEC=0 ;
-	defines += HAVE_VIS=1 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_X86=0 ARCH_X86_32=0 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_PPC=0 ;
+	HAIKU_FFMPEG_DEFINES += ARCH_SPARC=1 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
+	HAIKU_FFMPEG_DEFINES += HAVE_ALTIVEC=0 ;
+	HAIKU_FFMPEG_DEFINES += HAVE_VIS=1 ;
 }
 
-defines = [ FDefines $(defines) ] ;
-SubDirCcFlags $(defines) ;
-SubDirC++Flags $(defines) ;
+HAIKU_FFMPEG_DEFINES = [ FDefines $(HAIKU_FFMPEG_DEFINES) ] ;
+SubDirCcFlags $(HAIKU_FFMPEG_DEFINES) ;
+SubDirC++Flags $(HAIKU_FFMPEG_DEFINES) ;
 
 StaticLibrary libavcodec.a :
 	4xm.c

Modified: haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/ppc/Jamfile
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/ppc/Jamfile	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/ppc/Jamfile	2009-07-07 09:57:33 UTC (rev 31442)
@@ -18,19 +18,9 @@
 # Enable altivec support
 SubDirCcFlags -maltivec -mabi=altivec ;
 
-local defines ;
-defines = HAVE_AV_CONFIG_H=1 ;
-defines += ARCH_X86=0 ARCH_X86_32=0 ARCH_PPC=1 ARCH_SPARC=0 ;
-defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-defines += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
-defines += HAVE_ALTIVEC=1 HAVE_ALTIVEC_H=1 ;
-defines += HAVE_VIS=0 ;
+SubDirCcFlags $(HAIKU_FFMPEG_DEFINES) ;
+SubDirC++Flags $(HAIKU_FFMPEG_DEFINES) ;
 
-defines = [ FDefines $(defines) ] ;
-SubDirCcFlags $(defines) ;
-SubDirC++Flags $(defines) ;
-
-
 StaticLibrary libavcodec_ppc.a :
 	check_altivec.c
     float_altivec.c

Modified: haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/sparc/Jamfile
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/sparc/Jamfile	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/sparc/Jamfile	2009-07-07 09:57:33 UTC (rev 31442)
@@ -15,33 +15,9 @@
 	SubDirCcFlags -fomit-frame-pointer -DPIC ;
 }
 
-local defines ;
-defines = HAVE_AV_CONFIG_H=1 ;
+SubDirCcFlags $(HAIKU_FFMPEG_DEFINES) ;
+SubDirC++Flags $(HAIKU_FFMPEG_DEFINES) ;
 
-if $(TARGET_ARCH) = x86 {
-    defines += ARCH_X86=1 ARCH_X86_32=1 ARCH_PPC=0 ARCH_SPARC=0 ;
-    defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-    defines += HAVE_MMX=1 HAVE_MMX2=1 HAVE_SSE=0 HAVE_SSE3=1 ; 
-    defines += HAVE_ALTIVEC=0 ;
-	defines += HAVE_VIS=0 ;
-} else if $(TARGET_ARCH) = ppc {
-    defines += ARCH_X86=0 ARCH_X86_32=0 ARCH_PPC=1 ARCH_SPARC=0 ;
-    defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-    defines += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
-    defines += HAVE_ALTIVEC=1 ;
-	defines += HAVE_VIS=0 ;
-} else if $(TARGET_ARCH) = sparc {
-    defines += ARCH_X86=0 ARCH_X86_32=0 ARCH_PPC=0 ARCH_SPARC=1 ;
-    defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-    defines += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
-    defines += HAVE_ALTIVEC=0 ;
-	defines += HAVE_VIS=1 ;
-}
-
-defines = [ FDefines $(defines) ] ;
-SubDirCcFlags $(defines) ;
-SubDirC++Flags $(defines) ;
-
 StaticLibrary libavcodec_sparc.a :
     dsputil_vis.c
     simple_idct_vis.c

Modified: haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/x86/Jamfile
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/x86/Jamfile	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/add-ons/media/plugins/ffmpeg/libavcodec/x86/Jamfile	2009-07-07 09:57:33 UTC (rev 31442)
@@ -15,18 +15,9 @@
 	SubDirCcFlags -fomit-frame-pointer -DPIC ;
 }
 
-local defines ;
-defines = HAVE_AV_CONFIG_H=1 ;
-defines += ARCH_X86=1 ARCH_X86_32=1 ARCH_PPC=0 ARCH_SPARC=0 ;
-defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
-defines += HAVE_MMX=1 HAVE_MMX2=1 HAVE_SSE=0 HAVE_SSE3=1 ; 
-defines += HAVE_ALTIVEC=0 ;
-defines += HAVE_VIS=0 ;
+SubDirCcFlags $(HAIKU_FFMPEG_DEFINES) ;
+SubDirC++Flags $(HAIKU_FFMPEG_DEFINES) ;
 
-defines = [ FDefines $(defines) ] ;
-SubDirCcFlags $(defines) ;
-SubDirC++Flags $(defines) ;
-
 StaticLibrary libavcodec_x86.a :
 	cpuid.c
 	cavsdsp_mmx.c

Modified: haiku/branches/features/32bit-wchar_t/src/bin/bash/Jamfile
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/bin/bash/Jamfile	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/bin/bash/Jamfile	2009-07-07 09:57:33 UTC (rev 31442)
@@ -94,7 +94,8 @@
 Includes [ FGristFiles trap.c ] : &lt;bash&gt;signames.h ;
 
 # some sources include the generated builtext.h
-Includes [ FGristFiles execute_cmd.c jobs.c parse.c ] : &lt;bash&gt;builtext.h ;
+Includes [ FGristFiles execute_cmd.c jobs.c parse.c trap.c ]
+	: &lt;bash&gt;builtext.h ;
 
 SubInclude HAIKU_TOP src bin bash lib ;
 SubInclude HAIKU_TOP src bin bash builtins ;

Modified: haiku/branches/features/32bit-wchar_t/src/bin/bash/builtins/Jamfile
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/bin/bash/builtins/Jamfile	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/bin/bash/builtins/Jamfile	2009-07-07 09:57:33 UTC (rev 31442)
@@ -39,7 +39,7 @@
 
 	MakeLocateArch $(sources) ;
 	SEARCH on $(defFiles) = $(SEARCH_SOURCE) ;
-	
+
 	Depends $(sources) : $(defFiles) mkbuiltins ;
 	MkBuiltinsExt1 $(sources) : mkbuiltins $(defFiles) ;
 	LocalClean clean : $(sources) ;
@@ -59,7 +59,7 @@
 	shopt.def printf.def complete.def
 ;
 
-# generate the source file for the .def files
+# generate the source files for the .def files
 local bashDefFile ;
 for bashDefFile in [ FGristFiles $(bashDefFiles) ] {
 	local source = $(bashDefFile:S=.c) ;
@@ -77,5 +77,5 @@
 	  [ FGristFiles $(bashDefFiles:S=.c) ]
 ;
 
-# common.c includes builtext.h
-Includes [ FGristFiles common.c ] : &lt;bash&gt;builtext.h ;
+# common.c and mkbuiltins.c include builtext.h
+Includes [ FGristFiles common.c mkbuiltins.c ] : &lt;bash&gt;builtext.h ;

Modified: haiku/branches/features/32bit-wchar_t/src/bin/screen_blanker/ScreenSaverWindow.cpp
===================================================================
--- haiku/branches/features/32bit-wchar_t/src/bin/screen_blanker/ScreenSaverWindow.cpp	2009-07-07 09:52:38 UTC (rev 31441)
+++ haiku/branches/features/32bit-wchar_t/src/bin/screen_blanker/ScreenSaverWindow.cpp	2009-07-07 09:57:33 UTC (rev 31442)
@@ -47,6 +47,8 @@
 
 				// Fall through
 			}
+			case B_MODIFIERS_CHANGED:
+			case B_UNMAPPED_KEY_DOWN:
 			case B_MOUSE_DOWN:
 				fEnabled = false;
 				be_app-&gt;PostMessage(B_QUIT_REQUESTED);
@@ -86,7 +88,7 @@
 
 	fFilter = new ScreenSaverFilter();
 	fTopView-&gt;AddFilter(fFilter);
-	
+
 	AddChild(fTopView);
 
 	// Ensure that this view receives keyboard input


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017781.html">[Haiku-commits] r31441 - haiku/trunk/src/bin/screen_blanker
</A></li>
	<LI>Next message: <A HREF="017783.html">[Haiku-commits] r31443 - buildtools/trunk/gcc/gcc/config buildtools/trunk/gcc/gcc/config/arm buildtools/trunk/gcc/gcc/config/i386 buildtools/trunk/gcc/gcc/config/m68k buildtools/trunk/gcc/gcc/config/mips buildtools/trunk/gcc/gcc/config/rs6000 buildtools/trunk/legacy/binutils/bfd buildtools/trunk/legacy/gcc/gcc buildtools/trunk/legacy/gcc/gcc/config/i386 haiku/trunk haiku/trunk/build/jam haiku/trunk/build/scripts haiku/trunk/data/system/boot haiku/trunk/headers/glibc haiku/trunk/src/add-ons/disk_systems/bfs haiku/trunk/src/add-ons/disk_systems/intel haiku/trunk/src/add-ons/input_server/devices/keyboard haiku/trunk/src/add-ons/input_server/devices/mouse haiku/trunk/src/add-ons/input_server/devices/wacom haiku/trunk/src/add-ons/input_server/filters/screen_saver haiku/trunk/src/add-ons/input_server/methods/canna haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos haiku/trunk/src/add-ons/kernel/file_systems/use! rlandfs/server/fuse haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku haiku/trunk/src/add-ons/locale/catalogs/zeta haiku/trunk/src/add-ons/locale/collators haiku/trunk/src/add-ons/mail_daemon/inbound_filters/match_header haiku/trunk/src/add-ons/mail_daemon/inbound_filters/r5_filter haiku/trunk/src/add-ons/mail_daemon/inbound_filters/spam_filter haiku/trunk/src/add-ons/mail_daemon/inbound_protocols/imap haiku/trunk/src/add-ons/mail_daemon/inbound_protocols/pop3 haiku/trunk/src/add-ons/mail_daemon/outbound_filters/fortune haiku/trunk/src/add-ons/mail_daemon/system_filters/inbox haiku/trunk/src/add-ons/mail_daemon/system_filters/notifier haiku/trunk/src/add-ons/mail_daemon/system_filters/outbox haiku/trunk/src/add-ons/mail_daemon/system_filters/parser haiku/trunk/src/add-ons/media/media-add-ons/dvb haiku/trunk/src/add-ons/media/media-add-ons/esound_sink haiku/trunk/src/add-ons/media/media-add-ons/firewire_dv haiku/trunk/src/add-ons/media/media-add-ons/legacy ! haiku/trunk/src/add-ons/media/media-add-ons/mixer haiku/trunk/! src/add-
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17782">[ date ]</a>
              <a href="thread.html#17782">[ thread ]</a>
              <a href="subject.html#17782">[ subject ]</a>
              <a href="author.html#17782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
