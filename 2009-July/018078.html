<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r31619 - in	haiku/branches/components/gsoc-locale-kit: build/jam	headers/os/locale headers/private/locale	src/add-ons/locale/catalogs/plaintext	src/add-ons/locale/catalogs/zeta src/bin/locale	src/kits/locale src/preferences/locale src/tests/kits/locale	src/tools/locale
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31619%20-%20in%0A%09haiku/branches/components/gsoc-locale-kit%3A%20build/jam%0A%09headers/os/locale%20headers/private/locale%0A%09src/add-ons/locale/catalogs/plaintext%0A%09src/add-ons/locale/catalogs/zeta%20src/bin/locale%0A%09src/kits/locale%20src/preferences/locale%20src/tests/kits/locale%0A%09src/tools/locale&In-Reply-To=%3C200907171230.n6HCUp05019726%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018077.html">
   <LINK REL="Next"  HREF="018079.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r31619 - in	haiku/branches/components/gsoc-locale-kit: build/jam	headers/os/locale headers/private/locale	src/add-ons/locale/catalogs/plaintext	src/add-ons/locale/catalogs/zeta src/bin/locale	src/kits/locale src/preferences/locale src/tests/kits/locale	src/tools/locale</H1>
    <B>zooey at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31619%20-%20in%0A%09haiku/branches/components/gsoc-locale-kit%3A%20build/jam%0A%09headers/os/locale%20headers/private/locale%0A%09src/add-ons/locale/catalogs/plaintext%0A%09src/add-ons/locale/catalogs/zeta%20src/bin/locale%0A%09src/kits/locale%20src/preferences/locale%20src/tests/kits/locale%0A%09src/tools/locale&In-Reply-To=%3C200907171230.n6HCUp05019726%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r31619 - in	haiku/branches/components/gsoc-locale-kit: build/jam	headers/os/locale headers/private/locale	src/add-ons/locale/catalogs/plaintext	src/add-ons/locale/catalogs/zeta src/bin/locale	src/kits/locale src/preferences/locale src/tests/kits/locale	src/tools/locale">zooey at mail.berlios.de
       </A><BR>
    <I>Fri Jul 17 14:30:51 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="018077.html">[Haiku-commits] r31618 -	haiku/trunk/src/add-ons/media/plugins/ffmpeg
</A></li>
        <LI>Next message: <A HREF="018079.html">[Haiku-commits] r31620 - haiku/trunk/data/system/boot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18078">[ date ]</a>
              <a href="thread.html#18078">[ thread ]</a>
              <a href="subject.html#18078">[ subject ]</a>
              <a href="author.html#18078">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: zooey
Date: 2009-07-17 14:30:49 +0200 (Fri, 17 Jul 2009)
New Revision: 31619
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=31619&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=31619&amp;view=rev</A>

Modified:
   haiku/branches/components/gsoc-locale-kit/build/jam/BeOSRules
   haiku/branches/components/gsoc-locale-kit/headers/os/locale/Catalog.h
   haiku/branches/components/gsoc-locale-kit/headers/private/locale/DefaultCatalog.h
   haiku/branches/components/gsoc-locale-kit/headers/private/locale/HashMapCatalog.h
   haiku/branches/components/gsoc-locale-kit/headers/private/locale/PlainTextCatalog.h
   haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/plaintext/Catalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/zeta/Catalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/bin/locale/linkcatkeys.cpp
   haiku/branches/components/gsoc-locale-kit/src/kits/locale/Catalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/kits/locale/DefaultCatalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/kits/locale/HashMapCatalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp
   haiku/branches/components/gsoc-locale-kit/src/preferences/locale/french.catkeys
   haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTest.cpp
   haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTestAddOn.cpp
   haiku/branches/components/gsoc-locale-kit/src/tools/locale/Catalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/tools/locale/DefaultCatalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/tools/locale/HashMapCatalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/tools/locale/PlainTextCatalog.cpp
   haiku/branches/components/gsoc-locale-kit/src/tools/locale/linkcatkeys.cpp
Log:
applied patch by Adrien (with a small addition by myself):
* fingerprint is now uint32 instead of int32 and it will now be written as
  an attribute whenever a catalog is opened
* fix escaping of \n chars in translation strings
* fix several warnings, esp. in locale build tools
* adjusted tests accordingly

Modified: haiku/branches/components/gsoc-locale-kit/build/jam/BeOSRules
===================================================================
--- haiku/branches/components/gsoc-locale-kit/build/jam/BeOSRules	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/build/jam/BeOSRules	2009-07-17 12:30:49 UTC (rev 31619)
@@ -333,25 +333,26 @@
 {
 	$(HOST_ADD_BUILD_COMPATIBILITY_LIB_DIR)
 		cat &quot;$(2[2-])&quot; | $(CC) -E $(CCDEFS) $(HDRS) - &gt; &quot;$(1)&quot;.pre 
-		$(2[1]) -s $(LOCALE_KIT_SIGNATURE) -o &quot;$(1)&quot; &quot;$(1)&quot;.pre
+		$(2[1]) -s $(LOCALE_KIT_SIGNATURE) -p -o &quot;$(1)&quot; &quot;$(1)&quot;.pre
 }
 
 # Link catalog entries from given catkey file into output compiled catalog file.
 # Compiled catalog file will then be copied into the image, but only if the 
 # fingerprint matches the one from the untranslated catalog for the same file.
-rule LinkApplicationCatalog target : sources : signature
+rule LinkApplicationCatalog target : sources : signature : language
 {
 	MakeLocateArch $(target) ;
 	LOCALE_KIT_SIGNATURE on $(target) = $(signature) ;
 	Depends $(target) : $(sources) &lt;build&gt;linkcatkeys ;
 	LocalClean clean : $(target) ;
-	LinkApplicationCatalog1 $(target) : &lt;build&gt;linkcatkeys $(sources) ;
+	LinkApplicationCatalog1 $(target) 
+		: &lt;build&gt;linkcatkeys $(language) $(sources) ;
 }
 
 actions LinkApplicationCatalog1
 {
 	$(HOST_ADD_BUILD_COMPATIBILITY_LIB_DIR)
-		$(2[1]) &quot;$(2[2-])&quot; -v -s $(LOCALE_KIT_SIGNATURE) -o &quot;$(1)&quot;
+		$(2[1]) &quot;$(2[3-])&quot; -l $(2[2]:B) -v -s $(LOCALE_KIT_SIGNATURE) -o &quot;$(1)&quot;
 }
 
 # General rules to invoke from jamfiles and that do (almost) everything related
@@ -366,17 +367,15 @@
 {
 	genCat = [ FGristFiles $(generatedCatalog) ] ;
 	
-	for source in $(sources) {
-		ExtractCatalogEntries $(source).catkeys : $(source) : $(signature) ;
-	}
+	ExtractCatalogEntries $(genCat:S=.catkeys) : $(sources) : $(signature) ;
 
-	LinkApplicationCatalog $(genCat) : $(sources).catkeys 
-		: $(signature) ;
+	LinkApplicationCatalog $(genCat) : $(genCat:S=.catkeys)
+		: $(signature) : english ;
 	
 	for catalog in $(translatedCatalogs)
 	{
 		LinkApplicationCatalog $(catalog:B).catalog : $(catalog)
-			: $(signature) ;
+			: $(signature) : $(catalog:B) ;
 	}
 	
 	AddFilesToHaikuImage system etc locale catalogs $(signature) :

Modified: haiku/branches/components/gsoc-locale-kit/headers/os/locale/Catalog.h
===================================================================
--- haiku/branches/components/gsoc-locale-kit/headers/os/locale/Catalog.h	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/headers/os/locale/Catalog.h	2009-07-17 12:30:49 UTC (rev 31619)
@@ -15,7 +15,7 @@
 	public:
 		BCatalog();
 		BCatalog(const char *signature, const char *language = NULL,
-			int32 fingerprint = 0);
+			uint32 fingerprint = 0);
 		virtual ~BCatalog();
 
 		const char *GetString(const char *string, const char *context = NULL,
@@ -27,7 +27,7 @@
 
 		status_t GetSignature(BString *sig);
 		status_t GetLanguage(BString *lang);
-		status_t GetFingerprint(int32 *fp);
+		status_t GetFingerprint(uint32 *fp);
 
 		status_t InitCheck() const;
 		int32 CountItems() const;
@@ -143,7 +143,7 @@
 		friend class BLocaleRoster;
 	public:
 		BCatalogAddOn(const char *signature, const char *language,
-					  int32 fingerprint);
+					  uint32 fingerprint);
 		virtual ~BCatalogAddOn();
 
 		virtual const char *GetString(const char *string,
@@ -195,7 +195,7 @@
 		status_t 			fInitCheck;
 		BString 			fSignature;
 		BString 			fLanguageName;
-		int32				fFingerprint;
+		uint32				fFingerprint;
 		BCatalogAddOn 		*fNext;
 
 		friend class BCatalog;
@@ -206,7 +206,7 @@
 // ...the function that instantiates a catalog for this add-on-type...
 extern &quot;C&quot;
 BCatalogAddOn *instantiate_catalog(const char *signature,
-	const char *language, int32 fingerprint);
+	const char *language, uint32 fingerprint);
 // ...the function that creates an empty catalog for this add-on-type...
 extern &quot;C&quot;
 BCatalogAddOn *create_catalog(const char *signature,
@@ -243,7 +243,7 @@
 
 
 inline status_t
-BCatalog::GetFingerprint(int32 *fp)
+BCatalog::GetFingerprint(uint32 *fp)
 {
 	if (!fp)
 		return B_BAD_VALUE;

Modified: haiku/branches/components/gsoc-locale-kit/headers/private/locale/DefaultCatalog.h
===================================================================
--- haiku/branches/components/gsoc-locale-kit/headers/private/locale/DefaultCatalog.h	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/headers/private/locale/DefaultCatalog.h	2009-07-17 12:30:49 UTC (rev 31619)
@@ -21,7 +21,7 @@
 class DefaultCatalog : public BHashMapCatalog {
 	public:
 		DefaultCatalog(const char *signature, const char *language,
-			int32 fingerprint);
+			uint32 fingerprint);
 				// constructor for normal use
 		DefaultCatalog(entry_ref *appOrAddOnRef);
 				// constructor for embedded catalog
@@ -41,7 +41,7 @@
 		status_t WriteToResource(entry_ref *appOrAddOnRef);
 
 		static BCatalogAddOn *Instantiate(const char *signature,
-			const char *language, int32 fingerprint);
+			const char *language, uint32 fingerprint);
 		static BCatalogAddOn *InstantiateEmbedded(entry_ref *appOrAddOnRef);
 		static BCatalogAddOn *Create(const char *signature,
 			const char *language);

Modified: haiku/branches/components/gsoc-locale-kit/headers/private/locale/HashMapCatalog.h
===================================================================
--- haiku/branches/components/gsoc-locale-kit/headers/private/locale/HashMapCatalog.h	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/headers/private/locale/HashMapCatalog.h	2009-07-17 12:30:49 UTC (rev 31619)
@@ -77,7 +77,7 @@
 
 class BHashMapCatalog: public BCatalogAddOn {
 	protected:
-		int32 ComputeFingerprint() const;
+		uint32 ComputeFingerprint() const;
 #if __GNUC__ &gt; 2
 		typedef __gnu_cxx::hash_map&lt;CatKey, BString,
 			__gnu_cxx::hash&lt;CatKey&gt;, std::equal_to&lt;CatKey&gt; &gt; CatMap;
@@ -88,7 +88,7 @@
 		CatMap 				fCatMap;
 
 	public:
-		BHashMapCatalog(const char* signature, const char* language, int32 fingerprint);
+		BHashMapCatalog(const char* signature, const char* language, uint32 fingerprint);
 			// Constructor for normal use
 			//
 		// overrides of BCatalogAddOn:
@@ -141,7 +141,7 @@
 
 
 inline BHashMapCatalog::BHashMapCatalog(const char* signature,
-	const char* language, int32 fingerprint)
+	const char* language, uint32 fingerprint)
 	:
 	BCatalogAddOn(signature, language, fingerprint)
 {

Modified: haiku/branches/components/gsoc-locale-kit/headers/private/locale/PlainTextCatalog.h
===================================================================
--- haiku/branches/components/gsoc-locale-kit/headers/private/locale/PlainTextCatalog.h	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/headers/private/locale/PlainTextCatalog.h	2009-07-17 12:30:49 UTC (rev 31619)
@@ -14,7 +14,7 @@
 class PlainTextCatalog : public BHashMapCatalog {
 	public:
 		PlainTextCatalog(const char *signature, const char *language,
-			int32 fingerprint);
+			uint32 fingerprint);
 				// constructor for normal use
 		PlainTextCatalog(entry_ref *appOrAddOnRef);
 				// constructor for embedded catalog
@@ -30,7 +30,7 @@
 		status_t WriteToFile(const char *path = NULL);
 
 		static BCatalogAddOn *Instantiate(const char *signature,
-			const char *language, int32 fingerprint);
+			const char *language, uint32 fingerprint);
 
 		static const char *kCatMimeType;
 

Modified: haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/plaintext/Catalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/plaintext/Catalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/plaintext/Catalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -62,6 +62,15 @@
 	// version of the catalog archive structure, bump this if you change it!
 
 
+void
+escapeQuotedChars(BString&amp; stringToEscape)
+{
+	stringToEscape.ReplaceAll(&quot;\n&quot;,&quot;\\n&quot;);
+	stringToEscape.ReplaceAll(&quot;\t&quot;,&quot;\\t&quot;);
+	stringToEscape.ReplaceAll(&quot;\&quot;&quot;,&quot;\\\&quot;&quot;);
+}
+
+
 /*
  * constructs a PlainTextCatalog with given signature and language and reads
  * the catalog from disk.
@@ -69,7 +78,7 @@
  * give an appropriate error-code otherwise.
  */
 PlainTextCatalog::PlainTextCatalog(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 	:
 	BHashMapCatalog(signature, language, fingerprint)
 {
@@ -206,7 +215,7 @@
 	if (std::getline(catalogFile, currentItem).good()) {
 		// Get the fingerprint
 		std::istringstream ss(currentItem);
-		int foundFingerprint;
+		uint32 foundFingerprint;
 		ss &gt;&gt; foundFingerprint;
 		if (ss.fail()) {
 			log_team(LOG_DEBUG, &quot;Unable to get fingerprint (%s) from %s&quot;,
@@ -229,11 +238,8 @@
 	std::string originalString;
 	std::string context;
 	std::string comment;
-	std::string stringKey;
 	std::string translated;
 
-	uint32 key;
-
 	while (std::getline(catalogFile, originalString,'\t').good()) {
 		// Each line is : &quot;original string \t key \t translated string&quot;
 		// However, the original string is also tab-separated because it
@@ -251,13 +257,6 @@
 			return B_ERROR;
 		}
 
-		if (!std::getline(catalogFile,stringKey,'\t').good()) {
-			log_team(LOG_DEBUG,
-				&quot;Unable to get key for string %s (%s / %s) from %s&quot;,
-				originalString.c_str(), context.c_str(), comment.c_str(), path);
-			return B_ERROR;
-		}
-
 		if (!std::getline(catalogFile,translated).good()) {
 			log_team(LOG_DEBUG,
 				&quot;Unable to get translated text for string %s from %s&quot;,
@@ -265,25 +264,14 @@
 			return B_ERROR;
 		}
 
-		std::istringstream ss( stringKey );
-		ss &gt;&gt; key;
-		if (ss.fail()) {
-    		//something happened
-			log_team(LOG_DEBUG,
-				&quot;Unable to convert key %s (%d) for string %s (%s / %s) from %s&quot;,
-				stringKey.c_str(), key, originalString.c_str(), context.c_str(),
-				comment.c_str(), path);
-			return B_ERROR;
-		}
-
 		// We could do that :
 		// SetString(key, translated.c_str());
 		// but we want to keep the strings in the new catkey. Hash collisions
 		// happen, you know. (and CatKey::== will fail)
 		SetString(originalString.c_str(), translated.c_str(), context.c_str(),
 			comment.c_str()); 
-		log_team(LOG_DEBUG, &quot;Added string %s (key %u) from file %s&quot;,
-			originalString.c_str(), key, path);
+		log_team(LOG_DEBUG, &quot;Added string %s from file %s&quot;,
+			originalString.c_str(), path);
 	}
 
 	catalogFile.close();
@@ -321,12 +309,19 @@
 		return res;
 
 	CatMap::const_iterator iter;
+	BString original;
+	BString translated;
+
 	for (iter = fCatMap.begin(); iter!=fCatMap.end(); ++iter) {
+		original = iter-&gt;first.fString;
+		translated = iter-&gt;second;
+		escapeQuotedChars(original);
+		escapeQuotedChars(translated);
 		textContent.Truncate(0);
-		textContent &lt;&lt; iter-&gt;first.fString.String() &lt;&lt; &quot;\t&quot; &lt;&lt;
-			iter-&gt;first.fContext.String() &lt;&lt; &quot;\t&quot; &lt;&lt;
-			iter-&gt;first.fComment.String() &lt;&lt; &quot;\t&quot; &lt;&lt; iter-&gt;first.fHashVal
-			&lt;&lt; &quot;\t&quot; &lt;&lt; iter-&gt;second.String() &lt;&lt; &quot;\n&quot;;
+		textContent &lt;&lt; original.String() &lt;&lt; &quot;\t&quot; 
+			&lt;&lt; iter-&gt;first.fContext.String() &lt;&lt; &quot;\t&quot;
+			&lt;&lt; iter-&gt;first.fComment.String() &lt;&lt; &quot;\t&quot;
+			&lt;&lt; translated.String() &lt;&lt; &quot;\n&quot;;
 		res = catalogFile.Write(textContent.String(),textContent.Length());
 		if(res != textContent.Length())
 			return res;
@@ -334,9 +329,6 @@
 
 	// set mimetype-, language- and signature-attributes:
 	UpdateAttributes(catalogFile);
-	// finally write fingerprint:
-	catalogFile.WriteAttr(BLocaleRoster::kCatFingerprintAttr, B_INT32_TYPE,
-		0, &amp;fFingerprint, sizeof(int32));
 
 	return B_OK;
 }
@@ -351,6 +343,7 @@
 {
 	static const int bufSize = 256;
 	char buf[bufSize];
+	uint32 temp;
 	if (catalogFile.ReadAttr(&quot;BEOS:TYPE&quot;, B_MIME_STRING_TYPE, 0, &amp;buf, bufSize)
 			&lt;= 0
 		|| strcmp(kCatMimeType, buf) != 0) {
@@ -369,6 +362,11 @@
 		catalogFile.WriteAttr(BLocaleRoster::kCatSigAttr, B_STRING_TYPE, 0,
 			fSignature.String(), fSignature.Length()+1);
 	}
+	if (catalogFile.ReadAttr(BLocaleRoster::kCatFingerprintAttr, B_UINT32_TYPE,
+		0, &amp;temp, sizeof(uint32)) &lt;= 0) {
+		catalogFile.WriteAttr(BLocaleRoster::kCatFingerprintAttr, B_UINT32_TYPE,
+			0, &amp;fFingerprint, sizeof(uint32));
+	}
 }
 
 
@@ -383,7 +381,7 @@
 
 BCatalogAddOn *
 PlainTextCatalog::Instantiate(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 {
 	PlainTextCatalog *catalog
 		= new(std::nothrow) PlainTextCatalog(signature, language, fingerprint);
@@ -397,7 +395,7 @@
 
 extern &quot;C&quot; BCatalogAddOn *
 instantiate_catalog(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 {
 	PlainTextCatalog *catalog
 		= new(std::nothrow) PlainTextCatalog(signature, language, fingerprint);

Modified: haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/zeta/Catalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/zeta/Catalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/add-ons/locale/catalogs/zeta/Catalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -26,7 +26,7 @@
 
 	public:
 		ZetaCatalog(const char *signature, const char *language,
-			int32 fingerprint);
+			uint32 fingerprint);
 		~ZetaCatalog();
 
 		const char *GetString(const char *string, const char *context=NULL,
@@ -38,7 +38,7 @@
 };
 
 ZetaCatalog::ZetaCatalog(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 	:
 	BCatalogAddOn(signature, language, fingerprint)
 {
@@ -77,7 +77,7 @@
 
 
 extern &quot;C&quot; BCatalogAddOn *
-instantiate_catalog(const char *signature, const char *language, int32 fingerprint)
+instantiate_catalog(const char *signature, const char *language, uint32 fingerprint)
 {
 	ZetaCatalog *catalog
 		= new(std::nothrow) ZetaCatalog(signature, language, fingerprint);

Modified: haiku/branches/components/gsoc-locale-kit/src/bin/locale/linkcatkeys.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/bin/locale/linkcatkeys.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/bin/locale/linkcatkeys.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -37,45 +37,6 @@
 }
 
 
-void
-parseQuotedChars(BString&amp; stringToParse)
-{
-	char* in = stringToParse.LockBuffer(0);
-	char* out = in;
-	int newLength = 0;
-	bool quoted = false;
-
-	while (*in != 0 || quoted) {
-		if (quoted) {
-			if (*in == 'n')
-				*out = '\n';
-			else if (*in == 't')
-				*out = '\t';
-			else if (*in == '&quot;')
-				*out = '&quot;';
-			else {
-				// dump quote from unknown quoting-sequence:
-				*out = *in ;
-			}
-			quoted = false;
-			out++;
-			newLength++;
-		} else {
-			quoted = (*in == '\\');
-			if (!quoted) {
-				*out = *in;
-				out++;
-				newLength++;
-			}
-		}
-		in++;
-	}
-	*out = '\0';
-
-	stringToParse.UnlockBuffer(newLength);
-}
-
-
 int
 main(int argc, char **argv)
 {
@@ -90,7 +51,7 @@
 	};
 	TargetType outputTarget = TARGET_FILE;
 	const char *catalogSig = NULL;
-	const char *catalogLang = &quot;English&quot;;
+	BString catalogLang(&quot;English&quot;);
 	status_t res;
 	while ((++argv)[0]) {
 		if (argv[0][0] == '-' &amp;&amp; argv[0][1] != '-') {
@@ -99,6 +60,8 @@
 			while ((c = *arg++) != '\0') {
 				if (c == 's')
 					catalogSig = (++argv)[0];
+				else if (c == 'l')
+					catalogLang = (++argv)[0];
 				else if (c == 'v')
 					showSummary = true;
 				else if (c == 'w')
@@ -125,7 +88,7 @@
 	if (inputFiles.empty() || !catalogSig || !outputFile.Length())
 		usage();
 
-	EditableCatalog targetCatalog(&quot;Default&quot;, catalogSig, catalogLang);
+	EditableCatalog targetCatalog(&quot;Default&quot;, catalogSig, catalogLang.String());
 	if ((res = targetCatalog.InitCheck()) != B_OK) {
 		fprintf(stderr, &quot;couldn't construct target-catalog %s - error: %s\n&quot;,
 			outputFile.String(), strerror(res));
@@ -162,15 +125,10 @@
 			const CatKey &amp;plainTextKey(walker.GetKey());
 			BString keyString, keyComment, keyContext;
 			plainTextKey.GetStringParts(&amp;keyString,&amp;keyComment,&amp;keyContext);
-			parseQuotedChars(keyString);
 			const CatKey fixedCatKey(keyString.String(), keyComment.String(),
 					keyContext.String());
 
-			// We need to parse \n, \t and \&quot; now.
-			// They are kept in readable form in the plaintext catkeys, but we
-			// need the raw ascii to match the strings in the compiled program.
 			BString translatedString = walker.GetValue();
-			parseQuotedChars(translatedString);
 
 			if (!targetCatImpl-&gt;GetString(fixedCatKey)) {
 				targetCatImpl-&gt;SetString(fixedCatKey,

Modified: haiku/branches/components/gsoc-locale-kit/src/kits/locale/Catalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/kits/locale/Catalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/kits/locale/Catalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -32,7 +32,7 @@
 
 
 BCatalog::BCatalog(const char *signature, const char *language, 
-	int32 fingerprint)
+	uint32 fingerprint)
 {
 	fCatalog = be_locale_roster-&gt;LoadCatalog(signature, language, fingerprint);
 }
@@ -118,10 +118,10 @@
 		sig.Remove(0, pos+1);
 
 	// try to fetch fingerprint from app-file (attribute):
-	int32 fingerprint = 0;
+	uint32 fingerprint = 0;
 	BNode appNode(&amp;appInfo.ref);
-	appNode.ReadAttr(BLocaleRoster::kCatFingerprintAttr, B_INT32_TYPE, 0, 
-		&amp;fingerprint, sizeof(int32));
+	appNode.ReadAttr(BLocaleRoster::kCatFingerprintAttr, B_UINT32_TYPE, 0, 
+		&amp;fingerprint, sizeof(uint32));
 	// try to load catalog (with given fingerprint):
 	catalog-&gt;fCatalog
 		= be_locale_roster-&gt;LoadCatalog(sig.String(), NULL,	fingerprint);
@@ -152,7 +152,7 @@
 
 //#pragma mark - BCatalogAddOn
 BCatalogAddOn::BCatalogAddOn(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 	:
 	fInitCheck(B_NO_INIT),
 	fSignature(signature),

Modified: haiku/branches/components/gsoc-locale-kit/src/kits/locale/DefaultCatalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/kits/locale/DefaultCatalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/kits/locale/DefaultCatalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -60,7 +60,7 @@
  * give an appropriate error-code otherwise.
  */
 DefaultCatalog::DefaultCatalog(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 	:
 	BHashMapCatalog(signature, language, fingerprint)
 {
@@ -320,9 +320,6 @@
 
 		// set mimetype-, language- and signature-attributes:
 		UpdateAttributes(catalogFile);
-		// finally write fingerprint:
-		catalogFile.WriteAttr(BLocaleRoster::kCatFingerprintAttr, B_INT32_TYPE,
-			0, &amp;fFingerprint, sizeof(int32));
 	}
 	if (res == B_OK)
 		UpdateAttributes(catalogFile);
@@ -396,6 +393,7 @@
 {
 	static const int bufSize = 256;
 	char buf[bufSize];
+	uint32 temp;
 	if (catalogFile.ReadAttr(&quot;BEOS:TYPE&quot;, B_MIME_STRING_TYPE, 0, &amp;buf,
 			bufSize) &lt;= 0
 		|| strcmp(kCatMimeType, buf) != 0) {
@@ -414,6 +412,11 @@
 		catalogFile.WriteAttr(BLocaleRoster::kCatSigAttr, B_STRING_TYPE, 0,
 			fSignature.String(), fSignature.Length()+1);
 	}
+	if (catalogFile.ReadAttr(BLocaleRoster::kCatFingerprintAttr, B_UINT32_TYPE,
+		0, &amp;temp, sizeof(uint32)) &lt;= 0) {
+		catalogFile.WriteAttr(BLocaleRoster::kCatFingerprintAttr, B_UINT32_TYPE,
+			0, &amp;fFingerprint, sizeof(uint32));
+	}
 }
 
 
@@ -466,7 +469,7 @@
 	if (res == B_OK) {
 		fLanguageName = archiveMsg.FindString(&quot;c:lang&quot;);
 		fSignature = archiveMsg.FindString(&quot;c:sig&quot;);
-		int32 foundFingerprint = archiveMsg.FindInt32(&quot;c:fpr&quot;);
+		uint32 foundFingerprint = archiveMsg.FindInt32(&quot;c:fpr&quot;);
 
 		// if a specific fingerprint has been requested and the catalog does in
 		// fact have a fingerprint, both are compared. If they mismatch, we do
@@ -508,7 +511,7 @@
 					BString&gt;(key, translated));
 			}
 		}
-		int32 checkFP = ComputeFingerprint();
+		uint32 checkFP = ComputeFingerprint();
 		if (fFingerprint != checkFP) {
 			log_team(LOG_WARNING, &quot;default-catalog(sig=%s, lang=%s) &quot;
 				&quot;has wrong fingerprint after load (%ld instead of the %ld). &quot;
@@ -524,7 +527,7 @@
 
 BCatalogAddOn *
 DefaultCatalog::Instantiate(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 {
 	DefaultCatalog *catalog
 		= new(std::nothrow) DefaultCatalog(signature, language, fingerprint);

Modified: haiku/branches/components/gsoc-locale-kit/src/kits/locale/HashMapCatalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/kits/locale/HashMapCatalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/kits/locale/HashMapCatalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -145,12 +145,54 @@
 }
 
 
+void
+parseQuotedChars(BString&amp; stringToParse)
+{
+	char* in = stringToParse.LockBuffer(0);
+	char* out = in;
+	int newLength = 0;
+	bool quoted = false;
+
+	while (*in != 0 || quoted) {
+		if (quoted) {
+			if (*in == 'n')
+				*out = '\n';
+			else if (*in == 't')
+				*out = '\t';
+			else if (*in == '&quot;')
+				*out = '&quot;';
+			else {
+				// dump quote from unknown quoting-sequence:
+				*out = *in ;
+			}
+			quoted = false;
+			out++;
+			newLength++;
+		} else {
+			quoted = (*in == '\\');
+			if (!quoted) {
+				*out = *in;
+				out++;
+				newLength++;
+			}
+		}
+		in++;
+	}
+	*out = '\0';
+	stringToParse.UnlockBuffer();
+}
+
+
 status_t
 BHashMapCatalog::SetString(const char *string, const char *translated,
 	const char *context, const char *comment)
 {
-	CatKey key(string, context, comment);
-	fCatMap[key] = translated;
+	BString stringCopy(string);
+	BString translatedCopy(translated);
+	parseQuotedChars(stringCopy);
+	parseQuotedChars(translatedCopy);
+	CatKey key(stringCopy.String(), context, comment);
+	fCatMap[key] = translatedCopy.String();
 		// overwrite existing element
 	return B_OK;
 }
@@ -159,8 +201,10 @@
 status_t
 BHashMapCatalog::SetString(int32 id, const char *translated)
 {
+	BString translatedCopy(translated);
+	parseQuotedChars(translatedCopy);
 	CatKey key(id);
-	fCatMap[key] = translated;
+	fCatMap[key] = translatedCopy.String();
 		// overwrite existing element
 	return B_OK;
 }
@@ -169,7 +213,9 @@
 status_t
 BHashMapCatalog::SetString(const CatKey&amp; key, const char *translated)
 {
-	fCatMap[key] = translated;
+	BString translatedCopy(translated);
+	parseQuotedChars(translatedCopy);
+	fCatMap[key] = translatedCopy.String();
 		// overwrite existing element
 	return B_OK;
 }
@@ -181,7 +227,7 @@
  * different languages of the same app to have the same fingerprint, since we
  * use it to separate different catalog-versions.
  */
-int32
+uint32
 BHashMapCatalog::ComputeFingerprint() const
 {
 	uint32 adler = adler32(0, NULL, 0);

Modified: haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -30,7 +30,7 @@
 static const char *kPriorityAttr = &quot;ADDON:priority&quot;;
 
 typedef BCatalogAddOn *(*InstantiateCatalogFunc)(const char *name,
-	const char *language, int32 fingerprint);
+	const char *language, uint32 fingerprint);
 
 typedef BCatalogAddOn *(*CreateCatalogFunc)(const char *name,
 	const char *language);

Modified: haiku/branches/components/gsoc-locale-kit/src/preferences/locale/french.catkeys
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/preferences/locale/french.catkeys	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/preferences/locale/french.catkeys	2009-07-17 12:30:49 UTC (rev 31619)
@@ -1,7 +1,7 @@
 1	french	x-vnd.Haiku-Locale	101974625
-Locale\n\twritten by Axel D&#246;rfler\n\tCopyright 2005, Haiku.\n\n	Locale Preflet		2612084183	Locale\n\t&#233;crit par Axel D&#246;rfler\n\tCopyright 2009, Haiku.\n\n
-Keyboard	Locale Preflet Window		439013050	Clavier
-Defaults	Locale Preflet Window		3903918745	D&#233;fauts
-Revert	Locale Preflet Window		3820004861	D&#233;faire
-Country	Locale Preflet Window		573711869	Pays
-Language	Locale Preflet Window		1031611593	Langage
+Locale\n\twritten by Axel D&#246;rfler\n\tCopyright 2005, Haiku.\n\n	Locale Preflet		Locale\n\t&#233;crit par Axel D&#246;rfler\n\tCopyright 2009, Haiku.\n\n
+Keyboard	Locale Preflet Window		Clavier
+Defaults	Locale Preflet Window		D&#233;fauts
+Revert	Locale Preflet Window		D&#233;faire
+Country	Locale Preflet Window		Pays
+Language	Locale Preflet Window		Langage

Modified: haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTest.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTest.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTest.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -112,7 +112,7 @@
 	res = be_locale-&gt;GetAppCatalog(&amp;cat);
 	assert(res == B_OK);
 	// fetch basic data:
-	int32 fingerprint = 0;
+	uint32 fingerprint = 0;
 	res = cat.GetFingerprint(&amp;fingerprint);
 	assert(res == B_OK);
 	BString lang;

Modified: haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTestAddOn.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTestAddOn.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/tests/kits/locale/catalogTestAddOn.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -100,7 +100,7 @@
 	res = get_add_on_catalog(&amp;cat, catSig);
 	assert(res == B_OK);
 	// fetch basic data:
-	int32 fingerprint;
+	uint32 fingerprint;
 	res = cat.GetFingerprint(&amp;fingerprint);
 	assert(res == B_OK);
 	BString lang;

Modified: haiku/branches/components/gsoc-locale-kit/src/tools/locale/Catalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/tools/locale/Catalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/tools/locale/Catalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -32,7 +32,7 @@
 
 
 BCatalog::BCatalog(const char *signature, const char *language, 
-	int32 fingerprint)
+	uint32 fingerprint)
 {
 	//fCatalog = be_locale_roster-&gt;LoadCatalog(signature, language, fingerprint);
 }
@@ -113,7 +113,7 @@
 
 //#pragma mark - BCatalogAddOn
 BCatalogAddOn::BCatalogAddOn(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 	:
 	fInitCheck(B_NO_INIT),
 	fSignature(signature),

Modified: haiku/branches/components/gsoc-locale-kit/src/tools/locale/DefaultCatalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/tools/locale/DefaultCatalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/tools/locale/DefaultCatalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -43,9 +43,6 @@
  */
 
 
-static const char *kCatFolder = &quot;catalogs&quot;;
-static const char *kCatExtension = &quot;.catalog&quot;;
-
 const char *DefaultCatalog::kCatMimeType
 	= &quot;locale/x-vnd.Be.locale-catalog.default&quot;;
 
@@ -60,7 +57,7 @@
  * give an appropriate error-code otherwise.
  */
 DefaultCatalog::DefaultCatalog(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 	:
 	BHashMapCatalog(signature, language, fingerprint)
 {
@@ -133,7 +130,7 @@
 
 	auto_ptr&lt;char&gt; buf(new(std::nothrow) char [sz]);
 	if (buf.get() == NULL) {
-		fprintf(stderr, &quot;couldn't allocate array of %d chars\n&quot;, sz);
+		fprintf(stderr, &quot;couldn't allocate array of %Ld chars\n&quot;, sz);
 		return B_NO_MEMORY;
 	}
 	res = catalogFile.Read(buf.get(), sz);
@@ -245,7 +242,7 @@
 
 	status_t res;
 	BMessage archive;
-	int32 count = fCatMap.size();
+	uint32 count = fCatMap.size();
 	res = archive.AddString(&quot;class&quot;, &quot;DefaultCatalog&quot;)
 		|| archive.AddInt32(&quot;c:sz&quot;, count)
 		|| archive.AddInt16(&quot;c:ver&quot;, kCatArchiveVersion)
@@ -286,7 +283,7 @@
 	if (res == B_OK) {
 		fLanguageName = archiveMsg.FindString(&quot;c:lang&quot;);
 		fSignature = archiveMsg.FindString(&quot;c:sig&quot;);
-		int32 foundFingerprint = archiveMsg.FindInt32(&quot;c:fpr&quot;);
+		uint32 foundFingerprint = archiveMsg.FindInt32(&quot;c:fpr&quot;);
 
 		// if a specific fingerprint has been requested and the catalog does in
 		// fact have a fingerprint, both are compared. If they mismatch, we do
@@ -328,7 +325,7 @@
 					BString&gt;(key, translated));
 			}
 		}
-		int32 checkFP = ComputeFingerprint();
+		uint32 checkFP = ComputeFingerprint();
 		if (fFingerprint != checkFP) {
 			fprintf(stderr, &quot;default-catalog(sig=%s, lang=%s) &quot;
 				&quot;has wrong fingerprint after load (%ld instead of the %ld). &quot;
@@ -345,7 +342,7 @@
 
 BCatalogAddOn *
 DefaultCatalog::Instantiate(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 {
 	DefaultCatalog *catalog
 		= new(std::nothrow) DefaultCatalog(signature, language, fingerprint);

Modified: haiku/branches/components/gsoc-locale-kit/src/tools/locale/HashMapCatalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/tools/locale/HashMapCatalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/tools/locale/HashMapCatalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -145,12 +145,54 @@
 }
 
 
+void
+parseQuotedChars(BString&amp; stringToParse)
+{
+	char* in = stringToParse.LockBuffer(0);
+	char* out = in;
+	int newLength = 0;
+	bool quoted = false;
+
+	while (*in != 0 || quoted) {
+		if (quoted) {
+			if (*in == 'n')
+				*out = '\n';
+			else if (*in == 't')
+				*out = '\t';
+			else if (*in == '&quot;')
+				*out = '&quot;';
+			else {
+				// dump quote from unknown quoting-sequence:
+				*out = *in ;
+			}
+			quoted = false;
+			out++;
+			newLength++;
+		} else {
+			quoted = (*in == '\\');
+			if (!quoted) {
+				*out = *in;
+				out++;
+				newLength++;
+			}
+		}
+		in++;
+	}
+	*out = '\0';
+	stringToParse.UnlockBuffer();
+}
+
+
 status_t
 BHashMapCatalog::SetString(const char *string, const char *translated,
 	const char *context, const char *comment)
 {
-	CatKey key(string, context, comment);
-	fCatMap[key] = translated;
+	BString stringCopy(string);
+	BString translatedCopy(translated);
+	parseQuotedChars(stringCopy);
+	parseQuotedChars(translatedCopy);
+	CatKey key(stringCopy.String(), context, comment);
+	fCatMap[key] = translatedCopy.String();
 		// overwrite existing element
 	return B_OK;
 }
@@ -159,8 +201,10 @@
 status_t
 BHashMapCatalog::SetString(int32 id, const char *translated)
 {
+	BString translatedCopy(translated);
+	parseQuotedChars(translatedCopy);
 	CatKey key(id);
-	fCatMap[key] = translated;
+	fCatMap[key] = translatedCopy.String();
 		// overwrite existing element
 	return B_OK;
 }
@@ -169,7 +213,9 @@
 status_t
 BHashMapCatalog::SetString(const CatKey&amp; key, const char *translated)
 {
-	fCatMap[key] = translated;
+	BString translatedCopy(translated);
+	parseQuotedChars(translatedCopy);
+	fCatMap[key] = translatedCopy.String();
 		// overwrite existing element
 	return B_OK;
 }
@@ -181,7 +227,7 @@
  * different languages of the same app to have the same fingerprint, since we
  * use it to separate different catalog-versions.
  */
-int32
+uint32
 BHashMapCatalog::ComputeFingerprint() const
 {
 	uint32 adler = adler32(0, NULL, 0);

Modified: haiku/branches/components/gsoc-locale-kit/src/tools/locale/PlainTextCatalog.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/tools/locale/PlainTextCatalog.cpp	2009-07-17 11:58:33 UTC (rev 31618)
+++ haiku/branches/components/gsoc-locale-kit/src/tools/locale/PlainTextCatalog.cpp	2009-07-17 12:30:49 UTC (rev 31619)
@@ -58,6 +58,15 @@
 	// version of the catalog archive structure, bump this if you change it!
 
 
+void
+escapeQuotedChars(BString&amp; stringToEscape)
+{
+	stringToEscape.ReplaceAll(&quot;\n&quot;,&quot;\\n&quot;);
+	stringToEscape.ReplaceAll(&quot;\t&quot;,&quot;\\t&quot;);
+	stringToEscape.ReplaceAll(&quot;\&quot;&quot;,&quot;\\\&quot;&quot;);
+}
+
+
 /*
  * constructs a PlainTextCatalog with given signature and language and reads
  * the catalog from disk.
@@ -65,7 +74,7 @@
  * give an appropriate error-code otherwise.
  */
 PlainTextCatalog::PlainTextCatalog(const char *signature, const char *language,
-	int32 fingerprint)
+	uint32 fingerprint)
 	:
 	BHashMapCatalog(signature, language, fingerprint)
 {
@@ -162,7 +171,7 @@
 	if (std::getline(catalogFile, currentItem).good()) {
 		// Get the fingerprint
 		std::istringstream ss(currentItem);
-		int foundFingerprint;
+		uint32 foundFingerprint;
 		ss &gt;&gt; foundFingerprint;
 		if (ss.fail()) {
 			fprintf(stderr, &quot;Unable to get fingerprint (%s) from %s\n&quot;,
@@ -185,15 +194,10 @@
 	std::string originalString;
 	std::string context;
 	std::string comment;
-	std::string stringKey;
 	std::string translated;
 
-	uint32 key;
-
 	while (std::getline(catalogFile, originalString,'\t').good()) {
-		// Each line is : &quot;original string \t key \t translated string&quot;
-		// However, the original string is also tab-separated because it
-		// also holds the context and comment
+		// Each line is : &quot;original string \t context \t comment \t translation&quot;
 
 		if (!std::getline(catalogFile,context,'\t').good()) {
 			fprintf(stderr, &quot;Unable to get context for string %s from %s\n&quot;,
@@ -207,13 +211,6 @@
 			return B_ERROR;
 		}
 
-		if (!std::getline(catalogFile,stringKey,'\t').good()) {
-			fprintf(stderr,
-				&quot;Unable to get key for string %s (%s / %s) from %s\n&quot;,
-				originalString.c_str(), context.c_str(), comment.c_str(), path);
-			return B_ERROR;
-		}

[... truncated: 189 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018077.html">[Haiku-commits] r31618 -	haiku/trunk/src/add-ons/media/plugins/ffmpeg
</A></li>
	<LI>Next message: <A HREF="018079.html">[Haiku-commits] r31620 - haiku/trunk/data/system/boot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18078">[ date ]</a>
              <a href="thread.html#18078">[ thread ]</a>
              <a href="subject.html#18078">[ subject ]</a>
              <a href="author.html#18078">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
