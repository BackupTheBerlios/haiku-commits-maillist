<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r31658 - in haiku/trunk:	headers/private/kernel/disk_device_manager	headers/private/storage src/add-ons/disk_systems/bfs	src/add-ons/disk_systems/intel	src/add-ons/kernel/partitioning_systems/intel	src/apps/drivesetup src/kits/storage src/kits/storage/disk_device	src/system/kernel/disk_device_manager
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31658%20-%20in%20haiku/trunk%3A%0A%09headers/private/kernel/disk_device_manager%0A%09headers/private/storage%20src/add-ons/disk_systems/bfs%0A%09src/add-ons/disk_systems/intel%0A%09src/add-ons/kernel/partitioning_systems/intel%0A%09src/apps/drivesetup%20src/kits/storage%20src/kits/storage/disk_device%0A%09src/system/kernel/disk_device_manager&In-Reply-To=%3C200907202029.n6KKTTHs003243%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018122.html">
   <LINK REL="Next"  HREF="018124.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r31658 - in haiku/trunk:	headers/private/kernel/disk_device_manager	headers/private/storage src/add-ons/disk_systems/bfs	src/add-ons/disk_systems/intel	src/add-ons/kernel/partitioning_systems/intel	src/apps/drivesetup src/kits/storage src/kits/storage/disk_device	src/system/kernel/disk_device_manager</H1>
    <B>bonefish at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31658%20-%20in%20haiku/trunk%3A%0A%09headers/private/kernel/disk_device_manager%0A%09headers/private/storage%20src/add-ons/disk_systems/bfs%0A%09src/add-ons/disk_systems/intel%0A%09src/add-ons/kernel/partitioning_systems/intel%0A%09src/apps/drivesetup%20src/kits/storage%20src/kits/storage/disk_device%0A%09src/system/kernel/disk_device_manager&In-Reply-To=%3C200907202029.n6KKTTHs003243%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r31658 - in haiku/trunk:	headers/private/kernel/disk_device_manager	headers/private/storage src/add-ons/disk_systems/bfs	src/add-ons/disk_systems/intel	src/add-ons/kernel/partitioning_systems/intel	src/apps/drivesetup src/kits/storage src/kits/storage/disk_device	src/system/kernel/disk_device_manager">bonefish at mail.berlios.de
       </A><BR>
    <I>Mon Jul 20 22:29:29 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="018122.html">[Haiku-commits] r31657 - haiku/trunk/src/servers/app
</A></li>
        <LI>Next message: <A HREF="018124.html">[Haiku-commits] r31659 -	haiku/trunk/src/add-ons/kernel/drivers/input/ps2_hid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18123">[ date ]</a>
              <a href="thread.html#18123">[ thread ]</a>
              <a href="subject.html#18123">[ subject ]</a>
              <a href="author.html#18123">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2009-07-20 22:29:16 +0200 (Mon, 20 Jul 2009)
New Revision: 31658
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=31658&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=31658&amp;view=rev</A>

Added:
   haiku/trunk/headers/private/storage/PartitionParameterEditor.h
   haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.cpp
   haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.h
   haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.cpp
   haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.h
   haiku/trunk/src/kits/storage/disk_device/PartitionParameterEditor.cpp
Modified:
   haiku/trunk/headers/private/kernel/disk_device_manager/ddm_modules.h
   haiku/trunk/headers/private/storage/DiskSystemAddOn.h
   haiku/trunk/headers/private/storage/Partition.h
   haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.cpp
   haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.h
   haiku/trunk/src/add-ons/disk_systems/bfs/Jamfile
   haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.cpp
   haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.h
   haiku/trunk/src/add-ons/disk_systems/intel/Jamfile
   haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.cpp
   haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.h
   haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.cpp
   haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.h
   haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/write_support.cpp
   haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/write_support.h
   haiku/trunk/src/apps/drivesetup/CreateParamsPanel.cpp
   haiku/trunk/src/apps/drivesetup/CreateParamsPanel.h
   haiku/trunk/src/apps/drivesetup/InitParamsPanel.cpp
   haiku/trunk/src/apps/drivesetup/InitParamsPanel.h
   haiku/trunk/src/apps/drivesetup/MainWindow.cpp
   haiku/trunk/src/apps/drivesetup/MainWindow.h
   haiku/trunk/src/kits/storage/Jamfile
   haiku/trunk/src/kits/storage/disk_device/DiskSystemAddOn.cpp
   haiku/trunk/src/kits/storage/disk_device/Partition.cpp
   haiku/trunk/src/kits/storage/disk_device/PartitionDelegate.cpp
   haiku/trunk/src/kits/storage/disk_device/PartitionDelegate.h
   haiku/trunk/src/system/kernel/disk_device_manager/KPartitioningSystem.cpp
Log:
Patch by Bryce Groff with changes by myself:
* Added missing name parameter to the partitioning system module child creation
  and child creation validation hooks. Pass the name to them.
* Added BPartitionParameterEditor interface, which is/will be used for editing
  disk system specific parameters.
* Implemented partition parameter editors for BFS initialization and Intel
  partition map child creation.
* Fixed the incorrect supported child partition type iteration in the Intel
  partition map add-on. It does now return actual types.
* Handle the &quot;active&quot; flag parameter in the Intel partitioning system module.
* DriveSetup:
  - Replaced the &quot;Create&quot; submenu by a simple menu item. The type can now by
    chosen in the dialog.
  - Make use of initialization and child creation parameter editors. Some
    non-generic code has been moved to the respective editor implementations
    (BFS, intel partitioning system).


Modified: haiku/trunk/headers/private/kernel/disk_device_manager/ddm_modules.h
===================================================================
--- haiku/trunk/headers/private/kernel/disk_device_manager/ddm_modules.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/headers/private/kernel/disk_device_manager/ddm_modules.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -57,8 +57,8 @@
 	bool (*validate_initialize)(partition_data* partition, char* name,
 				const char* parameters);
 	bool (*validate_create_child)(partition_data* partition, off_t* start,
-				off_t* size, const char* type, const char* parameters,
-				int32* index);
+				off_t* size, const char* type, const char* name,
+				const char* parameters, int32* index);
 	status_t (*get_partitionable_spaces)(partition_data* partition,
 				partitionable_space_data* buffer, int32 count,
 				int32* actualCount);
@@ -100,8 +100,9 @@
 	status_t (*initialize)(int fd, partition_id partition, const char* name,
 				const char *parameters, off_t partitionSize, disk_job_id job);
 	status_t (*create_child)(int fd, partition_id partition, off_t offset,
-				off_t size, const char* type, const char* parameters,
-				disk_job_id job, partition_id* childID);
+				off_t size, const char* type, const char* name, 
+				const char* parameters, disk_job_id job, 
+				partition_id* childID);
 		// childID is used for the return value, but is also an optional input
 		// parameter -- -1 to be ignored
 	status_t (*delete_child)(int fd, partition_id partition, partition_id child,

Modified: haiku/trunk/headers/private/storage/DiskSystemAddOn.h
===================================================================
--- haiku/trunk/headers/private/storage/DiskSystemAddOn.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/headers/private/storage/DiskSystemAddOn.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -9,7 +9,7 @@
 #include &lt;SupportDefs.h&gt;
 
 
-class BDiskDeviceParameterEditor;
+class BPartitionParameterEditor;
 class BList;
 class BMutablePartition;
 class BPartitionHandle;
@@ -33,7 +33,7 @@
 									const BMutablePartition* partition);
 	virtual	status_t			GetInitializationParameterEditor(
 									const BMutablePartition* partition,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateInitialize(
 									const BMutablePartition* partition,
 									BString* name, const char* parameters);
@@ -107,10 +107,10 @@
 									const char* type);
 
 	virtual	status_t			GetContentParameterEditor(
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			GetParameterEditor(
 									const BMutablePartition* child,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateSetContentParameters(
 									const char* parameters);
 	virtual	status_t			ValidateSetParameters(
@@ -122,7 +122,7 @@
 
 	virtual	status_t			GetChildCreationParameterEditor(
 									const char* type,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateCreateChild(off_t* offset,
 									off_t* size, const char* type,
 									BString* name, const char* parameters);

Modified: haiku/trunk/headers/private/storage/Partition.h
===================================================================
--- haiku/trunk/headers/private/storage/Partition.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/headers/private/storage/Partition.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -6,6 +6,7 @@
 #ifndef _PARTITION_H
 #define _PARTITION_H
 
+
 #include &lt;DiskDeviceDefs.h&gt;
 #include &lt;Messenger.h&gt;
 #include &lt;Mime.h&gt;
@@ -14,7 +15,7 @@
 
 class BBitmap;
 class BDiskDevice;
-class BDiskDeviceParameterEditor;
+class BPartitionParameterEditor;
 class BDiskDeviceVisitor;
 class BDiskSystem;
 class BMutablePartition;
@@ -128,13 +129,13 @@
 
 			bool				CanEditParameters() const;
 			status_t			GetParameterEditor(
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 			status_t			SetParameters(const char* parameters);
 
 			bool				CanEditContentParameters(
 									bool* whileMounted = NULL) const;
 			status_t			GetContentParameterEditor(
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 			status_t			SetContentParameters(const char* parameters);
 
 			status_t			GetNextSupportedType(int32 *cookie,
@@ -152,7 +153,7 @@
 			bool				CanInitialize(const char* diskSystem) const;
 			status_t			GetInitializationParameterEditor(
 									const char* system,
-									BDiskDeviceParameterEditor** editor) const;
+									BPartitionParameterEditor** editor) const;
 			status_t			ValidateInitialize(const char* diskSystem,
 									BString* name, const char* parameters);
 			status_t			Initialize(const char* diskSystem,
@@ -164,7 +165,7 @@
 			bool				CanCreateChild() const;
 			status_t			GetChildCreationParameterEditor(
 									const char* type,
-									BDiskDeviceParameterEditor** editor) const;
+									BPartitionParameterEditor** editor) const;
 			status_t			ValidateCreateChild(off_t* start, off_t* size,
 									const char* type, BString* name,
 									const char* parameters) const;
@@ -176,6 +177,8 @@
 			bool				CanDeleteChild(int32 index) const;
 			status_t			DeleteChild(int32 index);
 
+			bool				SupportsChildName() const;
+
 private:
 			class Delegate;
 
@@ -230,4 +233,5 @@
 			Delegate*			fDelegate;
 };
 
+
 #endif	// _PARTITION_H

Added: haiku/trunk/headers/private/storage/PartitionParameterEditor.h
===================================================================
--- haiku/trunk/headers/private/storage/PartitionParameterEditor.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/headers/private/storage/PartitionParameterEditor.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -0,0 +1,34 @@
+/*
+ * Copyright 2009, Bryce Groff, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">brycegroff at gmail.com.</A>
+ * Distributed under the terms of the MIT License.
+ */
+#ifndef _PARTITION_PARAMETER_EDITOR_H
+#define _PARTITION_PARAMETER_EDITOR_H
+
+
+#include &lt;View.h&gt;
+
+
+// BPartitionParameterEditor
+class BPartitionParameterEditor {
+public:
+								BPartitionParameterEditor();
+	virtual						~BPartitionParameterEditor();
+
+	virtual		bool			FinishedEditing();
+
+	virtual		BView*			View();
+
+	virtual		status_t		GetParameters(BString* parameters);
+
+	// TODO: Those are child creation specific and shouldn't be in a generic
+	// interface. Something like a
+	// GenericPartitionParameterChanged(partition_parameter_type,
+	//		const BVariant&amp;)
+	// would be better.
+	virtual		status_t		PartitionTypeChanged(const char* type);
+	virtual		status_t		PartitionNameChanged(const char* name);
+};
+
+
+#endif //_PARTITION_PARAMETER_EDITOR_H

Modified: haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.cpp
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.cpp	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.cpp	2009-07-20 20:29:16 UTC (rev 31658)
@@ -5,7 +5,9 @@
  * Distributed under the terms of the MIT License.
  */
 
+
 #include &quot;BFSAddOn.h&quot;
+#include &quot;InitializeParameterEditor.h&quot;
 
 #include &lt;new&gt;
 
@@ -100,10 +102,15 @@
 // GetInitializationParameterEditor
 status_t
 BFSAddOn::GetInitializationParameterEditor(const BMutablePartition* partition,
-	BDiskDeviceParameterEditor** editor)
+	BPartitionParameterEditor** editor)
 {
-	// TODO: Implement!
 	*editor = NULL;
+
+	try {
+		*editor = new InitializeBFSEditor();
+	} catch (std::bad_alloc) {
+		return B_NO_MEMORY;
+	}
 	return B_OK;
 }
 

Modified: haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.h
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/bfs/BFSAddOn.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -21,7 +21,7 @@
 									const BMutablePartition* partition);
 	virtual	status_t			GetInitializationParameterEditor(
 									const BMutablePartition* partition,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateInitialize(
 									const BMutablePartition* partition,
 									BString* name, const char* parameters);

Added: haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.cpp
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.cpp	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.cpp	2009-07-20 20:29:16 UTC (rev 31658)
@@ -0,0 +1,136 @@
+/*
+ * Copyright 2009, Bryce Groff, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">brycegroff at gmail.com.</A>
+ * Distributed under the terms of the MIT License.
+ */
+
+
+#include &lt;stdio.h&gt;
+
+#include &quot;InitializeParameterEditor.h&quot;
+
+#include &lt;Button.h&gt;
+#include &lt;GroupLayoutBuilder.h&gt;
+#include &lt;GridLayoutBuilder.h&gt;
+#include &lt;MenuField.h&gt;
+#include &lt;MenuItem.h&gt;
+#include &lt;PartitionParameterEditor.h&gt;
+#include &lt;PopUpMenu.h&gt;
+#include &lt;SpaceLayoutItem.h&gt;
+#include &lt;View.h&gt;
+#include &lt;Window.h&gt;
+
+
+static uint32 MSG_BLOCK_SIZE = 'blsz';
+
+
+InitializeBFSEditor::InitializeBFSEditor()
+	:
+	BPartitionParameterEditor(),
+	fView(NULL),
+	fNameTC(NULL),
+	fBlockSizeMF(NULL),
+	fParameters(NULL)
+{
+	_CreateViewControls();
+}
+
+
+InitializeBFSEditor::~InitializeBFSEditor()
+{
+}
+
+
+BView*
+InitializeBFSEditor::View()
+{
+	return fView;
+}
+
+
+bool
+InitializeBFSEditor::FinishedEditing()
+{
+	fParameters = &quot;&quot;;
+	if (BMenuItem* item = fBlockSizeMF-&gt;Menu()-&gt;FindMarked()) {
+		const char* size;
+		BMessage* message = item-&gt;Message();
+		if (!message || message-&gt;FindString(&quot;size&quot;, &amp;size) &lt; B_OK)
+			size = &quot;2048&quot;;
+		// TODO: use libroot driver settings API
+		fParameters &lt;&lt; &quot;block_size &quot; &lt;&lt; size &lt;&lt; &quot;;\n&quot;;
+	}
+	fParameters &lt;&lt; &quot;name &quot; &lt;&lt; fNameTC-&gt;Text() &lt;&lt; &quot;;\n&quot;;
+
+	return true;
+}
+
+
+status_t
+InitializeBFSEditor::GetParameters(BString* parameters)
+{
+	if (parameters == NULL)
+		return B_BAD_VALUE;
+
+	*parameters = fParameters;
+	return B_OK;
+}
+
+
+status_t
+InitializeBFSEditor::PartitionNameChanged(const char* name)
+{
+	fNameTC-&gt;SetText(name);
+	return B_OK;
+}
+
+
+void
+InitializeBFSEditor::_CreateViewControls()
+{
+	fNameTC = new BTextControl(&quot;Name&quot;, &quot;Haiku&quot;, NULL);
+	// TODO find out what is the max length for this specific FS partition name
+	fNameTC-&gt;TextView()-&gt;SetMaxBytes(31);
+
+	BPopUpMenu* blocksizeMenu = new BPopUpMenu(&quot;Blocksize&quot;);
+	BMessage* message = new BMessage(MSG_BLOCK_SIZE);
+	message-&gt;AddString(&quot;size&quot;, &quot;1024&quot;);
+	blocksizeMenu-&gt;AddItem(new BMenuItem(&quot;1024 (Mostly small files)&quot;,
+		message));
+	message = new BMessage(MSG_BLOCK_SIZE);
+	message-&gt;AddString(&quot;size&quot;, &quot;2048&quot;);
+	BMenuItem* defaultItem = new BMenuItem(&quot;2048 (Recommended)&quot;, message);
+	blocksizeMenu-&gt;AddItem(defaultItem);
+	message = new BMessage(MSG_BLOCK_SIZE);
+	message-&gt;AddString(&quot;size&quot;, &quot;4096&quot;);
+	blocksizeMenu-&gt;AddItem(new BMenuItem(&quot;4096&quot;, message));
+	message = new BMessage(MSG_BLOCK_SIZE);
+	message-&gt;AddString(&quot;size&quot;, &quot;8192&quot;);
+	blocksizeMenu-&gt;AddItem(new BMenuItem(&quot;8192 (Mostly large files)&quot;,
+		message));
+
+	fBlockSizeMF = new BMenuField(&quot;Blocksize&quot;, blocksizeMenu, NULL);
+	defaultItem-&gt;SetMarked(true);
+
+	fView = BGroupLayoutBuilder(B_VERTICAL, 5)
+		.Add(BSpaceLayoutItem::CreateVerticalStrut(10))
+
+		// test views
+		.Add(BGridLayoutBuilder(10, 10)
+			// row 1
+			.Add(BSpaceLayoutItem::CreateHorizontalStrut(5), 0, 0)
+
+			.Add(fNameTC-&gt;CreateLabelLayoutItem(), 1, 0)
+			.Add(fNameTC-&gt;CreateTextViewLayoutItem(), 2, 0)
+
+			.Add(BSpaceLayoutItem::CreateHorizontalStrut(10), 3, 0)
+
+			// row 2
+			.Add(BSpaceLayoutItem::CreateHorizontalStrut(10), 0, 1)
+
+			.Add(fBlockSizeMF-&gt;CreateLabelLayoutItem(), 1, 1)
+			.Add(fBlockSizeMF-&gt;CreateMenuBarLayoutItem(), 2, 1)
+
+			.Add(BSpaceLayoutItem::CreateHorizontalStrut(5), 3, 1)
+		)
+	;
+}

Added: haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.h
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/bfs/InitializeParameterEditor.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -0,0 +1,38 @@
+/*
+ * Copyright 2009, Bryce Groff, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">brycegroff at gmail.com.</A>
+ * Distributed under the terms of the MIT License.
+ */
+#ifndef _INITIALIZE_PARAMETER_EDITOR
+#define _INITIALIZE_PARAMETER_EDITOR
+
+
+#include &lt;PartitionParameterEditor.h&gt;
+
+#include &lt;MenuField.h&gt;
+#include &lt;TextControl.h&gt;
+#include &lt;String.h&gt;
+#include &lt;View.h&gt;
+
+
+class InitializeBFSEditor : public BPartitionParameterEditor {
+public:
+								InitializeBFSEditor();
+	virtual						~InitializeBFSEditor();
+
+	virtual		bool			FinishedEditing();
+	virtual		BView*			View();
+	virtual		status_t		GetParameters(BString* parameters);
+
+	virtual		status_t		PartitionNameChanged(const char* name);
+
+private:
+				void			_CreateViewControls();
+
+				BView*			fView;
+				BTextControl*	fNameTC;
+				BMenuField*		fBlockSizeMF;
+				BString			fParameters;
+};
+
+
+#endif //_INITIALIZE_PARAMETER_EDITOR

Modified: haiku/trunk/src/add-ons/disk_systems/bfs/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/bfs/Jamfile	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/bfs/Jamfile	2009-07-20 20:29:16 UTC (rev 31658)
@@ -7,6 +7,7 @@
 
 Addon &lt;disk_system&gt;bfs :
 	BFSAddOn.cpp
+	InitializeParameterEditor.cpp
 
 	bfs_disk_system.cpp
 

Added: haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.cpp
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.cpp	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.cpp	2009-07-20 20:29:16 UTC (rev 31658)
@@ -0,0 +1,71 @@
+/*
+ * Copyright 2009, Bryce Groff, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">brycegroff at gmail.com.</A>
+ * Distributed under the terms of the MIT License.
+ */
+
+
+#include &quot;CreationParameterEditor.h&quot;
+
+#include &lt;DiskDeviceTypes.h&gt;
+#include &lt;GroupLayoutBuilder.h&gt;
+#include &lt;PartitionParameterEditor.h&gt;
+#include &lt;View.h&gt;
+
+
+PrimaryPartitionEditor::PrimaryPartitionEditor()
+	:
+	BPartitionParameterEditor(),
+	fView(NULL),
+	fActiveCB(NULL),
+	fParameters(NULL)
+{
+	fActiveCB = new BCheckBox(&quot;active&quot;, &quot;Active Partition&quot;, NULL);
+	fView = BGroupLayoutBuilder(B_VERTICAL, 4)
+		.Add(fActiveCB)
+	;
+}
+
+
+PrimaryPartitionEditor::~PrimaryPartitionEditor()
+{
+}
+
+
+BView*
+PrimaryPartitionEditor::View()
+{
+	return fView;
+}
+
+
+bool
+PrimaryPartitionEditor::FinishedEditing()
+{
+	if (fActiveCB-&gt;IsEnabled()) {
+		if (fActiveCB-&gt;Value() == B_CONTROL_ON)
+			fParameters.SetTo(&quot;active true ;&quot;);
+		else
+			fParameters.SetTo(&quot;active false ;&quot;);
+	} else fParameters.SetTo(&quot;&quot;);
+
+	return true;
+}
+
+
+status_t
+PrimaryPartitionEditor::GetParameters(BString* parameters)
+{
+	if (fParameters == NULL)
+		return B_BAD_VALUE;
+
+	*parameters = fParameters;
+	return B_OK;
+}
+
+
+status_t
+PrimaryPartitionEditor::PartitionTypeChanged(const char* type)
+{
+	fActiveCB-&gt;SetEnabled(strcmp(type, kPartitionTypeIntelExtended) != 0);
+	return B_OK;
+}

Added: haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.h
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/intel/CreationParameterEditor.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -0,0 +1,34 @@
+/*
+ * Copyright 2009, Bryce Groff, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">brycegroff at gmail.com.</A>
+ * Distributed under the terms of the MIT License.
+ */
+#ifndef _CREATION_PARAMETER_EDITOR
+#define _CREATION_PARAMETER_EDITOR
+
+
+#include &lt;PartitionParameterEditor.h&gt;
+
+#include &lt;CheckBox.h&gt;
+#include &lt;String.h&gt;
+#include &lt;View.h&gt;
+
+
+class PrimaryPartitionEditor : public BPartitionParameterEditor {
+public:
+								PrimaryPartitionEditor();
+	virtual						~PrimaryPartitionEditor();
+
+	virtual		bool			FinishedEditing();
+	virtual		BView*			View();
+	virtual		status_t		GetParameters(BString* parameters);
+
+	virtual		status_t		PartitionTypeChanged(const char* type);
+
+private:
+				BView*			fView;
+				BCheckBox*		fActiveCB;
+				BString			fParameters;
+};
+
+
+#endif //_CREATION_PARAMETER_EDITOR

Modified: haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.cpp
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.cpp	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.cpp	2009-07-20 20:29:16 UTC (rev 31658)
@@ -99,7 +99,7 @@
 // GetInitializationParameterEditor
 status_t
 ExtendedPartitionAddOn::GetInitializationParameterEditor(
-	const BMutablePartition* partition, BDiskDeviceParameterEditor** editor)
+	const BMutablePartition* partition, BPartitionParameterEditor** editor)
 {
 	// Nothing to edit, really.
 	*editor = NULL;
@@ -307,7 +307,7 @@
 // GetChildCreationParameterEditor
 status_t
 ExtendedPartitionHandle::GetChildCreationParameterEditor(const char* type,
-	BDiskDeviceParameterEditor** editor)
+	BPartitionParameterEditor** editor)
 {
 	// TODO: We actually need an editor here.
 	*editor = NULL;

Modified: haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.h
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/intel/ExtendedPartitionAddOn.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -23,7 +23,7 @@
 									const BMutablePartition* partition);
 	virtual	status_t			GetInitializationParameterEditor(
 									const BMutablePartition* partition,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateInitialize(
 									const BMutablePartition* partition,
 									BString* name, const char* parameters);
@@ -54,7 +54,7 @@
 
 	virtual	status_t			GetChildCreationParameterEditor(
 									const char* type,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateCreateChild(off_t* offset,
 									off_t* size, const char* type,
 									BString* name, const char* parameters);

Modified: haiku/trunk/src/add-ons/disk_systems/intel/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/intel/Jamfile	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/intel/Jamfile	2009-07-20 20:29:16 UTC (rev 31658)
@@ -16,6 +16,7 @@
 	IntelDiskSystem.cpp
 	ExtendedPartitionAddOn.cpp
 	PartitionMapAddOn.cpp
+	CreationParameterEditor.cpp
 
 	# kernel sources
 	PartitionMap.cpp

Modified: haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.cpp
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.cpp	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.cpp	2009-07-20 20:29:16 UTC (rev 31658)
@@ -3,6 +3,7 @@
  * Distributed under the terms of the MIT License.
  */
 
+#include &quot;CreationParameterEditor.h&quot;
 #include &quot;PartitionMapAddOn.h&quot;
 
 #include &lt;new&gt;
@@ -99,7 +100,7 @@
 // GetInitializationParameterEditor
 status_t
 PartitionMapAddOn::GetInitializationParameterEditor(
-	const BMutablePartition* partition, BDiskDeviceParameterEditor** editor)
+	const BMutablePartition* partition, BPartitionParameterEditor** editor)
 {
 	// Nothing to edit, really.
 	*editor = NULL;
@@ -263,58 +264,25 @@
 {
 	TRACE(&quot;%p-&gt;PartitionMapHandle::GetNextSupportedType(child: %p, &quot;
 		&quot;cookie: %ld)\n&quot;, this, child, *cookie);
-	// TODO: What are we supposed to do with the child?
 
-	// we support creating two types, primary and extended
-	if (*cookie &lt; 0 || *cookie &gt; 1)
-		return B_ENTRY_NOT_FOUND;
+	int32 index = *cookie;
+	const partition_type* nextType;
+	while (true) {
+		nextType = fPartitionMap.GetNextSupportedPartitionType(index);
+		if (nextType == NULL)
+			return B_ENTRY_NOT_FOUND;
+		index++;
+		if (nextType-&gt;used)
+			break;
+	}
 
-	// check if there are any spaces at all
-	// TODO: check if the spaces have enough size at all
-	BPartitioningInfo info;
-	status_t ret = GetPartitioningInfo(&amp;info);
-	if (ret &lt; B_OK)
-		return ret;
-
-	if (info.CountPartitionableSpaces() == 0)
+	if (!nextType)
 		return B_ENTRY_NOT_FOUND;
 
-	// adjust the cookie here already so that we don't have
-	// to worry about it when returning early below
-	*cookie = *cookie + 1;
+	type-&gt;SetTo(nextType-&gt;name);
+	*cookie = index;
 
-	if (*cookie == 1) {
-		// On first iteration, check if we can create more primary
-		// partitions. If this is not possible, we cannot create
-		// any extended partitions either.
-		for (int32 i = 0; i &lt; 4; i++) {
-			PrimaryPartition* primary = fPartitionMap.PrimaryPartitionAt(i);
-			if (primary-&gt;IsEmpty()) {
-				*type = kPartitionTypeIntelPrimary;
-				return B_OK;
-			}
-		}
-	} else if (*cookie == 2) {
-		// On second iteration, check if we can create more primary
-		// partitions. Also check if there already is an extended
-		// partition, only if there is at least one empty and no
-		// extended partition, we can create an extended partition.
-		bool foundExtended = false;
-		bool foundEmpty = false;
-		for (int32 i = 0; i &lt; 4; i++) {
-			PrimaryPartition* primary = fPartitionMap.PrimaryPartitionAt(i);
-			if (primary-&gt;IsEmpty())
-				foundEmpty = true;
-			else if (primary-&gt;IsExtended())
-				foundExtended = true;
-		}
-		if (foundEmpty &amp;&amp; !foundExtended) {
-			*type = kPartitionTypeIntelExtended;
-			return B_OK;
-		}
-	}
-
-	return B_ENTRY_NOT_FOUND;
+	return B_OK;
 }
 
 
@@ -347,10 +315,15 @@
 // GetChildCreationParameterEditor
 status_t
 PartitionMapHandle::GetChildCreationParameterEditor(const char* type,
-	BDiskDeviceParameterEditor** editor)
+	BPartitionParameterEditor** editor)
 {
-	// TODO: We actually need an editor here.
 	*editor = NULL;
+
+	try {
+		*editor = new PrimaryPartitionEditor();
+	} catch (std::bad_alloc) {
+		return B_NO_MEMORY;
+	}
 	return B_OK;
 }
 
@@ -373,8 +346,12 @@
 		name-&gt;Truncate(0);
 
 	// check parameters
-	// TODO:...
+	void* handle = parse_driver_settings_string(parameters);
+	if (handle == NULL)
+		return B_ERROR;
 
+	bool active = get_driver_boolean_parameter(handle, &quot;active&quot;, false, true);
+
 	// do we have a spare primary partition?
 	if (fPartitionMap.CountNonEmptyPrimaryPartitions() == 4)
 		return B_BAD_VALUE;
@@ -481,12 +458,16 @@
 		return B_BAD_VALUE;
 
 	// check name
-	if (name &amp;&amp; strlen(name) &gt; 0)
+	if (name &amp;&amp; *name != '\0')
 		return B_BAD_VALUE;
 
 	// check parameters
-	// TODO:...
+	void* handle = parse_driver_settings_string(parameters);
+	if (handle == NULL)
+		return B_ERROR;
 
+	bool active = get_driver_boolean_parameter(handle, &quot;active&quot;, false, true);
+
 	// get a spare primary partition
 	PrimaryPartition* primary = NULL;
 	for (int32 i = 0; i &lt; 4; i++) {
@@ -533,7 +514,7 @@
 	// we picked the first empty primary partition.)
 	BMutablePartition* partition = Partition();
 	BMutablePartition* child;
-	error = partition-&gt;CreateChild(primary-&gt;Index(), typeString, NULL,
+	error = partition-&gt;CreateChild(primary-&gt;Index(), typeString, name,
 		parameters, &amp;child);
 	if (error != B_OK)
 		return error;
@@ -546,8 +527,6 @@
 	child-&gt;SetChildCookie(primary);
 
 	// init the primary partition
-	bool active = false;
-		// TODO: Get from parameters!
 	primary-&gt;SetTo(offset, size, type.Type(), active, partition-&gt;BlockSize());
 
 	// TODO: If the child is an extended partition, we should trigger its

Modified: haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.h
===================================================================
--- haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/disk_systems/intel/PartitionMapAddOn.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -23,7 +23,7 @@
 									const BMutablePartition* partition);
 	virtual	status_t			GetInitializationParameterEditor(
 									const BMutablePartition* partition,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateInitialize(
 									const BMutablePartition* partition,
 									BString* name, const char* parameters);
@@ -54,7 +54,7 @@
 
 	virtual	status_t			GetChildCreationParameterEditor(
 									const char* type,
-									BDiskDeviceParameterEditor** editor);
+									BPartitionParameterEditor** editor);
 	virtual	status_t			ValidateCreateChild(off_t* offset,
 									off_t* size, const char* type,
 									BString* name, const char* parameters);

Modified: haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.cpp	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.cpp	2009-07-20 20:29:16 UTC (rev 31658)
@@ -43,11 +43,6 @@
 
 using std::nothrow;
 
-// partition_type
-struct partition_type {
-	uint8		type;
-	const char	*name;
-};
 
 static const char* const kUnrecognizedTypeString = &quot;Unrecognized Type &quot;;
 static const size_t kUnrecognizedTypeStringLength = 18;
@@ -55,36 +50,39 @@
 static const struct partition_type kPartitionTypes[] = {
 	// these entries must be sorted by type (currently not)
 // TODO: Standardize naming.
-	{ 0x00, &quot;empty&quot; },
-	{ 0x01, &quot;FAT 12-bit&quot; },
-	{ 0x02, &quot;Xenix root&quot; },
-	{ 0x03, &quot;Xenix user&quot; },
-	{ 0x04, &quot;FAT 16-bit (dos 3.0)&quot; },
-	{ 0x05, /*&quot;Extended Partition&quot;*/INTEL_EXTENDED_PARTITION_NAME },
-	{ 0x06, &quot;FAT 16-bit (dos 3.31)&quot; },
-	{ 0x07, &quot;OS/2 IFS, Windows NT, Advanced Unix&quot; },
-	{ 0x0b, &quot;FAT 32-bit&quot; },
-	{ 0x0c, &quot;FAT 32-bit, LBA-mapped&quot; },
-	{ 0x0d, &quot;FAT 16-bit, LBA-mapped&quot; },
-	{ 0x0f, /*&quot;Extended Partition, LBA-mapped&quot;*/INTEL_EXTENDED_PARTITION_NAME },
-	{ 0x42, &quot;Windows 2000 marker (switches to a proprietary partition table)&quot; },
-	{ 0x4d, &quot;QNX 4&quot; },
-	{ 0x4e, &quot;QNX 4 2nd part&quot; },
-	{ 0x4f, &quot;QNX 4 3rd part&quot; },
-	{ 0x78, &quot;XOSL boot loader&quot; },
-	{ 0x82, &quot;Linux swapfile&quot; },
-	{ 0x83, &quot;Linux native&quot; },
-	{ 0x85, /*&quot;Linux extendend partition&quot;*/INTEL_EXTENDED_PARTITION_NAME },
-	{ 0xa5, &quot;FreeBSD&quot; },
-	{ 0xa6, &quot;OpenBSD&quot; },
-	{ 0xa7, &quot;NextSTEP&quot; },
-	{ 0xa8, &quot;MacOS X&quot; },
-	{ 0xa9, &quot;NetBSD&quot; },
-	{ 0xab, &quot;MacOS X boot&quot; },
-	{ 0xaf, &quot;MacOS X HFS&quot; },
-	{ 0xbe, &quot;Solaris 8 boot&quot; },
-	{ 0xeb, /*&quot;BeOS&quot;*/ BFS_NAME },
-	{ 0, NULL }
+	{ 0x00, &quot;empty&quot;, true },
+	{ 0x01, &quot;FAT 12-bit&quot;, false},
+	{ 0x02, &quot;Xenix root&quot;, false },
+	{ 0x03, &quot;Xenix user&quot;, false },
+	{ 0x04, &quot;FAT 16-bit (dos 3.0)&quot;, false },
+	{ 0x05, /*&quot;Extended Partition&quot;*/INTEL_EXTENDED_PARTITION_NAME, false },
+	{ 0x06, &quot;FAT 16-bit (dos 3.31)&quot;, false },
+	{ 0x07, &quot;OS/2 IFS, Windows NT, Advanced Unix&quot;, true },
+	{ 0x0b, &quot;FAT 32-bit&quot;, false },
+	{ 0x0c, &quot;FAT 32-bit, LBA-mapped&quot;, true },
+	{ 0x0d, &quot;FAT 16-bit, LBA-mapped&quot;, false },
+	{ 0x0f, /*&quot;Extended Partition, LBA-mapped&quot;*/INTEL_EXTENDED_PARTITION_NAME,
+		true },
+	{ 0x42, &quot;Windows 2000 marker (switches to a proprietary partition table)&quot;,
+		false },
+	{ 0x4d, &quot;QNX 4&quot;, true },
+	{ 0x4e, &quot;QNX 4 2nd part&quot;, false },
+	{ 0x4f, &quot;QNX 4 3rd part&quot;, false },
+	{ 0x78, &quot;XOSL boot loader&quot;, false },
+	{ 0x82, &quot;Linux swapfile&quot;, true },
+	{ 0x83, &quot;Linux native&quot;, true },
+	{ 0x85, /*&quot;Linux extendend partition&quot;*/INTEL_EXTENDED_PARTITION_NAME,
+		false },
+	{ 0xa5, &quot;FreeBSD&quot;, true },
+	{ 0xa6, &quot;OpenBSD&quot;, true },
+	{ 0xa7, &quot;NextSTEP&quot;, false },
+	{ 0xa8, &quot;MacOS X&quot;, true },
+	{ 0xa9, &quot;NetBSD&quot;, true },
+	{ 0xab, &quot;MacOS X boot&quot;, true },
+	{ 0xaf, &quot;MacOS X HFS&quot;, true },
+	{ 0xbe, &quot;Solaris 8 boot&quot;, false },
+	{ 0xeb, /*&quot;BeOS&quot;*/ BFS_NAME, true },
+	{ 0, NULL, false }
 };
 
 static const struct partition_type kPartitionContentTypes[] = {
@@ -835,3 +833,12 @@
 	return result;
 }
 
+
+const partition_type*
+PartitionMap::GetNextSupportedPartitionType(uint32 index)
+{
+	if (index &gt; (sizeof(kPartitionTypes) / sizeof(partition_type) - 2))
+		return NULL;
+
+	return kPartitionTypes + index;
+}

Modified: haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.h	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/PartitionMap.h	2009-07-20 20:29:16 UTC (rev 31658)
@@ -14,6 +14,7 @@
 // NOTE: &lt;<A HREF="http://www.win.tue.nl/~aeb/partitions/partition_tables-2.html">http://www.win.tue.nl/~aeb/partitions/partition_tables-2.html</A>&gt;
 
 #include &lt;SupportDefs.h&gt;
+#include &lt;driver_settings.h&gt;
 
 #ifndef _USER_MODE
 #	include &lt;util/kernel_cpp.h&gt;
@@ -27,6 +28,14 @@
 #define BFS_NAME &quot;BFS Filesystem&quot;
 
 
+// partition_type
+struct partition_type {
+	uint8		type;
+	const char	*name;
+	bool		used;
+};
+
+
 // is_empty_type
 static inline bool
 is_empty_type(uint8 type)
@@ -287,6 +296,7 @@
 			const Partition*	PartitionAt(int32 index) const;
 
 			bool				Check(off_t sessionSize) const;
+			const partition_type* GetNextSupportedPartitionType(uint32 cookie);
 
 private:
 			PrimaryPartition	fPrimaries[4];

Modified: haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/write_support.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/write_support.cpp	2009-07-20 17:27:41 UTC (rev 31657)
+++ haiku/trunk/src/add-ons/kernel/partitioning_systems/intel/write_support.cpp	2009-07-20 20:29:16 UTC (rev 31658)
@@ -530,7 +530,7 @@
 */
 bool
 pm_validate_create_child(partition_data *partition, off_t *start, off_t *size,
-	const char *type, const char *parameters, int32 *index)
+	const char *type, const char *name, const char *parameters, int32 *index)
 {
 	TRACE((&quot;intel: pm_validate_create_child\n&quot;));
 
@@ -540,6 +540,7 @@
 		return false;
 	}
 
+	// TODO: check name
 	// TODO: check parameters
 	// type check
 	if (!is_type_valid_pm(type, partition))
@@ -1291,8 +1292,8 @@
 */
 status_t
 pm_create_child(int fd, partition_id partitionID, off_t offset, off_t size,
-	const char *type, const char *parameters, disk_job_id job,
-	partition_id *childID)
+	const char *type, const char *name, const char *parameters,
+	disk_job_id job, partition_id *childID)
 {
 	TRACE((&quot;intel: pm_create_child\n&quot;));
 
@@ -1318,7 +1319,7 @@
 	int32 index = 0;
 
 	if (!pm_validate_create_child(partition, &amp;validatedOffset, &amp;validatedSize,
-			type, parameters, &amp;index)) {
+			type, name, parameters, &amp;index)) {
 		return B_BAD_VALUE;
 	}
 
@@ -1338,12 +1339,26 @@
 	PartitionType ptype;
 	ptype.SetType(type);
 
+	// check parameters
+	void *handle = parse_driver_settings_string(parameters);
+	if (handle == NULL)
+		return B_ERROR;
+
+	bool active = get_driver_boolean_parameter(handle, &quot;active&quot;, false, true);
+
+	// set the active flags to false
+	if (active) {
+		for (int i = 0; i &lt; 4; i++) {
+			PrimaryPartition *partition = map-&gt;PrimaryPartitionAt(i);
+			partition-&gt;SetActive(false);
+		}
+	}
+
 	primary-&gt;SetPartitionTableOffset(0);
 	primary-&gt;SetOffset(validatedOffset);
 	primary-&gt;SetSize(validatedSize);
 	primary-&gt;SetType(ptype.Type());
-	// TODO: correctly fill active parameter
-	primary-&gt;SetActive(false);
+	primary-&gt;SetActive(active);
 
 	// write changes to disk
 	PartitionMapWriter writer(fd, 0, partition-&gt;size);
@@ -1602,7 +1617,7 @@

[... truncated: 1055 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018122.html">[Haiku-commits] r31657 - haiku/trunk/src/servers/app
</A></li>
	<LI>Next message: <A HREF="018124.html">[Haiku-commits] r31659 -	haiku/trunk/src/add-ons/kernel/drivers/input/ps2_hid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18123">[ date ]</a>
              <a href="thread.html#18123">[ thread ]</a>
              <a href="subject.html#18123">[ subject ]</a>
              <a href="author.html#18123">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
