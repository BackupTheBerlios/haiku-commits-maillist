<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r32027 - in haiku/trunk/src/apps: . haiku3d	haiku3d/data haiku3d/mesh haiku3d/texture
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32027%20-%20in%20haiku/trunk/src/apps%3A%20.%20haiku3d%0A%09haiku3d/data%20haiku3d/mesh%20haiku3d/texture&In-Reply-To=%3C200907311538.n6VFcQA6010856%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018601.html">
   <LINK REL="Next"  HREF="018605.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r32027 - in haiku/trunk/src/apps: . haiku3d	haiku3d/data haiku3d/mesh haiku3d/texture</H1>
    <B>aldeck at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32027%20-%20in%20haiku/trunk/src/apps%3A%20.%20haiku3d%0A%09haiku3d/data%20haiku3d/mesh%20haiku3d/texture&In-Reply-To=%3C200907311538.n6VFcQA6010856%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r32027 - in haiku/trunk/src/apps: . haiku3d	haiku3d/data haiku3d/mesh haiku3d/texture">aldeck at mail.berlios.de
       </A><BR>
    <I>Fri Jul 31 17:38:26 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="018601.html">[Haiku-commits] r32026 - haiku/trunk/src/servers/app
</A></li>
        <LI>Next message: <A HREF="018605.html">[Haiku-commits] r32028 - in haiku/trunk:	headers/private/kernel/arch/x86 src/system/kernel/arch/x86
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18602">[ date ]</a>
              <a href="thread.html#18602">[ thread ]</a>
              <a href="subject.html#18602">[ subject ]</a>
              <a href="author.html#18602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aldeck
Date: 2009-07-31 17:38:12 +0200 (Fri, 31 Jul 2009)
New Revision: 32027
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=32027&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=32027&amp;view=rev</A>

Added:
   haiku/trunk/src/apps/haiku3d/
   haiku/trunk/src/apps/haiku3d/App.cpp
   haiku/trunk/src/apps/haiku3d/App.h
   haiku/trunk/src/apps/haiku3d/Camera.cpp
   haiku/trunk/src/apps/haiku3d/Camera.h
   haiku/trunk/src/apps/haiku3d/Haiku3d.rdef
   haiku/trunk/src/apps/haiku3d/Jamfile
   haiku/trunk/src/apps/haiku3d/MainWindow.cpp
   haiku/trunk/src/apps/haiku3d/MainWindow.h
   haiku/trunk/src/apps/haiku3d/MathUtils.cpp
   haiku/trunk/src/apps/haiku3d/MathUtils.h
   haiku/trunk/src/apps/haiku3d/Mesh.cpp
   haiku/trunk/src/apps/haiku3d/Mesh.h
   haiku/trunk/src/apps/haiku3d/MeshInstance.cpp
   haiku/trunk/src/apps/haiku3d/MeshInstance.h
   haiku/trunk/src/apps/haiku3d/Quaternion.h
   haiku/trunk/src/apps/haiku3d/RenderView.cpp
   haiku/trunk/src/apps/haiku3d/RenderView.h
   haiku/trunk/src/apps/haiku3d/Texture.cpp
   haiku/trunk/src/apps/haiku3d/Texture.h
   haiku/trunk/src/apps/haiku3d/Vector3.h
   haiku/trunk/src/apps/haiku3d/data/
   haiku/trunk/src/apps/haiku3d/data/LetterA.hk3d
   haiku/trunk/src/apps/haiku3d/data/LetterA.hk3d.bin
   haiku/trunk/src/apps/haiku3d/data/LetterH.hk3d
   haiku/trunk/src/apps/haiku3d/data/LetterH.hk3d.bin
   haiku/trunk/src/apps/haiku3d/data/LetterI.hk3d
   haiku/trunk/src/apps/haiku3d/data/LetterI.hk3d.bin
   haiku/trunk/src/apps/haiku3d/data/LetterK.hk3d
   haiku/trunk/src/apps/haiku3d/data/LetterK.hk3d.bin
   haiku/trunk/src/apps/haiku3d/data/LetterU.hk3d
   haiku/trunk/src/apps/haiku3d/data/LetterU.hk3d.bin
   haiku/trunk/src/apps/haiku3d/data/texture.png
   haiku/trunk/src/apps/haiku3d/mesh/
   haiku/trunk/src/apps/haiku3d/mesh/StaticMesh.cpp
   haiku/trunk/src/apps/haiku3d/mesh/StaticMesh.h
   haiku/trunk/src/apps/haiku3d/texture/
   haiku/trunk/src/apps/haiku3d/texture/BitmapTexture.cpp
   haiku/trunk/src/apps/haiku3d/texture/BitmapTexture.h
   haiku/trunk/src/apps/haiku3d/texture/VideoFileTexture.cpp
   haiku/trunk/src/apps/haiku3d/texture/VideoFileTexture.h
Modified:
   haiku/trunk/src/apps/Jamfile
Log:
* New demo showing an OpenGL animated Haiku logo. Could be a good base for
 future 3d demos i have in mind and the missing ones (ie: 3dmov and 3dmix).
 Makes for a nice Haiku sample code too, without legacy.
 Not in the image yet, waiting for the green light. Enjoy!

 ps: Will commit the Blender object files and export script later.


Modified: haiku/trunk/src/apps/Jamfile
===================================================================
--- haiku/trunk/src/apps/Jamfile	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/Jamfile	2009-07-31 15:38:12 UTC (rev 32027)
@@ -22,6 +22,7 @@
 HaikuSubInclude fontdemo ;
 HaikuSubInclude glteapot ;
 HaikuSubInclude gradients ;
+HaikuSubInclude haiku3d ;
 HaikuSubInclude icon-o-matic ;
 HaikuSubInclude installedpackages ;
 HaikuSubInclude installer ;

Added: haiku/trunk/src/apps/haiku3d/App.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/App.cpp	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/App.cpp	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,49 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+#include &lt;Alert.h&gt;
+
+#include &quot;App.h&quot;
+#include &quot;MainWindow.h&quot;
+
+
+App::App()
+	:
+	BApplication(&quot;application/x-vnd.Haiku3d&quot;)
+{
+	BRect frame(50, 50, 640 + 50, 480 + 50);
+	const char *title = &quot;Hauku3d&quot;;
+	fMainWindow = new MainWindow(frame, title);
+}
+
+
+App::~App()
+{
+}
+
+
+void App::AboutRequested()
+{
+	BAlert* alert;
+	alert = new BAlert(&quot;About&quot;, &quot;A little 3d demo&quot;, &quot;ok&quot;);
+	alert-&gt;Go(NULL);
+}
+
+
+void App::MessageReceived(BMessage *message)
+{
+}
+
+
+int
+main(int argc, char** argv)
+{
+	App app;
+	app.Run();
+	return 0;
+}

Added: haiku/trunk/src/apps/haiku3d/App.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/App.h	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/App.h	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,26 @@
+/*
+ * Copyright 2008, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+#ifndef _APP_H
+#define _APP_H
+
+#include &lt;Application.h&gt;
+
+class App: public BApplication {
+protected:
+	BWindow*		fMainWindow;
+public:
+					App();
+					~App();
+
+	virtual void	AboutRequested();
+	virtual void	MessageReceived(BMessage *message);
+
+};
+
+#endif /* _APP_H */

Added: haiku/trunk/src/apps/haiku3d/Camera.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/Camera.cpp	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/Camera.cpp	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,26 @@
+/*
+ * Copyright 2008, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+#include &quot;Camera.h&quot;
+
+
+Camera::Camera(const Vector3&amp; position, const Quaternion&amp; orientation,
+	float fov, float near, float far)
+	:
+	fPosition(position),
+	fOrientation(orientation),
+	fFieldOfView(fov),
+	fNear(near),
+	fFar(far)
+{
+}
+
+
+Camera::~Camera()
+{
+}

Added: haiku/trunk/src/apps/haiku3d/Camera.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/Camera.h	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/Camera.h	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,72 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+#ifndef _CAMERA_H
+#define _CAMERA_H
+
+#include &quot;Vector3.h&quot;
+#include &quot;Quaternion.h&quot;
+
+
+class Camera {
+public:
+					Camera(const Vector3&amp; position,
+						const Quaternion&amp; orientation, float fov = 50.0f, float near = 1.0f,
+						float far = 100.0f);
+	virtual			~Camera();
+
+	const Vector3&amp;		Position() const;
+	const Quaternion&amp;	Orientation() const;
+	float				FieldOfView() const;
+	float				Near() const;
+	float				Far() const;
+
+protected:
+	Vector3			fPosition;
+	Quaternion		fOrientation;
+	float			fFieldOfView;
+	float			fNear;
+	float			fFar;
+	bool			fOrtho;
+};
+
+
+inline const Vector3&amp;
+Camera::Position() const
+{
+	return fPosition;
+}
+
+
+inline const Quaternion&amp;
+Camera::Orientation() const
+{
+	return fOrientation;
+}
+
+
+inline float
+Camera::FieldOfView() const
+{
+	return fFieldOfView;
+}
+
+
+inline float
+Camera::Near() const
+{
+	return fNear;
+}
+
+
+inline float
+Camera::Far() const
+{
+	return fFar;
+}
+
+#endif /* _CAMERA_H */

Added: haiku/trunk/src/apps/haiku3d/Haiku3d.rdef
===================================================================
--- haiku/trunk/src/apps/haiku3d/Haiku3d.rdef	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/Haiku3d.rdef	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,89 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>
+ *
+ * Copyright Be, Inc. (for the temporary icon)
+ */
+
+resource(1, &quot;BEOS:APP_SIG&quot;) #'MIMS' &quot;application/x-vnd.Haiku3d&quot;;
+
+resource app_version {
+	major  = 1,
+	middle = 0,
+	minor  = 0,
+
+	variety = B_APPV_BETA,
+	internal = 0,
+
+	short_info = &quot;Haiku3d&quot;,
+	long_info = &quot;Haiku3d &#169;2009 Haiku, Inc.&quot;
+};
+
+resource(101, &quot;BEOS:L:STD_ICON&quot;) #'ICON' array {
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00FFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF005D00FFFFFFFFFFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF005D5D00FFFFFFFFFFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF005D5D5D00FFFFFFFFFFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF003F5D5D5D5D00FFFFFFFFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF003F5D5D5D5D00FFFFFFFFFFFFFF&quot;
+	$&quot;FFFFFFFF000000FFFFFFFFFFFFFFFFFFFF00FA3F5D5D5D5D5D00FFFFFFFFFFFF&quot;
+	$&quot;FFFFFF005E5E5E0000FFFFFFFFFFFFFFFF00FA3F5D5D5D5D5D00FFFFFFFFFFFF&quot;
+	$&quot;FFFF005E5E5E5E5E5E0000FFFFFFFFFF00FAFA3F5D5D5D5D5D00FFFFFFFFFFFF&quot;
+	$&quot;FF005E5E5E5E5E5E5E5E5E00FFFFFFFF00FAFAFA3F5D5D5D5D5D00FFFFFFFFFF&quot;
+	$&quot;005E5E5E5E5E5E5E5E5EB200FFFFFF00FAFAFAFA3F5D5D5D5D5D00FFFFFFFFFF&quot;
+	$&quot;00B2B25E5E5E5E5E5EB22100FFFF00FAFAFAFAFA3F5D5D5D5D5D5D00FFFFFFFF&quot;
+	$&quot;002121B2B25E5E5EB2212400FFFF00FAFAFAFAFAFA3F5D5D5D5D5D00FFFFFFFF&quot;
+	$&quot;0021212021B2B2B221242500FF00FAFAFAFAFAFAFA3F5D5D5D5D5D5D00FFFFFF&quot;
+	$&quot;002121202121BE2124252500FF00FAFAFAFAFAFAFAFA3F5D5D5D5D5D00FFFFFF&quot;
+	$&quot;002121202121BE212425250000FAFAFAFAFAFAFAFAFA3F5D5D5D5D5D00FFFFFF&quot;
+	$&quot;002121202121BE212425250000FAFAFAFAFAFAFAFAFA3F5D5D5D5D5D5D00FFFF&quot;
+	$&quot;002121202121BE2124252500FF0000FAFAFA00000000003F5D5D5D5D5D0011FF&quot;
+	$&quot;002121202121BE2124252500FFFFFF0000002FEB2F302F00005D5D5D5D001111&quot;
+	$&quot;002121202121BE2124252500FFFFFF002F2B2B2B2D2D2F302F005D5D00111111&quot;
+	$&quot;002121202121BE2124252500FFFF002F2B2A2B2A2C2C2BEB2F2F0000111111FF&quot;
+	$&quot;002121202121BE2124252500FFFF002B2B2B2A2B2B2B2D2D2F2F00111111FFFF&quot;
+	$&quot;002121202121BE2124252500FF002F2B2B2A5A2B2B2B2C2D2DEB3000FFFFFFFF&quot;
+	$&quot;002121202121BE212425250011002F2B2B5A3F5A2B2C2C2D2D2F2F00FFFFFFFF&quot;
+	$&quot;002121202121BE212425250011002F2C2C2A5A2C2B2C2C2DEB2F2F00FFFFFFFF&quot;
+	$&quot;002121202121BE21242500111100302E2B2C2B2B2C2C2D2CEB2F2F0011FFFFFF&quot;
+	$&quot;FF0000212120BE2124001111FF002F2F2D2C2C2C2C2D2D2E2EEB30001111FFFF&quot;
+	$&quot;FFFFFF000021BE21001111FFFFFF00302D2D2D2C2D2DEBEB2F2F00111111FFFF&quot;
+	$&quot;FFFFFFFFFF0000001111FFFFFFFF00302EEBEBEBEBEBEB2FEB3000111111FFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00302F2FEB2FEB2F2F2F0011111111FFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000302F2F302F000011111111FFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000011111111FFFFFFFFFF&quot;
+};
+
+resource(101, &quot;BEOS:M:STD_ICON&quot;) #'MICN' array {
+	$&quot;FFFFFFFFFFFFFFFFFFFFFF0000FFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFF005D5D00FFFF&quot;
+	$&quot;FFFF000000FFFFFFFF005D5D5D00FFFF&quot;
+	$&quot;FF005E5E5E00FFFF00FA5D5D5D00FFFF&quot;
+	$&quot;005E5E5E5E5E00FF00FAFA5D5D5D00FF&quot;
+	$&quot;00215E5E5E250000FAFAFA5D5D5D00FF&quot;
+	$&quot;0021212025250000FAFAFA5D5D5D5D00&quot;
+	$&quot;00202121242500FAFAFAFAFA5D5D5D00&quot;
+	$&quot;00212021252400FAFA000000005D5D00&quot;
+	$&quot;00212120252500FA002B2D2F30000000&quot;
+	$&quot;00202121242500002B2B2B2D2D2F0011&quot;
+	$&quot;00212021252400002B5A2C2C2D2F00FF&quot;
+	$&quot;00212120250000002D2B2B2D2D2F0011&quot;
+	$&quot;00002120001111002F2E2C2E2E2F0011&quot;
+	$&quot;FFFF00001111FFFF0030EB2F2F001111&quot;
+	$&quot;FFFFFFFFFFFFFFFFFF00000000111111&quot;
+};
+
+resource(1, &quot;texture&quot;) #'PNG ' import &quot;./data/texture.png&quot;;
+
+resource(2, &quot;LetterH&quot;) import &quot;./data/LetterH.hk3d.bin&quot;;
+
+resource(3, &quot;LetterA&quot;) import &quot;./data/LetterA.hk3d.bin&quot;;
+
+resource(4, &quot;LetterI&quot;) import &quot;./data/LetterI.hk3d.bin&quot;;
+
+resource(5, &quot;LetterK&quot;) import &quot;./data/LetterK.hk3d.bin&quot;;
+
+resource(6, &quot;LetterU&quot;) import &quot;./data/LetterU.hk3d.bin&quot;;

Added: haiku/trunk/src/apps/haiku3d/Jamfile
===================================================================
--- haiku/trunk/src/apps/haiku3d/Jamfile	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/Jamfile	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,27 @@
+SubDir HAIKU_TOP src apps haiku3d ;
+
+SEARCH_SOURCE += [ FDirName $(SUBDIR) mesh ] ;
+SEARCH_SOURCE += [ FDirName $(SUBDIR) texture ] ;
+
+UsePrivateHeaders shared ;
+
+Application Haiku3d :
+	App.cpp
+	Camera.cpp
+	MainWindow.cpp
+	MathUtils.cpp
+	Mesh.cpp
+	MeshInstance.cpp
+	RenderView.cpp
+	Texture.cpp
+
+	# mesh
+	StaticMesh.cpp
+
+	# texture
+	BitmapTexture.cpp
+	VideoFileTexture.cpp
+
+	: be game GL media translation
+	: Haiku3d.rdef
+;

Added: haiku/trunk/src/apps/haiku3d/MainWindow.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/MainWindow.cpp	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/MainWindow.cpp	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,60 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+#include &quot;MainWindow.h&quot;
+#include &quot;RenderView.h&quot;
+
+#include &lt;Application.h&gt;
+#include &lt;MenuBar.h&gt;
+#include &lt;MenuItem.h&gt;
+
+#include &lt;stdio.h&gt;
+
+MainWindow::MainWindow(BRect frame, const char* title)
+	:
+	BDirectWindow(frame, title, B_TITLED_WINDOW_LOOK, B_NORMAL_WINDOW_FEEL, 0)
+{
+	fRenderView = new RenderView(Bounds());
+	fRenderView-&gt;SetViewColor(0, 0, 0);
+
+	AddChild(fRenderView);
+	Show();
+}
+
+
+MainWindow::~MainWindow()
+{
+}
+
+
+bool
+MainWindow::QuitRequested()
+{
+	be_app-&gt;Lock();
+	if (be_app-&gt;CountWindows() &lt; 2)
+		be_app_messenger.SendMessage(B_QUIT_REQUESTED);
+	be_app-&gt;Unlock();
+	return true;
+}
+
+
+void
+MainWindow::MessageReceived(BMessage *message)
+{
+	switch (message-&gt;what) {
+		default:
+			BDirectWindow::MessageReceived(message);
+	}
+}
+
+
+void
+MainWindow::DirectConnected(direct_buffer_info* info)
+{
+	fRenderView-&gt;DirectConnected(info);
+}

Added: haiku/trunk/src/apps/haiku3d/MainWindow.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/MainWindow.h	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/MainWindow.h	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,28 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+#ifndef _MAINWINDOW_H
+#define _MAINWINDOW_H
+
+#include &lt;DirectWindow.h&gt;
+
+class RenderView;
+
+class MainWindow: public BDirectWindow {
+public:
+					MainWindow(BRect frame, const char* title);
+					~MainWindow();
+
+	virtual bool	QuitRequested();
+	virtual void	MessageReceived(BMessage *message);
+	virtual void	DirectConnected(direct_buffer_info* info);
+
+protected:
+	RenderView*		fRenderView;
+};
+
+#endif /* _MAINWINDOW_H */

Added: haiku/trunk/src/apps/haiku3d/MathUtils.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/MathUtils.cpp	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/MathUtils.cpp	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,55 @@
+/*
+ * Copyright 2008, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+// Some math utils, useful for animation
+
+
+#include &quot;MathUtils.h&quot;
+
+
+float
+MathUtils::EaseInOutCubic(float t /*time*/, float b /*begin*/, float c /*distance*/, float d /*duration*/)
+{
+	t /= d / 2.0;
+	if (t &lt; 1.0)
+		return c / 2.0 * t * t * t + b;
+	t -= 2.0;
+	return c / 2.0 * (t * t * t + 2.0) + b;
+}
+
+
+float
+MathUtils::EaseInOutQuart(float t /*time*/, float b /*begin*/, float c /*distance*/, float d /*duration*/)
+{
+	t /= d / 2;
+
+	if (t &lt; 1)
+		return c / 2 * t * t * t * t + b;
+
+	t -= 2;
+
+	return -c / 2 * (t * t * t * t - 2) + b;
+}
+
+
+float
+MathUtils::EaseInOutQuint(float t /*time*/, float b /*begin*/, float c /*distance*/, float d /*duration*/)
+{
+	t /= d / 2;
+	if (t &lt; 1)
+		return c / 2 * t * t * t * t * t + b;
+	t -= 2;
+	return c / 2 *(t * t * t * t * t + 2) + b;
+}
+
+
+float
+MathUtils::EaseInOutSine(float t /*time*/, float b /*begin*/, float c /*distance*/, float d /*duration*/)
+{
+	return -c / 2 * (cos(3.14159 * t / d) - 1) + b;
+}

Added: haiku/trunk/src/apps/haiku3d/MathUtils.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/MathUtils.h	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/MathUtils.h	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,21 @@
+/* 
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+#ifndef _MATH_UTILS_H
+#define _MATH_UTILS_H
+
+
+class MathUtils
+{
+public:	
+	static float EaseInOutCubic(float time, float begin, float distance, float duration);
+	static float EaseInOutQuart(float time, float begin, float distance, float duration);
+	static float EaseInOutQuint(float time, float begin, float distance, float duration);
+	static float EaseInOutSine(float time, float begin, float distance, float duration);		
+};
+
+#endif /* _MATH_UTILS_H */

Added: haiku/trunk/src/apps/haiku3d/Mesh.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/Mesh.cpp	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/Mesh.cpp	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,14 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+#include &quot;Mesh.h&quot;
+
+
+Mesh::~Mesh()
+{
+}

Added: haiku/trunk/src/apps/haiku3d/Mesh.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/Mesh.h	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/Mesh.h	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,39 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+#ifndef _MESH_H
+#define _MESH_H
+
+#include &lt;Referenceable.h&gt;
+#include &lt;SupportDefs.h&gt;
+
+#include &quot;Vector3.h&quot;
+
+
+struct Vertex {
+	Vector3 p;
+	float u;
+	float v;
+};
+
+
+struct Face {
+	Vertex v[4];
+	uint16 vertexCount;
+};
+
+
+class Mesh : public Referenceable {
+public:
+	virtual	~Mesh();
+
+	virtual Face&amp;	GetFace(uint32 index) const = 0;
+	virtual uint32	FaceCount() const = 0;
+};
+
+
+#endif /* _MESH_H */

Added: haiku/trunk/src/apps/haiku3d/MeshInstance.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/MeshInstance.cpp	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/MeshInstance.cpp	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,183 @@
+/*
+ * Copyright 2008, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+#include &quot;MeshInstance.h&quot;
+#include &quot;MathUtils.h&quot;
+#include &lt;opengl/GL/gl.h&gt;
+
+//#include &lt;stdio.h&gt; // debug
+
+
+MeshInstance::MeshInstance(Mesh* mesh, Texture* texture,
+	const Vector3&amp; position, const Quaternion&amp; orientation, float animOffset)
+	:
+	fMeshReference(mesh),
+	fTextureReference(texture),
+	fPosition(position),
+	fOrientation(orientation),
+	fScale(1.0f),
+	fTime(0.0f),
+	fAnimOffset(animOffset),
+	fDoubleSided(true),
+	fDrawNormals(false)
+{
+}
+
+
+MeshInstance::~MeshInstance()
+{
+}
+
+
+void
+MeshInstance::Update(float dt)
+{
+	fTextureReference-&gt;Update(dt);
+
+	float animDuration = 4.0f;
+
+	fTime += dt;
+	if (fTime &gt;= fAnimOffset) {
+		float animTime = (fTime - fAnimOffset);
+
+		float rotAngle = MathUtils::EaseInOutQuart(animTime, 0,
+			3 * 2 * 3.14159, animDuration);
+
+		fOrientation = Quaternion(Vector3(0.0f, 1.0f, 0.0f), rotAngle);
+	}
+
+	if (fTime &gt;= fAnimOffset + animDuration) {
+		fOrientation = Quaternion(Vector3(0.0f, 1.0f, 0.0f), 0.0);
+	}
+
+	if (fTime &gt;= animDuration * 6) {
+		fTime = 0.0;
+	}
+}
+
+
+void
+MeshInstance::Render()
+{
+	if (fMeshReference-&gt;FaceCount() == 0)
+		return;
+
+	glPushMatrix();
+	glTranslatef(fPosition.x(), fPosition.y(), fPosition.z());
+	float mat[4][4];
+	fOrientation.toOpenGLMatrix(mat);
+	glMultMatrixf((GLfloat*) mat);
+	glScalef(fScale, fScale, fScale);
+	glBindTexture(GL_TEXTURE_2D, fTextureReference-&gt;Id());
+
+	int lastVertexCount = 0;
+	//int batchCount = 0;
+
+	for(uint32 i = 0; i &lt; fMeshReference-&gt;FaceCount(); i++) {
+
+		const Face&amp; face = fMeshReference-&gt;GetFace(i);
+
+		// switch face mode
+		if (face.vertexCount != lastVertexCount) {
+			if (lastVertexCount != 0)
+				glEnd();
+
+			if (face.vertexCount == 3)
+				glBegin(GL_TRIANGLES);
+			else
+				glBegin(GL_QUADS);
+
+			//batchCount++;
+		}
+
+		// calculate normal
+		Vector3 lu(face.v[0].p - face.v[1].p);
+		Vector3 lv(face.v[1].p - face.v[2].p);
+		Vector3 normal(lu.cross(lv));
+		if (normal.length() &lt;= 0.000001)
+			normal.setValue(0, 0, -1.0);
+		normal.normalize();
+
+		// draw face
+		glNormal3f(normal.x(), normal.y(),  normal.z());
+   		glTexCoord2f(face.v[0].u, face.v[0].v);
+   		glVertex3f(face.v[0].p.x(), face.v[0].p.y(),  face.v[0].p.z());
+
+   		glNormal3f(normal.x(), normal.y(),  normal.z());
+   		glTexCoord2f(face.v[1].u, face.v[1].v);
+   		glVertex3f(face.v[1].p.x(), face.v[1].p.y(),  face.v[1].p.z());
+
+   		glNormal3f(normal.x(), normal.y(),  normal.z());
+   		glTexCoord2f(face.v[2].u, face.v[2].v);
+   		glVertex3f(face.v[2].p.x(), face.v[2].p.y(),  face.v[2].p.z());
+
+   		if (face.vertexCount == 4) {
+   			glNormal3f(normal.x(), normal.y(),  normal.z());
+   			glTexCoord2f(face.v[3].u, face.v[3].v);
+   			glVertex3f(face.v[3].p.x(), face.v[3].p.y(),  face.v[3].p.z());
+   		}
+
+   		if (fDoubleSided) {
+	   		if (face.vertexCount == 4) {
+		   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
+		   		glTexCoord2f(face.v[3].u, face.v[3].v);
+		   		glVertex3f(face.v[3].p.x(), face.v[3].p.y(),  face.v[3].p.z());
+	   		}
+
+	   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
+	   		glTexCoord2f(face.v[2].u, face.v[2].v);
+	   		glVertex3f(face.v[2].p.x(), face.v[2].p.y(),  face.v[2].p.z());
+
+	   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
+	   		glTexCoord2f(face.v[1].u, face.v[1].v);
+	   		glVertex3f(face.v[1].p.x(), face.v[1].p.y(),  face.v[1].p.z());
+
+	   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
+	   		glTexCoord2f(face.v[0].u, face.v[0].v);
+	   		glVertex3f(face.v[0].p.x(), face.v[0].p.y(),  face.v[0].p.z());
+   		}
+   		lastVertexCount = face.vertexCount;
+	}
+	glEnd();
+	//printf(&quot;batchCount %d\n&quot;, batchCount);
+
+   	if (fDrawNormals) {
+   		glBegin(GL_LINES);
+	   	for(uint32 i = 0; i &lt; fMeshReference-&gt;FaceCount(); i++) {
+
+			const Face&amp; face = fMeshReference-&gt;GetFace(i);
+
+			if (face.vertexCount == 4) {
+
+				// calculate normal
+				Vector3 lu(face.v[0].p - face.v[1].p);
+				Vector3 lv(face.v[1].p - face.v[2].p);
+				Vector3 normal(lu.cross(lv));
+				if (normal.length() &lt;= 0.000001)
+					normal.setValue(0, 0, -1.0);
+				normal.normalize();
+
+				// center of the face
+				Vector3 g;
+				if (face.vertexCount == 4)
+					g = (face.v[0].p + face.v[1].p + face.v[2].p + face.v[3].p)
+						/ 4.0;
+				else
+					g = (face.v[0].p + face.v[1].p + face.v[2].p) / 3.0;
+
+				Vector3 h(g + normal);
+
+				glVertex3f(g.x(), g.y(), g.z());
+				glVertex3f(h.x(), h.y(), h.z());
+	    	}
+		}
+		glEnd();
+	}
+
+	glPopMatrix();
+}

Added: haiku/trunk/src/apps/haiku3d/MeshInstance.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/MeshInstance.h	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/MeshInstance.h	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,44 @@
+/*
+ * Copyright 2009, Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ * 		Alexandre Deckner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">alex at zappotek.com</A>&gt;
+ */
+
+#ifndef _MESH_INSTANCE_H
+#define _MESH_INSTANCE_H
+
+#include &quot;Mesh.h&quot;
+#include &quot;Texture.h&quot;
+#include &quot;Vector3.h&quot;
+#include &quot;Quaternion.h&quot;
+
+
+class MeshInstance {
+public:
+				MeshInstance(Mesh* mesh, Texture* texture,
+					const Vector3&amp; position, const Quaternion&amp; orientation,
+					float animOffset);
+				~MeshInstance();
+
+	void		Update(float dt);
+	void		Render();
+
+protected:
+	Reference&lt;Mesh&gt;		fMeshReference;
+	Reference&lt;Texture&gt;	fTextureReference;
+
+	Vector3		fPosition;
+	Quaternion	fOrientation;
+	float		fScale;
+
+	// TODO: manage the animation externally
+	float		fTime;
+	float		fAnimOffset;
+
+	bool		fDoubleSided;
+	bool		fDrawNormals;
+};
+
+#endif /* _MESH_INSTANCE_H */

Added: haiku/trunk/src/apps/haiku3d/Quaternion.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/Quaternion.h	2009-07-31 15:34:04 UTC (rev 32026)
+++ haiku/trunk/src/apps/haiku3d/Quaternion.h	2009-07-31 15:38:12 UTC (rev 32027)
@@ -0,0 +1,407 @@
+/*
+ * Copyright 2008 Haiku Inc. All rights reserved.
+ * Distributed under the terms of the MIT License.
+ *
+ * Authors:
+ *		Alexandre Deckner
+ *
+ */
+
+/*
+ *
+ * This is a refactored and stripped down version of bullet-2.66 src\LinearMath\btQuaternion.h
+ * The dependancies on base class btQuadWord have been removed for simplification.
+ * Added gl matrix conversion method.
+ *
+ */
+
+/*
+Copyright (c) 2003-2006 Gino van den Bergen / Erwin Coumans  <A HREF="http://continuousphysics.com/Bullet/">http://continuousphysics.com/Bullet/</A>
+
+This software is provided 'as-is', without any express or implied warranty.
+In no event will the authors be held liable for any damages arising from the use of this software.
+Permission is granted to anyone to use this software for any purpose,
+including commercial applications, and to alter it and redistribute it freely,
+subject to the following restrictions:
+
+1. The origin of this software must not be misrepresented; you must not claim that you wrote the original software. If you use this software in a product, an acknowledgment in the product documentation would be appreciated but is not required.
+2. Altered source versions must be plainly marked as such, and must not be misrepresented as being the original software.
+3. This notice may not be removed or altered from any source distribution.
+*/
+#ifndef __QUATERNION_H__
+#define __QUATERNION_H__
+
+#include &quot;Vector3.h&quot;
+#include &lt;SupportDefs.h&gt; //pout FLT_EPSILON
+
+class Quaternion {
+protected:
+	float	m_x;
+	float	m_y;
+	float	m_z;
+	float	m_w;
+public:
+	Quaternion() {}
+
+	Quaternion(const Quaternion&amp; q)
+	{
+		*((Quaternion*)this) = q;
+	}
+
+	Quaternion(const float&amp; x, const float&amp; y, const float&amp; z,const float&amp; w)
+	{
+		m_x = x, m_y = y, m_z = z, m_w = w;
+	}
+
+	Quaternion(const Vector3&amp; axis, const float&amp; angle)
+	{
+		setRotation(axis, angle);
+	}
+
+	Quaternion(const float&amp; yaw, const float&amp; pitch, const float&amp; roll)
+	{
+		setEuler(yaw, pitch, roll);
+	}
+
+	inline const float&amp; x() const { return m_x; }
+
+
+	inline const float&amp; y() const { return m_y; }
+
+
+	inline const float&amp; z() const { return m_z; }
+
+
+	inline const float&amp; w() const { return m_w; }
+
+
+	void setValue(const float&amp; x, const float&amp; y, const float&amp; z)
+	{
+		m_x=x;
+		m_y=y;
+		m_z=z;
+		m_w = 0.f;
+	}
+
+
+	void setValue(const float&amp; x, const float&amp; y, const float&amp; z,const float&amp; w)
+	{
+		m_x=x;
+		m_y=y;
+		m_z=z;
+		m_w=w;
+	}
+
+
+	void setRotation(const Vector3&amp; axis, const float&amp; angle)
+	{
+		float d = axis.length();
+		assert(d != 0.0f);
+		float s = sin(angle * 0.5f) / d;
+		setValue(axis.x() * s, axis.y() * s, axis.z() * s,
+			cos(angle * 0.5f));
+	}
+
+
+	void setEuler(const float&amp; yaw, const float&amp; pitch, const float&amp; roll)
+	{
+		float halfYaw = yaw * 0.5f;
+		float halfPitch = pitch * 0.5f;
+		float halfRoll = roll * 0.5f;
+		float cosYaw = cos(halfYaw);
+		float sinYaw = sin(halfYaw);
+		float cosPitch = cos(halfPitch);
+		float sinPitch = sin(halfPitch);
+		float cosRoll = cos(halfRoll);
+		float sinRoll = sin(halfRoll);
+		setValue(cosRoll * sinPitch * cosYaw + sinRoll * cosPitch * sinYaw,
+			cosRoll * cosPitch * sinYaw - sinRoll * sinPitch * cosYaw,
+			sinRoll * cosPitch * cosYaw - cosRoll * sinPitch * sinYaw,
+			cosRoll * cosPitch * cosYaw + sinRoll * sinPitch * sinYaw);
+	}
+
+
+	Quaternion&amp; operator+=(const Quaternion&amp; q)
+	{
+		m_x += q.x(); m_y += q.y(); m_z += q.z(); m_w += q.m_w;
+		return *this;
+	}
+
+
+	Quaternion&amp; operator-=(const Quaternion&amp; q)
+	{
+		m_x -= q.x(); m_y -= q.y(); m_z -= q.z(); m_w -= q.m_w;
+		return *this;
+	}
+
+
+	Quaternion&amp; operator*=(const float&amp; s)
+	{
+		m_x *= s; m_y *= s; m_z *= s; m_w *= s;
+		return *this;
+	}
+
+
+	Quaternion&amp; operator*=(const Quaternion&amp; q)
+	{
+		setValue(m_w * q.x() + m_x * q.m_w + m_y * q.z() - m_z * q.y(),
+			m_w * q.y() + m_y * q.m_w + m_z * q.x() - m_x * q.z(),
+			m_w * q.z() + m_z * q.m_w + m_x * q.y() - m_y * q.x(),
+			m_w * q.m_w - m_x * q.x() - m_y * q.y() - m_z * q.z());
+		return *this;
+	}
+
+
+	float dot(const Quaternion&amp; q) const
+	{
+		return m_x * q.x() + m_y * q.y() + m_z * q.z() + m_w * q.m_w;
+	}
+
+
+	float length2() const
+	{
+		return dot(*this);
+	}
+

[... truncated: 2688 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018601.html">[Haiku-commits] r32026 - haiku/trunk/src/servers/app
</A></li>
	<LI>Next message: <A HREF="018605.html">[Haiku-commits] r32028 - in haiku/trunk:	headers/private/kernel/arch/x86 src/system/kernel/arch/x86
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18602">[ date ]</a>
              <a href="thread.html#18602">[ thread ]</a>
              <a href="subject.html#18602">[ subject ]</a>
              <a href="author.html#18602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
