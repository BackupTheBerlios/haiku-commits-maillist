<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r31962 - in haiku/trunk: headers/private/interface	src/kits/interface
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31962%20-%20in%20haiku/trunk%3A%20headers/private/interface%0A%09src/kits/interface&In-Reply-To=%3C200907301034.n6UAY4GB014524%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018509.html">
   <LINK REL="Next"  HREF="018512.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r31962 - in haiku/trunk: headers/private/interface	src/kits/interface</H1>
    <B>jackburton at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r31962%20-%20in%20haiku/trunk%3A%20headers/private/interface%0A%09src/kits/interface&In-Reply-To=%3C200907301034.n6UAY4GB014524%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r31962 - in haiku/trunk: headers/private/interface	src/kits/interface">jackburton at mail.berlios.de
       </A><BR>
    <I>Thu Jul 30 12:34:04 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="018509.html">[Haiku-commits] r31961 -	haiku/trunk/src/apps/debuganalyzer/gui/main_window
</A></li>
        <LI>Next message: <A HREF="018512.html">[Haiku-commits] r31963 - in haiku/trunk: headers/private/interface	src/kits/interface
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18511">[ date ]</a>
              <a href="thread.html#18511">[ thread ]</a>
              <a href="subject.html#18511">[ subject ]</a>
              <a href="author.html#18511">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jackburton
Date: 2009-07-30 12:33:46 +0200 (Thu, 30 Jul 2009)
New Revision: 31962
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=31962&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=31962&amp;view=rev</A>

Modified:
   haiku/trunk/headers/private/interface/MenuPrivate.h
   haiku/trunk/src/kits/interface/InterfaceDefs.cpp
   haiku/trunk/src/kits/interface/Menu.cpp
   haiku/trunk/src/kits/interface/MenuItem.cpp
Log:
Instead of creating the Modifiers bitmaps on demand, for every DrawItem invocation,
for every BMenuItem, have them created in _init_interface_kit(), and keep
them cached. This required some reorganisation of the code in Menu and MenuItem.
Also has the side effect that BMenuItem doesn't have to know about the
alt/ctrl/command keys stuff.
Added a comment in BMenu::AttachedToWindow().


Modified: haiku/trunk/headers/private/interface/MenuPrivate.h
===================================================================
--- haiku/trunk/headers/private/interface/MenuPrivate.h	2009-07-30 02:54:40 UTC (rev 31961)
+++ haiku/trunk/headers/private/interface/MenuPrivate.h	2009-07-30 10:33:46 UTC (rev 31962)
@@ -16,6 +16,7 @@
 	MENU_STATE_CLOSED = 5
 };
 
+class BBitmap;
 class BMenu;
 class BWindow;
 
@@ -45,10 +46,22 @@
 	void InvokeItem(BMenuItem *item, bool now = false);	
 	void QuitTracking(bool thisMenuOnly = true);
 	
+	static	status_t	CreateBitmaps();
+	static	void		DeleteBitmaps();
+
+	static const BBitmap *MenuItemCommand();
+	static const BBitmap *MenuItemControl();
+	static const BBitmap *MenuItemOption();
+	static const BBitmap *MenuItemShift();
 private:
 	BMenu *fMenu;	
 };
 
+extern BBitmap *gMenuItemAlt;
+extern BBitmap *gMenuItemControl;
+extern BBitmap *gMenuItemOption;
+extern BBitmap *gMenuItemShift;
+
 };
 
 extern const char *kEmptyMenuLabel;

Modified: haiku/trunk/src/kits/interface/InterfaceDefs.cpp
===================================================================
--- haiku/trunk/src/kits/interface/InterfaceDefs.cpp	2009-07-30 02:54:40 UTC (rev 31961)
+++ haiku/trunk/src/kits/interface/InterfaceDefs.cpp	2009-07-30 10:33:46 UTC (rev 31962)
@@ -32,6 +32,7 @@
 #include &lt;DefaultColors.h&gt;
 #include &lt;InputServerTypes.h&gt;
 #include &lt;input_globals.h&gt;
+#include &lt;MenuPrivate.h&gt;
 #include &lt;pr_server.h&gt;
 #include &lt;ServerProtocol.h&gt;
 #include &lt;ServerReadOnlyMemory.h&gt;
@@ -951,8 +952,9 @@
 	be_control_look = new BControlLook();
 
 	_init_global_fonts_();
-
+	
 	BPrivate::gWidthBuffer = new BPrivate::WidthBuffer;
+	BPrivate::MenuPrivate::CreateBitmaps();
 
 	_menu_info_ptr_ = &amp;BMenu::sMenuInfo;
 
@@ -973,6 +975,8 @@
 extern &quot;C&quot; status_t
 _fini_interface_kit_()
 {
+	BPrivate::MenuPrivate::DeleteBitmaps();
+	
 	delete BPrivate::gWidthBuffer;
 	BPrivate::gWidthBuffer = NULL;
 

Modified: haiku/trunk/src/kits/interface/Menu.cpp
===================================================================
--- haiku/trunk/src/kits/interface/Menu.cpp	2009-07-30 02:54:40 UTC (rev 31961)
+++ haiku/trunk/src/kits/interface/Menu.cpp	2009-07-30 10:33:46 UTC (rev 31962)
@@ -14,6 +14,7 @@
 #include &lt;ctype.h&gt;
 #include &lt;string.h&gt;
 
+#include &lt;Bitmap.h&gt;
 #include &lt;ControlLook.h&gt;
 #include &lt;Debug.h&gt;
 #include &lt;File.h&gt;
@@ -76,6 +77,11 @@
 };
 
 
+BBitmap *gMenuItemAlt;
+BBitmap *gMenuItemControl;
+BBitmap *gMenuItemOption;
+BBitmap *gMenuItemShift;
+
 }	// namespace BPrivate
 
 
@@ -83,6 +89,66 @@
 bool BMenu::sAltAsCommandKey;
 
 
+const unsigned char kCtrlBits[] = {
+	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
+	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
+};
+
+
+const unsigned char kAltBits[] = {
+	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x04,0x04,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
+	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
+};
+
+
+const unsigned char kOptBits[] = {
+	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x13,0x04,0x04,0x13,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
+	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
+};
+
+
+const unsigned char kShiftBits[] = {
+	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x17,0x04,0x04,0x17,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x17,0x17,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x17,0x04,0x04,0x17,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x04,0x17,0x17,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x17,0x04,0x04,0x17,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
+	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
+	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
+	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
+};
+
+
 static property_info sPropList[] = {
 	{ &quot;Enabled&quot;, { B_GET_PROPERTY, 0 },
 		{ B_DIRECT_SPECIFIER, 0 }, &quot;Returns true if menu or menu item is enabled; false &quot;
@@ -348,16 +414,20 @@
 {
 	BView::AttachedToWindow();
 
-	sAltAsCommandKey = true;
+	// TODO: Move into init_interface_kit().
+	// Currently we can't do that, as get_key_map() blocks forever
+	// when called there. Probably because the BApplication isn't yet
+	// initialized, or running.
+	BMenu::sAltAsCommandKey = true;
 	key_map *keys = NULL;
 	char *chars = NULL;
 	get_key_map(&amp;keys, &amp;chars);
 	if (keys == NULL || keys-&gt;left_command_key != 0x5d
 		|| keys-&gt;left_control_key != 0x5c)
-		sAltAsCommandKey = false;
+		BMenu::sAltAsCommandKey = false;
 	free(chars);
 	free(keys);
-
+	
 	BMenuItem *superItem = Superitem();
 	BMenu *superMenu = Supermenu();
 	if (AddDynamicItem(B_INITIAL_ADD)) {
@@ -2256,12 +2326,14 @@
 void
 BMenu::_DrawItems(BRect updateRect)
 {
+	bigtime_t start = system_time();
 	int32 itemCount = fItems.CountItems();
 	for (int32 i = 0; i &lt; itemCount; i++) {
 		BMenuItem *item = ItemAt(i);
 		if (item-&gt;Frame().Intersects(updateRect))
 			item-&gt;Draw();
 	}
+	printf(&quot;BMenu::_DrawItems() took %lld usecs\n&quot;, system_time() - start);
 }
 
 
@@ -2879,4 +2951,79 @@
 	fMenu-&gt;_QuitTracking(thisMenuOnly);
 }
 
+
+/* static */
+status_t
+MenuPrivate::CreateBitmaps()
+{
+	BRect smallRect(0, 0, 16, 10);
+	BRect largeRect(0, 0, 21, 10);
+	
+	gMenuItemAlt = new BBitmap(smallRect, B_CMAP8);
+	gMenuItemControl = new BBitmap(smallRect, B_CMAP8);
+	gMenuItemOption = new BBitmap(smallRect, B_CMAP8);	
+	gMenuItemShift = new BBitmap(largeRect, B_CMAP8);
+	
+	gMenuItemAlt-&gt;ImportBits(kAltBits, sizeof(kAltBits),
+		17, 0, B_CMAP8);
+	gMenuItemControl-&gt;ImportBits(kCtrlBits, sizeof(kCtrlBits),
+		17, 0, B_CMAP8);				
+	gMenuItemOption-&gt;ImportBits(kOptBits, sizeof(kOptBits),
+		17, 0, B_CMAP8);
+	gMenuItemShift-&gt;ImportBits(kShiftBits, sizeof(kShiftBits),
+		22, 0, B_CMAP8);
+	
+	return B_OK;
+}
+
+
+/* static */
+void
+MenuPrivate::DeleteBitmaps()
+{
+	delete gMenuItemAlt;
+	delete gMenuItemControl;
+	delete gMenuItemOption;
+	delete gMenuItemShift;
+}
+
+
+/* static */
+const BBitmap *
+MenuPrivate::MenuItemCommand()
+{
+	if (BMenu::sAltAsCommandKey)
+		return gMenuItemAlt;
+	
+	return gMenuItemControl;
+}
+
+
+/* static */
+const BBitmap *
+MenuPrivate::MenuItemControl()
+{
+	if (BMenu::sAltAsCommandKey)
+		return gMenuItemControl;
+	
+	return gMenuItemAlt;
+}
+
+
+/* static */
+const BBitmap *
+MenuPrivate::MenuItemOption()
+{
+	return gMenuItemOption;
+}
+
+
+/* static */
+const BBitmap *
+MenuPrivate::MenuItemShift()
+{
+	return gMenuItemShift;
+}
+
+
 }	// namespace BPrivate

Modified: haiku/trunk/src/kits/interface/MenuItem.cpp
===================================================================
--- haiku/trunk/src/kits/interface/MenuItem.cpp	2009-07-30 02:54:40 UTC (rev 31961)
+++ haiku/trunk/src/kits/interface/MenuItem.cpp	2009-07-30 10:33:46 UTC (rev 31962)
@@ -26,65 +26,7 @@
 
 #include &quot;utf8_functions.h&quot;
 
-const unsigned char kCtrlBits[] = {
-	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
-	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
-};
 
-
-const unsigned char kAltBits[] = {
-	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x04,0x04,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
-	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
-};
-
-
-const unsigned char kOptBits[] = {
-	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x13,0x04,0x04,0x13,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x1a,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x13,0x04,0x04,0x13,0x1a,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
-	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
-};
-
-
-const unsigned char kShiftBits[] = {
-	0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x1d,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x17,0x04,0x04,0x17,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x17,0x17,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x04,0x04,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x17,0x04,0x04,0x17,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x04,0x04,0x04,0x1a,0x04,0x04,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x04,0x17,0x17,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x17,0x04,0x04,0x17,0x1a,0x04,0x1a,0x04,0x1a,0x04,0x1a,0x1a,0x1a,0x1a,0x04,0x1a,0x1a,0x17,0x14,
-	0x1d,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x1a,0x17,0x14,
-	0x1d,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x17,0x14,
-	0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14
-};
-
 const float kLightBGTint = (B_LIGHTEN_1_TINT + B_LIGHTEN_1_TINT + B_NO_TINT) / 3.0;
 
 // map control key shortcuts to drawable Unicode characters
@@ -790,46 +732,32 @@
 	where.y += (fBounds.Height() - 11) / 2 - 1;
 	where.x -= 4;	
 	
-	const bool altCommandKey = MenuPrivate(fSuper).IsAltCommandKey();
 	if (fModifiers &amp; B_COMMAND_KEY) {
-		BRect rect(0,0,16,10);
-		BBitmap control(rect, B_CMAP8);
-
-		if (altCommandKey)
-			control.ImportBits(kAltBits, sizeof(kAltBits), 17, 0, B_CMAP8);
-		else
-			control.ImportBits(kCtrlBits, sizeof(kCtrlBits), 17, 0, B_CMAP8);
-		
+		const BBitmap *command = MenuPrivate::MenuItemCommand();
+		const BRect &amp;rect = command-&gt;Bounds();
 		where.x -= rect.Width() + 1;
-		fSuper-&gt;DrawBitmap(&amp;control, where);
+		fSuper-&gt;DrawBitmap(command, where);
 	}
 
 	if (fModifiers &amp; B_CONTROL_KEY) {
-		BRect rect(0,0,16,10);
-		BBitmap control(rect, B_CMAP8);
-
-		if (altCommandKey)
-			control.ImportBits(kCtrlBits, sizeof(kCtrlBits), 17, 0, B_CMAP8);
-		else	
-			control.ImportBits(kAltBits, sizeof(kAltBits), 17, 0, B_CMAP8);
+		const BBitmap *control = MenuPrivate::MenuItemControl();
+		const BRect &amp;rect = control-&gt;Bounds();
 		where.x -= rect.Width() + 1;
-		fSuper-&gt;DrawBitmap(&amp;control, where);
+		fSuper-&gt;DrawBitmap(control, where);
 	}
 
 	if (fModifiers &amp; B_OPTION_KEY) {
-		BRect rect(0,0,16,10);
-		BBitmap option(rect, B_CMAP8);
-		option.ImportBits(kOptBits, sizeof(kOptBits), 17, 0, B_CMAP8);
+		const BBitmap *option = MenuPrivate::MenuItemOption();
+		const BRect &amp;rect = option-&gt;Bounds();
 		where.x -= rect.Width() + 1;
-		fSuper-&gt;DrawBitmap(&amp;option, where);
+		fSuper-&gt;DrawBitmap(option, where);
 	}
 	
 	if (fModifiers &amp; B_SHIFT_KEY) {
-		BRect rect(0,0,21,10);
-		BBitmap shift(rect, B_CMAP8);
-		shift.ImportBits(kShiftBits, sizeof(kShiftBits), 22, 0, B_CMAP8);
+		const BBitmap *shift = MenuPrivate::MenuItemOption();		
+		const BRect &amp;rect = shift-&gt;Bounds();
 		where.x -= rect.Width() + 1;
-		fSuper-&gt;DrawBitmap(&amp;shift, where);
+		fSuper-&gt;DrawBitmap(shift, where);
 	}
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018509.html">[Haiku-commits] r31961 -	haiku/trunk/src/apps/debuganalyzer/gui/main_window
</A></li>
	<LI>Next message: <A HREF="018512.html">[Haiku-commits] r31963 - in haiku/trunk: headers/private/interface	src/kits/interface
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18511">[ date ]</a>
              <a href="thread.html#18511">[ thread ]</a>
              <a href="subject.html#18511">[ subject ]</a>
              <a href="author.html#18511">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
