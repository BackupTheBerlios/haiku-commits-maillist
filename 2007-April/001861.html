<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r20860 - in haiku/trunk/src:	add-ons/kernel/file_systems/bfs tools tools/bfs_shell
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20860%20-%20in%20haiku/trunk/src%3A%0A%09add-ons/kernel/file_systems/bfs%20tools%20tools/bfs_shell&In-Reply-To=%3C200704271225.l3RCPrhs023534%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001860.html">
   <LINK REL="Next"  HREF="001862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r20860 - in haiku/trunk/src:	add-ons/kernel/file_systems/bfs tools tools/bfs_shell</H1>
    <B>bonefish at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20860%20-%20in%20haiku/trunk/src%3A%0A%09add-ons/kernel/file_systems/bfs%20tools%20tools/bfs_shell&In-Reply-To=%3C200704271225.l3RCPrhs023534%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r20860 - in haiku/trunk/src:	add-ons/kernel/file_systems/bfs tools tools/bfs_shell">bonefish at mail.berlios.de
       </A><BR>
    <I>Fri Apr 27 14:25:53 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001860.html">[Haiku-commits] r20859 - in haiku/trunk: headers/private	headers/private/fs_shell src/tools src/tools/fs_shell
</A></li>
        <LI>Next message: <A HREF="001862.html">[Haiku-commits] r20860 - in haiku/trunk/src:	add-ons/kernel/file_systems/bfs tools tools/bfs_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1861">[ date ]</a>
              <a href="thread.html#1861">[ thread ]</a>
              <a href="subject.html#1861">[ subject ]</a>
              <a href="author.html#1861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2007-04-27 14:25:49 +0200 (Fri, 27 Apr 2007)
New Revision: 20860
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=20860&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=20860&amp;view=rev</A>

Added:
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/system_dependencies.h
   haiku/trunk/src/tools/bfs_shell/
   haiku/trunk/src/tools/bfs_shell/Jamfile
Modified:
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Attribute.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/BlockAllocator.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/CachedBlock.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Chain.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Lock.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_control.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_endian.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp
   haiku/trunk/src/tools/Jamfile
Log:
* Prepared the BFS sources to be used with the new FS shell:
  - Moved all inclusions of system headers into a new
    system_dependencies.h header, which conditionally either includes
    these or the FS shell headers.
  - Fixed compiler warnings related to printf-like functions (int32 is
    int, not long on non-BeOS platforms).
* Build a new bfs_shell. Compiles and links, but does nothing ATM.


Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Attribute.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Attribute.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Attribute.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -6,7 +6,6 @@
 
 
 #include &quot;Attribute.h&quot;
-#include &lt;stdlib.h&gt;
 
 
 // ToDo: clean this up, find a better separation between Inode and this class

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -13,15 +13,7 @@
 #include &quot;Inode.h&quot;
 #include &quot;Utility.h&quot;
 
-#include &lt;util/kernel_cpp.h&gt;
-#include &lt;util/Stack.h&gt;
-#include &lt;TypeConstants.h&gt;
 
-#include &lt;string.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;stdio.h&gt;
-
-
 #ifdef DEBUG
 class NodeChecker {
 	public:
@@ -795,8 +787,8 @@
 			duplicate_array *array = duplicate-&gt;FragmentAt(bplustree_node::FragmentIndex(oldValue));
 			if (array-&gt;count &gt; NUM_FRAGMENT_VALUES
 				|| array-&gt;count &lt; 1) {
-				FATAL((&quot;insertDuplicate: Invalid array[%ld] size in fragment %Ld == %Ld!\n&quot;,
-					bplustree_node::FragmentIndex(oldValue),
+				FATAL((&quot;insertDuplicate: Invalid array[%d] size in fragment %Ld == %Ld!\n&quot;,
+					(int)bplustree_node::FragmentIndex(oldValue),
 					bplustree_node::FragmentOffset(oldValue),
 					array-&gt;count));
 				return B_BAD_DATA;
@@ -1365,8 +1357,8 @@
 
 		if (array-&gt;count &gt; NUM_FRAGMENT_VALUES
 			|| array-&gt;count &lt; 1) {
-			FATAL((&quot;removeDuplicate: Invalid array[%ld] size in fragment %Ld == %Ld!\n&quot;,
-				bplustree_node::FragmentIndex(oldValue), duplicateOffset, array-&gt;count));
+			FATAL((&quot;removeDuplicate: Invalid array[%d] size in fragment %Ld == %Ld!\n&quot;,
+				(int)bplustree_node::FragmentIndex(oldValue), duplicateOffset, array-&gt;count));
 			return B_BAD_DATA;
 		}
 		if (!array-&gt;Remove(value)) {
@@ -1549,8 +1541,8 @@
 	uint8 *key = node-&gt;KeyAt(index, &amp;length);
 	if (key + length + sizeof(off_t) + sizeof(uint16) &gt; (uint8 *)node + fNodeSize
 		|| length &gt; BPLUSTREE_MAX_KEY_LENGTH) {
-		FATAL((&quot;Key length to long: %s, %u (inode at %ld,%u)\n&quot;, key, length,
-			fStream-&gt;BlockRun().allocation_group, fStream-&gt;BlockRun().start));
+		FATAL((&quot;Key length to long: %s, %u (inode at %d,%u)\n&quot;, key, length,
+			(int)fStream-&gt;BlockRun().allocation_group, fStream-&gt;BlockRun().start));
 		fStream-&gt;GetVolume()-&gt;Panic();
 		return;
 	}

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/BPlusTree.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -14,9 +14,7 @@
 #include &quot;Journal.h&quot;
 #include &quot;Chain.h&quot;
 
-#include &lt;string.h&gt;
 
-
 //****************** on-disk structures ********************
 
 struct bplustree_node;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/BlockAllocator.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/BlockAllocator.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/BlockAllocator.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -12,9 +12,7 @@
 #include &quot;BPlusTree.h&quot;
 #include &quot;bfs_control.h&quot;
 
-#include &lt;util/Stack.h&gt;
-#include &lt;util/kernel_cpp.h&gt;
-#include &lt;stdlib.h&gt;
+#include &quot;system_dependencies.h&quot;
 
 #ifdef USER
 #	define spawn_kernel_thread spawn_thread
@@ -161,7 +159,7 @@
 #endif
 
 	if (uint32(start + numBlocks) &gt; fNumBits) {
-		FATAL((&quot;Allocation::Allocate(): tried to allocate too many blocks: %u (numBlocks = %lu)!\n&quot;, numBlocks, fNumBits));
+		FATAL((&quot;Allocation::Allocate(): tried to allocate too many blocks: %u (numBlocks = %u)!\n&quot;, numBlocks, (unsigned)fNumBits));
 		DIE((&quot;Allocation::Allocate(): tried to allocate too many blocks&quot;));
 	}
 
@@ -195,7 +193,7 @@
 #endif
 
 	if (uint32(start + numBlocks) &gt; fNumBits) {
-		FATAL((&quot;Allocation::Free(): tried to free too many blocks: %u (numBlocks = %lu)!\n&quot;, numBlocks, fNumBits));
+		FATAL((&quot;Allocation::Free(): tried to free too many blocks: %u (numBlocks = %u)!\n&quot;, numBlocks, (unsigned)fNumBits));
 		DIE((&quot;Allocation::Free(): tried to free too many blocks&quot;));
 	}
 
@@ -736,13 +734,13 @@
 		|| start &gt; fGroups[group].NumBits()
 		|| uint32(start + length) &gt; fGroups[group].NumBits()
 		|| length == 0) {
-		FATAL((&quot;tried to free an invalid block_run (%ld, %u, %u)\n&quot;, group, start, length));
+		FATAL((&quot;tried to free an invalid block_run (%d, %u, %u)\n&quot;, (int)group, start, length));
 		DEBUGGER((&quot;tried to free invalid block_run&quot;));
 		return B_BAD_VALUE;
 	}
 	// check if someone tries to free reserved areas at the beginning of the drive
 	if (group == 0 &amp;&amp; start &lt; uint32(fVolume-&gt;Log().Start() + fVolume-&gt;Log().Length())) {
-		FATAL((&quot;tried to free a reserved block_run (%ld, %u, %u)\n&quot;, group, start, length));
+		FATAL((&quot;tried to free a reserved block_run (%d, %u, %u)\n&quot;, (int)group, start, length));
 		DEBUGGER((&quot;tried to free reserved block&quot;));
 		return B_BAD_VALUE;
 	}
@@ -1161,8 +1159,8 @@
 					control-&gt;stats.already_set++;
 				} else {
 					if (firstSet != -1) {
-						FATAL((&quot;%s: block_run(%ld, %u, %u): blocks %Ld - %Ld are already set!\n&quot;,
-							type, run.AllocationGroup(), run.Start(), run.Length(), firstSet, firstGroupBlock + offset - 1));
+						FATAL((&quot;%s: block_run(%d, %u, %u): blocks %Ld - %Ld are already set!\n&quot;,
+							type, (int)run.AllocationGroup(), run.Start(), run.Length(), firstSet, firstGroupBlock + offset - 1));
 						firstSet = -1;
 					}
 					_SetCheckBitmapAt(firstGroupBlock + offset);
@@ -1176,7 +1174,7 @@
 			if (firstMissing != -1)
 				PRINT((&quot;%s: block_run(%ld, %u, %u): blocks %Ld - %Ld are not allocated!\n&quot;, type, run.AllocationGroup(), run.Start(), run.Length(), firstMissing, firstGroupBlock + pos + block * bitsPerBlock - 1));
 			if (firstSet != -1)
-				FATAL((&quot;%s: block_run(%ld, %u, %u): blocks %Ld - %Ld are already set!\n&quot;, type, run.AllocationGroup(), run.Start(), run.Length(), firstSet, firstGroupBlock + pos + block * bitsPerBlock - 1));
+				FATAL((&quot;%s: block_run(%d, %u, %u): blocks %Ld - %Ld are already set!\n&quot;, type, (int)run.AllocationGroup(), run.Start(), run.Length(), firstSet, firstGroupBlock + pos + block * bitsPerBlock - 1));
 		}
 	}
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/CachedBlock.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/CachedBlock.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/CachedBlock.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,15 +7,8 @@
 #define CACHED_BLOCK_H
 
 
-#include &lt;KernelExport.h&gt;
-#ifdef USER
-//#	include &quot;myfs.h&quot;
-#	include &lt;stdio.h&gt;
-#endif
+#include &quot;system_dependencies.h&quot;
 
-#include &lt;string.h&gt;
-#include &lt;unistd.h&gt;
-
 #include &quot;Volume.h&quot;
 #include &quot;Journal.h&quot;
 #include &quot;Lock.h&quot;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Chain.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Chain.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Chain.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,7 +7,7 @@
 ** This file may be used under the terms of the OpenBeOS License.
 */
 
-#include &lt;null.h&gt;
+#include &quot;system_dependencies.h&quot;
 
 /** The Link class you want to use with the Chain class needs to have
  *	a &quot;fNext&quot; member which is accessable from within the Chain class.

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -11,10 +11,6 @@
 #include &quot;BPlusTree.h&quot;
 #include &quot;Inode.h&quot;
 
-#include &lt;KernelExport.h&gt;
-
-#include &lt;time.h&gt;
-
 #define Print __out
 
 
@@ -40,7 +36,7 @@
 void
 dump_block_run(const char *prefix, const block_run &amp;run)
 {
-	Print(&quot;%s(%ld, %d, %d)\n&quot;, prefix, run.allocation_group, run.start, run.length);
+	Print(&quot;%s(%d, %d, %d)\n&quot;, prefix, (int)run.allocation_group, run.start, run.length);
 }
 
 
@@ -49,22 +45,22 @@
 {
 	Print(&quot;disk_super_block:\n&quot;);
 	Print(&quot;  name           = %s\n&quot;, superBlock-&gt;name);
-	Print(&quot;  magic1         = %#08lx (%s) %s\n&quot;, superBlock-&gt;magic1, get_tupel(superBlock-&gt;magic1), (superBlock-&gt;magic1 == SUPER_BLOCK_MAGIC1 ? &quot;valid&quot; : &quot;INVALID&quot;));
-	Print(&quot;  fs_byte_order  = %#08lx (%s)\n&quot;, superBlock-&gt;fs_byte_order, get_tupel(superBlock-&gt;fs_byte_order));
-	Print(&quot;  block_size     = %lu\n&quot;, superBlock-&gt;block_size);
-	Print(&quot;  block_shift    = %lu\n&quot;, superBlock-&gt;block_shift);
+	Print(&quot;  magic1         = %#08x (%s) %s\n&quot;, (int)superBlock-&gt;magic1, get_tupel(superBlock-&gt;magic1), (superBlock-&gt;magic1 == SUPER_BLOCK_MAGIC1 ? &quot;valid&quot; : &quot;INVALID&quot;));
+	Print(&quot;  fs_byte_order  = %#08x (%s)\n&quot;, (int)superBlock-&gt;fs_byte_order, get_tupel(superBlock-&gt;fs_byte_order));
+	Print(&quot;  block_size     = %u\n&quot;, (unsigned)superBlock-&gt;block_size);
+	Print(&quot;  block_shift    = %u\n&quot;, (unsigned)superBlock-&gt;block_shift);
 	Print(&quot;  num_blocks     = %Lu\n&quot;, superBlock-&gt;num_blocks);
 	Print(&quot;  used_blocks    = %Lu\n&quot;, superBlock-&gt;used_blocks);
-	Print(&quot;  inode_size     = %lu\n&quot;, superBlock-&gt;inode_size);
-	Print(&quot;  magic2         = %#08lx (%s) %s\n&quot;, superBlock-&gt;magic2, get_tupel(superBlock-&gt;magic2), (superBlock-&gt;magic2 == (int)SUPER_BLOCK_MAGIC2 ? &quot;valid&quot; : &quot;INVALID&quot;));
-	Print(&quot;  blocks_per_ag  = %lu\n&quot;, superBlock-&gt;blocks_per_ag);
-	Print(&quot;  ag_shift       = %lu (%ld bytes)\n&quot;, superBlock-&gt;ag_shift, 1L &lt;&lt; superBlock-&gt;ag_shift);
-	Print(&quot;  num_ags        = %lu\n&quot;, superBlock-&gt;num_ags);
-	Print(&quot;  flags          = %#08lx (%s)\n&quot;, superBlock-&gt;flags, get_tupel(superBlock-&gt;flags));
+	Print(&quot;  inode_size     = %u\n&quot;, (unsigned)superBlock-&gt;inode_size);
+	Print(&quot;  magic2         = %#08x (%s) %s\n&quot;, (int)superBlock-&gt;magic2, get_tupel(superBlock-&gt;magic2), (superBlock-&gt;magic2 == (int)SUPER_BLOCK_MAGIC2 ? &quot;valid&quot; : &quot;INVALID&quot;));
+	Print(&quot;  blocks_per_ag  = %u\n&quot;, (unsigned)superBlock-&gt;blocks_per_ag);
+	Print(&quot;  ag_shift       = %u (%ld bytes)\n&quot;, (unsigned)superBlock-&gt;ag_shift, 1L &lt;&lt; superBlock-&gt;ag_shift);
+	Print(&quot;  num_ags        = %u\n&quot;, (unsigned)superBlock-&gt;num_ags);
+	Print(&quot;  flags          = %#08x (%s)\n&quot;, (int)superBlock-&gt;flags, get_tupel(superBlock-&gt;flags));
 	dump_block_run(&quot;  log_blocks     = &quot;, superBlock-&gt;log_blocks);
 	Print(&quot;  log_start      = %Lu\n&quot;, superBlock-&gt;log_start);
 	Print(&quot;  log_end        = %Lu\n&quot;, superBlock-&gt;log_end);
-	Print(&quot;  magic3         = %#08lx (%s) %s\n&quot;, superBlock-&gt;magic3, get_tupel(superBlock-&gt;magic3), (superBlock-&gt;magic3 == SUPER_BLOCK_MAGIC3 ? &quot;valid&quot; : &quot;INVALID&quot;));
+	Print(&quot;  magic3         = %#08x (%s) %s\n&quot;, (int)superBlock-&gt;magic3, get_tupel(superBlock-&gt;magic3), (superBlock-&gt;magic3 == SUPER_BLOCK_MAGIC3 ? &quot;valid&quot; : &quot;INVALID&quot;));
 	dump_block_run(&quot;  root_dir       = &quot;, superBlock-&gt;root_dir);
 	dump_block_run(&quot;  indices        = &quot;, superBlock-&gt;indices);
 }
@@ -99,30 +95,30 @@
 dump_inode(const bfs_inode *inode)
 {
 	Print(&quot;inode:\n&quot;);
-	Print(&quot;  magic1             = %08lx (%s) %s\n&quot;, inode-&gt;magic1,
+	Print(&quot;  magic1             = %08x (%s) %s\n&quot;, (int)inode-&gt;magic1,
 		get_tupel(inode-&gt;magic1), (inode-&gt;magic1 == INODE_MAGIC1 ? &quot;valid&quot; : &quot;INVALID&quot;));
 	dump_block_run(	&quot;  inode_num          = &quot;, inode-&gt;inode_num);
-	Print(&quot;  uid                = %lu\n&quot;, inode-&gt;uid);
-	Print(&quot;  gid                = %lu\n&quot;, inode-&gt;gid);
-	Print(&quot;  mode               = %08lx\n&quot;, inode-&gt;mode);
-	Print(&quot;  flags              = %08lx\n&quot;, inode-&gt;flags);
+	Print(&quot;  uid                = %u\n&quot;, (unsigned)inode-&gt;uid);
+	Print(&quot;  gid                = %u\n&quot;, (unsigned)inode-&gt;gid);
+	Print(&quot;  mode               = %08x\n&quot;, (int)inode-&gt;mode);
+	Print(&quot;  flags              = %08x\n&quot;, (int)inode-&gt;flags);
 	Print(&quot;  create_time        = %Ld (%Ld)\n&quot;, inode-&gt;create_time,
 		inode-&gt;create_time &gt;&gt; INODE_TIME_SHIFT);
 	Print(&quot;  last_modified_time = %Ld (%Ld)\n&quot;, inode-&gt;last_modified_time,
 		inode-&gt;last_modified_time &gt;&gt; INODE_TIME_SHIFT);
 	dump_block_run(	&quot;  parent             = &quot;, inode-&gt;parent);
 	dump_block_run(	&quot;  attributes         = &quot;, inode-&gt;attributes);
-	Print(&quot;  type               = %lu\n&quot;, inode-&gt;type);
-	Print(&quot;  inode_size         = %lu\n&quot;, inode-&gt;inode_size);
-	Print(&quot;  etc                = %#08lx\n&quot;, inode-&gt;etc);
+	Print(&quot;  type               = %u\n&quot;, (unsigned)inode-&gt;type);
+	Print(&quot;  inode_size         = %u\n&quot;, (unsigned)inode-&gt;inode_size);
+	Print(&quot;  etc                = %#08x\n&quot;, (int)inode-&gt;etc);
 	Print(&quot;  short_symlink      = %s\n&quot;,
 		S_ISLNK(inode-&gt;mode) &amp;&amp; (inode-&gt;flags &amp; INODE_LONG_SYMLINK) == 0 ?
 			inode-&gt;short_symlink : &quot;-&quot;);
 	dump_data_stream(&amp;(inode-&gt;data));
-	Print(&quot;  --\n  pad[0]             = %08lx\n&quot;, inode-&gt;pad[0]);
-	Print(&quot;  pad[1]             = %08lx\n&quot;, inode-&gt;pad[1]);
-	Print(&quot;  pad[2]             = %08lx\n&quot;, inode-&gt;pad[2]);
-	Print(&quot;  pad[3]             = %08lx\n&quot;, inode-&gt;pad[3]);
+	Print(&quot;  --\n  pad[0]             = %08x\n&quot;, (int)inode-&gt;pad[0]);
+	Print(&quot;  pad[1]             = %08x\n&quot;, (int)inode-&gt;pad[1]);
+	Print(&quot;  pad[2]             = %08x\n&quot;, (int)inode-&gt;pad[2]);
+	Print(&quot;  pad[3]             = %08x\n&quot;, (int)inode-&gt;pad[3]);
 }
 
 
@@ -130,11 +126,11 @@
 dump_bplustree_header(const bplustree_header *header)
 {
 	Print(&quot;bplustree_header:\n&quot;);
-	Print(&quot;  magic                = %#08lx (%s) %s\n&quot;, header-&gt;magic,
+	Print(&quot;  magic                = %#08x (%s) %s\n&quot;, (int)header-&gt;magic,
 		get_tupel(header-&gt;magic), (header-&gt;magic == BPLUSTREE_MAGIC ? &quot;valid&quot; : &quot;INVALID&quot;));
-	Print(&quot;  node_size            = %lu\n&quot;, header-&gt;node_size);
-	Print(&quot;  max_number_of_levels = %lu\n&quot;, header-&gt;max_number_of_levels);
-	Print(&quot;  data_type            = %lu\n&quot;, header-&gt;data_type);
+	Print(&quot;  node_size            = %u\n&quot;, (unsigned)header-&gt;node_size);
+	Print(&quot;  max_number_of_levels = %u\n&quot;, (unsigned)header-&gt;max_number_of_levels);
+	Print(&quot;  data_type            = %u\n&quot;, (unsigned)header-&gt;data_type);
 	Print(&quot;  root_node_pointer    = %Ld\n&quot;, header-&gt;root_node_pointer);
 	Print(&quot;  free_node_pointer    = %Ld\n&quot;, header-&gt;free_node_pointer);
 	Print(&quot;  maximum_size         = %Lu\n&quot;, header-&gt;maximum_size);
@@ -203,7 +199,7 @@
 		uint16 length;
 		char buffer[256], *key = (char *)node-&gt;KeyAt(i, &amp;length);
 		if (length &gt; 255 || length == 0) {
-			Print(&quot;  %2ld. Invalid length (%u)!!\n&quot;, i, length);
+			Print(&quot;  %2d. Invalid length (%u)!!\n&quot;, (int)i, length);
 			dump_block((char *)node, header-&gt;node_size/*, sizeof(off_t)*/);
 			break;
 		}
@@ -212,15 +208,15 @@
 
 		off_t *value = node-&gt;Values() + i;
 		if ((uint32)value &lt; (uint32)node || (uint32)value &gt; (uint32)node + header-&gt;node_size)
-			Print(&quot;  %2ld. Invalid Offset!!\n&quot;, i);
+			Print(&quot;  %2d. Invalid Offset!!\n&quot;, (int)i);
 		else {
-			Print(&quot;  %2ld. &quot;, i);
+			Print(&quot;  %2d. &quot;, (int)i);
 			if (header-&gt;data_type == BPLUSTREE_STRING_TYPE)
 				Print(&quot;\&quot;%s\&quot;&quot;, buffer);
 			else if (header-&gt;data_type == BPLUSTREE_INT32_TYPE)
-				Print(&quot;int32 = %ld (0x%lx)&quot;, *(int32 *)&amp;buffer, *(int32 *)&amp;buffer);
+				Print(&quot;int32 = %d (0x%x)&quot;, (int)*(int32 *)&amp;buffer, (int)*(int32 *)&amp;buffer);
 			else if (header-&gt;data_type == BPLUSTREE_UINT32_TYPE)
-				Print(&quot;uint32 = %lu (0x%lx)&quot;, *(uint32 *)&amp;buffer, *(uint32 *)&amp;buffer);
+				Print(&quot;uint32 = %u (0x%x)&quot;, (unsigned)*(uint32 *)&amp;buffer, (unsigned)*(uint32 *)&amp;buffer);
 			else if (header-&gt;data_type == BPLUSTREE_INT64_TYPE)
 				Print(&quot;int64 = %Ld (0x%Lx)&quot;, *(int64 *)&amp;buffer, *(int64 *)&amp;buffer);
 			else
@@ -230,7 +226,7 @@
 			Print(&quot; (%d bytes) -&gt; %Ld&quot;, length, offset);
 			if (volume != NULL) {
 				block_run run = volume-&gt;ToBlockRun(offset);
-				Print(&quot; (%ld, %d)&quot;, run.allocation_group, run.start);
+				Print(&quot; (%d, %d)&quot;, (int)run.allocation_group, run.start);
 			}
 			if (bplustree_node::LinkType(*value) == BPLUSTREE_DUPLICATE_FRAGMENT)
 				Print(&quot; (duplicate fragment %Ld)\n&quot;, *value &amp; 0x3ff);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Debug.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,17 +7,11 @@
 #define DEBUG_H
 
 
-#include &lt;KernelExport.h&gt;
+#include &quot;system_dependencies.h&quot;
 
-#ifdef DEBUG
-#	include &lt;string.h&gt;
-#endif
-
 #ifdef USER
-#	include &lt;stdio.h&gt;
 #	define __out printf
 #else
-#	include &lt;null.h&gt;
 #	define __out dprintf
 #endif
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -12,8 +12,6 @@
 #include &quot;Inode.h&quot;
 #include &quot;BPlusTree.h&quot;
 
-#include &lt;util/kernel_cpp.h&gt;
-#include &lt;TypeConstants.h&gt;
 
 // B_MIME_STRING_TYPE is defined in storage/Mime.h, but we
 // don't need the whole file here; the type can't change anyway

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Index.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,7 +7,7 @@
 #define INDEX_H
 
 
-#include &lt;KernelExport.h&gt;
+#include &quot;system_dependencies.h&quot;
 
 class Transaction;
 class Volume;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -11,13 +11,7 @@
 #include &quot;BPlusTree.h&quot;
 #include &quot;Index.h&quot;
 
-#include &lt;fs_cache.h&gt;
-#include &lt;util/kernel_cpp.h&gt;
 
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-
-
 class InodeAllocator {
 	public:
 		InodeAllocator(Transaction &amp;transaction);
@@ -183,8 +177,8 @@
 	memcpy(&amp;fNode, node.Node(), sizeof(bfs_inode));
 
 	char lockName[B_OS_NAME_LENGTH];
-	snprintf(lockName, sizeof(lockName), &quot;bfs inode %ld.%d&quot;,
-		BlockRun().AllocationGroup(), BlockRun().Start());
+	snprintf(lockName, sizeof(lockName), &quot;bfs inode %d.%d&quot;,
+		(int)BlockRun().AllocationGroup(), BlockRun().Start());
 	fLock.Initialize(lockName);
 
 	// these two will help to maintain the indices
@@ -210,8 +204,8 @@
 		volume, &amp;transaction, id, this));
 
 	char lockName[B_OS_NAME_LENGTH];
-	snprintf(lockName, sizeof(lockName), &quot;bfs inode+%ld.%d&quot;,
-		run.AllocationGroup(), run.Start());
+	snprintf(lockName, sizeof(lockName), &quot;bfs inode+%d.%d&quot;,
+		(int)run.AllocationGroup(), run.Start());
 	fLock.Initialize(lockName);
 
 	NodeGetter node(volume, transaction, this, true);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Inode.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -6,19 +6,12 @@
 #define INODE_H
 
 
-#include &lt;KernelExport.h&gt;
-#ifdef USER
-//#	include &quot;myfs.h&quot;
-#	include &lt;stdio.h&gt;
-#endif
+#include &quot;system_dependencies.h&quot;
 
 #ifndef _IMPEXP_KERNEL
 #	define _IMPEXP_KERNEL
 #endif
 
-#include &lt;string.h&gt;
-#include &lt;unistd.h&gt;
-
 #include &quot;Volume.h&quot;
 #include &quot;Journal.h&quot;
 #include &quot;Lock.h&quot;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -9,12 +9,7 @@
 #include &quot;Inode.h&quot;
 #include &quot;Debug.h&quot;
 
-#include &lt;Drivers.h&gt;
-#include &lt;util/kernel_cpp.h&gt;
-#include &lt;util/Stack.h&gt;
-#include &lt;errno.h&gt;
 
-
 struct run_array {
 	int32		count;
 	union {
@@ -337,8 +332,8 @@
 	if (array-&gt;MaxRuns() != maxRuns
 		|| array-&gt;CountRuns() &gt; maxRuns
 		|| array-&gt;CountRuns() &lt;= 0) {
-		dprintf(&quot;run count: %ld, array max: %ld, max runs: %ld\n&quot;,
-			array-&gt;CountRuns(), array-&gt;MaxRuns(), maxRuns);
+		dprintf(&quot;run count: %d, array max: %d, max runs: %d\n&quot;,
+			(int)array-&gt;CountRuns(), (int)array-&gt;MaxRuns(), (int)maxRuns);
 		FATAL((&quot;Log entry has broken header!\n&quot;));
 		return B_ERROR;
 	}
@@ -433,7 +428,7 @@
 
 		status_t status = _ReplayRunArray(&amp;start);
 		if (status &lt; B_OK) {
-			FATAL((&quot;replaying log entry from %ld failed: %s\n&quot;, start, strerror(status)));
+			FATAL((&quot;replaying log entry from %d failed: %s\n&quot;, (int)start, strerror(status)));
 			return B_ERROR;
 		}
 		start = start % fLogSize;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Journal.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,14 +7,8 @@
 #define JOURNAL_H
 
 
-#include &lt;KernelExport.h&gt;
-#include &lt;util/DoublyLinkedList.h&gt;
+#include &quot;system_dependencies.h&quot;
 
-#ifdef USER
-//#	include &quot;myfs.h&quot;
-#	include &lt;stdio.h&gt;
-#endif
-
 #ifndef _IMPEXP_KERNEL
 #	define _IMPEXP_KERNEL
 #endif

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Lock.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Lock.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Lock.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,9 +7,8 @@
 #ifndef LOCK_H
 #define LOCK_H
 
+#include &quot;system_dependencies.h&quot;
 
-#include &lt;KernelExport.h&gt;
-#include &lt;stdio.h&gt;
 #include &quot;Utility.h&quot;
 #include &quot;Debug.h&quot;
 
@@ -165,7 +164,7 @@
 		{
 			thread_id thread = find_thread(NULL);
 			if (thread != fOwner) {
-				panic(&quot;RecursiveLock unlocked by %ld, owned by %ld\n&quot;, thread, fOwner);
+				panic(&quot;RecursiveLock unlocked by %d, owned by %d\n&quot;, (int)thread, (int)fOwner);
 			}
 
 			if (--fOwnerCount == 0) {

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -17,18 +17,7 @@
 #include &quot;BPlusTree.h&quot;
 #include &quot;Index.h&quot;
 
-#include &lt;util/kernel_cpp.h&gt;
-#include &lt;SupportDefs.h&gt;
-#include &lt;NodeMonitor.h&gt;
-#include &lt;TypeConstants.h&gt;
-#include &lt;AppDefs.h&gt;
-#include &lt;fs_query.h&gt;
 
-#include &lt;malloc.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;string.h&gt;
-
-
 // The parser has a very static design, but it will do what is required.
 //
 // ParseOr(), ParseAnd(), ParseEquation() are guarantying the operator
@@ -698,7 +687,7 @@
 			fSize = sizeof(double);
 			break;
 		default:
-			FATAL((&quot;query value conversion to 0x%lx requested!\n&quot;, type));
+			FATAL((&quot;query value conversion to 0x%x requested!\n&quot;, (int)type));
 			// should we fail here or just do a safety int32 conversion?
 			return B_ERROR;
 	}

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Query.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -6,13 +6,11 @@
 #ifndef QUERY_H
 #define QUERY_H
 
+#include &quot;system_dependencies.h&quot;
 
 #include &quot;Chain.h&quot;
 #include &quot;Index.h&quot;
 
-#include &lt;util/Stack.h&gt;
-#include &lt;SupportDefs.h&gt;
-
 class Volume;
 class Term;
 class Equation;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -8,12 +8,7 @@
 #include &quot;Utility.h&quot;
 #include &quot;Debug.h&quot;
 
-#include &lt;util/kernel_cpp.h&gt;
 
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-
-
 bool
 sorted_array::FindInternal(off_t value, int32 &amp;index) const
 {

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Utility.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,7 +7,7 @@
 #define UTILITY_H
 
 
-#include &lt;SupportDefs.h&gt;
+#include &quot;system_dependencies.h&quot;
 
 
 // Simple array, used for the duplicate handling in the B+Tree,

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -11,18 +11,7 @@
 #include &quot;Inode.h&quot;
 #include &quot;Query.h&quot;
 
-#include &lt;util/kernel_cpp.h&gt;
-#include &lt;KernelExport.h&gt;
-#include &lt;Drivers.h&gt;
-#include &lt;fs_volume.h&gt;
 
-#include &lt;ctype.h&gt;
-#include &lt;errno.h&gt;
-#include &lt;stdio.h&gt;
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-
-
 static const int32 kDesiredAllocationGroups = 56;
 	// This is the number of allocation groups that will be tried
 	// to be given for newly initialized disks.
@@ -444,7 +433,7 @@
 		|| run.length == 0
 		|| uint32(run.Length() + run.Start()) &gt; (1UL &lt;&lt; AllocationGroupShift())) {
 		Panic();
-		FATAL((&quot;*** invalid run(%ld,%d,%d)\n&quot;, run.AllocationGroup(), run.Start(), run.Length()));
+		FATAL((&quot;*** invalid run(%d,%d,%d)\n&quot;, (int)run.AllocationGroup(), run.Start(), run.Length()));
 		return B_BAD_DATA;
 	}
 	return B_OK;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/Volume.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,9 +7,7 @@
 #define VOLUME_H
 
 
-#include &lt;KernelExport.h&gt;
-#include &lt;fs_interface.h&gt;
-#include &lt;fs_cache.h&gt;
+#include &quot;system_dependencies.h&quot;
 
 #include &quot;bfs.h&quot;
 #include &quot;BlockAllocator.h&quot;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -9,15 +9,10 @@
 #define BFS_H
 
 
-#include &lt;SupportDefs.h&gt;
-
 #include &quot;bfs_endian.h&quot;
+#include &quot;system_dependencies.h&quot;
 
 
-#ifndef B_BEOS_VERSION_DANO
-#	define B_BAD_DATA B_ERROR
-#endif
-
 // ToDo: temporary fix! (missing but public ioctls)
 #define IOCTL_FILE_UNCACHED_IO	10000
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_control.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_control.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_control.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -7,7 +7,7 @@
 */
 
 
-#include &lt;fs_interface.h&gt;
+#include &quot;system_dependencies.h&quot;
 
 
 /* ioctl to check the version of BFS used - parameter is a uint32 *

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_endian.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_endian.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/bfs_endian.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -6,7 +6,7 @@
 #define BFS_ENDIAN_H
 
 
-#include &lt;ByteOrder.h&gt;
+#include &quot;system_dependencies.h&quot;
 
 
 #if !defined(BFS_LITTLE_ENDIAN_ONLY) &amp;&amp; !defined(BFS_BIG_ENDIAN_ONLY)

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp	2007-04-27 12:25:49 UTC (rev 20860)
@@ -14,22 +14,7 @@
 #include &quot;Attribute.h&quot;
 #include &quot;bfs_control.h&quot;
 
-#include &lt;util/kernel_cpp.h&gt;
 
-#include &lt;string.h&gt;
-#include &lt;stdio.h&gt;
-
-#include &lt;KernelExport.h&gt;
-#include &lt;NodeMonitor.h&gt;
-#include &lt;fs_interface.h&gt;
-#include &lt;fs_cache.h&gt;
-
-#include &lt;fs_attr.h&gt;
-#include &lt;fs_info.h&gt;
-#include &lt;fs_index.h&gt;
-#include &lt;fs_query.h&gt;
-#include &lt;fs_volume.h&gt;
-
 #define BFS_IO_SIZE	65536
 
 
@@ -1265,8 +1250,8 @@
 		if (needsTrimming) {
 			status = inode-&gt;TrimPreallocation(transaction);
 			if (status &lt; B_OK) {
-				FATAL((&quot;Could not trim preallocated blocks: inode %Ld, transaction %ld: %s!\n&quot;,
-					inode-&gt;ID(), transaction.ID(), strerror(status)));
+				FATAL((&quot;Could not trim preallocated blocks: inode %Ld, transaction %d: %s!\n&quot;,
+					inode-&gt;ID(), (int)transaction.ID(), strerror(status)));
 
 				// we still want this transaction to succeed
 				status = B_OK;

Added: haiku/trunk/src/add-ons/kernel/file_systems/bfs/system_dependencies.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/system_dependencies.h	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/system_dependencies.h	2007-04-27 12:25:49 UTC (rev 20860)
@@ -0,0 +1,46 @@
+/*
+ * Copyright 2007, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at cs.tu-berlin.de.</A>
+ * Distributed under the terms of the MIT License.
+ */
+
+#ifndef _SYSTEM_DEPENDENCIES_H
+#define _SYSTEM_DEPENDENCIES_H
+
+
+#ifdef BFS_SHELL
+
+#include &quot;fssh_api_wrapper.h&quot;
+
+#else	// !BFS_SHELL
+
+#include &lt;ctype.h&gt;
+#include &lt;errno.h&gt;
+#include &lt;null.h&gt;
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;time.h&gt;
+#include &lt;unistd.h&gt;
+
+#include &lt;fs_attr.h&gt;
+#include &lt;fs_cache.h&gt;
+#include &lt;fs_index.h&gt;
+#include &lt;fs_info.h&gt;
+#include &lt;fs_interface.h&gt;
+#include &lt;fs_query.h&gt;
+#include &lt;fs_volume.h&gt;
+#include &lt;ByteOrder.h&gt;
+#include &lt;Drivers.h&gt;
+#include &lt;KernelExport.h&gt;
+#include &lt;NodeMonitor.h&gt;
+#include &lt;SupportDefs.h&gt;
+#include &lt;TypeConstants.h&gt;
+
+#include &lt;util/DoublyLinkedList.h&gt;
+#include &lt;util/kernel_cpp.h&gt;
+#include &lt;util/Stack.h&gt;
+
+#endif	// !BFS_SHELL
+
+
+#endif	// _SYSTEM_DEPENDENCIES_H

Modified: haiku/trunk/src/tools/Jamfile
===================================================================
--- haiku/trunk/src/tools/Jamfile	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/tools/Jamfile	2007-04-27 12:25:49 UTC (rev 20860)
@@ -59,6 +59,7 @@
 		UpdateMimeInfoThread.cpp MimeUpdateThread.cpp database_support.cpp
 	] = [ FDirName $(HAIKU_TOP) src build libbe storage mime ] ;
 
+SubInclude HAIKU_TOP src tools bfs_shell ;
 SubInclude HAIKU_TOP src tools copy_to_bfs_image ;
 SubInclude HAIKU_TOP src tools cppunit ;
 SubInclude HAIKU_TOP src tools docbook ;

Added: haiku/trunk/src/tools/bfs_shell/Jamfile
===================================================================
--- haiku/trunk/src/tools/bfs_shell/Jamfile	2007-04-27 12:17:22 UTC (rev 20859)
+++ haiku/trunk/src/tools/bfs_shell/Jamfile	2007-04-27 12:25:49 UTC (rev 20860)
@@ -0,0 +1,40 @@
+SubDir HAIKU_TOP src tools bfs_shell ;
+
+SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src add-ons kernel file_systems bfs ] ;
+
+# set some additional defines
+{
+	local defines =
+		#BFS_BIG_ENDIAN_ONLY
+		BFS_SHELL
+		;
+
+	if $(DEBUG) = 0 {
+		# the gcc on BeOS doesn't compile BFS correctly with -O2 or more
+		OPTIM = -O1 ;
+	}
+
+	defines = [ FDefines $(defines) ] ;
+	SubDirCcFlags $(defines) -Wall -Wno-multichar ;
+	SubDirC++Flags $(defines) -Wall -Wno-multichar -fno-rtti ;
+}
+
+UsePrivateHeaders fs_shell ;
+
+BuildPlatformMain &lt;build2&gt;bfs_shell
+	:
+	BlockAllocator.cpp
+	BPlusTree.cpp
+	Attribute.cpp
+	Debug.cpp
+	Index.cpp
+	Inode.cpp
+	Journal.cpp
+	Query.cpp
+	Utility.cpp
+	Volume.cpp
+
+	kernel_interface.cpp
+
+	: &lt;build2&gt;fs_shell.a $(HOST_LIBSUPC++) $(HOST_LIBROOT)
+;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001860.html">[Haiku-commits] r20859 - in haiku/trunk: headers/private	headers/private/fs_shell src/tools src/tools/fs_shell
</A></li>
	<LI>Next message: <A HREF="001862.html">[Haiku-commits] r20860 - in haiku/trunk/src:	add-ons/kernel/file_systems/bfs tools tools/bfs_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1861">[ date ]</a>
              <a href="thread.html#1861">[ thread ]</a>
              <a href="subject.html#1861">[ subject ]</a>
              <a href="author.html#1861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
