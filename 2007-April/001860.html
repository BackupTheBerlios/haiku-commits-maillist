<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r20859 - in haiku/trunk: headers/private	headers/private/fs_shell src/tools src/tools/fs_shell
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20859%20-%20in%20haiku/trunk%3A%20headers/private%0A%09headers/private/fs_shell%20src/tools%20src/tools/fs_shell&In-Reply-To=%3C200704271217.l3RCHZlH022995%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001859.html">
   <LINK REL="Next"  HREF="001861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r20859 - in haiku/trunk: headers/private	headers/private/fs_shell src/tools src/tools/fs_shell</H1>
    <B>bonefish at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20859%20-%20in%20haiku/trunk%3A%20headers/private%0A%09headers/private/fs_shell%20src/tools%20src/tools/fs_shell&In-Reply-To=%3C200704271217.l3RCHZlH022995%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r20859 - in haiku/trunk: headers/private	headers/private/fs_shell src/tools src/tools/fs_shell">bonefish at mail.berlios.de
       </A><BR>
    <I>Fri Apr 27 14:17:35 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001859.html">[Haiku-commits] r20858 - in haiku/trunk: headers/build	src/build/libroot
</A></li>
        <LI>Next message: <A HREF="001861.html">[Haiku-commits] r20860 - in haiku/trunk/src:	add-ons/kernel/file_systems/bfs tools tools/bfs_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1860">[ date ]</a>
              <a href="thread.html#1860">[ thread ]</a>
              <a href="subject.html#1860">[ subject ]</a>
              <a href="author.html#1860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2007-04-27 14:17:22 +0200 (Fri, 27 Apr 2007)
New Revision: 20859
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=20859&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=20859&amp;view=rev</A>

Added:
   haiku/trunk/headers/private/fs_shell/
   haiku/trunk/headers/private/fs_shell/DoublyLinkedList.h
   haiku/trunk/headers/private/fs_shell/KPath.h
   haiku/trunk/headers/private/fs_shell/Stack.h
   haiku/trunk/headers/private/fs_shell/fssh_api_wrapper.h
   haiku/trunk/headers/private/fs_shell/fssh_atomic.h
   haiku/trunk/headers/private/fs_shell/fssh_auto_locker.h
   haiku/trunk/headers/private/fs_shell/fssh_byte_order.h
   haiku/trunk/headers/private/fs_shell/fssh_defs.h
   haiku/trunk/headers/private/fs_shell/fssh_dirent.h
   haiku/trunk/headers/private/fs_shell/fssh_disk_device_defs.h
   haiku/trunk/headers/private/fs_shell/fssh_disk_device_manager.h
   haiku/trunk/headers/private/fs_shell/fssh_drivers.h
   haiku/trunk/headers/private/fs_shell/fssh_errno.h
   haiku/trunk/headers/private/fs_shell/fssh_errors.h
   haiku/trunk/headers/private/fs_shell/fssh_fcntl.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_attr.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_cache.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_index.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_info.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_interface.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_query.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_volume.h
   haiku/trunk/headers/private/fs_shell/fssh_kernel_export.h
   haiku/trunk/headers/private/fs_shell/fssh_kernel_priv.h
   haiku/trunk/headers/private/fs_shell/fssh_module.h
   haiku/trunk/headers/private/fs_shell/fssh_node_monitor.h
   haiku/trunk/headers/private/fs_shell/fssh_os.h
   haiku/trunk/headers/private/fs_shell/fssh_stat.h
   haiku/trunk/headers/private/fs_shell/fssh_stdio.h
   haiku/trunk/headers/private/fs_shell/fssh_string.h
   haiku/trunk/headers/private/fs_shell/fssh_time.h
   haiku/trunk/headers/private/fs_shell/fssh_type_constants.h
   haiku/trunk/headers/private/fs_shell/fssh_types.h
   haiku/trunk/headers/private/fs_shell/fssh_uio.h
   haiku/trunk/headers/private/fs_shell/fssh_unistd.h
   haiku/trunk/src/tools/fs_shell/
   haiku/trunk/src/tools/fs_shell/Jamfile
   haiku/trunk/src/tools/fs_shell/KPath.cpp
   haiku/trunk/src/tools/fs_shell/atomic.cpp
   haiku/trunk/src/tools/fs_shell/block_cache.cpp
   haiku/trunk/src/tools/fs_shell/block_cache_priv.h
   haiku/trunk/src/tools/fs_shell/errno.cpp
   haiku/trunk/src/tools/fs_shell/fcntl.cpp
   haiku/trunk/src/tools/fs_shell/fd.cpp
   haiku/trunk/src/tools/fs_shell/fd.h
   haiku/trunk/src/tools/fs_shell/file_cache.cpp
   haiku/trunk/src/tools/fs_shell/fssh.cpp
   haiku/trunk/src/tools/fs_shell/hash.cpp
   haiku/trunk/src/tools/fs_shell/hash.h
   haiku/trunk/src/tools/fs_shell/kernel_export.cpp
   haiku/trunk/src/tools/fs_shell/list.cpp
   haiku/trunk/src/tools/fs_shell/list.h
   haiku/trunk/src/tools/fs_shell/lock.cpp
   haiku/trunk/src/tools/fs_shell/lock.h
   haiku/trunk/src/tools/fs_shell/node_monitor.cpp
   haiku/trunk/src/tools/fs_shell/sem.cpp
   haiku/trunk/src/tools/fs_shell/sem_unix.cpp
   haiku/trunk/src/tools/fs_shell/stat.cpp
   haiku/trunk/src/tools/fs_shell/stat_util.cpp
   haiku/trunk/src/tools/fs_shell/stat_util.h
   haiku/trunk/src/tools/fs_shell/stdio.cpp
   haiku/trunk/src/tools/fs_shell/string.cpp
   haiku/trunk/src/tools/fs_shell/thread.cpp
   haiku/trunk/src/tools/fs_shell/time.cpp
   haiku/trunk/src/tools/fs_shell/uio.cpp
   haiku/trunk/src/tools/fs_shell/unistd.cpp
   haiku/trunk/src/tools/fs_shell/vfs.cpp
   haiku/trunk/src/tools/fs_shell/vfs.h
Modified:
   haiku/trunk/src/tools/Jamfile
Log:
Beginnings of a new, better portable FS shell with Haiku FS interface.
Doesn't do anything ATM, but already provides the required system
interface (VFS, caches, POSIX functions).


Added: haiku/trunk/headers/private/fs_shell/DoublyLinkedList.h
===================================================================
--- haiku/trunk/headers/private/fs_shell/DoublyLinkedList.h	2007-04-27 12:11:30 UTC (rev 20858)
+++ haiku/trunk/headers/private/fs_shell/DoublyLinkedList.h	2007-04-27 12:17:22 UTC (rev 20859)
@@ -0,0 +1,584 @@
+/* 
+ * Copyright 2005-2006, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at users.sf.net.</A> All rights reserved.
+ * Distributed under the terms of the MIT License.
+ */
+#ifndef KERNEL_UTIL_DOUBLY_LINKED_LIST_H
+#define KERNEL_UTIL_DOUBLY_LINKED_LIST_H
+
+
+#include &quot;fssh_types.h&quot;
+
+
+#ifdef __cplusplus
+
+
+namespace FSShell {
+
+
+// DoublyLinkedListLink
+template&lt;typename Element&gt;
+class DoublyLinkedListLink {
+public:
+	DoublyLinkedListLink() : previous(NULL), next(NULL) {}
+	~DoublyLinkedListLink() {}
+
+	Element	*previous;
+	Element	*next;
+};
+
+// DoublyLinkedListLinkImpl
+template&lt;typename Element&gt;
+class DoublyLinkedListLinkImpl {
+private:
+	typedef DoublyLinkedListLink&lt;Element&gt; DLL_Link;
+
+public:
+	DoublyLinkedListLinkImpl() : fDoublyLinkedListLink() {}
+	~DoublyLinkedListLinkImpl() {}
+
+	DLL_Link *GetDoublyLinkedListLink()	
+		{ return &fDoublyLinkedListLink; }
+	const DLL_Link *GetDoublyLinkedListLink() const
+		{ return &fDoublyLinkedListLink; }
+
+private:
+	DLL_Link	fDoublyLinkedListLink;
+};
+
+// DoublyLinkedListStandardGetLink
+template&lt;typename Element&gt;
+class DoublyLinkedListStandardGetLink {
+private:
+	typedef DoublyLinkedListLink&lt;Element&gt; Link;
+
+public:
+	inline Link *operator()(Element *element) const
+	{
+		return element-&gt;GetDoublyLinkedListLink();
+	}
+
+	inline const Link *operator()(const Element *element) const
+	{
+		return element-&gt;GetDoublyLinkedListLink();
+	}
+};
+
+// DoublyLinkedListMemberGetLink
+template&lt;typename Element,
+	DoublyLinkedListLink&lt;Element&gt; Element::* LinkMember = &amp;Element::fLink&gt;
+class DoublyLinkedListMemberGetLink {
+private:
+	typedef DoublyLinkedListLink&lt;Element&gt; Link;
+
+public:
+	inline Link *operator()(Element *element) const
+	{
+		return &amp;(element-&gt;*LinkMember);
+	}
+
+	inline const Link *operator()(const Element *element) const
+	{
+		return &amp;(element-&gt;*LinkMember);
+	}
+};
+
+// DoublyLinkedListCLink - interface to struct list
+template&lt;typename Element&gt;
+class DoublyLinkedListCLink {
+	private:
+		typedef DoublyLinkedListLink&lt;Element&gt; Link;
+
+	public:
+		inline Link *operator()(Element *element) const
+		{
+			return (Link *)&amp;element-&gt;link;
+		}
+
+		inline const Link *operator()(const Element *element) const
+		{
+			return (const Link *)&amp;element-&gt;link;
+		}
+};
+
+// for convenience
+#define DOUBLY_LINKED_LIST_TEMPLATE_LIST \
+	template&lt;typename Element, typename GetLink&gt;
+#define DOUBLY_LINKED_LIST_CLASS_NAME DoublyLinkedList&lt;Element, GetLink&gt;
+
+// DoublyLinkedList
+template&lt;typename Element,
+	typename GetLink = DoublyLinkedListStandardGetLink&lt;Element&gt; &gt;
+class DoublyLinkedList {
+private:
+	typedef DoublyLinkedList&lt;Element, GetLink&gt;	List;
+	typedef DoublyLinkedListLink&lt;Element&gt;		Link;
+
+public:
+	class Iterator {
+	public:
+		Iterator(List *list)
+			:
+			fList(list)
+		{
+			Rewind();
+		}
+
+		Iterator(const Iterator &amp;other)
+		{
+			*this = other;
+		}
+
+		bool HasNext() const
+		{
+			return fNext;
+		}
+
+		Element *Next()
+		{
+			fCurrent = fNext;
+			if (fNext)
+				fNext = fList-&gt;GetNext(fNext);
+			return fCurrent;
+		}
+
+		Element *Remove()
+		{
+			Element *element = fCurrent;
+			if (fCurrent) {
+				fList-&gt;Remove(fCurrent);
+				fCurrent = NULL;
+			}
+			return element;
+		}
+
+		Iterator &amp;operator=(const Iterator &amp;other)
+		{
+			fList = other.fList;
+			fCurrent = other.fCurrent;
+			fNext = other.fNext;
+			return *this;
+		}
+
+		void Rewind()
+		{
+			fCurrent = NULL;
+			fNext = fList-&gt;First();
+		}
+
+	private:
+		List	*fList;
+		Element	*fCurrent;
+		Element	*fNext;
+	};
+
+	class ConstIterator {
+	public:
+		ConstIterator(const List *list)
+			:
+			fList(list)
+		{
+			Rewind();
+		}
+
+		ConstIterator(const ConstIterator &amp;other)
+		{
+			*this = other;
+		}
+
+		bool HasNext() const
+		{
+			return fNext;
+		}
+
+		Element *Next()
+		{
+			Element *element = fNext;
+			if (fNext)
+				fNext = fList-&gt;GetNext(fNext);
+			return element;
+		}
+
+		ConstIterator &amp;operator=(const ConstIterator &amp;other)
+		{
+			fList = other.fList;
+			fNext = other.fNext;
+			return *this;
+		}
+
+		void Rewind()
+		{
+			fNext = fList-&gt;First();
+		}
+
+	private:
+		const List	*fList;
+		Element		*fNext;
+	};
+
+	class ReverseIterator {
+	public:
+		ReverseIterator(List *list)
+			:
+			fList(list)
+		{
+			Rewind();
+		}
+
+		ReverseIterator(const ReverseIterator &amp;other)
+		{
+			*this = other;
+		}
+
+		bool HasNext() const
+		{
+			return fNext;
+		}
+
+		Element *Next()
+		{
+			fCurrent = fNext;
+			if (fNext)
+				fNext = fList-&gt;GetPrevious(fNext);
+			return fCurrent;
+		}
+
+		Element *Remove()
+		{
+			Element *element = fCurrent;
+			if (fCurrent) {
+				fList-&gt;Remove(fCurrent);
+				fCurrent = NULL;
+			}
+			return element;
+		}
+
+		ReverseIterator &amp;operator=(const ReverseIterator &amp;other)
+		{
+			fList = other.fList;
+			fCurrent = other.fCurrent;
+			fNext = other.fNext;
+			return *this;
+		}
+
+		void Rewind()
+		{
+			fCurrent = NULL;
+			fNext = fList-&gt;Last();
+		}
+
+	private:
+		List	*fList;
+		Element	*fCurrent;
+		Element	*fNext;
+	};
+
+	class ConstReverseIterator {
+	public:
+		ConstReverseIterator(const List *list)
+			:
+			fList(list)
+		{
+			Rewind();
+		}
+
+		ConstReverseIterator(const ConstReverseIterator &amp;other)
+		{
+			*this = other;
+		}
+
+		bool HasNext() const
+		{
+			return fNext;
+		}
+
+		Element *Next()
+		{
+			Element *element = fNext;
+			if (fNext)
+				fNext = fList-&gt;GetPrevious(fNext);
+			return element;
+		}
+
+		ConstReverseIterator &amp;operator=(const ConstReverseIterator &amp;other)
+		{
+			fList = other.fList;
+			fNext = other.fNext;
+			return *this;
+		}
+
+		void Rewind()
+		{
+			fNext = fList-&gt;Last();
+		}
+
+	private:
+		const List	*fList;
+		Element		*fNext;
+	};
+
+public:
+	DoublyLinkedList() : fFirst(NULL), fLast(NULL) {}
+	~DoublyLinkedList() {}
+
+	inline bool IsEmpty() const			{ return (fFirst == NULL); }
+
+	inline void Insert(Element *element, bool back = true);
+	inline void Insert(Element *before, Element *element);
+	inline void Add(Element *element, bool back = true);
+	inline void Remove(Element *element);
+
+	inline void Swap(Element *a, Element *b);
+
+	inline void MoveFrom(DOUBLY_LINKED_LIST_CLASS_NAME *fromList);
+
+	inline void RemoveAll();
+	inline void MakeEmpty()				{ RemoveAll(); }
+
+	inline Element *First() const		{ return fFirst; }
+	inline Element *Last() const		{ return fLast; }
+
+	inline Element *Head() const		{ return fFirst; }
+	inline Element *Tail() const		{ return fLast; }
+
+	inline Element *RemoveHead();
+
+	inline Element *GetPrevious(Element *element) const;
+	inline Element *GetNext(Element *element) const;
+
+	inline int32_t Size() const;
+		// O(n)!
+
+	inline Iterator GetIterator()				{ return Iterator(this); }
+	inline ConstIterator GetIterator() const	{ return ConstIterator(this); }
+
+	inline ReverseIterator GetReverseIterator()
+		{ return ReverseIterator(this); }
+	inline ConstReverseIterator GetReverseIterator() const
+		{ return ConstReverseIterator(this); }
+
+private:
+	Element	*fFirst;
+	Element	*fLast;
+
+	static GetLink	sGetLink;
+};
+
+
+// inline methods
+
+// Insert
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+void
+DOUBLY_LINKED_LIST_CLASS_NAME::Insert(Element *element, bool back)
+{
+	if (element) {
+		if (back) {
+			// append
+			Link *elLink = sGetLink(element);
+			elLink-&gt;previous = fLast;
+			elLink-&gt;next = NULL;
+			if (fLast)
+				sGetLink(fLast)-&gt;next = element;
+			else
+				fFirst = element;
+			fLast = element;
+		} else {
+			// prepend
+			Link *elLink = sGetLink(element);
+			elLink-&gt;previous = NULL;
+			elLink-&gt;next = fFirst;
+			if (fFirst)
+				sGetLink(fFirst)-&gt;previous = element;
+			else
+				fLast = element;
+			fFirst = element;
+		}
+	}
+}
+
+// Insert
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+void
+DOUBLY_LINKED_LIST_CLASS_NAME::Insert(Element *before, Element *element)
+{
+	if (before == NULL) {
+		Insert(element);
+		return;
+	}
+	if (element == NULL)
+		return;
+
+	Link *beforeLink = sGetLink(before);
+	Link *link = sGetLink(element);
+
+	link-&gt;next = before;
+	link-&gt;previous = beforeLink-&gt;previous;
+	if (link-&gt;previous != NULL)
+		sGetLink(link-&gt;previous)-&gt;next = element;
+	beforeLink-&gt;previous = element;
+
+	if (fFirst == before)
+		fFirst = element;
+}
+
+// Add
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+void
+DOUBLY_LINKED_LIST_CLASS_NAME::Add(Element *element, bool back)
+{
+	Insert(element, back);
+}
+
+// Remove
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+void
+DOUBLY_LINKED_LIST_CLASS_NAME::Remove(Element *element)
+{
+	if (element) {
+		Link *elLink = sGetLink(element);
+		if (elLink-&gt;previous)
+			sGetLink(elLink-&gt;previous)-&gt;next = elLink-&gt;next;
+		else
+			fFirst = elLink-&gt;next;
+		if (elLink-&gt;next)
+			sGetLink(elLink-&gt;next)-&gt;previous = elLink-&gt;previous;
+		else
+			fLast = elLink-&gt;previous;
+		elLink-&gt;previous = NULL;
+		elLink-&gt;next = NULL;
+	}
+}
+
+// Swap
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+void
+DOUBLY_LINKED_LIST_CLASS_NAME::Swap(Element *a, Element *b)
+{
+	if (a &amp;&amp; b &amp;&amp; a != b) {
+		Link *aLink = sGetLink(a);
+		Link *bLink = sGetLink(b);
+		Element *aPrev = aLink-&gt;previous;
+		Element *bPrev = bLink-&gt;previous;
+		Element *aNext = aLink-&gt;next;
+		Element *bNext = bLink-&gt;next;
+		// place a
+		if (bPrev)
+			sGetLink(bPrev)-&gt;next = a;
+		else
+			fFirst = a;
+		if (bNext)
+			sGetLink(bNext)-&gt;previous = a;
+		else
+			fLast = a;
+		aLink-&gt;previous = bPrev;
+		aLink-&gt;next = bNext;
+		// place b
+		if (aPrev)
+			sGetLink(aPrev)-&gt;next = b;
+		else
+			fFirst = b;
+		if (aNext)
+			sGetLink(aNext)-&gt;previous = b;
+		else
+			fLast = b;
+		bLink-&gt;previous = aPrev;
+		bLink-&gt;next = aNext;
+	}
+}
+
+// MoveFrom
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+void
+DOUBLY_LINKED_LIST_CLASS_NAME::MoveFrom(DOUBLY_LINKED_LIST_CLASS_NAME *fromList)
+{
+	if (fromList &amp;&amp; fromList-&gt;fFirst) {
+		if (fFirst) {
+			sGetLink(fLast)-&gt;next = fromList-&gt;fFirst;
+			sGetLink(fFirst)-&gt;previous = fLast;
+			fLast = fromList-&gt;fLast;
+		} else {
+			fFirst = fromList-&gt;fFirst;
+			fLast = fromList-&gt;fLast;
+		}
+		fromList-&gt;fFirst = NULL;
+		fromList-&gt;fLast = NULL;
+	}
+}
+
+// RemoveAll
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+void
+DOUBLY_LINKED_LIST_CLASS_NAME::RemoveAll()
+{
+	Element *element = fFirst;
+	while (element) {
+		Link *elLink = sGetLink(element);
+		element = elLink-&gt;next;
+		elLink-&gt;previous = NULL;
+		elLink-&gt;next = NULL;
+	}
+	fFirst = NULL;
+	fLast = NULL;
+}
+
+// RemoveHead
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+Element *
+DOUBLY_LINKED_LIST_CLASS_NAME::RemoveHead()
+{
+	Element *element = Head();
+	Remove(element);
+	return element;
+}
+
+// GetPrevious
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+Element *
+DOUBLY_LINKED_LIST_CLASS_NAME::GetPrevious(Element *element) const
+{
+	Element *result = NULL;
+	if (element)
+		result = sGetLink(element)-&gt;previous;
+	return result;
+}
+
+// GetNext
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+Element *
+DOUBLY_LINKED_LIST_CLASS_NAME::GetNext(Element *element) const
+{
+	Element *result = NULL;
+	if (element)
+		result = sGetLink(element)-&gt;next;
+	return result;
+}
+
+// Size
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+int32_t
+DOUBLY_LINKED_LIST_CLASS_NAME::Size() const
+{
+	int32_t count = 0;
+	for (Element* element = First(); element; element = GetNext(element))
+		count++;
+	return count;
+}
+
+// sGetLink
+DOUBLY_LINKED_LIST_TEMPLATE_LIST
+GetLink DOUBLY_LINKED_LIST_CLASS_NAME::sGetLink;
+
+
+}	// namespace FSShell
+
+using FSShell::DoublyLinkedListLink;
+using FSShell::DoublyLinkedListLinkImpl;
+using FSShell::DoublyLinkedListStandardGetLink;
+using FSShell::DoublyLinkedListMemberGetLink;
+using FSShell::DoublyLinkedListCLink;
+using FSShell::DoublyLinkedList;
+
+
+#endif	/* __cplusplus */
+
+#endif	// _KERNEL_UTIL_DOUBLY_LINKED_LIST_H

Added: haiku/trunk/headers/private/fs_shell/KPath.h
===================================================================
--- haiku/trunk/headers/private/fs_shell/KPath.h	2007-04-27 12:11:30 UTC (rev 20858)
+++ haiku/trunk/headers/private/fs_shell/KPath.h	2007-04-27 12:17:22 UTC (rev 20859)
@@ -0,0 +1,62 @@
+/*
+ * Copyright 2004-2007, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at users.sf.net.</A>
+ * Distributed under the terms of the MIT License.
+ */
+#ifndef _K_PATH_H
+#define _K_PATH_H
+
+
+#include &quot;fssh_defs.h&quot;
+#include &quot;fssh_kernel_export.h&quot;
+
+
+namespace FSShell {
+
+class KPath {
+	public:
+		KPath(fssh_size_t bufferSize = FSSH_B_PATH_NAME_LENGTH);
+		KPath(const char* path, bool normalize = false,
+			fssh_size_t bufferSize = FSSH_B_PATH_NAME_LENGTH);
+		KPath(const KPath&amp; other);
+		~KPath();
+
+		fssh_status_t SetTo(const char *path, bool normalize = false,
+			fssh_size_t bufferSize = FSSH_B_PATH_NAME_LENGTH);
+
+		fssh_status_t InitCheck() const;
+
+		fssh_status_t SetPath(const char *path, bool normalize = false);
+		const char *Path() const;
+		fssh_size_t Length() const { return fPathLength; }
+
+		fssh_size_t BufferSize() const { return fBufferSize; }
+		char *LockBuffer();
+		void UnlockBuffer();
+
+		const char *Leaf() const;
+		fssh_status_t ReplaceLeaf(const char *newLeaf);
+
+		fssh_status_t Append(const char *toAppend, bool isComponent = true);
+
+		KPath&amp; operator=(const KPath&amp; other);
+		KPath&amp; operator=(const char* path);
+
+		bool operator==(const KPath&amp; other) const;
+		bool operator==(const char* path) const;
+		bool operator!=(const KPath&amp; other) const;
+		bool operator!=(const char* path) const;
+
+	private:
+		void _ChopTrailingSlashes();
+
+		char*		fBuffer;
+		fssh_size_t	fBufferSize;
+		fssh_size_t	fPathLength;
+		bool		fLocked;
+};
+
+} // namespace FSShell
+
+using FSShell::KPath;
+
+#endif	/* _K_PATH_H */

Added: haiku/trunk/headers/private/fs_shell/Stack.h
===================================================================
--- haiku/trunk/headers/private/fs_shell/Stack.h	2007-04-27 12:11:30 UTC (rev 20858)
+++ haiku/trunk/headers/private/fs_shell/Stack.h	2007-04-27 12:17:22 UTC (rev 20859)
@@ -0,0 +1,87 @@
+/* Stack - a template stack class (plus some handy methods)
+ *
+ * Copyright 2001-2005, Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de.</A>
+ * This file may be used under the terms of the MIT License.
+ */
+#ifndef _FSSH_STACK_H
+#define _FSSH_STACK_H
+
+
+#include &quot;fssh_defs.h&quot;
+#include &quot;fssh_errors.h&quot;
+
+
+namespace FSShell {
+
+
+template&lt;class T&gt; class Stack {
+	public:
+		Stack()
+			:
+			fArray(NULL),
+			fUsed(0),
+			fMax(0)
+		{
+		}
+
+		~Stack()
+		{
+			free(fArray);
+		}
+
+		bool IsEmpty() const
+		{
+			return fUsed == 0;
+		}
+
+		void MakeEmpty()
+		{
+			// could also free the memory
+			fUsed = 0;
+		}
+
+		fssh_status_t Push(T value)
+		{
+			if (fUsed &gt;= fMax) {
+				fMax += 16;
+				T *newArray = (T *)realloc(fArray, fMax * sizeof(T));
+				if (newArray == NULL)
+					return FSSH_B_NO_MEMORY;
+
+				fArray = newArray;
+			}
+			fArray[fUsed++] = value;
+			return FSSH_B_OK;
+		}
+
+		bool Pop(T *value)
+		{
+			if (fUsed == 0)
+				return false;
+
+			*value = fArray[--fUsed];
+			return true;
+		}
+
+		T *Array()
+		{
+			return fArray;
+		}
+
+		int32_t CountItems() const
+		{
+			return fUsed;
+		}
+
+	private:
+		T		*fArray;
+		int32_t	fUsed;
+		int32_t	fMax;
+};
+
+}	// namespace FSShell
+
+using FSShell::Stack;
+
+
+#endif	/* _FSSH_STACK_H */

Added: haiku/trunk/headers/private/fs_shell/fssh_api_wrapper.h
===================================================================
--- haiku/trunk/headers/private/fs_shell/fssh_api_wrapper.h	2007-04-27 12:11:30 UTC (rev 20858)
+++ haiku/trunk/headers/private/fs_shell/fssh_api_wrapper.h	2007-04-27 12:17:22 UTC (rev 20859)
@@ -0,0 +1,1477 @@
+/*
+ * Copyright 2007, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at cs.tu-berlin.de.</A>
+ * Distributed under the terms of the MIT License.
+ */
+
+#ifndef _FSSH_API_WRAPPER_H
+#define _FSSH_API_WRAPPER_H
+
+#include &lt;stdlib.h&gt;
+
+#include &quot;fssh_dirent.h&quot;
+#include &quot;fssh_errno.h&quot;
+#include &quot;fssh_fcntl.h&quot;
+#include &quot;fssh_stat.h&quot;
+#include &quot;fssh_stdio.h&quot;
+#include &quot;fssh_string.h&quot;
+#include &quot;fssh_time.h&quot;
+#include &quot;fssh_uio.h&quot;
+#include &quot;fssh_unistd.h&quot;
+
+#include &quot;fssh_atomic.h&quot;
+#include &quot;fssh_byte_order.h&quot;
+#include &quot;fssh_defs.h&quot;
+#include &quot;fssh_disk_device_defs.h&quot;
+#include &quot;fssh_disk_device_manager.h&quot;
+#include &quot;fssh_drivers.h&quot;
+#include &quot;fssh_errors.h&quot;
+#include &quot;fssh_fs_attr.h&quot;
+#include &quot;fssh_fs_cache.h&quot;
+#include &quot;fssh_fs_index.h&quot;
+#include &quot;fssh_fs_info.h&quot;
+#include &quot;fssh_fs_interface.h&quot;
+#include &quot;fssh_fs_query.h&quot;
+#include &quot;fssh_fs_volume.h&quot;
+#include &quot;fssh_kernel_export.h&quot;
+#include &quot;fssh_module.h&quot;
+#include &quot;fssh_node_monitor.h&quot;
+#include &quot;fssh_os.h&quot;
+#include &quot;fssh_type_constants.h&quot;
+#include &quot;fssh_types.h&quot;
+
+#include &quot;DoublyLinkedList.h&quot;
+#include &quot;Stack.h&quot;
+
+
+////////////////////////////////////////////////////////////////////////////////
+// #pragma mark - fssh_atomic.h
+
+#define atomic_set			fssh_atomic_set
+#define atomic_test_and_set	fssh_atomic_test_and_set
+#define atomic_add			fssh_atomic_add
+#define atomic_and			fssh_atomic_and
+#define atomic_or			fssh_atomic_or
+#define atomic_get			fssh_atomic_get
+
+
+////////////////////////////////////////////////////////////////////////////////
+// #pragma mark - fssh_bytes_order.h
+
+// swap directions
+#define B_SWAP_HOST_TO_LENDIAN	FSSH_B_SWAP_HOST_TO_LENDIAN
+#define B_SWAP_HOST_TO_BENDIAN	FSSH_B_SWAP_HOST_TO_BENDIAN
+#define B_SWAP_LENDIAN_TO_HOST	FSSH_B_SWAP_LENDIAN_TO_HOST
+#define B_SWAP_BENDIAN_TO_HOST	FSSH_B_SWAP_BENDIAN_TO_HOST
+#define B_SWAP_ALWAYS			FSSH_B_SWAP_ALWAYS
+
+#define swap_action	fssh_swap_action
+
+// BSD/networking macros
+#define htonl(x)	fssh_htonl(x)
+#define ntohl(x)	fssh_ntohl(x)
+#define htons(x)	fssh_htons(x)
+#define ntohs(x)	fssh_ntohs(x)
+
+// always swap macros
+#define B_SWAP_DOUBLE(arg)	FSSH_B_SWAP_DOUBLE(arg)
+#define B_SWAP_FLOAT(arg)	FSSH_B_SWAP_FLOAT(arg)
+#define B_SWAP_INT64(arg)	FSSH_B_SWAP_INT64(arg)
+#define B_SWAP_INT32(arg)	FSSH_B_SWAP_INT32(arg)
+#define B_SWAP_INT16(arg)	FSSH_B_SWAP_INT16(arg)
+
+#define B_HOST_IS_LENDIAN	FSSH_B_HOST_IS_LENDIAN
+#define B_HOST_IS_BENDIAN	FSSH_B_HOST_IS_BENDIAN
+
+// Host native to little endian
+#define B_HOST_TO_LENDIAN_DOUBLE(arg)	FSSH_B_HOST_TO_LENDIAN_DOUBLE(arg)
+#define B_HOST_TO_LENDIAN_FLOAT(arg)	FSSH_B_HOST_TO_LENDIAN_FLOAT(arg)
+#define B_HOST_TO_LENDIAN_INT64(arg)	FSSH_B_HOST_TO_LENDIAN_INT64(arg)
+#define B_HOST_TO_LENDIAN_INT32(arg)	FSSH_B_HOST_TO_LENDIAN_INT32(arg)
+#define B_HOST_TO_LENDIAN_INT16(arg)	FSSH_B_HOST_TO_LENDIAN_INT16(arg)
+
+// Little endian to host native
+#define B_LENDIAN_TO_HOST_DOUBLE(arg)	FSSH_B_LENDIAN_TO_HOST_DOUBLE(arg)
+#define B_LENDIAN_TO_HOST_FLOAT(arg)	FSSH_B_LENDIAN_TO_HOST_FLOAT(arg)
+#define B_LENDIAN_TO_HOST_INT64(arg)	FSSH_B_LENDIAN_TO_HOST_INT64(arg)
+#define B_LENDIAN_TO_HOST_INT32(arg)	FSSH_B_LENDIAN_TO_HOST_INT32(arg)
+#define B_LENDIAN_TO_HOST_INT16(arg)	FSSH_B_LENDIAN_TO_HOST_INT16(arg)
+
+// Host native to big endian
+#define B_HOST_TO_BENDIAN_DOUBLE(arg)	FSSH_B_HOST_TO_BENDIAN_DOUBLE(arg)
+#define B_HOST_TO_BENDIAN_FLOAT(arg)	FSSH_B_HOST_TO_BENDIAN_FLOAT(arg)
+#define B_HOST_TO_BENDIAN_INT64(arg)	FSSH_B_HOST_TO_BENDIAN_INT64(arg)
+#define B_HOST_TO_BENDIAN_INT32(arg)	FSSH_B_HOST_TO_BENDIAN_INT32(arg)
+#define B_HOST_TO_BENDIAN_INT16(arg)	FSSH_B_HOST_TO_BENDIAN_INT16(arg)
+
+// Big endian to host native
+#define B_BENDIAN_TO_HOST_DOUBLE(arg)	FSSH_B_BENDIAN_TO_HOST_DOUBLE(arg)
+#define B_BENDIAN_TO_HOST_FLOAT(arg)	FSSH_B_BENDIAN_TO_HOST_FLOAT(arg)
+#define B_BENDIAN_TO_HOST_INT64(arg)	FSSH_B_BENDIAN_TO_HOST_INT64(arg)
+#define B_BENDIAN_TO_HOST_INT32(arg)	FSSH_B_BENDIAN_TO_HOST_INT32(arg)
+#define B_BENDIAN_TO_HOST_INT16(arg)	FSSH_B_BENDIAN_TO_HOST_INT16(arg)
+
+#define swap_data	fssh_swap_data
+#define 			is_type_swapped
+
+
+// Private implementations
+#define __fssh_swap_double
+#define __fssh_swap_float
+#define __fssh_swap_int64
+#define __fssh_swap_int32
+#define __fssh_swap_int16
+
+
+////////////////////////////////////////////////////////////////////////////////
+// #pragma mark - fssh_defs.h
+
+// Limits
+#define B_DEV_NAME_LENGTH	FSSH_B_DEV_NAME_LENGTH
+#define B_FILE_NAME_LENGTH	FSSH_B_FILE_NAME_LENGTH
+#define B_PATH_NAME_LENGTH	FSSH_B_PATH_NAME_LENGTH
+#define B_ATTR_NAME_LENGTH	FSSH_B_ATTR_NAME_LENGTH
+#define B_MIME_TYPE_LENGTH	FSSH_B_MIME_TYPE_LENGTH
+#define B_MAX_SYMLINKS		FSSH_B_MAX_SYMLINKS
+
+// Open Modes
+#define B_READ_ONLY			FSSH_B_READ_ONLY
+#define B_WRITE_ONLY		FSSH_B_WRITE_ONLY
+#define B_READ_WRITE		FSSH_B_READ_WRITE
+
+#define	B_FAIL_IF_EXISTS	FSSH_B_FAIL_IF_EXISTS
+#define B_CREATE_FILE		FSSH_B_CREATE_FILE
+#define B_ERASE_FILE		FSSH_B_ERASE_FILE
+#define B_OPEN_AT_END		FSSH_B_OPEN_AT_END
+
+// Node Flavors
+#define node_flavor			fssh_node_flavor
+#define	B_FILE_NODE			FSSH_B_FILE_NODE
+#define	B_SYMLINK_NODE		FSSH_B_SYMLINK_NODE
+#define	B_DIRECTORY_NODE	FSSH_B_DIRECTORY_NODE
+#define	B_ANY_NODE			FSSH_B_ANY_NODE
+
+#define offsetof(type,member)	fssh_offsetof(type,member)
+
+#define min_c(a,b)				fssh_min_c(a,b)
+#define max_c(a,b)				fssh_max_c(a,b)
+
+#define _PACKED	_FSSH_PACKED
+
+
+////////////////////////////////////////////////////////////////////////////////
+// #pragma mark - fssh_dirent.h
+
+#define dirent		fssh_dirent
+#define dirent_t	fssh_dirent_t
+
+#define DIR			fssh_DIR
+
+
+
+////////////////////////////////////////////////////////////////////////////////
+// #pragma mark - fssh_disk_device_defs.h
+
+#define partition_id	fssh_partition_id
+#define disk_system_id	fssh_disk_system_id
+#define disk_job_id		fssh_disk_job_id
+
+// partition flags
+#define B_PARTITION_IS_DEVICE			FSSH_B_PARTITION_IS_DEVICE
+#define B_PARTITION_FILE_SYSTEM			FSSH_B_PARTITION_FILE_SYSTEM
+#define B_PARTITION_PARTITIONING_SYSTEM	FSSH_B_PARTITION_PARTITIONING_SYSTEM
+#define B_PARTITION_READ_ONLY			FSSH_B_PARTITION_READ_ONLY
+#define B_PARTITION_MOUNTED				FSSH_B_PARTITION_MOUNTED
+#define B_PARTITION_BUSY				FSSH_B_PARTITION_BUSY
+#define B_PARTITION_DESCENDANT_BUSY		FSSH_B_PARTITION_DESCENDANT_BUSY
+
+// partition statuses
+#define B_PARTITION_VALID			FSSH_B_PARTITION_VALID
+#define B_PARTITION_CORRUPT			FSSH_B_PARTITION_CORRUPT
+#define B_PARTITION_UNRECOGNIZED	FSSH_B_PARTITION_UNRECOGNIZED
+#define B_PARTITION_UNINITIALIZED	FSSH_B_PARTITION_UNINITIALIZED
+
+// partition change flags
+#define B_PARTITION_CHANGED_OFFSET				FSSH_B_PARTITION_CHANGED_OFFSET
+#define B_PARTITION_CHANGED_SIZE				FSSH_B_PARTITION_CHANGED_SIZE
+#define B_PARTITION_CHANGED_CONTENT_SIZE		FSSH_B_PARTITION_CHANGED_CONTENT_SIZE
+#define B_PARTITION_CHANGED_BLOCK_SIZE			FSSH_B_PARTITION_CHANGED_BLOCK_SIZE
+#define B_PARTITION_CHANGED_STATUS				FSSH_B_PARTITION_CHANGED_STATUS
+#define B_PARTITION_CHANGED_FLAGS				FSSH_B_PARTITION_CHANGED_FLAGS
+#define B_PARTITION_CHANGED_VOLUME				FSSH_B_PARTITION_CHANGED_VOLUME
+#define B_PARTITION_CHANGED_NAME				FSSH_B_PARTITION_CHANGED_NAME
+#define B_PARTITION_CHANGED_CONTENT_NAME		FSSH_B_PARTITION_CHANGED_CONTENT_NAME
+#define B_PARTITION_CHANGED_TYPE				FSSH_B_PARTITION_CHANGED_TYPE
+#define B_PARTITION_CHANGED_CONTENT_TYPE		FSSH_B_PARTITION_CHANGED_CONTENT_TYPE
+#define B_PARTITION_CHANGED_PARAMETERS			FSSH_B_PARTITION_CHANGED_PARAMETERS
+#define B_PARTITION_CHANGED_CONTENT_PARAMETERS	FSSH_B_PARTITION_CHANGED_CONTENT_PARAMETERS
+#define B_PARTITION_CHANGED_CHILDREN			FSSH_B_PARTITION_CHANGED_CHILDREN
+#define B_PARTITION_CHANGED_DESCENDANTS			FSSH_B_PARTITION_CHANGED_DESCENDANTS
+#define B_PARTITION_CHANGED_DEFRAGMENTATION		FSSH_B_PARTITION_CHANGED_DEFRAGMENTATION
+#define B_PARTITION_CHANGED_CHECK				FSSH_B_PARTITION_CHANGED_CHECK
+#define B_PARTITION_CHANGED_REPAIR				FSSH_B_PARTITION_CHANGED_REPAIR
+#define B_PARTITION_CHANGED_INITIALIZATION		FSSH_B_PARTITION_CHANGED_INITIALIZATION
+
+// disk device flags
+#define B_DISK_DEVICE_REMOVABLE		FSSH_B_DISK_DEVICE_REMOVABLE
+#define B_DISK_DEVICE_HAS_MEDIA		FSSH_B_DISK_DEVICE_HAS_MEDIA
+#define B_DISK_DEVICE_READ_ONLY		FSSH_B_DISK_DEVICE_READ_ONLY
+#define B_DISK_DEVICE_WRITE_ONCE	FSSH_B_DISK_DEVICE_WRITE_ONCE
+
+// disk system flags
+#define B_DISK_SYSTEM_IS_FILE_SYSTEM	FSSH_B_DISK_SYSTEM_IS_FILE_SYSTEM
+
+// flags common for both file and partitioning systems
+#define B_DISK_SYSTEM_SUPPORTS_CHECKING						FSSH_B_DISK_SYSTEM_SUPPORTS_CHECKING
+#define B_DISK_SYSTEM_SUPPORTS_REPAIRING					FSSH_B_DISK_SYSTEM_SUPPORTS_REPAIRING
+#define B_DISK_SYSTEM_SUPPORTS_RESIZING						FSSH_B_DISK_SYSTEM_SUPPORTS_RESIZING
+#define B_DISK_SYSTEM_SUPPORTS_MOVING						FSSH_B_DISK_SYSTEM_SUPPORTS_MOVING
+#define B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_NAME			FSSH_B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_NAME
+#define B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_PARAMETERS	FSSH_B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_PARAMETERS
+
+// file system specific flags
+#define B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING							FSSH_B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING
+#define B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING_WHILE_MOUNTED				FSSH_B_DISK_SYSTEM_SUPPORTS_DEFRAGMENTING_WHILE_MOUNTED
+#define B_DISK_SYSTEM_SUPPORTS_CHECKING_WHILE_MOUNTED					FSSH_B_DISK_SYSTEM_SUPPORTS_CHECKING_WHILE_MOUNTED
+#define B_DISK_SYSTEM_SUPPORTS_REPAIRING_WHILE_MOUNTED					FSSH_B_DISK_SYSTEM_SUPPORTS_REPAIRING_WHILE_MOUNTED
+#define B_DISK_SYSTEM_SUPPORTS_RESIZING_WHILE_MOUNTED					FSSH_B_DISK_SYSTEM_SUPPORTS_RESIZING_WHILE_MOUNTED
+#define B_DISK_SYSTEM_SUPPORTS_MOVING_WHILE_MOUNTED						FSSH_B_DISK_SYSTEM_SUPPORTS_MOVING_WHILE_MOUNTED
+#define B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_NAME_WHILE_MOUNTED		FSSH_B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_NAME_WHILE_MOUNTED
+#define B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_PARAMETERS_WHILE_MOUNTED	FSSH_B_DISK_SYSTEM_SUPPORTS_SETTING_CONTENT_PARAMETERS_WHILE_MOUNTED
+
+// partitioning system specific flags
+#define B_DISK_SYSTEM_SUPPORTS_RESIZING_CHILD		FSSH_B_DISK_SYSTEM_SUPPORTS_RESIZING_CHILD
+#define B_DISK_SYSTEM_SUPPORTS_MOVING_CHILD			FSSH_B_DISK_SYSTEM_SUPPORTS_MOVING_CHILD
+#define B_DISK_SYSTEM_SUPPORTS_SETTING_NAME			FSSH_B_DISK_SYSTEM_SUPPORTS_SETTING_NAME

[... truncated: 16918 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001859.html">[Haiku-commits] r20858 - in haiku/trunk: headers/build	src/build/libroot
</A></li>
	<LI>Next message: <A HREF="001861.html">[Haiku-commits] r20860 - in haiku/trunk/src:	add-ons/kernel/file_systems/bfs tools tools/bfs_shell
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1860">[ date ]</a>
              <a href="thread.html#1860">[ thread ]</a>
              <a href="subject.html#1860">[ subject ]</a>
              <a href="author.html#1860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
