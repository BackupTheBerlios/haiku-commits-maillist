<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r20806 - in haiku/trunk/src/apps: . mandelbrot
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20806%20-%20in%20haiku/trunk/src/apps%3A%20.%20mandelbrot&In-Reply-To=%3C200704242300.l3ON0EUp002213%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001788.html">
   <LINK REL="Next"  HREF="001791.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r20806 - in haiku/trunk/src/apps: . mandelbrot</H1>
    <B>phoudoin at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20806%20-%20in%20haiku/trunk/src/apps%3A%20.%20mandelbrot&In-Reply-To=%3C200704242300.l3ON0EUp002213%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r20806 - in haiku/trunk/src/apps: . mandelbrot">phoudoin at mail.berlios.de
       </A><BR>
    <I>Wed Apr 25 01:00:14 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001788.html">[Haiku-commits] r20805 - haiku/trunk/src/apps/tv
</A></li>
        <LI>Next message: <A HREF="001791.html">[Haiku-commits] r20807 -	haiku/trunk/src/tests/kits/opengl/direct_mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1789">[ date ]</a>
              <a href="thread.html#1789">[ thread ]</a>
              <a href="subject.html#1789">[ subject ]</a>
              <a href="author.html#1789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: phoudoin
Date: 2007-04-25 01:00:11 +0200 (Wed, 25 Apr 2007)
New Revision: 20806
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=20806&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=20806&amp;view=rev</A>

Added:
   haiku/trunk/src/apps/mandelbrot/
   haiku/trunk/src/apps/mandelbrot/Jamfile
   haiku/trunk/src/apps/mandelbrot/LICENSE
   haiku/trunk/src/apps/mandelbrot/Mandelbrot.rdef
   haiku/trunk/src/apps/mandelbrot/main.cpp
   haiku/trunk/src/apps/mandelbrot/tsb.cpp
   haiku/trunk/src/apps/mandelbrot/tsb.h
   haiku/trunk/src/apps/mandelbrot/tsb1.cpp
Modified:
   haiku/trunk/src/apps/Jamfile
Log:
Added Be sample code Mandelbrot app.


Modified: haiku/trunk/src/apps/Jamfile
===================================================================
--- haiku/trunk/src/apps/Jamfile	2007-04-24 22:35:06 UTC (rev 20805)
+++ haiku/trunk/src/apps/Jamfile	2007-04-24 23:00:11 UTC (rev 20806)
@@ -15,6 +15,7 @@
 SubInclude HAIKU_TOP src apps installer ;
 SubInclude HAIKU_TOP src apps magnify ;
 SubInclude HAIKU_TOP src apps mail ;
+SubInclude HAIKU_TOP src apps mandelbrot ;
 SubInclude HAIKU_TOP src apps mediaplayer ;
 SubInclude HAIKU_TOP src apps midiplayer ;
 SubInclude HAIKU_TOP src apps networkstatus ;

Added: haiku/trunk/src/apps/mandelbrot/Jamfile
===================================================================
--- haiku/trunk/src/apps/mandelbrot/Jamfile	2007-04-24 22:35:06 UTC (rev 20805)
+++ haiku/trunk/src/apps/mandelbrot/Jamfile	2007-04-24 23:00:11 UTC (rev 20806)
@@ -0,0 +1,11 @@
+SubDir HAIKU_TOP src apps mandelbrot ;
+
+SetSubDirSupportedPlatformsBeOSCompatible ;
+AddSubDirSupportedPlatforms libbe_test ;
+
+Application Mandelbrot : 
+	main.cpp
+	tsb.cpp
+	: be
+	: Mandelbrot.rdef ;
+

Added: haiku/trunk/src/apps/mandelbrot/LICENSE
===================================================================
--- haiku/trunk/src/apps/mandelbrot/LICENSE	2007-04-24 22:35:06 UTC (rev 20805)
+++ haiku/trunk/src/apps/mandelbrot/LICENSE	2007-04-24 23:00:11 UTC (rev 20806)
@@ -0,0 +1,31 @@
+----------------------
+Be Sample Code License
+----------------------
+
+Copyright 1991-1999, Be Incorporated.
+All rights reserved.
+
+Redistribution and use in source and binary forms, with or without
+modification, are permitted provided that the following conditions
+are met:
+
+1. Redistributions of source code must retain the above copyright
+   notice, this list of conditions, and the following disclaimer.
+
+2. Redistributions in binary form must reproduce the above copyright
+   notice, this list of conditions, and the following disclaimer in the
+   documentation and/or other materials provided with the distribution.
+
+3. The name of the author may not be used to endorse or promote products
+   derived from this software without specific prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE AUTHOR &quot;AS IS&quot; AND ANY EXPRESS OR
+IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR
+PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
+DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
+AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
+TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.    

Added: haiku/trunk/src/apps/mandelbrot/Mandelbrot.rdef
===================================================================
--- haiku/trunk/src/apps/mandelbrot/Mandelbrot.rdef	2007-04-24 22:35:06 UTC (rev 20805)
+++ haiku/trunk/src/apps/mandelbrot/Mandelbrot.rdef	2007-04-24 23:00:11 UTC (rev 20806)
@@ -0,0 +1,60 @@
+resource large_icon
+{
+	$&quot;FFFFFF000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FFFF001B1C1B0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF003F1B1C1B1C1C0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF0015153F1B1C1B1C1C0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A16153F3F1B1C1B1C0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B0B15153F1B1C1B1C1C0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B000B0A16153F1B1C1B1C1C0000FFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B0000000B0A16153F3F1B1C1B1C0000FFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B00000000000B0A16153F3F1B1C1B1C0000FFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B000000000000000B0A16153F3F1B1C1B1C0000FFFFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B000000000000FC3E920A0B15153F3F1B1C1B3F00FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B0000000000FC0000FC3E670A0B15163F3F3F0E00FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B000000000000000000007494730B0B15150F0F00FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B0000000000000000000043FC743E1B16150F0F29FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B0000FC0000000000000000FC943E1B16150F0F29FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B0069FC00000000000000006F94941C15150F0F00FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0BFC3EFE000000000000000094736D1C15150F0F00FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B3E5E4300000000000000FCFC3E5E4116150F0F01FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B7394FCFC0000000000000000947E4116150F0F01FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B6D7394FCFC000000FCFC0000747E4116150F0F01FFFFFFFFFFFFFF&quot;
+	$&quot;FF00150A0B1C6D6E693EFEFC946E3EFE6994FC1B15160F0E00FFFFFFFFFFFFFF&quot;
+	$&quot;FF0015150B1B1C1C6D737494947394949473944682140F0F00FFFFFFFFFFFFFF&quot;
+	$&quot;FF11000015151C1B1C1C3EFEFC6D6D6D6D6D941C15150F0F00FFFFFFFFFFFFFF&quot;
+	$&quot;FFFF1111000015151C1B1C1C6D6D6D6D6D6D3E1C1516AE1000FFFFFFFFFFFFFF&quot;
+	$&quot;FFFFFFFF1111000015151C1B1C1C67676D6D731C15150F0F001111FFFFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFF1111000015151C1B1C1C6D6D6E1C15150F0F0011111111FFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFF1111000015151C1B1C1CFC1B15160F0E00111111111111FF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFF1111000015151C1B1C1C15150F0F001111111111FFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFF1111000015151C1B16150F0F0011111111FFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFF11110000151515160E0F00111111FFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1111000015150F00111111FFFFFFFFFF&quot;
+	$&quot;FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1111000000111111FFFFFFFFFFFF&quot;
+};
+
+resource mini_icon
+{
+	$&quot;FF000000FFFFFFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;00151B1C0000FFFFFFFFFFFFFFFFFFFF&quot;
+	$&quot;00150A161B1C0000FFFFFFFFFFFFFFFF&quot;
+	$&quot;00150A000B151C1C0000FFFFFFFFFFFF&quot;
+	$&quot;00150A0000000B151C1C0000FFFFFFFF&quot;
+	$&quot;00150A000000FC0A0B151C0F00FFFFFF&quot;
+	$&quot;00150A0000FC00FC940A160E00FFFFFF&quot;
+	$&quot;00150A0000000000941C150F00FFFFFF&quot;
+	$&quot;00150A00FC000000FC1B150F00FFFFFF&quot;
+	$&quot;00150A9494FC00FC001B150F00FFFFFF&quot;
+	$&quot;00150A1C1C9494FCFC1B150F00FFFFFF&quot;
+	$&quot;11000015151C1B6D6D1C150F00FFFFFF&quot;
+	$&quot;FFFF11000015151C1B1C150F001111FF&quot;
+	$&quot;FFFFFFFF11000015151C150F00111111&quot;
+	$&quot;FFFFFFFFFFFF11000015150F001111FF&quot;
+	$&quot;FFFFFFFFFFFFFFFF110000001111FFFF&quot;
+};
+
+resource app_signature &quot;application/x-vnd.Be-MAND&quot;;
+
+resource app_flags B_MULTIPLE_LAUNCH;
+

Added: haiku/trunk/src/apps/mandelbrot/main.cpp
===================================================================
--- haiku/trunk/src/apps/mandelbrot/main.cpp	2007-04-24 22:35:06 UTC (rev 20805)
+++ haiku/trunk/src/apps/mandelbrot/main.cpp	2007-04-24 23:00:11 UTC (rev 20806)
@@ -0,0 +1,237 @@
+//******************************************************************************
+//
+//	File:		main.cpp
+//
+//******************************************************************************
+
+/*
+	Copyright 1993-1999, Be Incorporated.   All Rights Reserved.
+	This file may be used under the terms of the Be Sample Code License.
+*/
+
+#include &lt;Debug.h&gt;
+
+#ifndef _OS_H
+#include &lt;OS.h&gt;
+#endif
+#ifndef _APPLICATION_H
+#include &lt;Application.h&gt;
+#endif
+#ifndef _ROSTER_H
+#include &lt;Roster.h&gt;
+#endif
+#ifndef	_BITMAP_H
+#include &lt;Bitmap.h&gt;
+#endif
+#ifndef _MENU_ITEM_H
+#include &lt;MenuItem.h&gt;
+#endif
+#ifndef _MENU_H
+#include &lt;Menu.h&gt;
+#endif
+#ifndef _MENU_BAR_H
+#include &lt;MenuBar.h&gt;
+#endif
+#ifndef	_SCROLL_VIEW_H
+#include &lt;ScrollView.h&gt;
+#endif
+#ifndef	_ALERT_H
+#include &lt;Alert.h&gt;
+#endif
+
+#include &lt;stdio.h&gt;
+
+
+#include &quot;tsb.h&quot;
+
+#include &lt;math.h&gt;
+
+/*------------------------------------------------------------*/
+/* Those are the menu item id's of the main window	      */
+
+#define	P1		0x60
+#define	P2		0x61
+#define	P3		0x62
+#define	P4		0x63
+
+/*------------------------------------------------------------*/
+
+class	TMainWindow : public BWindow {
+public:
+					TMainWindow(BRect bound, char *name, window_type type,
+				    			long flags);
+virtual		void	MessageReceived(BMessage *an_event);
+virtual		void	FrameResized(float, float);
+virtual		bool	QuitRequested();
+
+virtual		void	UpdateScrollBars();
+
+private:
+		TShowBit	*the_view;
+};
+
+/*------------------------------------------------------------*/
+
+TMainWindow::TMainWindow(BRect bound, char *name, window_type type, long flags)
+	: BWindow(bound, name, type, flags)
+{
+	BMenu		*a_menu;
+	BRect		a_rect;
+	BScrollView	*scroll_view;
+	BMenuBar	*menubar;
+	TShowBit	*my_view;
+	BMenuItem	*item;
+
+	Lock();
+
+	a_rect.Set( 0, 0, 1000, 15);
+	menubar = new BMenuBar(a_rect, &quot;MB&quot;);
+	
+	a_menu = new BMenu(&quot;File&quot;);
+	a_menu-&gt;AddItem(new BMenuItem(&quot;Quit&quot;, new BMessage(B_QUIT_REQUESTED), 'Q'));
+	menubar-&gt;AddItem(a_menu);
+
+	a_menu = new BMenu(&quot;Palette&quot;);
+	a_menu-&gt;AddItem(new BMenuItem(&quot;Palette1&quot;, new BMessage(P1)));
+	a_menu-&gt;AddItem(new BMenuItem(&quot;Palette2&quot;, new BMessage(P2)));
+	a_menu-&gt;AddItem(item = new BMenuItem(&quot;Palette3&quot;, new BMessage(P3)));
+	a_menu-&gt;AddItem(new BMenuItem(&quot;Palette4&quot;, new BMessage(P4)));
+	menubar-&gt;AddItem(a_menu);
+
+	item-&gt;SetMarked(TRUE);
+	a_menu-&gt;SetRadioMode(TRUE);
+	
+	a_menu = new BMenu(&quot;Iterations&quot;);
+	a_menu-&gt;AddItem(new BMenuItem(&quot;128&quot;, new BMessage(128)));
+	a_menu-&gt;AddItem(item = new BMenuItem(&quot;256&quot;, new BMessage(256)));
+	a_menu-&gt;AddItem(new BMenuItem(&quot;384&quot;, new BMessage(384)));
+	a_menu-&gt;AddItem(new BMenuItem(&quot;512&quot;, new BMessage(512)));
+	a_menu-&gt;AddItem(new BMenuItem(&quot;768&quot;, new BMessage(768)));
+	a_menu-&gt;AddItem(new BMenuItem(&quot;1024&quot;, new BMessage(1024)));
+	menubar-&gt;AddItem(a_menu);
+
+	item-&gt;SetMarked(TRUE);
+	a_menu-&gt;SetRadioMode(TRUE);
+
+	AddChild(menubar);
+	float mb_height = menubar-&gt;Bounds().Height();
+
+	a_rect.Set(0, mb_height + 1, 188 - B_V_SCROLL_BAR_WIDTH,
+									 188 - B_H_SCROLL_BAR_HEIGHT);
+	the_view = my_view = new TShowBit(a_rect, B_FOLLOW_ALL | B_WILL_DRAW);
+	scroll_view = new BScrollView(&quot;scroll view&quot;, my_view, B_FOLLOW_ALL, B_WILL_DRAW,
+		TRUE, TRUE, B_NO_BORDER);
+//	my_view-&gt;ResizeBy(-1, -1);
+	AddChild(scroll_view);
+	SetSizeLimits(80, size_x + 13, 80 + 20, size_y + mb_height + 1 + 13);
+	ResizeTo(size_x + 13, size_y + mb_height + 1 + 13);
+	SetPulseRate(150000);
+	UpdateScrollBars();
+	Show();
+	Unlock();
+}
+
+/*------------------------------------------------------------*/
+
+void TMainWindow::UpdateScrollBars()
+{
+	BScrollView*	scrollview;
+	BScrollBar*		scrollbar;
+	BRect			visible_extent;
+	BRect			total_extent;
+	BRect			bound;
+	BRect			my_bounds;
+	long			max;
+
+	Lock();
+	if ((scrollview = (BScrollView*)FindView(&quot;scroll view&quot;))) {
+		bound.Set(0, 0, size_x, size_y);
+		my_bounds = Bounds();
+
+		visible_extent = bound &amp; my_bounds;
+		total_extent = bound | my_bounds;
+
+		scrollbar = scrollview-&gt;ScrollBar(B_HORIZONTAL);
+		max = (long) (bound.Width() - my_bounds.Width());
+		if (max &lt; 0)
+			max = 0;
+		scrollbar-&gt;SetRange(0, max);
+		scrollbar-&gt;SetProportion(visible_extent.Width() / total_extent.Width());
+
+		scrollbar = scrollview-&gt;ScrollBar(B_VERTICAL);
+		max = (long) (bound.Height() - my_bounds.Height());
+		if (max &lt; 0)
+			max = 0;
+		scrollbar-&gt;SetRange(0, max);
+		scrollbar-&gt;SetProportion(visible_extent.Height() / total_extent.Height());
+	}
+	Unlock();
+}
+
+//------------------------------------------------------------
+void TMainWindow::FrameResized(float, float)
+{
+	UpdateScrollBars();
+}
+
+/*------------------------------------------------------------*/
+
+bool	TMainWindow::QuitRequested()
+{
+	if (the_view-&gt;busy) {
+		the_view-&gt;exit_now = TRUE;
+		PostMessage(B_QUIT_REQUESTED);
+		return FALSE;
+	}
+	
+	be_app-&gt;PostMessage(B_QUIT_REQUESTED);
+	return(TRUE);
+}
+
+/*------------------------------------------------------------*/
+
+void	TMainWindow::MessageReceived(BMessage *an_event)
+{
+
+	switch(an_event-&gt;what) {
+		case	P1 :
+		case	P2 :
+		case	P3 :
+		case	P4 :
+			the_view-&gt;set_palette(an_event-&gt;what - P1);
+			break;
+
+		case	128  :
+		case	256  :
+		case	384  :
+		case	512  :
+		case	768  :
+		case	1024 :
+			the_view-&gt;set_iter(an_event-&gt;what);
+			break;
+		
+		default:
+			inherited::MessageReceived(an_event);
+			break;
+	}
+}
+
+/*------------------------------------------------------------*/
+
+int main(int, char**)
+{
+	BApplication	*my_app;
+	TMainWindow	*a_window;
+	BRect		a_rect;
+
+	set_thread_priority(find_thread(NULL), B_DISPLAY_PRIORITY);
+	
+	my_app = new BApplication(&quot;application/x-vnd.Be-MAND&quot;);
+
+	a_rect.Set(100, 100, 288, 288);
+	a_window = new TMainWindow(a_rect, &quot;Mandelbrot&quot;, B_DOCUMENT_WINDOW,
+		B_WILL_ACCEPT_FIRST_CLICK);
+	my_app-&gt;Run();
+
+	delete my_app;
+}

Added: haiku/trunk/src/apps/mandelbrot/tsb.cpp
===================================================================
--- haiku/trunk/src/apps/mandelbrot/tsb.cpp	2007-04-24 22:35:06 UTC (rev 20805)
+++ haiku/trunk/src/apps/mandelbrot/tsb.cpp	2007-04-24 23:00:11 UTC (rev 20806)
@@ -0,0 +1,584 @@
+//******************************************************************************
+//
+//	File:		tsb.cpp
+//
+//******************************************************************************
+
+/*
+	Copyright 1993-1999, Be Incorporated.   All Rights Reserved.
+	This file may be used under the terms of the Be Sample Code License.
+*/
+
+#include &lt;Debug.h&gt;
+#include &lt;Window.h&gt;
+
+#include &lt;string.h&gt;
+#include &lt;math.h&gt;
+#include &lt;OS.h&gt;
+#include &lt;Screen.h&gt;
+
+#include &quot;tsb.h&quot;
+
+#ifndef _INTERFACE_DEFS_H
+#include &lt;InterfaceDefs.h&gt;
+#endif
+
+/*------------------------------------------------------------*/
+
+TShowBit	*tsbb;
+
+/*------------------------------------------------------------*/
+long	niter = 256; 
+/*------------------------------------------------------------*/
+
+uchar	palette[256];
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::MouseDown(BPoint where)
+{
+	if (!this-&gt;Window()-&gt;IsActive()) {
+		this-&gt;Window()-&gt;Activate(TRUE);
+		this-&gt;Window()-&gt;UpdateIfNeeded();
+	}
+
+	if (busy)
+		return;
+
+	if ((modifiers() &amp; B_SHIFT_KEY) == 0) {
+		change_selection(where.x, where.y);
+		if ((selection.bottom - selection.top) &lt; 4)
+			return;
+	}
+	redraw_mand();
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::redraw_mand()
+{
+	double	px0;
+	double	py0;
+	double	scale0;
+
+	if (modifiers() &amp; B_SHIFT_KEY) {
+		px -= (scale / 2.0);
+		py -= (scale / 2.0);
+		scale *= 2.0;
+	}
+	else {
+		px0 = px + (scale * (selection.left / (1.0*size_x)));
+		py0 = py + (scale * (selection.top / (1.0*size_x)));
+		scale0 = scale * ((selection.bottom-selection.top) / (1.0*size_x));
+
+		px = px0; py = py0; scale = scale0;	
+	}
+	selection.Set(-1000, -1000, -1000, -1000);
+	mand(px, py, scale, scale);
+
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::set_iter(long it)
+{
+	if (it != iter) {
+		iter = it;
+		niter = it;
+		selection.Set(-1000, -1000, -1000, -1000);
+		mand(px, py, scale, scale);
+	}
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::set_palette(long code)
+{
+	rgb_color	c;
+	long		i;
+	
+	BScreen screen( Window() );
+
+	if (code == 0) {
+		for (i = 0; i &lt; 256; i++)
+			palette[i] = (i &gt;&gt; 1) &amp; 0x1f;
+	}
+	if (code == 1) {
+		for (i = 0; i &lt; 256; i++) {
+			c.red = i * 4;
+			c.green = i * 7;
+			c.blue = 256-(i - i * 5);
+			palette[i] = screen.IndexForColor(c);
+		}
+	}
+
+	if (code == 2) {
+		for (i = 0; i &lt; 256; i++) {
+			c.red = (i * 7);
+			c.green = i/2;
+			c.blue = 256-(i * 3);
+			palette[i] = screen.IndexForColor(c);
+		}
+	}
+
+	if (code == 3) {
+		for (i = 0; i &lt; 256; i++) {
+			c.red = 256-(i * 6);
+			c.green = (i * 7);
+			c.blue = 0;
+			palette[i] = screen.IndexForColor(c);
+		}
+	}
+	mand(px, py, scale, scale);
+}
+
+/*------------------------------------------------------------*/
+
+TShowBit::TShowBit(BRect r, long flags) :
+	BView(r, &quot;&quot;, flags, B_WILL_DRAW | B_PULSE_NEEDED)
+{
+	BRect	bitmap_r;
+	char	*bits;
+
+	busy = FALSE;
+	exit_now = FALSE;
+	tsbb = this;
+	bitmap_r.Set(0, 0, size_x - 1, size_y - 1);
+	selection.Set(-1000, -1000, -1000, -1000);
+	iter = 256;
+
+	the_bitmap = new BBitmap(bitmap_r, B_COLOR_8_BIT);
+	bits = (char *)the_bitmap-&gt;Bits();
+	memset(bits, 0x00, size_x*size_y);
+	px = -1.5;
+	py = -1.5;
+	scale = 3.0;
+	set_palette(2);
+}
+
+/*------------------------------------------------------------*/
+
+TShowBit::~TShowBit()
+{
+	delete	the_bitmap;
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::Draw(BRect update_rect)
+{
+	DrawBitmap(the_bitmap, BPoint(0, 0));
+}
+
+
+/*------------------------------------------------------------*/
+
+
+int iterate1(double a, double b)
+{
+	double	x;
+	double	y;
+	double	xsq;
+	double	ysq;
+	double	ctwo = 2.0, cfour = 4.0;
+	int		i = 0, iter = niter;
+
+	x = 0.0;
+	y = 0.0;
+
+	while (i &lt; iter) {
+		xsq = x * x;
+		ysq = y * y;
+		y = (ctwo * x * y) + b;
+		i++;
+		x = a + (xsq - ysq);
+	
+		if ((xsq + ysq) &gt; cfour)
+			return(i);
+	}
+	return(i);
+}
+
+/*------------------------------------------------------------*/
+//extern &quot;C&quot; int iterate(float a, float b);
+/*------------------------------------------------------------*/
+
+int iterate(float a, float b)
+{
+	float	x;
+	float	y;
+	float	xsq;
+	float	ysq;
+// These are variables, because the metaware compiler would reload the
+// constants from memory each time through the loop rather than leave them
+// in registers.  Lovely.
+	float	ctwo = 2.0, cfour = 4.0;
+	long	i;
+	int		iter = niter;
+
+	x = 0.0;
+	y = 0.0;
+	i = 0;
+
+	while (i &lt; iter) {
+		xsq = x * x;
+		ysq = y * y;
+		y = (ctwo * x * y) + b;
+		i++;
+		x = a + (xsq - ysq);
+	
+		if ((xsq + ysq) &gt; cfour)
+			return(i);
+	}
+	return(i);
+}
+
+/*------------------------------------------------------------*/
+
+double	vvx;
+double	vvy;
+double	ssx;
+char	t1_done;
+char	t2_done;
+
+/*------------------------------------------------------------*/
+
+long	__calc1(void *arg)
+{
+	tsbb-&gt;manda(vvx, vvy, ssx, ssx);
+	return B_NO_ERROR;
+}
+
+/*------------------------------------------------------------*/
+
+long	__calc2(void *arg)
+{
+	tsbb-&gt;mandb(vvx, vvy, ssx, ssx);
+	return B_NO_ERROR;
+}
+
+/*------------------------------------------------------------*/
+
+uchar	tmp[256];
+uchar	pc[32][32];
+uchar	tmp1[256];
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::mand(double vx, double vy, double sx, double sy)
+{
+	vvx = vx; vvy = vy; ssx = sx;
+	t1_done = 0; t2_done = 0;
+
+	precompute(vx, vy, sx, sy);
+	
+	resume_thread(spawn_thread(__calc1, &quot;calc1&quot;, B_NORMAL_PRIORITY, NULL));
+	resume_thread(spawn_thread(__calc2, &quot;calc2&quot;, B_NORMAL_PRIORITY, NULL));
+	busy = TRUE;
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::Pulse()
+{
+//	PRINT((&quot;pulsing (%d)\n&quot;, busy));
+	if (busy) {
+		Draw(BRect(0,0,0,0));
+		if (t1_done &amp;&amp; t2_done) {
+			busy = FALSE;
+			exit_now = FALSE;
+		}
+	}
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::precompute(double vx, double vy, double sx, double sy)
+{
+	long	x, y;
+	double	cx, cy;
+	double	scale = sx;	
+
+	sx = sx / (32.0);
+	sy = sy / (32.0);
+	cy = vy;
+
+	for (y = 0; y &lt; 32; y++) {
+		cy += sy;
+		cx = vx;
+		if (scale &lt; 0.000025 || niter != 256) {
+			for (x = 0; x &lt; 32; x++) {
+				cx += sx;
+				pc[x][y] = iterate1(cx, cy);
+			}
+		}
+		else
+		for (x = 0; x &lt; 32; x++) {
+			cx += sx;
+			pc[x][y] = iterate(cx, cy);
+		}
+	}
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::mandb(double vx, double vy, double sx, double sy)
+{
+	long	x, y;
+	long	bx;
+	double	cx, cy;
+	char	v;
+	uchar	*bits = (uchar *)the_bitmap-&gt;Bits();
+	uchar	*b0;
+	long	y12;
+	long	x12;
+	double	scale = sx;	
+	
+	sx = sx / (size_x * 1.0);
+	sy = sy / (size_y * 1.0);
+	cy = vy;
+
+	cy += sy;
+	sy *= 2.0;
+	for (y = 1; y &lt; size_y; y+=2) {
+		y12 = y / 12;
+		cy += sy;
+		cx = vx;
+		b0 = bits + (y * size_x);
+		for (bx = 0; bx &lt; size_x; bx += 12) {
+			x12 = (bx+6) / 12;
+			v = pc[x12][y12];
+			
+			if (exit_now)
+				goto done;
+
+			if (v == pc[x12+1][y12] &amp;&amp;
+			    v == pc[x12][y12+1] &amp;&amp;
+				v == pc[x12-1][y12] &amp;&amp;
+				v == pc[x12][y12-1] &amp;&amp;
+				v == pc[x12-2][y12]) {
+				for (x = bx; x &lt; (bx+12); x++) {
+					cx += sx;
+					*b0++ = palette[v];
+				}
+			}
+			else {
+				if (scale &lt; 0.000025 || niter != 256) {
+					for (x = bx; x &lt; (bx+12); x++) {
+						cx += sx;
+						v = iterate1(cx, cy);
+						*b0++ = palette[v];
+					}
+				}
+				else
+				for (x = bx; x &lt; (bx+12); x++) {
+					cx += sx;
+					v = iterate(cx, cy);
+					*b0++ = palette[v];
+				}
+			}
+		}
+	}
+done:
+	t2_done = 1;
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::manda(double vx, double vy, double sx, double sy)
+{
+	long	x, y;
+	long	bx;
+	double	cx, cy;
+	char	v;
+	uchar	*bits = (uchar *)the_bitmap-&gt;Bits();
+	uchar	*b0;
+	long	y12;
+	long	x12;
+	double	scale = sx;	
+	
+	sx = sx / (size_x * 1.0);
+	sy = sy / (size_y * 1.0);
+	cy = vy;
+
+	sy *= 2.0;
+	for (y = 0; y &lt; size_y; y+=2) {
+		y12 = y / 12;
+		cy += sy;
+		cx = vx;
+		b0 = bits + (y * size_x);
+		for (bx = 0; bx &lt; size_x; bx += 12) {
+			x12 = (bx+6) / 12;
+			v = pc[x12][y12];
+
+			if (exit_now)
+				goto done;
+			
+			if (v == pc[x12+1][y12] &amp;&amp;
+			    v == pc[x12][y12+1] &amp;&amp;
+				v == pc[x12-1][y12] &amp;&amp;
+				v == pc[x12][y12-1] &amp;&amp;
+				v == pc[x12-2][y12]) {
+				for (x = bx; x &lt; (bx+12); x++) {
+					cx += sx;
+					*b0++ = palette[v];
+				}
+			}
+			else {
+				if (scale &lt; 0.000025 || niter != 256) {
+					for (x = bx; x &lt; (bx+12); x++) {
+						cx += sx;
+						v = iterate1(cx, cy);
+						*b0++ = palette[v];
+					}
+				}
+				else
+				for (x = bx; x &lt; (bx+12); x++) {
+					cx += sx;
+					v = iterate(cx, cy);
+					*b0++ = palette[v];
+				}
+			}
+		}
+	}
+done:
+	t1_done = 1;
+}
+
+
+/*------------------------------------------------------------*/
+
+long	TShowBit::limit_v(long v)
+{
+	if (v &gt; (size_y - 1))
+			v = (size_y - 1);
+
+	if (v &lt; 0)
+			v = 0;
+	return(v);
+}
+
+/*------------------------------------------------------------*/
+
+long	TShowBit::limit_h(long v)
+{
+	if (v &gt; (size_x - 1))
+			v = size_x - 1;
+
+	if (v &lt; 0)
+			v = 0;
+	return(v);
+}
+
+/*------------------------------------------------------------*/
+
+BRect	TShowBit::sort_rect(BRect *aRect)
+{
+	BRect	tmp_rect;
+	long	tmp;
+
+	tmp_rect = *aRect;
+	if (tmp_rect.bottom &lt; tmp_rect.top) {
+		tmp = (long)tmp_rect.top;
+		tmp_rect.top = tmp_rect.bottom;
+		tmp_rect.bottom = tmp;
+	}
+
+	if (tmp_rect.left &gt; tmp_rect.right) {
+		tmp = (long) tmp_rect.right;
+		tmp_rect.right = tmp_rect.left;
+		tmp_rect.left = tmp;
+	}
+
+	tmp_rect.top = limit_v(tmp_rect.top);
+	tmp_rect.left = limit_h(tmp_rect.left);
+	tmp_rect.bottom = limit_v(tmp_rect.bottom);
+	tmp_rect.right = limit_h(tmp_rect.right);
+
+	return(tmp_rect);
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::clip(long *h, long *v)
+{
+	if (*h &gt; (size_x - 1))
+			*h = (size_x - 1);
+	if (*h &lt; 0)
+			*h = 0;
+	if (*v &gt; (size_y - 1))
+			*v = size_y - 1;
+	if (*v &lt; 0)
+			*v = 0;
+}
+
+/*------------------------------------------------------------*/
+
+char	TShowBit::has_selection()
+{
+	if (((selection.bottom - selection.top) + (selection.right - selection.left)) &lt; 5) 
+		return 0;
+	else
+		return 1;
+}
+
+/*------------------------------------------------------------*/
+
+void	TShowBit::change_selection(long h, long v)
+{
+	ulong	buttons;
+	long	h0;
+	long	v0;
+	BRect	new_select;
+	BRect	old_select;
+	BRect	tmp_rect;
+	long	max;
+	long	width, height;
+	
+	clip(&amp;h, &amp;v);
+	new_select.top = v;
+	new_select.left = h;
+	old_select = selection;
+
+	SetDrawingMode(B_OP_INVERT);
+
+	do {
+		BPoint where;
+		GetMouse(&amp;where, &amp;buttons);
+		h0 = (long) where.x;
+		v0 = (long) where.y;
+		width = h0 - h;
+		height = v0 - v;
+		max= ((v0&gt;v) ^ (height &lt; width)) ? height : width;
+
+		h0 = h+max; v0 = v+max;
+
+		clip(&amp;h0, &amp;v0);
+		new_select.right = h0;
+		new_select.bottom = v0;
+
+		if ((old_select.top != new_select.top) || 
+		    (old_select.bottom != new_select.bottom) ||
+		    (old_select.right != new_select.right) ||
+		    (old_select.left != new_select.left)) {
+		
+			tmp_rect = sort_rect(&amp;new_select);
+			StrokeRect(tmp_rect);
+
+			tmp_rect = sort_rect(&amp;old_select);
+			StrokeRect(tmp_rect);
+
+			old_select = new_select;
+			Flush();
+		}
+
+		snooze(20000);
+	} while(buttons);
+
+	selection = sort_rect(&amp;new_select);
+	if (!has_selection()) {
+		StrokeRect(selection);
+		selection.Set(-1000, -1000, -1000, -1000);
+	} 
+	SetDrawingMode(B_OP_COPY);
+}

Added: haiku/trunk/src/apps/mandelbrot/tsb.h
===================================================================
--- haiku/trunk/src/apps/mandelbrot/tsb.h	2007-04-24 22:35:06 UTC (rev 20805)
+++ haiku/trunk/src/apps/mandelbrot/tsb.h	2007-04-24 23:00:11 UTC (rev 20806)
@@ -0,0 +1,58 @@
+/*
+	Copyright 1999, Be Incorporated.   All Rights Reserved.
+	This file may be used under the terms of the Be Sample Code License.
+*/
+
+#ifndef	_VIEW_H
+#include &lt;View.h&gt;
+#endif
+#ifndef	_BITMAP_H
+#include &lt;Bitmap.h&gt;
+#endif
+
+#include &lt;math.h&gt;
+
+#ifndef	TSB
+#define	TSB
+
+/*------------------------------------------------------------*/
+
+#define	size_x	384
+#define	size_y	384
+
+/*------------------------------------------------------------*/
+
+class	TShowBit : public BView {
+public:
+		BBitmap		*the_bitmap;
+		bool		busy;
+		bool		exit_now;

[... truncated: 478 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001788.html">[Haiku-commits] r20805 - haiku/trunk/src/apps/tv
</A></li>
	<LI>Next message: <A HREF="001791.html">[Haiku-commits] r20807 -	haiku/trunk/src/tests/kits/opengl/direct_mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1789">[ date ]</a>
              <a href="thread.html#1789">[ thread ]</a>
              <a href="subject.html#1789">[ subject ]</a>
              <a href="author.html#1789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
