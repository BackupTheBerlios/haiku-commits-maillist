<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r20817 - in haiku/trunk:	headers/libs/freetype2/freetype	headers/libs/freetype2/freetype/config	headers/libs/freetype2/freetype/internal	headers/libs/freetype2/freetype/internal/services	src/libs/freetype2/autofit src/libs/freetype2/base	src/libs/freetype2/bdf src/libs/freetype2/cff	src/libs/freetype2/gzip src/libs/freetype2/pcf	src/libs/freetype2/pfr src/libs/freetype2/psaux	src/libs/freetype2/pshinter src/libs/freetype2/psnames	src/libs/freetype2/raster src/libs/freetype2/sfnt	src/libs/freetype2/smooth src/libs/freetype2/truetype	src/libs/freetype2/type1 src/libs/freetype2/type42
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20817%20-%20in%20haiku/trunk%3A%0A%09headers/libs/freetype2/freetype%0A%09headers/libs/freetype2/freetype/config%0A%09headers/libs/freetype2/freetype/internal%0A%09headers/libs/freetype2/freetype/internal/services%0A%09src/libs/freetype2/autofit%20src/libs/freetype2/base%0A%09src/libs/freetype2/bdf%20src/libs/freetype2/cff%0A%09src/libs/freetype2/gzip%20src/libs/freetype2/pcf%0A%09src/libs/freetype2/pfr%20src/libs/freetype2/psaux%0A%09src/libs/freetype2/pshinter%20src/libs/freetype2/psnames%0A%09src/libs/freetype2/raster%20src/libs/freetype2/sfnt%0A%09src/libs/freetype2/smooth%20src/libs/freetype2/truetype%0A%09src/libs/freetype2/type1%20src/libs/freetype2/type42&In-Reply-To=%3C200704251718.l3PHIJJu009491%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001917.html">
   <LINK REL="Next"  HREF="001802.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r20817 - in haiku/trunk:	headers/libs/freetype2/freetype	headers/libs/freetype2/freetype/config	headers/libs/freetype2/freetype/internal	headers/libs/freetype2/freetype/internal/services	src/libs/freetype2/autofit src/libs/freetype2/base	src/libs/freetype2/bdf src/libs/freetype2/cff	src/libs/freetype2/gzip src/libs/freetype2/pcf	src/libs/freetype2/pfr src/libs/freetype2/psaux	src/libs/freetype2/pshinter src/libs/freetype2/psnames	src/libs/freetype2/raster src/libs/freetype2/sfnt	src/libs/freetype2/smooth src/libs/freetype2/truetype	src/libs/freetype2/type1 src/libs/freetype2/type42</H1>
    <B>korli at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r20817%20-%20in%20haiku/trunk%3A%0A%09headers/libs/freetype2/freetype%0A%09headers/libs/freetype2/freetype/config%0A%09headers/libs/freetype2/freetype/internal%0A%09headers/libs/freetype2/freetype/internal/services%0A%09src/libs/freetype2/autofit%20src/libs/freetype2/base%0A%09src/libs/freetype2/bdf%20src/libs/freetype2/cff%0A%09src/libs/freetype2/gzip%20src/libs/freetype2/pcf%0A%09src/libs/freetype2/pfr%20src/libs/freetype2/psaux%0A%09src/libs/freetype2/pshinter%20src/libs/freetype2/psnames%0A%09src/libs/freetype2/raster%20src/libs/freetype2/sfnt%0A%09src/libs/freetype2/smooth%20src/libs/freetype2/truetype%0A%09src/libs/freetype2/type1%20src/libs/freetype2/type42&In-Reply-To=%3C200704251718.l3PHIJJu009491%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r20817 - in haiku/trunk:	headers/libs/freetype2/freetype	headers/libs/freetype2/freetype/config	headers/libs/freetype2/freetype/internal	headers/libs/freetype2/freetype/internal/services	src/libs/freetype2/autofit src/libs/freetype2/base	src/libs/freetype2/bdf src/libs/freetype2/cff	src/libs/freetype2/gzip src/libs/freetype2/pcf	src/libs/freetype2/pfr src/libs/freetype2/psaux	src/libs/freetype2/pshinter src/libs/freetype2/psnames	src/libs/freetype2/raster src/libs/freetype2/sfnt	src/libs/freetype2/smooth src/libs/freetype2/truetype	src/libs/freetype2/type1 src/libs/freetype2/type42">korli at mail.berlios.de
       </A><BR>
    <I>Wed Apr 25 19:18:19 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001917.html">[Haiku-commits] r20816 - haiku/trunk/src/apps/terminal
</A></li>
        <LI>Next message: <A HREF="001802.html">[Haiku-commits] r20818 - in haiku/trunk: headers/private/net	src/add-ons/kernel/network/protocols/tcp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1801">[ date ]</a>
              <a href="thread.html#1801">[ thread ]</a>
              <a href="subject.html#1801">[ subject ]</a>
              <a href="author.html#1801">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: korli
Date: 2007-04-25 19:18:01 +0200 (Wed, 25 Apr 2007)
New Revision: 20817
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=20817&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=20817&amp;view=rev</A>

Modified:
   haiku/trunk/headers/libs/freetype2/freetype/config/ftconfig.h
   haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h
   haiku/trunk/headers/libs/freetype2/freetype/freetype.h
   haiku/trunk/headers/libs/freetype2/freetype/fterrors.h
   haiku/trunk/headers/libs/freetype2/freetype/ftimage.h
   haiku/trunk/headers/libs/freetype2/freetype/ftincrem.h
   haiku/trunk/headers/libs/freetype2/freetype/ftlist.h
   haiku/trunk/headers/libs/freetype2/freetype/ftmac.h
   haiku/trunk/headers/libs/freetype2/freetype/ftoutln.h
   haiku/trunk/headers/libs/freetype2/freetype/fttrigon.h
   haiku/trunk/headers/libs/freetype2/freetype/ftxf86.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/autohint.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/ftdebug.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/ftmemory.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/pshints.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/services/svpostnm.h
   haiku/trunk/headers/libs/freetype2/freetype/internal/tttypes.h
   haiku/trunk/headers/libs/freetype2/freetype/ttnameid.h
   haiku/trunk/src/libs/freetype2/autofit/afglobal.c
   haiku/trunk/src/libs/freetype2/autofit/afhints.c
   haiku/trunk/src/libs/freetype2/autofit/afhints.h
   haiku/trunk/src/libs/freetype2/autofit/aflatin.c
   haiku/trunk/src/libs/freetype2/autofit/aflatin.h
   haiku/trunk/src/libs/freetype2/autofit/afloader.c
   haiku/trunk/src/libs/freetype2/autofit/aftypes.h
   haiku/trunk/src/libs/freetype2/autofit/afwarp.c
   haiku/trunk/src/libs/freetype2/autofit/afwarp.h
   haiku/trunk/src/libs/freetype2/base/ftbase.c
   haiku/trunk/src/libs/freetype2/base/ftbbox.c
   haiku/trunk/src/libs/freetype2/base/ftbitmap.c
   haiku/trunk/src/libs/freetype2/base/ftinit.c
   haiku/trunk/src/libs/freetype2/base/ftmac.c
   haiku/trunk/src/libs/freetype2/base/ftobjs.c
   haiku/trunk/src/libs/freetype2/base/ftutil.c
   haiku/trunk/src/libs/freetype2/bdf/bdfdrivr.c
   haiku/trunk/src/libs/freetype2/bdf/bdflib.c
   haiku/trunk/src/libs/freetype2/cff/cffdrivr.c
   haiku/trunk/src/libs/freetype2/cff/cffgload.c
   haiku/trunk/src/libs/freetype2/cff/cffload.c
   haiku/trunk/src/libs/freetype2/cff/cffobjs.c
   haiku/trunk/src/libs/freetype2/cff/cffparse.c
   haiku/trunk/src/libs/freetype2/gzip/inftrees.c
   haiku/trunk/src/libs/freetype2/pcf/README
   haiku/trunk/src/libs/freetype2/pcf/pcfread.c
   haiku/trunk/src/libs/freetype2/pfr/pfrload.c
   haiku/trunk/src/libs/freetype2/psaux/psobjs.c
   haiku/trunk/src/libs/freetype2/pshinter/pshalgo.c
   haiku/trunk/src/libs/freetype2/pshinter/pshrec.c
   haiku/trunk/src/libs/freetype2/psnames/psmodule.c
   haiku/trunk/src/libs/freetype2/raster/ftraster.c
   haiku/trunk/src/libs/freetype2/sfnt/sfdriver.c
   haiku/trunk/src/libs/freetype2/sfnt/sfobjs.c
   haiku/trunk/src/libs/freetype2/sfnt/ttcmap.c
   haiku/trunk/src/libs/freetype2/sfnt/ttkern.c
   haiku/trunk/src/libs/freetype2/sfnt/ttload.c
   haiku/trunk/src/libs/freetype2/sfnt/ttmtx.c
   haiku/trunk/src/libs/freetype2/sfnt/ttpost.c
   haiku/trunk/src/libs/freetype2/smooth/ftgrays.c
   haiku/trunk/src/libs/freetype2/truetype/ttgload.c
   haiku/trunk/src/libs/freetype2/truetype/ttgxvar.c
   haiku/trunk/src/libs/freetype2/truetype/ttinterp.c
   haiku/trunk/src/libs/freetype2/truetype/ttinterp.h
   haiku/trunk/src/libs/freetype2/truetype/ttobjs.c
   haiku/trunk/src/libs/freetype2/type1/t1afm.c
   haiku/trunk/src/libs/freetype2/type1/t1driver.c
   haiku/trunk/src/libs/freetype2/type1/t1load.c
   haiku/trunk/src/libs/freetype2/type1/t1load.h
   haiku/trunk/src/libs/freetype2/type42/t42drivr.c
Log:
updated freetype to 2.3.4


Modified: haiku/trunk/headers/libs/freetype2/freetype/config/ftconfig.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/config/ftconfig.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/config/ftconfig.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    ANSI-specific configuration file (specification only).               */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2003, 2004, 2006 by                         */
+/*  Copyright 1996-2001, 2002, 2003, 2004, 2006, 2007 by                   */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -126,8 +126,15 @@
   /*                                                                       */
 #if ( defined( __APPLE__ ) &amp;&amp; !defined( DARWIN_NO_CARBON ) ) || \
     ( defined( __MWERKS__ ) &amp;&amp; defined( macintosh )        )
+  /* no Carbon frameworks for 64bit 10.4.x */
+#include &quot;AvailabilityMacros.h&quot;
+#if defined( __LP64__ ) &amp;&amp; \
+    ( MAC_OS_X_VERSION_MIN_REQUIRED &lt;= MAC_OS_X_VERSION_10_4 )
+#define DARWIN_NO_CARBON 1
+#else
 #define FT_MACINTOSH 1
 #endif
+#endif
 
 
   /*************************************************************************/

Modified: haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/config/ftstdlib.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -5,7 +5,7 @@
 /*    ANSI-specific library and header configuration file (specification   */
 /*    only).                                                               */
 /*                                                                         */
-/*  Copyright 2002, 2003, 2004, 2005, 2006 by                              */
+/*  Copyright 2002, 2003, 2004, 2005, 2006, 2007 by                        */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -101,6 +101,7 @@
 #define ft_strncmp  strncmp
 #define ft_strncpy  strncpy
 #define ft_strrchr  strrchr
+#define ft_strstr   strstr
 
 
   /**********************************************************************/

Modified: haiku/trunk/headers/libs/freetype2/freetype/freetype.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/freetype.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/freetype.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -637,7 +637,7 @@
   /*     <A HREF="http://www.unicode.org/Public/MAPPINGS/VENDORS/APPLE/README.TXT">http://www.unicode.org/Public/MAPPINGS/VENDORS/APPLE/README.TXT</A>   */
   /*                                                                       */
   /*   to get an idea how to do that.  Basically, if the language ID is 0, */
-  /*   dont use it, otherwise subtract 1 from the language ID.  Then       */
+  /*   don't use it, otherwise subtract 1 from the language ID.  Then      */
   /*   examine `encoding_id'.  If, for example, `encoding_id' is           */
   /*   @TT_MAC_ID_ROMAN and the language ID (minus 1) is                   */
   /*   `TT_MAC_LANGID_GREEK', it is the Greek encoding, not Roman.         */
@@ -1585,7 +1585,7 @@
   /*    FT_Done_FreeType                                                   */
   /*                                                                       */
   /* &lt;Description&gt;                                                         */
-  /*    Destroy a given FreeType library object and all of its childs,     */
+  /*    Destroy a given FreeType library object and all of its children,   */
   /*    including resources, drivers, faces, sizes, etc.                   */
   /*                                                                       */
   /* &lt;Input&gt;                                                               */
@@ -1725,6 +1725,10 @@
   /*    If the `FT_OPEN_PARAMS' bit is set, the parameters given by        */
   /*    `num_params' and `params' is used.  They are ignored otherwise.    */
   /*                                                                       */
+  /*    Ideally, both the `pathname' and `params' fields should be tagged  */
+  /*    as `const'; this is missing for API backwards compatibility.  With */
+  /*    other words, applications should treat them as read-only.          */
+  /*                                                                       */
   typedef struct  FT_Open_Args_
   {
     FT_UInt         flags;
@@ -2311,7 +2315,7 @@
    *     This flag implies @FT_LOAD_NO_SCALE and @FT_LOAD_IGNORE_TRANSFORM.
    *
    *   FT_LOAD_IGNORE_TRANSFORM ::
-   *     Indicates that the tranform matrix set by @FT_Set_Transform should
+   *     Indicates that the transform matrix set by @FT_Set_Transform should
    *     be ignored.
    *
    *   FT_LOAD_MONOCHROME ::
@@ -2809,6 +2813,11 @@
   /*    This function returns an error if no charmap in the face           */
   /*    corresponds to the encoding queried here.                          */
   /*                                                                       */
+  /*    Because many fonts contain more than a single cmap for Unicode     */
+  /*    encoding, this function has some special code to select the one    */
+  /*    which covers Unicode best.  It is thus preferable to               */
+  /*    @FT_Set_Charmap in this case.                                      */
+  /*                                                                       */
   FT_EXPORT( FT_Error )
   FT_Select_Charmap( FT_Face      face,
                      FT_Encoding  encoding );
@@ -3314,7 +3323,7 @@
    */
 #define FREETYPE_MAJOR  2
 #define FREETYPE_MINOR  3
-#define FREETYPE_PATCH  0
+#define FREETYPE_PATCH  4
 
 
   /*************************************************************************/

Modified: haiku/trunk/headers/libs/freetype2/freetype/fterrors.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/fterrors.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/fterrors.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    FreeType error code handling (specification).                        */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2004 by                                     */
+/*  Copyright 1996-2001, 2002, 2004, 2007 by                               */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -73,7 +73,7 @@
   /*       const struct                                                    */
   /*       {                                                               */
   /*         int          err_code;                                        */
-  /*         const char*  err_msg                                          */
+  /*         const char*  err_msg;                                         */
   /*       } ft_errors[] =                                                 */
   /*                                                                       */
   /*       #include FT_ERRORS_H                                            */

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftimage.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftimage.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftimage.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -5,7 +5,7 @@
 /*    FreeType glyph image formats and default raster interface            */
 /*    (specification).                                                     */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2003, 2004, 2005, 2006 by                   */
+/*  Copyright 1996-2001, 2002, 2003, 2004, 2005, 2006, 2007 by             */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -381,8 +381,7 @@
   /*                                 the outline uses the opposite         */
   /*                                 direction (typically for Type 1       */
   /*                                 fonts).  This flag is ignored by the  */
-  /*                                 scan-converter.  However, it is very  */
-  /*                                 important for the auto-hinter.        */
+  /*                                 scan-converter.                       */
   /*                                                                       */
   /*   FT_OUTLINE_IGNORE_DROPOUTS :: By default, the scan converter will   */
   /*                                 try to detect drop-outs in an outline */
@@ -724,7 +723,7 @@
   /*    ft_glyph_format_xxx                                                */
   /*                                                                       */
   /* &lt;Description&gt;                                                         */
-  /*    A list of decprecated constants.  Use the corresponding            */
+  /*    A list of deprecated constants.  Use the corresponding             */
   /*    @FT_Glyph_Format values instead.                                   */
   /*                                                                       */
   /* &lt;Values&gt;                                                              */

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftincrem.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftincrem.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftincrem.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    FreeType incremental loading (specification).                        */
 /*                                                                         */
-/*  Copyright 2002, 2003, 2006 by                                          */
+/*  Copyright 2002, 2003, 2006, 2007 by                                    */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -149,7 +149,7 @@
   *   FreeType error code.  0 means success.
   *
   * @note:
-  *   If this function returns succesfully the method
+  *   If this function returns successfully the method
   *   @FT_Incremental_FreeGlyphDataFunc will be called later to release
   *   the data bytes.
   *

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftlist.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftlist.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftlist.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    Generic list support for FreeType (specification).                   */
 /*                                                                         */
-/*  Copyright 1996-2001, 2003 by                                           */
+/*  Copyright 1996-2001, 2003, 2007 by                                     */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -199,8 +199,7 @@
   /*                                                                       */
   /* &lt;Input&gt;                                                               */
   /*    list     :: A handle to the list.                                  */
-  /*    iterator :: An interator function, called on each node of the      */
-  /*                list.                                                  */
+  /*    iterator :: An iterator function, called on each node of the list. */
   /*    user     :: A user-supplied field which is passed as the second    */
   /*                argument to the iterator.                              */
   /*                                                                       */

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftmac.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftmac.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftmac.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    Additional Mac-specific API.                                         */
 /*                                                                         */
-/*  Copyright 1996-2001, 2004, 2006 by                                     */
+/*  Copyright 1996-2001, 2004, 2006, 2007 by                               */
 /*  Just van Rossum, David Turner, Robert Wilhelm, and Werner Lemberg.     */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -35,6 +35,17 @@
 FT_BEGIN_HEADER
 
 
+/* gcc-3.4.1 and later can warn about functions tagged as deprecated */
+#ifndef FT_DEPRECATED_ATTRIBUTE
+#if defined(__GNUC__)                                               &amp;&amp; \
+    ((__GNUC__ &gt;= 4) || ((__GNUC__ == 3) &amp;&amp; (__GNUC_MINOR__ &gt;= 1)))
+#define FT_DEPRECATED_ATTRIBUTE  __attribute__((deprecated))
+#else
+#define FT_DEPRECATED_ATTRIBUTE
+#endif
+#endif
+
+
   /*************************************************************************/
   /*                                                                       */
   /* &lt;Section&gt;                                                             */
@@ -105,9 +116,11 @@
   /*                  Bold).                                               */
   /*                                                                       */
   /* &lt;Output&gt;                                                              */
-  /*    pathSpec   :: FSSpec to the file.  For passing to @FT_New_Face.    */
+  /*    pathSpec   :: FSSpec to the file.  For passing to                  */
+  /*                  @FT_New_Face_From_FSSpec.                            */
   /*                                                                       */
-  /*    face_index :: Index of the face.  For passing to @FT_New_Face.     */
+  /*    face_index :: Index of the face.  For passing to                   */
+  /*                  @FT_New_Face_From_FSSpec.                            */
   /*                                                                       */
   /* &lt;Return&gt;                                                              */
   /*    FreeType error code.  0 means success.                             */
@@ -115,7 +128,8 @@
   FT_EXPORT( FT_Error )
   FT_GetFile_From_Mac_Name( const char*  fontName,
                             FSSpec*      pathSpec,
-                            FT_Long*     face_index );
+                            FT_Long*     face_index )
+                          FT_DEPRECATED_ATTRIBUTE;
 
 
   /*************************************************************************/
@@ -130,9 +144,11 @@
   /*    fontName   :: Mac OS name of the font in ATS framework.            */
   /*                                                                       */
   /* &lt;Output&gt;                                                              */
-  /*    pathSpec   :: FSSpec to the file.  For passing to @FT_New_Face.    */
+  /*    pathSpec   :: FSSpec to the file. For passing to                   */
+  /*                  @FT_New_Face_From_FSSpec.                            */
   /*                                                                       */
-  /*    face_index :: Index of the face.  For passing to @FT_New_Face.     */
+  /*    face_index :: Index of the face. For passing to                    */
+  /*                  @FT_New_Face_From_FSSpec.                            */
   /*                                                                       */
   /* &lt;Return&gt;                                                              */
   /*    FreeType error code.  0 means success.                             */
@@ -140,12 +156,44 @@
   FT_EXPORT( FT_Error )
   FT_GetFile_From_Mac_ATS_Name( const char*  fontName,
                                 FSSpec*      pathSpec,
-                                FT_Long*     face_index );
+                                FT_Long*     face_index )
+                              FT_DEPRECATED_ATTRIBUTE;
 
 
   /*************************************************************************/
   /*                                                                       */
   /* &lt;Function&gt;                                                            */
+  /*    FT_GetFilePath_From_Mac_ATS_Name                                   */
+  /*                                                                       */
+  /* &lt;Description&gt;                                                         */
+  /*    Return a pathname of the disk file and face index for given font   */
+  /*    name which is handled by ATS framework.                            */
+  /*                                                                       */
+  /* &lt;Input&gt;                                                               */
+  /*    fontName    :: Mac OS name of the font in ATS framework.           */
+  /*                                                                       */
+  /* &lt;Output&gt;                                                              */
+  /*    path        :: Buffer to store pathname of the file.  For passing  */
+  /*                   to @FT_New_Face.  The client must allocate this     */
+  /*                   buffer before calling this function.                */
+  /*                                                                       */
+  /*    maxPathSize :: Lengths of the buffer `path' that client allocated. */
+  /*                                                                       */
+  /*    face_index  :: Index of the face.  For passing to @FT_New_Face.    */
+  /*                                                                       */
+  /* &lt;Return&gt;                                                              */
+  /*    FreeType error code.  0 means success.                             */
+  /*                                                                       */
+  FT_EXPORT( FT_Error )
+  FT_GetFilePath_From_Mac_ATS_Name( const char*  fontName,
+                                    UInt8*       path,
+                                    UInt32       maxPathSize,
+                                    FT_Long*     face_index );
+
+
+  /*************************************************************************/
+  /*                                                                       */
+  /* &lt;Function&gt;                                                            */
   /*    FT_New_Face_From_FSSpec                                            */
   /*                                                                       */
   /* &lt;Description&gt;                                                         */
@@ -174,7 +222,8 @@
   FT_New_Face_From_FSSpec( FT_Library     library,
                            const FSSpec  *spec,
                            FT_Long        face_index,
-                           FT_Face       *aface );
+                           FT_Face       *aface )
+                         FT_DEPRECATED_ATTRIBUTE;
 
 
   /*************************************************************************/
@@ -208,7 +257,8 @@
   FT_New_Face_From_FSRef( FT_Library    library,
                           const FSRef  *ref,
                           FT_Long       face_index,
-                          FT_Face      *aface );
+                          FT_Face      *aface )
+                        FT_DEPRECATED_ATTRIBUTE;
 
   /* */
 

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftoutln.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftoutln.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftoutln.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -5,7 +5,7 @@
 /*    Support for the FT_Outline type used to store glyph shapes of        */
 /*    most scalable font formats (specification).                          */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2003, 2005, 2006 by                         */
+/*  Copyright 1996-2001, 2002, 2003, 2005, 2006, 2007 by                   */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -103,7 +103,7 @@
   /*                      decomposition.                                   */
   /*                                                                       */
   /* &lt;Return&gt;                                                              */
-  /*    FreeType error code.  0 means sucess.                              */
+  /*    FreeType error code.  0 means success.                             */
   /*                                                                       */
   FT_EXPORT( FT_Error )
   FT_Outline_Decompose( FT_Outline*              outline,
@@ -393,7 +393,7 @@
   /*    This function does NOT CREATE the bitmap, it only renders an       */
   /*    outline image within the one you pass to it!                       */
   /*                                                                       */
-  /*    It will use the raster correponding to the default glyph format.   */
+  /*    It will use the raster corresponding to the default glyph format.  */
   /*                                                                       */
   FT_EXPORT( FT_Error )
   FT_Outline_Get_Bitmap( FT_Library        library,

Modified: haiku/trunk/headers/libs/freetype2/freetype/fttrigon.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/fttrigon.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/fttrigon.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    FreeType trigonometric functions (specification).                    */
 /*                                                                         */
-/*  Copyright 2001, 2003, 2005 by                                          */
+/*  Copyright 2001, 2003, 2005, 2007 by                                    */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -210,7 +210,7 @@
    *     Second angle.
    *
    * @return:
-   *   Contrainted value of `value2-value1'.
+   *   Constrained value of `value2-value1'.
    *
    */
   FT_EXPORT( FT_Angle )

Modified: haiku/trunk/headers/libs/freetype2/freetype/ftxf86.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ftxf86.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/ftxf86.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    Support functions for X11.                                           */
 /*                                                                         */
-/*  Copyright 2002, 2003, 2004, 2006 by                                    */
+/*  Copyright 2002, 2003, 2004, 2006, 2007 by                              */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -47,7 +47,7 @@
   /*   The single function in this section can be used to get the font     */
   /*   format.  Note that this information is not needed normally;         */
   /*   however, there are special cases (like in PDF devices) where it is  */
-  /*   important to differentiate, inspite of FreeType's uniform API.      */
+  /*   important to differentiate, in spite of FreeType's uniform API.     */
   /*                                                                       */
   /*************************************************************************/
 

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/autohint.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/autohint.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/autohint.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    High-level `autohint' module-specific interface (specification).     */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002 by                                           */
+/*  Copyright 1996-2001, 2002, 2007 by                                     */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -37,7 +37,7 @@
   /*                                                                       */
   /* - global hints: Usually some metrics that describe global properties  */
   /*                 of the face.  It is computed by scanning more or less */
-  /*                 agressively the glyphs in the face, and thus can be   */
+  /*                 aggressively the glyphs in the face, and thus can be  */
   /*                 very slow to compute (even if the size of global      */
   /*                 hints is really small).                               */
   /*                                                                       */

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/ftdebug.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/ftdebug.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/ftdebug.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    Debugging and logging component (specification).                     */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2004, 2006 by                               */
+/*  Copyright 1996-2001, 2002, 2004, 2006, 2007 by                         */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -138,7 +138,7 @@
   /*    components.                                                        */
   /*                                                                       */
   /*    This function may be useful if you want to control FreeType 2's    */
-  /*    debug level in your appliaciton.                                   */
+  /*    debug level in your application.                                   */
   /*                                                                       */
   FT_BASE( const char * )
   FT_Trace_Get_Name( FT_Int  idx );

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/ftmemory.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/ftmemory.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/ftmemory.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    The FreeType memory management macros (specification).               */
 /*                                                                         */
-/*  Copyright 1996-2001, 2002, 2004, 2005, 2006 by                         */
+/*  Copyright 1996-2001, 2002, 2004, 2005, 2006, 2007 by                   */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg                       */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -209,7 +209,7 @@
 
 
   /*
-   *  Return the maximum number of adressable elements in an array.
+   *  Return the maximum number of addressable elements in an array.
    *  We limit ourselves to INT_MAX, rather than UINT_MAX, to avoid
    *  any problems.
    */
@@ -322,6 +322,41 @@
 #endif /* FT_CONFIG_OPTION_OLD_INTERNALS */
 
 
+  FT_BASE( FT_Pointer )
+  ft_mem_strdup( FT_Memory    memory,
+                 const char*  str,
+                 FT_Error    *p_error );
+
+  FT_BASE( FT_Pointer )
+  ft_mem_dup( FT_Memory    memory,
+              const void*  address,
+              FT_ULong     size,
+              FT_Error    *p_error );
+
+#define FT_MEM_STRDUP( dst, str )                                     \
+          (dst) = ft_mem_strdup( memory, (const char*)(str), &amp;error )
+
+#define FT_STRDUP( dst, str )                           \
+          FT_MEM_SET_ERROR( FT_MEM_STRDUP( dst, str ) )
+
+#define FT_MEM_DUP( dst, address, size )                                    \
+          (dst) = ft_mem_dup( memory, (address), (FT_ULong)(size), &amp;error )
+
+#define FT_DUP( dst, address, size )                           \
+          FT_MEM_SET_ERROR( FT_MEM_DUP( dst, address, size ) )
+
+
+  /* Return &gt;= 1 if a truncation occurs.            */
+  /* Return 0 if the source string fits the buffer. */
+  /* This is *not* the same as strlcpy().           */
+  FT_BASE( FT_Int )
+  ft_mem_strcpyn( char*        dst,
+                  const char*  src,
+                  FT_ULong     size );
+
+#define FT_STRCPYN( dst, src, size )                                         \
+          ft_mem_strcpyn( (char*)dst, (const char*)(src), (FT_ULong)(size) )
+
  /* */
 
 

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/pshints.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/pshints.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/pshints.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -6,7 +6,7 @@
 /*    recorders (specification only).  These are used to support native    */
 /*    T1/T2 hints in the `type1', `cid', and `cff' font drivers.           */
 /*                                                                         */
-/*  Copyright 2001, 2002, 2003, 2005, 2006 by                              */
+/*  Copyright 2001, 2002, 2003, 2005, 2006, 2007 by                        */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -452,9 +452,9 @@
    *   Use vertical coordinates (y) for horizontal stems (dim=0).  Use
    *   horizontal coordinates (x) for vertical stems (dim=1).
    *
-   *   There are `2*count' elements in the `coords' aray.  Each even element
-   *   is an absolute position in font units, each odd element is a length
-   *   in font units.
+   *   There are `2*count' elements in the `coords' array.  Each even
+   *   element is an absolute position in font units, each odd element is a
+   *   length in font units.
    *
    *   A length can be negative, in which case it must be either -20 or
    *   -21.  It is interpreted as a `ghost' stem, according to the Type 1

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/services/svpostnm.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/services/svpostnm.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/services/svpostnm.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    The FreeType PostScript name services (specification).               */
 /*                                                                         */
-/*  Copyright 2003 by                                                      */
+/*  Copyright 2003, 2007 by                                                */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -28,7 +28,7 @@
    *  A trivial service used to retrieve the PostScript name of a given
    *  font when available.  The `get_name' field should never be NULL.
    *
-   *  The correponding function can return NULL to indicate that the
+   *  The corresponding function can return NULL to indicate that the
    *  PostScript name is not available.
    *
    *  The name is owned by the face and will be destroyed with it.

Modified: haiku/trunk/headers/libs/freetype2/freetype/internal/tttypes.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/internal/tttypes.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/internal/tttypes.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -864,7 +864,7 @@
    *
    *   USHORT   version      `BDF ' table version number, should be 0x0001.
    *   USHORT   strikeCount  Number of strikes (bitmap sizes) in this table.
-   *   ULONG    stringTable  Offset (froms start of BDF table) to string
+   *   ULONG    stringTable  Offset (from start of BDF table) to string
    *                         table.
    *
    * This is followed by an array of `strikeCount' descriptors, having the
@@ -1445,7 +1445,7 @@
   /*                                                                       */
   /*     max_points   :: The maximal size in points of the zone.           */
   /*                                                                       */
-  /*     max_contours :: Max size in links contours of thez one.           */
+  /*     max_contours :: Max size in links contours of the zone.           */
   /*                                                                       */
   /*     n_points     :: The current number of points in the zone.         */
   /*                                                                       */

Modified: haiku/trunk/headers/libs/freetype2/freetype/ttnameid.h
===================================================================
--- haiku/trunk/headers/libs/freetype2/freetype/ttnameid.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/headers/libs/freetype2/freetype/ttnameid.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    TrueType name ID definitions (specification only).                   */
 /*                                                                         */
-/*  Copyright 1996-2002, 2003, 2004, 2006 by                               */
+/*  Copyright 1996-2002, 2003, 2004, 2006, 2007 by                         */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -606,7 +606,7 @@
 #define TT_MS_LANGID_CROATIAN_BOSNIA_HERZEGOVINA       0x101a
 #define TT_MS_LANGID_BOSNIAN_BOSNIA_HERZEGOVINA        0x141a
        /* and XPsp2 Platform SDK added (2004-07-26) */
-       /* Names are shortened to be signifiant within 40 chars. */
+       /* Names are shortened to be significant within 40 chars. */
 #define TT_MS_LANGID_SERBIAN_BOSNIA_HERZ_LATIN         0x181a
 #define TT_MS_LANGID_SERBIAN_BOSNIA_HERZ_CYRILLIC      0x181a
 #endif
@@ -660,7 +660,7 @@
   /* ... and we also keep our old identifier... */
 #define TT_MS_LANGID_SAAMI_LAPONIA                     0x043b
 
-#if 0 /* this seems to be a previous invertion */
+#if 0 /* this seems to be a previous inversion */
 #define TT_MS_LANGID_IRISH_GAELIC_IRELAND              0x043c
 #define TT_MS_LANGID_SCOTTISH_GAELIC_UNITED_KINGDOM    0x083c
 #else
@@ -698,6 +698,15 @@
 #define TT_MS_LANGID_MONGOLIAN_MONGOLIA /* Cyrillic */ 0x0450
 #define TT_MS_LANGID_MONGOLIAN_MONGOLIA_MONGOLIAN      0x0850
 #define TT_MS_LANGID_TIBETAN_CHINA                     0x0451
+  /* Don't use the next constant!  It has            */
+  /*   (1) the wrong spelling (Dzonghka)             */
+  /*   (2) Microsoft doesn't officially define it -- */
+  /*       at least it is not in the List of Local   */
+  /*       ID Values.                                */
+  /*   (3) Dzongkha is not the same language as      */
+  /*       Tibetan, so merging it is wrong anyway.   */
+  /*                                                 */
+  /* TT_MS_LANGID_TIBETAN_BHUTAN is correct, BTW.    */
 #define TT_MS_LANGID_DZONGHKA_BHUTAN                   0x0851
 
 #if 0

Modified: haiku/trunk/src/libs/freetype2/autofit/afglobal.c
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/afglobal.c	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/src/libs/freetype2/autofit/afglobal.c	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    Auto-fitter routines to compute global hinting values (body).        */
 /*                                                                         */
-/*  Copyright 2003, 2004, 2005, 2006 by                                    */
+/*  Copyright 2003, 2004, 2005, 2006, 2007 by                              */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -131,7 +131,7 @@
   Exit:
     /*
      *  By default, all uncovered glyphs are set to the latin script.
-     *  XXX: Shouldnt' we disable hinting or do something similar?
+     *  XXX: Shouldn't we disable hinting or do something similar?
      */
     {
       FT_UInt  nn;

Modified: haiku/trunk/src/libs/freetype2/autofit/afhints.c
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/afhints.c	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/src/libs/freetype2/autofit/afhints.c	2007-04-25 17:18:01 UTC (rev 20817)
@@ -727,6 +727,9 @@
     hints-&gt;x_delta = x_delta;
     hints-&gt;y_delta = y_delta;
 
+    hints-&gt;xmin_delta = 0;
+    hints-&gt;xmax_delta = 0;
+
     points = hints-&gt;points;
     if ( hints-&gt;num_points == 0 )
       goto Exit;

Modified: haiku/trunk/src/libs/freetype2/autofit/afhints.h
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/afhints.h	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/src/libs/freetype2/autofit/afhints.h	2007-04-25 17:18:01 UTC (rev 20817)
@@ -4,7 +4,7 @@
 /*                                                                         */
 /*    Auto-fitter hinting routines (specification).                        */
 /*                                                                         */
-/*  Copyright 2003, 2004, 2005, 2006 by                                    */
+/*  Copyright 2003, 2004, 2005, 2006, 2007 by                              */
 /*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
 /*                                                                         */
 /*  This file is part of the FreeType project, and may only be used,       */
@@ -208,6 +208,9 @@
                                      /* implementations          */
     AF_ScriptMetrics  metrics;
 
+    FT_Pos            xmin_delta;    /* used for warping */
+    FT_Pos            xmax_delta;
+    
   } AF_GlyphHintsRec;
 
 

Modified: haiku/trunk/src/libs/freetype2/autofit/aflatin.c
===================================================================
--- haiku/trunk/src/libs/freetype2/autofit/aflatin.c	2007-04-25 17:00:51 UTC (rev 20816)
+++ haiku/trunk/src/libs/freetype2/autofit/aflatin.c	2007-04-25 17:18:01 UTC (rev 20817)
@@ -133,6 +133,8 @@
 
         /* let's try 20% of the smallest width */
         axis-&gt;edge_distance_threshold = stdw / 5;
+        axis-&gt;standard_width          = stdw;
+        axis-&gt;extra_light             = 0;
       }
     }
 
@@ -193,10 +195,8 @@
       for ( ; p &lt; limit &amp;&amp; *p; p++ )
       {
         FT_UInt     glyph_index;
-        FT_Vector*  extremum;
+        FT_Int      best_point, best_y, best_first, best_last;
         FT_Vector*  points;
-        FT_Vector*  point_limit;
-        FT_Vector*  point;
         FT_Bool     round;
 
 
@@ -213,85 +213,97 @@
 
         /* now compute min or max point indices and coordinates */
         points      = glyph-&gt;outline.points;
-        point_limit = points + glyph-&gt;outline.n_points;
-        point       = points;
-        extremum    = point;
-        point++;
+        best_point  = -1;
+        best_y      = 0;  /* make compiler happy */
+        best_first  = 0;  /* ditto */
+        best_last   = 0;  /* ditto */
 
-        if ( AF_LATIN_IS_TOP_BLUE( bb ) )
         {
-          for ( ; point &lt; point_limit; point++ )
-            if ( point-&gt;y &gt; extremum-&gt;y )
-              extremum = point;
-        }
-        else
-        {
-          for ( ; point &lt; point_limit; point++ )
-            if ( point-&gt;y &lt; extremum-&gt;y )
-              extremum = point;
-        }
+          FT_Int  nn;
+          FT_Int  first = 0;
+          FT_Int  last  = -1;
 
-        AF_LOG(( &quot;%5d&quot;, (int)extremum-&gt;y ));
 
-        /* now, check whether the point belongs to a straight or round  */
-        /* segment; we first need to find in which contour the extremum */
-        /* lies, then see its previous and next points                  */
-        {
-          FT_Int  idx = (FT_Int)( extremum - points );
-          FT_Int  n;
-          FT_Int  first, last, prev, next, end;
-          FT_Pos  dist;
+          for ( nn = 0; nn &lt; glyph-&gt;outline.n_contours; first = last+1, nn++ )
+          {
+            FT_Int  old_best_point = best_point;
+            FT_Int  pp;
 
 
-          last  = -1;
-          first = 0;
+            last = glyph-&gt;outline.contours[nn];
 
-          for ( n = 0; n &lt; glyph-&gt;outline.n_contours; n++ )
-          {
-            end = glyph-&gt;outline.contours[n];
-            if ( end &gt;= idx )
+            /* Avoid single-point contours since they are never rasterized. */
+            /* In some fonts, they correspond to mark attachment points     */
+            /* which are way outside of the glyph's real outline.           */
+            if ( last &lt;= first )
+                continue;
+
+            if ( AF_LATIN_IS_TOP_BLUE( bb ) )
             {
-              last = end;
-              break;
+              for ( pp = first; pp &lt;= last; pp++ )
+                if ( best_point &lt; 0 || points[pp].y &gt; best_y )
+                {
+                  best_point = pp;
+                  best_y     = points[pp].y;
+                }
             }
-            first = end + 1;
+            else
+            {
+              for ( pp = first; pp &lt;= last; pp++ )
+                if ( best_point &lt; 0 || points[pp].y &lt; best_y )
+                {
+                  best_point = pp;
+                  best_y     = points[pp].y;
+                }
+            }
+
+            if ( best_point != old_best_point )
+            {
+              best_first = first;
+              best_last  = last;
+            }
           }
+          AF_LOG(( &quot;%5d&quot;, best_y ));
+        }
 
-          /* XXX: should never happen! */
-          if ( last &lt; 0 )
-            continue;
+        /* now check whether the point belongs to a straight or round   */
+        /* segment; we first need to find in which contour the extremum */
+        /* lies, then inspect its previous and next points              */
+        {
+          FT_Int  prev, next;
+          FT_Pos  dist;
 
+
           /* now look for the previous and next points that are not on the */
           /* same Y coordinate.  Threshold the `closeness'...              */
-
-          prev = idx;
+          prev = best_point;
           next = prev;
 
           do
           {
-            if ( prev &gt; first )
+            if ( prev &gt; best_first )
               prev--;
             else
-              prev = last;
+              prev = best_last;
 
-            dist = points[prev].y - extremum-&gt;y;
+            dist = points[prev].y - best_y;
             if ( dist &lt; -5 || dist &gt; 5 )
               break;
 
-          } while ( prev != idx );
+          } while ( prev != best_point );
 
           do
           {
-            if ( next &lt; last )
+            if ( next &lt; best_last )
               next++;
             else
-              next = first;
+              next = best_first;
 
-            dist = points[next].y - extremum-&gt;y;
+            dist = points[next].y - best_y;
             if ( dist &lt; -5 || dist &gt; 5 )
               break;
 
-          } while ( next != idx );
+          } while ( next != best_point );
 
           /* now, set the `round' flag depending on the segment's kind */
           round = FT_BOOL(
@@ -302,9 +314,9 @@
         }
 
         if ( round )
-          rounds[num_rounds++] = extremum-&gt;y;
+          rounds[num_rounds++] = best_y;
         else
-          flats[num_flats++] = extremum-&gt;y;
+          flats[num_flats++]   = best_y;
       }
 
       AF_LOG(( &quot;\n&quot; ));
@@ -479,7 +491,7 @@
           if ( dim == AF_DIMENSION_HORZ )
           {
             if ( fitted &lt; scaled )
-              scale -= scale/50;  /* x_scale = x_scale*0.98 */
+              scale -= scale / 50;  /* scale *= 0.98 */
           }
           else
           {
@@ -513,6 +525,10 @@
       width-&gt;fit = width-&gt;cur;
     }
 
+    /* an extra-light axis corresponds to a standard width that is */
+    /* smaller than 0.75 pixels                                    */
+    axis-&gt;extra_light = FT_MulFix( axis-&gt;standard_width, scale ) &lt; 32 + 8;
+
     if ( dim == AF_DIMENSION_VERT )
     {
       /* scale the blue zones */
@@ -907,7 +923,6 @@
     AF_AxisHints  axis          = &amp;hints-&gt;axis[dim];
     AF_Segment    segments      = axis-&gt;segments;
     AF_Segment    segment_limit = segments + axis-&gt;num_segments;
-    AF_Direction  major_dir     = axis-&gt;major_dir;
     FT_Pos        len_threshold, len_score;
     AF_Segment    seg1, seg2;
 
@@ -923,11 +938,11 @@
     {
       /* the fake segments are introduced to hint the metrics -- */
       /* we must never link them to anything                     */
-      if ( seg1-&gt;first == seg1-&gt;last || seg1-&gt;dir != major_dir )
+      if ( seg1-&gt;first == seg1-&gt;last )
         continue;
 
-      for ( seg2 = segments; seg2 &lt; segment_limit; seg2++ )
-        if ( seg2 != seg1 &amp;&amp; seg1-&gt;dir + seg2-&gt;dir == 0 )
+      for ( seg2 = seg1 + 1; seg2 &lt; segment_limit; seg2++ )
+        if ( seg1-&gt;dir + seg2-&gt;dir == 0 )
         {
           FT_Pos  pos1 = seg1-&gt;pos;
           FT_Pos  pos2 = seg2-&gt;pos;
@@ -935,7 +950,7 @@
 
 
           if ( dist &lt; 0 )
-            continue;
+            dist = -dist;
 
           {
             FT_Pos  min = seg1-&gt;min_coord;
@@ -1020,7 +1035,7 @@
      *  corresponding threshold in font units.
      */
     if ( dim == AF_DIMENSION_HORZ )
-        segment_length_threshold = FT_DivFix( 96, hints-&gt;y_scale );
+        segment_length_threshold = FT_DivFix( 64, hints-&gt;y_scale );
     else
         segment_length_threshold = 0;
 
@@ -1057,6 +1072,12 @@
       if ( seg-&gt;height &lt; segment_length_threshold )
         continue;
 
+      /* A special case for serif edges: If they are smaller than */
+      /* 1.5 pixels we ignore them.                               */
+      if ( seg-&gt;serif                                     &amp;&amp;
+           2 * seg-&gt;height &lt; 3 * segment_length_threshold )
+        continue;
+
       /* look for an edge corresponding to the segment */
       for ( ee = 0; ee &lt; axis-&gt;num_edges; ee++ )
       {
@@ -1385,8 +1406,8 @@
     af_glyph_hints_rescale( hints, (AF_ScriptMetrics)metrics );
 
     /*
-     *  correct x_scale and y_scale when needed, since they may have
-     *  been modified af_latin_scale_dim above
+     *  correct x_scale and y_scale if needed, since they may have
+     *  been modified `af_latin_metrics_scale_dim' above
      */
     hints-&gt;x_scale = metrics-&gt;axis[AF_DIMENSION_HORZ].scale;
     hints-&gt;x_delta = metrics-&gt;axis[AF_DIMENSION_HORZ].delta;
@@ -1396,7 +1417,7 @@
     /* compute flags depending on render mode, etc. */
     mode = metrics-&gt;root.scaler.render_mode;
 
-#ifdef AF_USE_WARPER
+#if 0 /* #ifdef AF_USE_WARPER */
     if ( mode == FT_RENDER_MODE_LCD || mode == FT_RENDER_MODE_LCD_V )

[... truncated: 3009 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001917.html">[Haiku-commits] r20816 - haiku/trunk/src/apps/terminal
</A></li>
	<LI>Next message: <A HREF="001802.html">[Haiku-commits] r20818 - in haiku/trunk: headers/private/net	src/add-ons/kernel/network/protocols/tcp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1801">[ date ]</a>
              <a href="thread.html#1801">[ thread ]</a>
              <a href="subject.html#1801">[ subject ]</a>
              <a href="author.html#1801">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
