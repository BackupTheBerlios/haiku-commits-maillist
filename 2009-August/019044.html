<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r32272 - haiku/trunk/src/servers/mail
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32272%20-%20haiku/trunk/src/servers/mail&In-Reply-To=%3C200908121125.n7CBPqB2031409%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019078.html">
   <LINK REL="Next"  HREF="019077.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r32272 - haiku/trunk/src/servers/mail</H1>
    <B>aldeck at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32272%20-%20haiku/trunk/src/servers/mail&In-Reply-To=%3C200908121125.n7CBPqB2031409%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r32272 - haiku/trunk/src/servers/mail">aldeck at mail.berlios.de
       </A><BR>
    <I>Wed Aug 12 13:25:52 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019078.html">[Haiku-commits] Haiku-commits] r32267 - in haiku/trunk:	headers/os/opengl src/kits/opengl src/tests/kits/opengl/glinfo
</A></li>
        <LI>Next message: <A HREF="019077.html">[Haiku-commits] r32272 - haiku/trunk/src/servers/mail
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19044">[ date ]</a>
              <a href="thread.html#19044">[ thread ]</a>
              <a href="subject.html#19044">[ subject ]</a>
              <a href="author.html#19044">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aldeck
Date: 2009-08-12 13:25:44 +0200 (Wed, 12 Aug 2009)
New Revision: 32272
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=32272&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=32272&amp;view=rev</A>

Modified:
   haiku/trunk/src/servers/mail/DeskbarView.cpp
   haiku/trunk/src/servers/mail/DeskbarView.h
Log:
* Style update. Don't know what to do about the licence headers though


Modified: haiku/trunk/src/servers/mail/DeskbarView.cpp
===================================================================
--- haiku/trunk/src/servers/mail/DeskbarView.cpp	2009-08-12 10:53:00 UTC (rev 32271)
+++ haiku/trunk/src/servers/mail/DeskbarView.cpp	2009-08-12 11:25:44 UTC (rev 32272)
@@ -4,36 +4,35 @@
  */
 
 
-#include &lt;PopUpMenu.h&gt;
 #include &lt;Bitmap.h&gt;
-#include &lt;Rect.h&gt;
-#include &lt;MenuItem.h&gt;
-#include &lt;Window.h&gt;
-#include &lt;Messenger.h&gt;
-#include &lt;Roster.h&gt;
-#include &lt;Resources.h&gt;
+#include &lt;Deskbar.h&gt;
+#include &lt;Directory.h&gt;
 #include &lt;Entry.h&gt;
-#include &lt;Path.h&gt;
-#include &lt;NodeMonitor.h&gt;
-#include &lt;VolumeRoster.h&gt;
-#include &lt;Directory.h&gt;
 #include &lt;FindDirectory.h&gt;
 #include &lt;IconUtils.h&gt;
-#include &lt;Query.h&gt;
-#include &lt;SymLink.h&gt;
-#include &lt;NodeInfo.h&gt;
 #include &lt;kernel/fs_info.h&gt;
 #include &lt;kernel/fs_index.h&gt;
-#include &lt;Deskbar.h&gt;
+#include &lt;MenuItem.h&gt;
+#include &lt;Messenger.h&gt;
+#include &lt;NodeInfo.h&gt;
+#include &lt;NodeMonitor.h&gt;
+#include &lt;Path.h&gt;
+#include &lt;PopUpMenu.h&gt;
+#include &lt;Query.h&gt;
+#include &lt;Rect.h&gt;
+#include &lt;Resources.h&gt;
+#include &lt;Roster.h&gt;
 #include &lt;String.h&gt;
+#include &lt;SymLink.h&gt;
+#include &lt;VolumeRoster.h&gt;
+#include &lt;Window.h&gt;
 
 #include &lt;stdio.h&gt;
 #include &lt;malloc.h&gt;
 
 #include &lt;E-mail.h&gt;
+#include &lt;MailDaemon.h&gt;
 #include &lt;MailSettings.h&gt;
-#include &lt;MailDaemon.h&gt;
-
 #include &lt;MDRLanguage.h&gt;
 
 #include &quot;DeskbarView.h&quot;
@@ -86,6 +85,7 @@
 	_InitBitmaps();
 }
 
+
 DeskbarView::DeskbarView(BMessage *message)
 	:
 	BView(message),
@@ -94,6 +94,7 @@
 	_InitBitmaps();
 }
 
+
 DeskbarView::~DeskbarView()
 {
 	for (int i = 0; i &lt; kStatusCount; i++)
@@ -103,6 +104,7 @@
 		delete ((BQuery *)(fNewMailQueries.ItemAt(i)));
 }
 
+
 void DeskbarView::AttachedToWindow()
 {
 	BView::AttachedToWindow();
@@ -114,14 +116,15 @@
 	SetLowColor(ViewColor());
 
 	if (be_roster-&gt;IsRunning(&quot;application/x-vnd.Be-POST&quot;)) {
-		RefreshMailQuery();
+		_RefreshMailQuery();
 	} else {
 		BDeskbar deskbar;
 		deskbar.RemoveItem(&quot;mail_daemon&quot;);
 	}
 }
 
-void DeskbarView::RefreshMailQuery()
+
+void DeskbarView::_RefreshMailQuery()
 {
 	for (int32 i = 0; i &lt; fNewMailQueries.CountItems(); i++)
 		delete ((BQuery *)(fNewMailQueries.ItemAt(i)));
@@ -150,9 +153,10 @@
 		newMailQuery-&gt;Fetch();
 
 		BEntry entry;
-		while (newMailQuery-&gt;GetNextEntry(&amp;entry) == B_OK)
+		while (newMailQuery-&gt;GetNextEntry(&amp;entry) == B_OK) {
 			if (entry.InitCheck() == B_OK)
 				fNewMessages++;
+		}
 
 		fNewMailQueries.AddItem(newMailQuery);
 	}
@@ -161,6 +165,7 @@
 	Invalidate();
 }
 
+
 DeskbarView* DeskbarView::Instantiate(BMessage *data)
 {
 	if (!validate_instantiation(data, &quot;DeskbarView&quot;))
@@ -169,6 +174,7 @@
 	return new DeskbarView(data);
 }
 
+
 status_t DeskbarView::Archive(BMessage *data,bool deep) const
 {
 	BView::Archive(data, deep);
@@ -177,6 +183,7 @@
 	return B_NO_ERROR;
 }
 
+
 void DeskbarView::Draw(BRect /*updateRect*/)
 {
 	if (fBitmaps[fStatus] == NULL)
@@ -187,6 +194,7 @@
 	SetDrawingMode(B_OP_COPY);
 }
 
+
 status_t OpenFolder(const char* end)
 {
 	BPath path;
@@ -194,9 +202,11 @@
 	path.Append(end);
 
 	entry_ref ref;
-	if (get_ref_for_path(path.Path(),&amp;ref) != B_OK) return B_NAME_NOT_FOUND;
-	if (!BEntry(&amp;ref).Exists()) return B_NAME_NOT_FOUND;
+	if (get_ref_for_path(path.Path(),&amp;ref) != B_OK)
+		return B_NAME_NOT_FOUND;
 
+	if (!BEntry(&amp;ref).Exists())
+		return B_NAME_NOT_FOUND;
 
 	BMessage open_mbox(B_REFS_RECEIVED);
 	open_mbox.AddRef(&quot;refs&quot;,&amp;ref);
@@ -208,7 +218,7 @@
 
 
 void
-DeskbarView::MessageReceived(BMessage *message)
+DeskbarView::MessageReceived(BMessage* message)
 {
 	switch(message-&gt;what)
 	{
@@ -226,7 +236,7 @@
 
 		case MD_OPEN_NEW:
 		{
-			char *argv[] = {&quot;New Message&quot;, &quot;mailto:&quot;};
+			char* argv[] = {&quot;New Message&quot;, &quot;mailto:&quot;};
 			be_roster-&gt;Launch(&quot;text/x-email&quot;,2,argv);
 			break;
 		}
@@ -235,7 +245,7 @@
 			break;
 
 		case MD_REFRESH_QUERY:
-			RefreshMailQuery();
+			_RefreshMailQuery();
 			break;
 
 		case B_QUERY_UPDATE:
@@ -258,7 +268,8 @@
 			BMailDaemon::Quit();
 			break;
 
-		case B_REFS_RECEIVED:	// open received files in the standard mail application
+		// open received files in the standard mail application
+		case B_REFS_RECEIVED:
 		{
 			BMessage argv(B_ARGV_RECEIVED);
 			argv.AddString(&quot;argv&quot;, &quot;E-mail&quot;);
@@ -267,14 +278,13 @@
 			BPath path;
 			int i = 0;
 
-			while (message-&gt;FindRef(&quot;refs&quot;,i++,&amp;ref) == B_OK &amp;&amp; path.SetTo(&amp;ref) == B_OK)
-			{
+			while (message-&gt;FindRef(&quot;refs&quot;, i++, &amp;ref) == B_OK
+				&amp;&amp; path.SetTo(&amp;ref) == B_OK) {
 				//fprintf(stderr,&quot;got %s\n&quot;, path.Path());
 				argv.AddString(&quot;argv&quot;, path.Path());
 			}
 
-			if (i &gt; 1)
-			{
+			if (i &gt; 1) {
 				argv.AddInt32(&quot;argc&quot;, i);
 				be_roster-&gt;Launch(&quot;text/x-email&quot;, &amp;argv);
 			}
@@ -333,9 +343,9 @@
 DeskbarView::MouseUp(BPoint pos)
 {
 	if (fLastButtons &amp; B_PRIMARY_MOUSE_BUTTON) {
-		if (OpenFolder(&quot;mail/mailbox&quot;) != B_OK)
-		if (OpenFolder(&quot;mail/in&quot;) != B_OK)
-		if (OpenFolder(&quot;mail/INBOX&quot;) != B_OK)
+		if (OpenFolder(&quot;mail/mailbox&quot;) != B_OK
+			&amp;&amp; OpenFolder(&quot;mail/in&quot;) != B_OK
+			&amp;&amp; OpenFolder(&quot;mail/INBOX&quot;) != B_OK)
 			OpenFolder(&quot;mail&quot;);
 	}
 
@@ -353,7 +363,7 @@
 	if (fLastButtons &amp; B_SECONDARY_MOUSE_BUTTON) {
 		ConvertToScreen(&amp;pos);
 
-		BPopUpMenu *menu = BuildMenu();
+		BPopUpMenu* menu = _BuildMenu();
 		if (menu) {
 			menu-&gt;Go(pos, true, true, BRect(pos.x - 2, pos.y - 2,
 				pos.x + 2, pos.y + 2), true);
@@ -363,7 +373,7 @@
 
 
 bool
-DeskbarView::CreateMenuLinks(BDirectory &amp;directory,BPath &amp;path)
+DeskbarView::_CreateMenuLinks(BDirectory&amp; directory, BPath&amp; path)
 {
 	status_t status = directory.SetTo(path.Path());
 	if (status == B_OK)
@@ -406,7 +416,7 @@
 
 
 void
-DeskbarView::CreateNewMailQuery(BEntry &amp;query)
+DeskbarView::_CreateNewMailQuery(BEntry&amp; query)
 {
 	BFile file(&amp;query, B_READ_WRITE | B_CREATE_FILE);
 	if (file.InitCheck() != B_OK)
@@ -421,21 +431,21 @@
 }
 
 
-BPopUpMenu *
-DeskbarView::BuildMenu()
+BPopUpMenu*
+DeskbarView::_BuildMenu()
 {
-	BPopUpMenu *menu = new BPopUpMenu(B_EMPTY_STRING, false, false);
+	BPopUpMenu* menu = new BPopUpMenu(B_EMPTY_STRING, false, false);
 	menu-&gt;SetFont(be_plain_font);
 
 	menu-&gt;AddItem(new BMenuItem(MDR_DIALECT_CHOICE (
-		&quot;Create New Message&quot;,&quot;N) &#26032;&#35215;&#12513;&#12483;&#12475;&#12540;&#12472;&#20316;&#25104;&quot;)B_UTF8_ELLIPSIS,
+		&quot;Create New Message&quot;, &quot;N) &#26032;&#35215;&#12513;&#12483;&#12475;&#12540;&#12472;&#20316;&#25104;&quot;)B_UTF8_ELLIPSIS,
 		new BMessage(MD_OPEN_NEW)));
 	menu-&gt;AddSeparatorItem();
 
 	BMessenger tracker(kTrackerSignature);
-	BNavMenu *navMenu;
-	BMenuItem *item;
-	BMessage *msg;
+	BNavMenu* navMenu;
+	BMenuItem* item;
+	BMessage* msg;
 	entry_ref ref;
 
 	BPath path;
@@ -443,7 +453,7 @@
 	path.Append(&quot;Mail/Menu Links&quot;);
 
 	BDirectory directory;
-	if (CreateMenuLinks(directory, path)) {
+	if (_CreateMenuLinks(directory, path)) {
 		int32 count = 0;
 
 		while (directory.GetNextRef(&amp;ref) == B_OK) {
@@ -466,11 +476,12 @@
 					BNode node(&amp;entry);
 					BNodeInfo info(&amp;node);
 					if (info.GetType(mimeString) == B_OK
-						&amp;&amp; strcmp(mimeString, &quot;application/x-vnd.Be-query&quot;) == 0)
+						&amp;&amp; strcmp(mimeString, &quot;application/x-vnd.Be-query&quot;)
+							== 0)
 						useNavMenu = true;
 				}
-				// clobber the existing ref only if the symlink derefernces completely,
-				// otherwise we'll stick with what we have
+				// clobber the existing ref only if the symlink derefernces
+				// completely, otherwise we'll stick with what we have
 				entry.GetRef(&amp;ref);
 			}
 
@@ -514,7 +525,7 @@
 
 		BEntry query(path.Path());
 		if (!query.Exists())
-			CreateNewMailQuery(query);
+			_CreateNewMailQuery(query);
 		query.GetRef(&amp;ref);
 
 		item = new BMenuItem(navMenu = new BNavMenu(string.String(),
@@ -541,9 +552,9 @@
 		chainMenu-&gt;SetFont(&amp;font);
 
 		for (int32 i = 0; i &lt; list.CountItems(); i++) {
-			BMailChain *chain = (BMailChain *)list.ItemAt(i);
+			BMailChain* chain = (BMailChain*)list.ItemAt(i);
 
-			BMessage *message = new BMessage(MD_CHECK_FOR_MAILS);
+			BMessage* message = new BMessage(MD_CHECK_FOR_MAILS);
 			message-&gt;AddString(&quot;account&quot;, chain-&gt;Name());
 
 			chainMenu-&gt;AddItem(new BMenuItem(chain-&gt;Name(), message));
@@ -573,12 +584,12 @@
 
 	menu-&gt;AddSeparatorItem();
 	menu-&gt;AddItem(new BMenuItem(
-		MDR_DIALECT_CHOICE (&quot;Edit Preferences&quot;,&quot;P) &#12513;&#12540;&#12523;&#29872;&#22659;&#35373;&#23450;&quot;) B_UTF8_ELLIPSIS,
+		MDR_DIALECT_CHOICE (&quot;Edit Preferences&quot;, &quot;P) &#12513;&#12540;&#12523;&#29872;&#22659;&#35373;&#23450;&quot;) B_UTF8_ELLIPSIS,
 		new BMessage(MD_OPEN_PREFS)));
 
 	if (modifiers() &amp; B_SHIFT_KEY) {
 		menu-&gt;AddItem(new BMenuItem(
-			MDR_DIALECT_CHOICE (&quot;Shutdown Mail Services&quot;,&quot;Q) &#32066;&#20102;&quot;),
+			MDR_DIALECT_CHOICE (&quot;Shutdown Mail Services&quot;, &quot;Q) &#32066;&#20102;&quot;),
 			new BMessage(B_QUIT_REQUESTED)));
 	}
 
@@ -595,4 +606,3 @@
 	}
 	return menu;
 }
-

Modified: haiku/trunk/src/servers/mail/DeskbarView.h
===================================================================
--- haiku/trunk/src/servers/mail/DeskbarView.h	2009-08-12 10:53:00 UTC (rev 32271)
+++ haiku/trunk/src/servers/mail/DeskbarView.h	2009-08-12 11:25:44 UTC (rev 32272)
@@ -34,24 +34,24 @@
 class _EXPORT DeskbarView : public BView {
 	public:
 		DeskbarView (BRect frame);
-		DeskbarView (BMessage *data);
+		DeskbarView (BMessage* data);
 
 		virtual ~DeskbarView();
 
 		virtual void		Draw(BRect updateRect);
 		virtual void		AttachedToWindow();
-		static DeskbarView *Instantiate(BMessage *data);
-		virtual	status_t	Archive(BMessage *data, bool deep = true) const;
+		static DeskbarView*	Instantiate(BMessage* data);
+		virtual	status_t	Archive(BMessage* data, bool deep = true) const;
 		virtual void	 	MouseDown(BPoint);
 		virtual void	 	MouseUp(BPoint);
 		virtual void		MessageReceived(BMessage *message);
 		virtual void		Pulse();
 
 	private:
-		void		RefreshMailQuery();
-		bool		CreateMenuLinks(BDirectory &amp;,BPath &amp;);
-		void		CreateNewMailQuery(BEntry &amp;);
-		BPopUpMenu	*BuildMenu();
+		void		_RefreshMailQuery();
+		bool		_CreateMenuLinks(BDirectory&amp;, BPath&amp;);
+		void		_CreateNewMailQuery(BEntry&amp;);
+		BPopUpMenu*	_BuildMenu();
 		void		_InitBitmaps();
 
 		BBitmap*	fBitmaps[kStatusCount];


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019078.html">[Haiku-commits] Haiku-commits] r32267 - in haiku/trunk:	headers/os/opengl src/kits/opengl src/tests/kits/opengl/glinfo
</A></li>
	<LI>Next message: <A HREF="019077.html">[Haiku-commits] r32272 - haiku/trunk/src/servers/mail
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19044">[ date ]</a>
              <a href="thread.html#19044">[ thread ]</a>
              <a href="subject.html#19044">[ subject ]</a>
              <a href="author.html#19044">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
