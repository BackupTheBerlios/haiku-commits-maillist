<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r32521 - in haiku/trunk: build/jam	headers/private/app src/apps/drivesetup src/apps/icon-o-matic	src/kits src/kits/app src/kits/storage src/kits/tracker	src/servers/app src/tests/servers/app	src/tests/servers/app/archived_view	src/tests/servers/app/async_drawing src/tests/servers/app/benchmark	src/tests/servers/app/bitmap_bounds	src/tests/servers/app/bitmap_drawing	src/tests/servers/app/constrain_clipping_region	src/tests/servers/app/copy_bits	src/tests/servers/app/draw_after_children	src/tests/servers/app/find_view src/tests/servers/app/following	src/tests/servers/app/lagging_get_mouse	src/tests/servers/app/playground src/tests/servers/app/resize_limits	src/tests/servers/app/scrollbar src/tests/servers/app/scrolling	src/tests/servers/app/statusbar src/tests/servers/app/stress_test	src/tests/servers/app/textview src/tests/servers/registrar
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32521%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/app%20src/apps/drivesetup%20src/apps/icon-o-matic%0A%09src/kits%20src/kits/app%20src/kits/storage%20src/kits/tracker%0A%09src/servers/app%20src/tests/servers/app%0A%09src/tests/servers/app/archived_view%0A%09src/tests/servers/app/async_drawing%20src/tests/servers/app/benchmark%0A%09src/tests/servers/app/bitmap_bounds%0A%09src/tests/servers/app/bitmap_drawing%0A%09src/tests/servers/app/constrain_clipping_region%0A%09src/tests/servers/app/copy_bits%0A%09src/tests/servers/app/draw_after_children%0A%09src/tests/servers/app/find_view%20src/tests/servers/app/following%0A%09src/tests/servers/app/lagging_get_mouse%0A%09src/tests/servers/app/playground%20src/tests/servers/app/resize_limits%0A%09src/tests/servers/app/scrollbar%20src/tests/servers/app/scrolling%0A%09src/tests/servers/app/statusbar%20src/tests/servers/app/stress_test%0A%09src/tests/servers/app/textview%20src/tests/servers/registrar&In-Reply-To=%3C200908191417.n7JEHRlP020286%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019581.html">
   <LINK REL="Next"  HREF="019584.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r32521 - in haiku/trunk: build/jam	headers/private/app src/apps/drivesetup src/apps/icon-o-matic	src/kits src/kits/app src/kits/storage src/kits/tracker	src/servers/app src/tests/servers/app	src/tests/servers/app/archived_view	src/tests/servers/app/async_drawing src/tests/servers/app/benchmark	src/tests/servers/app/bitmap_bounds	src/tests/servers/app/bitmap_drawing	src/tests/servers/app/constrain_clipping_region	src/tests/servers/app/copy_bits	src/tests/servers/app/draw_after_children	src/tests/servers/app/find_view src/tests/servers/app/following	src/tests/servers/app/lagging_get_mouse	src/tests/servers/app/playground src/tests/servers/app/resize_limits	src/tests/servers/app/scrollbar src/tests/servers/app/scrolling	src/tests/servers/app/statusbar src/tests/servers/app/stress_test	src/tests/servers/app/textview src/tests/servers/registrar</H1>
    <B>axeld at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32521%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/app%20src/apps/drivesetup%20src/apps/icon-o-matic%0A%09src/kits%20src/kits/app%20src/kits/storage%20src/kits/tracker%0A%09src/servers/app%20src/tests/servers/app%0A%09src/tests/servers/app/archived_view%0A%09src/tests/servers/app/async_drawing%20src/tests/servers/app/benchmark%0A%09src/tests/servers/app/bitmap_bounds%0A%09src/tests/servers/app/bitmap_drawing%0A%09src/tests/servers/app/constrain_clipping_region%0A%09src/tests/servers/app/copy_bits%0A%09src/tests/servers/app/draw_after_children%0A%09src/tests/servers/app/find_view%20src/tests/servers/app/following%0A%09src/tests/servers/app/lagging_get_mouse%0A%09src/tests/servers/app/playground%20src/tests/servers/app/resize_limits%0A%09src/tests/servers/app/scrollbar%20src/tests/servers/app/scrolling%0A%09src/tests/servers/app/statusbar%20src/tests/servers/app/stress_test%0A%09src/tests/servers/app/textview%20src/tests/servers/registrar&In-Reply-To=%3C200908191417.n7JEHRlP020286%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r32521 - in haiku/trunk: build/jam	headers/private/app src/apps/drivesetup src/apps/icon-o-matic	src/kits src/kits/app src/kits/storage src/kits/tracker	src/servers/app src/tests/servers/app	src/tests/servers/app/archived_view	src/tests/servers/app/async_drawing src/tests/servers/app/benchmark	src/tests/servers/app/bitmap_bounds	src/tests/servers/app/bitmap_drawing	src/tests/servers/app/constrain_clipping_region	src/tests/servers/app/copy_bits	src/tests/servers/app/draw_after_children	src/tests/servers/app/find_view src/tests/servers/app/following	src/tests/servers/app/lagging_get_mouse	src/tests/servers/app/playground src/tests/servers/app/resize_limits	src/tests/servers/app/scrollbar src/tests/servers/app/scrolling	src/tests/servers/app/statusbar src/tests/servers/app/stress_test	src/tests/servers/app/textview src/tests/servers/registrar">axeld at mail.berlios.de
       </A><BR>
    <I>Wed Aug 19 16:17:27 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019581.html">[Haiku-commits] r32520 - haiku/trunk/src/kits/tracker
</A></li>
        <LI>Next message: <A HREF="019584.html">[Haiku-commits] r32521 - in haiku/trunk: build/jam headers/private/app src/apps/drivesetup src/apps/icon-o-matic src/kits src/kits/app src/kits/storage src/kits/tracker src/servers/app src/tests/servers/app src/tests/servers/app/archived_view src/tests/servers/app/async_drawing  src/tests/servers/app/benchmark src/tests/servers/app/bitmap_bounds src/tests/servers/app/bitmap_drawing src/tests/servers/app/constrain_clipping_region src/tests/servers/app/copy_bits src/tests/servers/app/draw_after_children src/tests/servers/app/find_view  src/tests/servers/app/following src/tests/servers/app/lagging_get_mouse src/tests/servers/app/playground  src/tests/servers/app/resize_limits src/tests/servers/app/scrollbar src/tests/servers/app/scrolling src/tests/servers/app/statusbar src/tests/servers/app/stress_test src/tests/servers/app/textview  src/tests/servers/registrar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19582">[ date ]</a>
              <a href="thread.html#19582">[ thread ]</a>
              <a href="subject.html#19582">[ subject ]</a>
              <a href="author.html#19582">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: axeld
Date: 2009-08-19 16:17:13 +0200 (Wed, 19 Aug 2009)
New Revision: 32521
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=32521&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=32521&amp;view=rev</A>

Added:
   haiku/trunk/src/kits/libbe_test_versions
   haiku/trunk/src/tests/servers/app/run
   haiku/trunk/src/tests/servers/registrar/run_test_registrar.cpp
Removed:
   haiku/trunk/src/kits/storage/LibBeAdapter.cpp
   haiku/trunk/src/tests/servers/app/archived_view/run
   haiku/trunk/src/tests/servers/app/async_drawing/run
   haiku/trunk/src/tests/servers/app/benchmark/run
   haiku/trunk/src/tests/servers/app/bitmap_bounds/run
   haiku/trunk/src/tests/servers/app/bitmap_drawing/run
   haiku/trunk/src/tests/servers/app/constrain_clipping_region/run
   haiku/trunk/src/tests/servers/app/copy_bits/run
   haiku/trunk/src/tests/servers/app/draw_after_children/run
   haiku/trunk/src/tests/servers/app/find_view/run
   haiku/trunk/src/tests/servers/app/following/run
   haiku/trunk/src/tests/servers/app/lagging_get_mouse/run
   haiku/trunk/src/tests/servers/app/playground/run
   haiku/trunk/src/tests/servers/app/resize_limits/run
   haiku/trunk/src/tests/servers/app/scrollbar/run
   haiku/trunk/src/tests/servers/app/scrolling/run
   haiku/trunk/src/tests/servers/app/statusbar/run
   haiku/trunk/src/tests/servers/app/stress_test/run
   haiku/trunk/src/tests/servers/app/textview/run
   haiku/trunk/src/tests/servers/registrar/run_haiku_registrar.cpp
Modified:
   haiku/trunk/build/jam/BuildSetup
   haiku/trunk/build/jam/TestsRules
   haiku/trunk/headers/private/app/RegistrarDefs.h
   haiku/trunk/headers/private/app/ServerProtocol.h
   haiku/trunk/src/apps/drivesetup/Jamfile
   haiku/trunk/src/apps/icon-o-matic/Jamfile
   haiku/trunk/src/kits/Jamfile
   haiku/trunk/src/kits/app/RegistrarDefs.cpp
   haiku/trunk/src/kits/storage/Directory.cpp
   haiku/trunk/src/kits/storage/Entry.cpp
   haiku/trunk/src/kits/storage/Jamfile
   haiku/trunk/src/kits/storage/Node.cpp
   haiku/trunk/src/kits/storage/Volume.cpp
   haiku/trunk/src/kits/tracker/FSUtils.cpp
   haiku/trunk/src/servers/app/DesktopSettings.cpp
   haiku/trunk/src/tests/servers/app/Jamfile
   haiku/trunk/src/tests/servers/app/NOTES
   haiku/trunk/src/tests/servers/registrar/Jamfile
Log:
* Made the libbe_test environment basically working under Haiku - to actually
  make it work, one would need to use versioning for all libbe symbols. This is
  worth an 8k price per file that links against libbe.so, so I didn't want to
  commit this as is. An alternative to this solution would be to write a
  separate application that is responsible for the app_server's window. Comments
  welcome.
* Removed BeOS compatbility of the libbe_test stuff.
* Renamed the libbe_test targets from *haiku* to *test*, ie. libbe_haiku.so is
  now called libbe_test.so, haiku_registrar is now test_registrar, etc.
* This also removes BeOS compatibility from tracker/FSUtils.cpp (all BeOS
  compatibility should be removed, but I don't want to make Alexandre more work
  in his branch, and it's not urgent at all).
* Replaced the former &quot;run&quot; scripts for the test environment with a single
  run script (see updated NOTES file).
* Removed the libbe_test target from some applications - this was only to help
  developing them under BeOS, and is thus no longer necessary.


Modified: haiku/trunk/build/jam/BuildSetup
===================================================================
--- haiku/trunk/build/jam/BuildSetup	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/build/jam/BuildSetup	2009-08-19 14:17:13 UTC (rev 32521)
@@ -954,7 +954,7 @@
 
 	# library name map
 	TARGET_LIBRARY_NAME_MAP = LIBBE_LIBRARY_NAME_MAP ;
-	LIBBE_LIBRARY_NAME_MAP_be = libbe_haiku.so ;
+	LIBBE_LIBRARY_NAME_MAP_be = libbe_test.so ;
 }
 
 

Modified: haiku/trunk/build/jam/TestsRules
===================================================================
--- haiku/trunk/build/jam/TestsRules	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/build/jam/TestsRules	2009-08-19 14:17:13 UTC (rev 32521)
@@ -9,7 +9,7 @@
 	local lib = $(1) ;
 	local sources = $(2) ;
 	local libraries = $(3) ;
-	
+
 	# if TEST_DEBUG is defined, we turn on debugging
 	if $(TEST_DEBUG) {
 		DEBUG on $(lib) [ FGristFiles $(sources:S=$(SUFOBJ)) ] ?= 1 ;
@@ -21,7 +21,7 @@
 
 		# make the target depend on the installed libbe libraries
 		Depends $(lib) :
-			 &lt;tests!unittests&gt;libbe_haiku.so &lt;tests!unittests&gt;libbeadapter.so ;
+			 &lt;tests!unittests&gt;libbe_test.so ;
 	} else {
 		ObjectDefines $(2) : TEST_R5 ;
 	}
@@ -49,7 +49,7 @@
 
 		# make the target depend on the installed libbe libraries
 		Depends $(target) :
-			 &lt;tests!unittests&gt;libbe_haiku.so &lt;tests!unittests&gt;libbeadapter.so ;
+			 &lt;tests!unittests&gt;libbe_test.so ;
 	} else {
 		ObjectDefines $(2) : TEST_R5 ;
 	}
@@ -106,6 +106,6 @@
 		relPath = $(SUBDIR_TOKENS[2-]) ;
 	}
 	MakeLocate $(target) : [ FDirName $(HAIKU_TEST_DIR) $(relPath) ] ;
-	
+
 	BuildPlatformMain $(target) : $(sources) ;
 }

Modified: haiku/trunk/headers/private/app/RegistrarDefs.h
===================================================================
--- haiku/trunk/headers/private/app/RegistrarDefs.h	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/headers/private/app/RegistrarDefs.h	2009-08-19 14:17:13 UTC (rev 32521)
@@ -18,15 +18,16 @@
 namespace BPrivate {
 
 // names
-extern const char *kRegistrarSignature;
-extern const char *kRosterThreadName;
-extern const char *kRAppLooperPortName;
+extern const char* kRegistrarSignature;
+extern const char* kRosterThreadName;
+extern const char* kRAppLooperPortName;
 
-extern const char *get_roster_port_name();
+extern const char* get_roster_port_name();
 
-#define REGISTRAR_AUTHENTICATION_PORT_NAME	&quot;registrar: auth manager&quot;
 
+#define REGISTRAR_AUTHENTICATION_PORT_NAME	&quot;system:registrar:auth manager&quot;
 
+
 // message constants
 enum {
 	// replies
@@ -122,7 +123,7 @@
 	B_REG_UPDATE_GROUP						= 'rugr',
 };
 
-// B_REG_MIME_SET_PARAM &quot;which&quot; constants 
+// B_REG_MIME_SET_PARAM &quot;which&quot; constants
 enum {
 	B_REG_MIME_APP_HINT				= 'rgmh',
 	B_REG_MIME_ATTR_INFO			= 'rgma',

Modified: haiku/trunk/headers/private/app/ServerProtocol.h
===================================================================
--- haiku/trunk/headers/private/app/ServerProtocol.h	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/headers/private/app/ServerProtocol.h	2009-08-19 14:17:13 UTC (rev 32521)
@@ -18,9 +18,14 @@
 // Server port names. The input port is the port which is used to receive
 // input messages from the Input Server. The other is the &quot;main&quot; port for
 // the server and is utilized mostly by BApplication objects.
-#define SERVER_PORT_NAME &quot;haiku app_server&quot;
+#ifdef HAIKU_TARGET_PLATFORM_HAIKU
+#	define SERVER_PORT_NAME &quot;system:app_server&quot;
+#else
+#	define SERVER_PORT_NAME &quot;haiku-test:app_server&quot;
+#endif
+
 #if TEST_MODE
-#	define SERVER_INPUT_PORT &quot;haiku input port&quot;
+#	define SERVER_INPUT_PORT &quot;haiku-test:input port&quot;
 #endif
 
 #define AS_REQUEST_COLOR_KEY 0x00010000

Modified: haiku/trunk/src/apps/drivesetup/Jamfile
===================================================================
--- haiku/trunk/src/apps/drivesetup/Jamfile	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/apps/drivesetup/Jamfile	2009-08-19 14:17:13 UTC (rev 32521)
@@ -16,9 +16,3 @@
 	: be libcolumnlistview.a libshared.a $(TARGET_LIBSUPC++)
 	: DriveSetup.rdef
 ;
-
-if ( $(TARGET_PLATFORM) = libbe_test ) {
-	HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : DriveSetup
-		: tests!apps ;
-}
-

Modified: haiku/trunk/src/apps/icon-o-matic/Jamfile
===================================================================
--- haiku/trunk/src/apps/icon-o-matic/Jamfile	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/apps/icon-o-matic/Jamfile	2009-08-19 14:17:13 UTC (rev 32521)
@@ -305,12 +305,3 @@
 
 	: Icon-O-Matic.rdef
 ;
-
-
-
-# also install in app_server test environment
-if ( $(TARGET_PLATFORM) = libbe_test ) {
-	HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : Icon-O-Matic
-		: tests!apps ;
-}
-

Modified: haiku/trunk/src/kits/Jamfile
===================================================================
--- haiku/trunk/src/kits/Jamfile	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/Jamfile	2009-08-19 14:17:13 UTC (rev 32521)
@@ -18,13 +18,8 @@
 }
 
 UsePrivateHeaders [ FDirName kernel ]   # For KMessage.h
-UsePrivateHeaders syslog_daemon ;		# For syslog.cpp
+#UsePrivateHeaders syslog_daemon ;		# For syslog.cpp
 
-local pngDump ;
-if $(TARGET_PLATFORM) != haiku {
-	pngDump = libpng.so libz.so ;
-}
-
 # Build our libbe.so
 
 AddResources libbe.so : libbe_version.rdef ;
@@ -42,31 +37,16 @@
 	libagg.a
 
 	libroot.so	# make sure it links against our libroot.so
-	$(pngDump) # For dumping the screen to PNG in the Interface Kit on R5
 	$(TARGET_LIBSTDC++)
 ;
 
-# Build libbe_haiku.so
+# Build libbe_test.so
 
-SetSupportedPlatformsForTarget libbe_haiku.so : libbe_test ;
+SetSupportedPlatformsForTarget libbe_test.so : libbe_test ;
 
-if $(TARGET_PLATFORM) = libbe_test {
-	local syslog = [ FGristFiles syslog.o ] ;
-	# Remove _NO_INLINE_ASM from the defines for syslog.cpp. Otherwise we get
-	# references to tls_get/set() etc. that don't exist under BeOS.
-	TARGET_DEFINES on $(syslog)
-		= [ on $(syslog) FFilter $(TARGET_DEFINES) : _NO_INLINE_ASM ] ;
+SetVersionScript libbe_test.so : libbe_test_versions ;
 
-	# We need to use our &lt;syslog.h&gt;, because the syslog() prototype differs
-	# from the BeOS one.
-	TARGET_DEFINES on $(syslog) += _SYS_LOG_H ;
-	TARGET_C++FLAGS on $(syslog) = [ on $(syslog) return $(TARGET_C++FLAGS) ]
-		-include [ FDirName $(HAIKU_TOP) headers posix syslog.h ] ;
-}
-
-SharedLibrary libbe_haiku.so :
-	KMessage.cpp
-	syslog.cpp
+SharedLibrary libbe_test.so :
 	:
 	&lt;libbe&gt;app_kit.o
 	&lt;libbe&gt;interface_kit.o
@@ -76,18 +56,16 @@
 	libicon.a
 	libagg.a
 
-	libbeadapter.so
-	$(TARGET_NETWORK_LIBS)
 	$(TARGET_LIBSTDC++)
 ;
 
-SEARCH on [ FGristFiles KMessage.cpp ]
-	= [ FDirName $(HAIKU_TOP) src system kernel messaging ] ;
+#SEARCH on [ FGristFiles KMessage.cpp ]
+#	= [ FDirName $(HAIKU_TOP) src system kernel messaging ] ;
+#
+#SEARCH on [ FGristFiles syslog.cpp ]
+#	= [ FDirName $(HAIKU_TOP) src system libroot posix ] ;
 
-SEARCH on [ FGristFiles syslog.cpp ]
-	= [ FDirName $(HAIKU_TOP) src system libroot posix ] ;
 
-
 SubInclude HAIKU_TOP src kits app ;
 SubInclude HAIKU_TOP src kits bluetooth ;
 SubInclude HAIKU_TOP src kits debug ;

Modified: haiku/trunk/src/kits/app/RegistrarDefs.cpp
===================================================================
--- haiku/trunk/src/kits/app/RegistrarDefs.cpp	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/app/RegistrarDefs.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -1,11 +1,12 @@
 /*
- * Copyright 2001-2005, Haiku.
+ * Copyright 2001-2009, Haiku.
  * Distributed under the terms of the MIT License.
  *
  * Authors:
  *		Ingo Weinhold (<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at users.sf.net</A>)
  */
 
+
 //! API classes - registrar interface.
 
 
@@ -16,18 +17,27 @@
 namespace BPrivate {
 
 // names
-const char *kRegistrarSignature	= &quot;application/x-vnd.haiku-registrar&quot;;
-const char *kRosterThreadName	= &quot;_roster_thread_&quot;;
-const char *kRAppLooperPortName	= &quot;rAppLooperPort&quot;;
+#ifdef HAIKU_TARGET_PLATFORM_HAIKU
+const char* kRegistrarSignature = &quot;application/x-vnd.haiku-registrar&quot;;
+const char* kRAppLooperPortName = &quot;rAppLooperPort&quot;;
+#else
+const char* kRegistrarSignature = &quot;application/x-vnd.test-registrar&quot;;
+const char* kRAppLooperPortName = &quot;haiku-test:rAppLooperPort&quot;;
+#endif
+const char* kRosterThreadName = &quot;_roster_thread_&quot;;
 
-// get_roster_port_name
+
 /*!	\brief Returns the name of the main request port of the registrar (roster).
 	\return the name of the registrar request port.
 */
-const char *
+const char*
 get_roster_port_name()
 {
-	return &quot;_haiku_roster_port_&quot;;
+#ifdef HAIKU_TARGET_PLATFORM_HAIKU
+	return &quot;system:roster&quot;;
+#else
+	return &quot;haiku-test:roster&quot;;
+#endif
 }
 
 }	// namespace BPrivate

Added: haiku/trunk/src/kits/libbe_test_versions
===================================================================
--- haiku/trunk/src/kits/libbe_test_versions	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/libbe_test_versions	2009-08-19 14:17:13 UTC (rev 32521)
@@ -0,0 +1,6 @@
+LIBBE_TEST_BASE {
+};
+LIBBE_TEST {
+	global:
+		*;
+};

Modified: haiku/trunk/src/kits/storage/Directory.cpp
===================================================================
--- haiku/trunk/src/kits/storage/Directory.cpp	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/storage/Directory.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -997,8 +997,13 @@
 // #pragma mark - symbol versions
 
 
-#if __GNUC__ == 2	// gcc 2
+#ifdef HAIKU_TARGET_PLATFORM_LIBBE_TEST
 
+B_DEFINE_SYMBOL_VERSION(&quot;_GetStatFor__C10BDirectoryPCcP4stat&quot;,
+	&quot;GetStatFor__C10BDirectoryPCcP4stat@@LIBBE_TEST&quot;);
+
+#elif __GNUC__ == 2	// gcc 2
+
 // BeOS compatible GetStatFor()
 B_DEFINE_SYMBOL_VERSION(&quot;_GetStatFor__C10BDirectoryPCcP9stat_beos&quot;,
 	&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">GetStatFor__C10BDirectoryPCcP4stat at LIBBE_BASE</A>&quot;);

Modified: haiku/trunk/src/kits/storage/Entry.cpp
===================================================================
--- haiku/trunk/src/kits/storage/Entry.cpp	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/storage/Entry.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -1130,8 +1130,13 @@
 // #pragma mark - symbol versions
 
 
-#if __GNUC__ == 2	// gcc 2
+#ifdef HAIKU_TARGET_PLATFORM_LIBBE_TEST
 
+B_DEFINE_SYMBOL_VERSION(&quot;_GetStat__C6BEntryP4stat&quot;,
+	&quot;GetStat__C6BEntryP4stat@@LIBBE_TEST&quot;);
+
+#elif __GNUC__ == 2	// gcc 2
+
 // BeOS compatible GetStat()
 B_DEFINE_SYMBOL_VERSION(&quot;_GetStat__C6BEntryP9stat_beos&quot;,
 	&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">GetStat__C6BEntryP4stat at LIBBE_BASE</A>&quot;);

Modified: haiku/trunk/src/kits/storage/Jamfile
===================================================================
--- haiku/trunk/src/kits/storage/Jamfile	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/storage/Jamfile	2009-08-19 14:17:13 UTC (rev 32521)
@@ -75,7 +75,7 @@
 	MutablePartition.cpp
 	Partition.cpp
 	PartitionDelegate.cpp
-	PartitioningInfo.cpp 
+	PartitioningInfo.cpp
 	PartitionParameterEditor.cpp
 	PartitionReference.cpp
 
@@ -89,12 +89,3 @@
 	SetStringJob.cpp
 	UninitializeJob.cpp
 ;
-
-
-# The adapter library we need (Storage Kit).
-#
-
-SharedLibrary libbeadapter.so :
-	LibBeAdapter.cpp
-;
-LinkAgainst libbeadapter.so : be : false ;

Deleted: haiku/trunk/src/kits/storage/LibBeAdapter.cpp

Modified: haiku/trunk/src/kits/storage/Node.cpp
===================================================================
--- haiku/trunk/src/kits/storage/Node.cpp	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/storage/Node.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -863,8 +863,13 @@
 // #pragma mark - symbol versions
 
 
-#if __GNUC__ == 2	// gcc 2
+#ifdef HAIKU_TARGET_PLATFORM_LIBBE_TEST
 
+B_DEFINE_SYMBOL_VERSION(&quot;_GetStat__C5BNodeP4stat&quot;,
+	&quot;GetStat__C5BNodeP4stat@@LIBBE_TEST&quot;);
+
+#elif __GNUC__ == 2	// gcc 2
+
 // BeOS compatible GetStat()
 B_DEFINE_SYMBOL_VERSION(&quot;_GetStat__C5BNodeP9stat_beos&quot;,
 	&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">GetStat__C5BNodeP4stat at LIBBE_BASE</A>&quot;);

Modified: haiku/trunk/src/kits/storage/Volume.cpp
===================================================================
--- haiku/trunk/src/kits/storage/Volume.cpp	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/storage/Volume.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -1,5 +1,5 @@
 /*
- * Copyright 2002-2008, Haiku Inc. All Rights Reserved.
+ * Copyright 2002-2009, Haiku Inc. All Rights Reserved.
  * Distributed under the terms of the MIT License.
  *
  * Authors:
@@ -25,9 +25,7 @@
 #include &lt;storage_support.h&gt;
 #include &lt;syscalls.h&gt;
 
-#ifndef HAIKU_TARGET_PLATFORM_LIBBE_TEST
-#	include &lt;fs_interface.h&gt;
-#endif
+#include &lt;fs_interface.h&gt;
 
 
 /*!

Modified: haiku/trunk/src/kits/tracker/FSUtils.cpp
===================================================================
--- haiku/trunk/src/kits/tracker/FSUtils.cpp	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/kits/tracker/FSUtils.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -545,7 +545,7 @@
 		if (gStatusWindow)
 			gStatusWindow-&gt;RemoveStatusItem(thread);
 
-		BAlert *alert = new BAlert(&quot;&quot;, 
+		BAlert *alert = new BAlert(&quot;&quot;,
 			&quot;You can't move or copy items to read-only volumes.&quot;,
 			&quot;Cancel&quot;, 0, 0, B_WIDTH_AS_USUAL, B_WARNING_ALERT);
 		alert-&gt;SetShortcut(0, B_ESCAPE);
@@ -1735,7 +1735,7 @@
 		const char *verb = (moveMode == kMoveSelectionTo) ? &quot;moving&quot; : &quot;copying&quot;;
 		char replaceMsg[256];
 		sprintf(replaceMsg, kReplaceManyStr, verb, verb);
-		
+
 		BAlert *alert = new BAlert(&quot;&quot;, replaceMsg,
 			&quot;Cancel&quot;, &quot;Prompt&quot;, &quot;Replace All&quot;);
 		alert-&gt;SetShortcut(0, B_ESCAPE);
@@ -2950,21 +2950,12 @@
 
 extern &quot;C&quot; char** environ;
 
-#ifdef HAIKU_TARGET_PLATFORM_HAIKU
 extern &quot;C&quot; status_t _kern_load_image(const char * const *flatArgs,
 	size_t flatArgsSize, int32 argCount, int32 envCount, int32 priority,
 	uint32 flags, port_id errorPort, uint32 errorToken);
 extern &quot;C&quot; status_t __flatten_process_args(const char * const *args,
 	int32 argCount, const char * const *env, int32 envCount, char ***_flatArgs,
 	size_t *_flatSize);
-#else
-extern &quot;C&quot;
-#	if !B_BEOS_VERSION_DANO
-_IMPEXP_ROOT
-#	endif
-status_t _kload_image_etc_(int argc, char **argv, char **envp,
-	char *buf, int bufsize);
-#endif
 
 
 static status_t
@@ -2979,7 +2970,6 @@
 
 	char *argv[2] = { const_cast&lt;char *&gt;(path.Path()), 0};
 
-#ifdef HAIKU_TARGET_PLATFORM_HAIKU
 	port_id errorPort = create_port(1, &quot;Tracker loader error&quot;);
 
 	// count environment variables
@@ -3063,11 +3053,6 @@
 	}
 
 	return B_OK;
-#else
-	result = _kload_image_etc_(1, argv, environ, details.LockBuffer(1024), 1024);
-	details.UnlockBuffer();
-#endif
-	return B_OK;
 }
 
 

Modified: haiku/trunk/src/servers/app/DesktopSettings.cpp
===================================================================
--- haiku/trunk/src/servers/app/DesktopSettings.cpp	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/servers/app/DesktopSettings.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -288,9 +288,13 @@
 status_t
 DesktopSettingsPrivate::Save(uint32 mask)
 {
+#if TEST_MODE
+	return B_OK;
+#endif
+
 	BPath basePath;
 	status_t status = _GetPath(basePath);
-	if (status &lt; B_OK)
+	if (status != B_OK)
 		return status;
 
 	if (mask &amp; kWorkspacesSettings) {

Modified: haiku/trunk/src/tests/servers/app/Jamfile
===================================================================
--- haiku/trunk/src/tests/servers/app/Jamfile	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/tests/servers/app/Jamfile	2009-08-19 14:17:13 UTC (rev 32521)
@@ -40,7 +40,7 @@
 	RGBColor.cpp
 	UpdateQueue.cpp
 
-	: libhaikuappserver.so be
+	: libtestappserver.so
 ;
 
 
@@ -56,10 +56,10 @@
 	MultiLocker.cpp
 
 #	trace.c
-	: be libhwinterface.so
+	: libhwinterface.so
 ;
 
-SharedLibrary libhaikuappserver.so :
+SharedLibrary libtestappserver.so :
 	Angle.cpp
 	ClientMemoryAllocator.cpp
 	CursorData.cpp
@@ -94,9 +94,9 @@
 	: be libpainter.a libtextencoding.so libfreetype.so libshared.a
 ;
 
-AddResources haiku_app_server : app_server.rdef ;
+AddResources test_app_server : app_server.rdef ;
 
-Server haiku_app_server :
+Server test_app_server :
 	# Misc. Sources
 	Decorator.cpp
 	ProfileMessageSupport.cpp
@@ -141,19 +141,19 @@
 
 	# libraries
 	:
-	z libpng.so libhaikuappserver.so libpainter.a be
+	z libtestappserver.so libpainter.a be
 	libhwinterface.so libhwinterfaceimpl.so
 	libagg.a libfreetype.so libtextencoding.so
 ;
 
 # install in the test dir
 HaikuInstall install-test-apps : $(HAIKU_APP_TEST_LIB_DIR)
-	: libpng.so libhaikuappserver.so libbe_haiku.so libbeadapter.so
+	: libtestappserver.so libbe_test.so
 	  libhwinterface.so libhwinterfaceimpl.so libfreetype.so
 	  libtextencoding.so
 	: tests!apps ;
 
-HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : haiku_app_server
+HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : test_app_server
 	: tests!apps ;
 
 } # if $(TARGET_PLATFORM) = libbe_test

Modified: haiku/trunk/src/tests/servers/app/NOTES
===================================================================
--- haiku/trunk/src/tests/servers/app/NOTES	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/tests/servers/app/NOTES	2009-08-19 14:17:13 UTC (rev 32521)
@@ -1,11 +1,11 @@
-For the tests to run properly on BeOS, you need to prepare a few things.
+For the test_app_server to run properly on Haiku, you need to prepare a few things.
 
 There is a pseudo target &quot;install-test-apps&quot; which needs to be built like this:
 
 $ TARGET_PLATFORM=libbe_test jam install-test-apps
 
-This will build &quot;haiku_registrar&quot;, &quot;haiku_app_server&quot;, the needed libs and some test apps and install everything into &quot;generated/tests/apps&quot;.
+This will build &quot;test_registrar&quot;, &quot;test_app_server&quot;, the needed libs and some test apps and install everything into &quot;generated/tests/apps&quot;.
 
-Each test app folder contains a script &quot;run&quot;, which launches the Haiku app_server and a second later the test app which connects to it.
+You can use the &quot;run&quot; script in this folder to run the servers, as well as open the test app folder in Tracker (via the -o option), or launch specific test app(s) by specifying their name in the command line, for example &quot;run WindowInvalidation&quot;.
 
 Have fun!

Deleted: haiku/trunk/src/tests/servers/app/archived_view/run

Deleted: haiku/trunk/src/tests/servers/app/async_drawing/run

Deleted: haiku/trunk/src/tests/servers/app/benchmark/run

Deleted: haiku/trunk/src/tests/servers/app/bitmap_bounds/run

Deleted: haiku/trunk/src/tests/servers/app/bitmap_drawing/run

Deleted: haiku/trunk/src/tests/servers/app/constrain_clipping_region/run

Deleted: haiku/trunk/src/tests/servers/app/copy_bits/run

Deleted: haiku/trunk/src/tests/servers/app/draw_after_children/run

Deleted: haiku/trunk/src/tests/servers/app/find_view/run

Deleted: haiku/trunk/src/tests/servers/app/following/run

Deleted: haiku/trunk/src/tests/servers/app/lagging_get_mouse/run

Deleted: haiku/trunk/src/tests/servers/app/playground/run

Deleted: haiku/trunk/src/tests/servers/app/resize_limits/run

Added: haiku/trunk/src/tests/servers/app/run
===================================================================
--- haiku/trunk/src/tests/servers/app/run	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/tests/servers/app/run	2009-08-19 14:17:13 UTC (rev 32521)
@@ -0,0 +1,28 @@
+#!/bin/sh
+
+BASE=../../../../generated/tests/libbe_test/x86/apps
+
+if [ ! -f $BASE/test_app_server ]; then
+	echo &quot;You need to \&quot;TARGET_PLATFORM=libbe_test jam install-test-apps\&quot; first.&quot;
+	exit
+fi
+
+# launch registrar
+$BASE/run_test_registrar || exit
+
+# launch app_server
+$BASE/test_app_server &amp;
+
+if [ &quot;$#&quot; -eq 0 ]; then
+	# no argument given, don't start any apps
+	exit
+elif [ &quot;$1&quot; = &quot;-o&quot; ]; then
+	open $BASE
+	shift
+fi
+
+sleep 1
+
+for i in $@; do
+	$BASE/$i &amp;
+done


Property changes on: haiku/trunk/src/tests/servers/app/run
___________________________________________________________________
Name: svn:executable
   + *

Deleted: haiku/trunk/src/tests/servers/app/scrollbar/run

Deleted: haiku/trunk/src/tests/servers/app/scrolling/run

Deleted: haiku/trunk/src/tests/servers/app/statusbar/run

Deleted: haiku/trunk/src/tests/servers/app/stress_test/run

Deleted: haiku/trunk/src/tests/servers/app/textview/run

Modified: haiku/trunk/src/tests/servers/registrar/Jamfile
===================================================================
--- haiku/trunk/src/tests/servers/registrar/Jamfile	2009-08-19 14:16:45 UTC (rev 32520)
+++ haiku/trunk/src/tests/servers/registrar/Jamfile	2009-08-19 14:17:13 UTC (rev 32521)
@@ -24,8 +24,8 @@
 
 SetSubDirSupportedPlatforms libbe_test ;
 
-SimpleTest run_haiku_registrar
-	: run_haiku_registrar.cpp
+SimpleTest run_test_registrar
+	: run_test_registrar.cpp
 	: be
 ;
 
@@ -68,7 +68,7 @@
 SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src servers registrar ] ;
 SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src servers registrar mime ] ;
 
-Server haiku_registrar
+Server test_registrar
  	:
 	AppInfoList.cpp
 	AppInfoListMessagingTargetSet.cpp
@@ -120,8 +120,8 @@
 ;
 
 if $(TARGET_PLATFORM) = libbe_test {
-	HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : haiku_registrar
+	HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : test_registrar
 		: tests!apps ;
-	HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : run_haiku_registrar
+	HaikuInstall install-test-apps : $(HAIKU_APP_TEST_DIR) : run_test_registrar
 		: tests!apps ;
 }

Deleted: haiku/trunk/src/tests/servers/registrar/run_haiku_registrar.cpp

Copied: haiku/trunk/src/tests/servers/registrar/run_test_registrar.cpp (from rev 32489, haiku/trunk/src/tests/servers/registrar/run_haiku_registrar.cpp)
===================================================================
--- haiku/trunk/src/tests/servers/registrar/run_haiku_registrar.cpp	2009-08-18 07:24:34 UTC (rev 32489)
+++ haiku/trunk/src/tests/servers/registrar/run_test_registrar.cpp	2009-08-19 14:17:13 UTC (rev 32521)
@@ -0,0 +1,97 @@
+/*
+ * Copyright 2005-2009, Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de.</A>
+ * Distributed under the terms of the MIT License.
+ */
+
+
+#include &lt;OS.h&gt;
+#include &lt;image.h&gt;
+#include &lt;Entry.h&gt;
+#include &lt;Query.h&gt;
+#include &lt;Path.h&gt;
+#include &lt;Volume.h&gt;
+#include &lt;fs_info.h&gt;
+
+#include &lt;stdio.h&gt;
+#include &lt;string.h&gt;
+#include &lt;stdlib.h&gt;
+
+
+extern const char* __progname;
+
+
+int
+main()
+{
+	team_info teamInfo;
+	int32 cookie = 0;
+	while (get_next_team_info(&amp;cookie, &amp;teamInfo) == B_OK) {
+		if (!strncmp(teamInfo.args, &quot;/boot/beos/&quot;, 11)) {
+			// this is a system component and not worth to investigate
+			continue;
+		}
+
+		thread_info threadInfo;
+		int32 threadCookie = 0;
+		while (get_next_thread_info(teamInfo.team, &amp;threadCookie, &amp;threadInfo)
+				== B_OK) {
+			// search for the roster thread
+			if (!strcmp(threadInfo.name, &quot;_roster_thread_&quot;)) {
+				port_id port = find_port(&quot;haiku-test:roster&quot;);
+				port_info portInfo;
+				if (get_port_info(port, &amp;portInfo) == B_OK
+					&amp;&amp; portInfo.team == teamInfo.team) {
+					puts(&quot;The Haiku Registrar is already running.&quot;);
+					return 0;
+				}
+			}
+		}
+	}
+
+	// the Haiku registrar doesn't seem to run yet, change this
+
+	BPath currentPath(&quot;.&quot;);
+
+	BQuery query;
+	query.SetPredicate(&quot;name==test_registrar&quot;);
+
+	// search on current volume only
+	dev_t device = dev_for_path(&quot;.&quot;);
+	BVolume volume(device);
+
+	query.SetVolume(&amp;volume);
+	query.Fetch();
+
+	entry_ref ref;
+	while (query.GetNextRef(&amp;ref) == B_OK) {
+		BPath path(&amp;ref);
+		if (path.InitCheck() != B_OK)
+			continue;
+
+		const char* registrarPath = path.Path();
+		const char* generatedPath = strstr(registrarPath, &quot;generated&quot;);
+		if (generatedPath == NULL)
+			continue;
+
+		if (!strncmp(currentPath.Path(), registrarPath, generatedPath - registrarPath)) {
+			// gotcha!
+			const char* args[] = { registrarPath, NULL };
+			thread_id thread = load_image(1, args, (const char**)environ);
+			if (thread &lt; B_OK) {
+				fprintf(stderr, &quot;%s: Could not start the registrar: %s\n&quot;,
+					__progname, strerror(thread));
+				return -1;
+			}
+
+			resume_thread(thread);
+			return 0;
+		}
+	}
+
+	fprintf(stderr, &quot;%s: Could not find the Haiku Registrar.\n&quot;
+		&quot;    (This tool only works when used in the Haiku tree, but maybe\n&quot;
+		&quot;    the registrar just needs to be built.)\n&quot;,
+		__progname);
+	return -1;
+}
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019581.html">[Haiku-commits] r32520 - haiku/trunk/src/kits/tracker
</A></li>
	<LI>Next message: <A HREF="019584.html">[Haiku-commits] r32521 - in haiku/trunk: build/jam headers/private/app src/apps/drivesetup src/apps/icon-o-matic src/kits src/kits/app src/kits/storage src/kits/tracker src/servers/app src/tests/servers/app src/tests/servers/app/archived_view src/tests/servers/app/async_drawing  src/tests/servers/app/benchmark src/tests/servers/app/bitmap_bounds src/tests/servers/app/bitmap_drawing src/tests/servers/app/constrain_clipping_region src/tests/servers/app/copy_bits src/tests/servers/app/draw_after_children src/tests/servers/app/find_view  src/tests/servers/app/following src/tests/servers/app/lagging_get_mouse src/tests/servers/app/playground  src/tests/servers/app/resize_limits src/tests/servers/app/scrollbar src/tests/servers/app/scrolling src/tests/servers/app/statusbar src/tests/servers/app/stress_test src/tests/servers/app/textview  src/tests/servers/registrar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19582">[ date ]</a>
              <a href="thread.html#19582">[ thread ]</a>
              <a href="subject.html#19582">[ subject ]</a>
              <a href="author.html#19582">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
