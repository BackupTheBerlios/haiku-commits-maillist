<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r32278 - in	haiku/branches/components/gsoc-locale-kit: headers/os/locale	src/kits/locale src/preferences/locale
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32278%20-%20in%0A%09haiku/branches/components/gsoc-locale-kit%3A%20headers/os/locale%0A%09src/kits/locale%20src/preferences/locale&In-Reply-To=%3C200908121419.n7CEJI8e006914%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019051.html">
   <LINK REL="Next"  HREF="019053.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r32278 - in	haiku/branches/components/gsoc-locale-kit: headers/os/locale	src/kits/locale src/preferences/locale</H1>
    <B>pulkomandy at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32278%20-%20in%0A%09haiku/branches/components/gsoc-locale-kit%3A%20headers/os/locale%0A%09src/kits/locale%20src/preferences/locale&In-Reply-To=%3C200908121419.n7CEJI8e006914%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r32278 - in	haiku/branches/components/gsoc-locale-kit: headers/os/locale	src/kits/locale src/preferences/locale">pulkomandy at mail.berlios.de
       </A><BR>
    <I>Wed Aug 12 16:19:18 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019051.html">[Haiku-commits] r32277 - haiku/trunk/src/system/libroot/os/arch/arm
</A></li>
        <LI>Next message: <A HREF="019053.html">[Haiku-commits] r32279 - haiku/trunk/src/bin/rc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19052">[ date ]</a>
              <a href="thread.html#19052">[ thread ]</a>
              <a href="subject.html#19052">[ subject ]</a>
              <a href="author.html#19052">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pulkomandy
Date: 2009-08-12 16:19:17 +0200 (Wed, 12 Aug 2009)
New Revision: 32278
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=32278&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=32278&amp;view=rev</A>

Modified:
   haiku/branches/components/gsoc-locale-kit/headers/os/locale/Country.h
   haiku/branches/components/gsoc-locale-kit/headers/os/locale/LocaleRoster.h
   haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp
   haiku/branches/components/gsoc-locale-kit/src/preferences/locale/LocaleWindow.cpp
   haiku/branches/components/gsoc-locale-kit/src/preferences/locale/TimeFormatSettingsView.cpp
Log:
Cleanup and style fixing.


Modified: haiku/branches/components/gsoc-locale-kit/headers/os/locale/Country.h
===================================================================
--- haiku/branches/components/gsoc-locale-kit/headers/os/locale/Country.h	2009-08-12 14:17:05 UTC (rev 32277)
+++ haiku/branches/components/gsoc-locale-kit/headers/os/locale/Country.h	2009-08-12 14:19:17 UTC (rev 32278)
@@ -33,33 +33,34 @@
 
 		// date &amp; time
 
-		virtual void	FormatDate(char* string,size_t maxSize,time_t time,
+		virtual void FormatDate(char* string, size_t maxSize, time_t time,
 			bool longFormat);
-		virtual void	FormatDate(BString* string,time_t time,bool longFormat);
-		virtual void	FormatTime(char* string,size_t maxSize,time_t time,
+		virtual void FormatDate(BString* string, time_t time, bool longFormat);
+		virtual void FormatTime(char* string, size_t maxSize, time_t time,
 			bool longFormat);
-		virtual void	FormatTime(BString* string,time_t time,bool longFormat);
+		virtual void FormatTime(BString* string, time_t time,
+			bool longFormat);
 
-		const char*		DateFormat(bool longFormat) const;
-		void			SetDateFormat(const char* formatString, 
-							bool longFormat = true);
-		const char*		TimeFormat(bool longFormat) const;
-		const char*		DateSeparator() const;
-		const char*		TimeSeparator() const;
+		const char*	DateFormat(bool longFormat) const;
+		void		SetDateFormat(const char* formatString,
+						bool longFormat = true);
+		const char*	TimeFormat(bool longFormat) const;
+		const char*	DateSeparator() const;
+		const char*	TimeSeparator() const;
 
 		// numbers
 
-		virtual void	FormatNumber(char* string,size_t maxSize,double value);
-		virtual void	FormatNumber(BString* string,double value);
-		virtual void	FormatNumber(char* string,size_t maxSize,int32 value);
-		virtual void	FormatNumber(BString* string,int32 value);
+		virtual void FormatNumber(char* string, size_t maxSize, double value);
+		virtual void FormatNumber(BString* string, double value);
+		virtual void FormatNumber(char* string, size_t maxSize, int32 value);
+		virtual void FormatNumber(BString* string, int32 value);
 
-		const char*		DecimalPoint() const;
-		const char*		ThousandsSeparator() const;
-		const char*		Grouping() const;
+		const char*	DecimalPoint() const;
+		const char*	ThousandsSeparator() const;
+		const char*	Grouping() const;
 
-		const char*		PositiveSign() const;
-		const char*		NegativeSign() const;
+		const char*	PositiveSign() const;
+		const char*	NegativeSign() const;
 
 		// measurements
 
@@ -71,11 +72,11 @@
 			double value);
 		virtual ssize_t	FormatMonetary(BString* string, double value);
 
-		const char*		CurrencySymbol() const;
-		const char*		InternationalCurrencySymbol() const;
-		const char*		MonDecimalPoint() const;
-		const char*		MonThousandsSeparator() const;
-		const char*		MonGrouping() const;
+		const char*	CurrencySymbol() const;
+		const char*	InternationalCurrencySymbol() const;
+		const char*	MonDecimalPoint() const;
+		const char*	MonThousandsSeparator() const;
+		const char*	MonGrouping() const;
 		virtual int32	MonFracDigits() const;
 
 	private:

Modified: haiku/branches/components/gsoc-locale-kit/headers/os/locale/LocaleRoster.h
===================================================================
--- haiku/branches/components/gsoc-locale-kit/headers/os/locale/LocaleRoster.h	2009-08-12 14:17:05 UTC (rev 32277)
+++ haiku/branches/components/gsoc-locale-kit/headers/os/locale/LocaleRoster.h	2009-08-12 14:19:17 UTC (rev 32278)
@@ -33,11 +33,12 @@
 //		status_t GetCatalog(const char *mimeType, BCatalog *catalog);
 //		status_t SetCatalog(BLocale *,const char *mimeType, BCatalog *catalog);
 
-//		status_t GetLocaleFor(const char *langCode,const char *countryCode);
+//		status_t GetLocaleFor(const char *langCode, const char *countryCode);
 
 		status_t GetDefaultCollator(BCollator **) const;
 		status_t GetDefaultLanguage(BLanguage **) const;
 		status_t GetDefaultCountry(BCountry **) const;
+		void SetDefaultCountry(BCountry *) const;
 
 		status_t GetPreferredLanguages(BMessage *) const;
 		status_t SetPreferredLanguages(BMessage *);

Modified: haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp	2009-08-12 14:17:05 UTC (rev 32277)
+++ haiku/branches/components/gsoc-locale-kit/src/kits/locale/LocaleRoster.cpp	2009-08-12 14:19:17 UTC (rev 32278)
@@ -150,6 +150,7 @@
 	BList fCatalogAddOnInfos;
 	BMessage fPreferredLanguages;
 	BString fCountryCodeName;
+	BString fCountryDateFormat;
 
 	RosterData();
 	~RosterData();
@@ -441,11 +442,22 @@
 	BAutolock lock(gRosterData.fLock);
 	assert(lock.IsLocked());
 
-	*country = new(std::nothrow) BCountry(gRosterData.fCountryCodeName.String());
+	*country = new(std::nothrow) BCountry(
+		gRosterData.fCountryCodeName.String());
+	if (gRosterData.fCountryDateFormat.Length() &gt; 0)
+		(*country)-&gt;SetDateFormat(gRosterData.fCountryDateFormat.String());
 	return B_OK;
 }
 
 
+void
+BLocaleRoster::SetDefaultCountry(BCountry * newDefault) const
+{
+	gRosterData.fCountryCodeName = newDefault-&gt;Code();
+	gRosterData.fCountryDateFormat = newDefault-&gt;DateFormat(true);
+}
+
+
 status_t
 BLocaleRoster::GetPreferredLanguages(BMessage *languages) const
 {
@@ -481,7 +493,6 @@
 	if (!languages)
 		return B_BAD_VALUE;
 
-	int32_t localeCount;
 	int32 i;
 	UnicodeString icuLanguageName;
 	BString languageName;
@@ -496,8 +507,9 @@
 		languageSet.insert(BString(icuLocaleList[i]));
 	}
 #else
-	static const Locale* icuLocaleList =
-		Locale::getAvailableLocales(localeCount);
+	int32_t localeCount;
+	static const Locale* icuLocaleList
+		= Locale::getAvailableLocales(localeCount);
 
 	// Loop over the strings and add them to an std::set to remove duplicates
 	for (i = 0; i &lt; localeCount; i++) {

Modified: haiku/branches/components/gsoc-locale-kit/src/preferences/locale/LocaleWindow.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/preferences/locale/LocaleWindow.cpp	2009-08-12 14:17:05 UTC (rev 32277)
+++ haiku/branches/components/gsoc-locale-kit/src/preferences/locale/LocaleWindow.cpp	2009-08-12 14:19:17 UTC (rev 32278)
@@ -69,14 +69,13 @@
 	const char* text = Text();
 	BString truncatedString(text);
 	owner-&gt;TruncateString(&amp;truncatedString, B_TRUNCATE_MIDDLE,
-						  frame.Width() - TEXT_OFFSET - 4.0);
+		frame.Width() - TEXT_OFFSET - 4.0);
 	float height = frame.Height();
 	float textHeight = fh.ascent + fh.descent;
 	BPoint textPoint;
 	textPoint.x = frame.left + TEXT_OFFSET;
 	textPoint.y = frame.top
-				  + ceilf(height / 2.0 - textHeight / 2.0
-				  		  + fh.ascent);
+		+ ceilf(height / 2.0 - textHeight / 2.0 + fh.ascent);
 	owner-&gt;DrawString(truncatedString.String(), textPoint);
 }
 
@@ -112,7 +111,7 @@
 						BList items;
 						int32 index;
 						for (int32 i = 0; message-&gt;FindInt32(&quot;index&quot;, i, &amp;index)
-							   	== B_OK; i++)
+							 	== B_OK; i++)
 							if (BListItem* item = ItemAt(index))
 								items.AddItem((void*)item);
 
@@ -131,7 +130,7 @@
 						for (int32 i = 0; message-&gt;FindInt32(&quot;index&quot;, i, &amp;index)
 								== B_OK; i++)
 							if (BListItem* item = list-&gt;RemoveItem(index)) {
-								AddItem(item,fDropIndex);
+								AddItem(item, fDropIndex);
 								fDropIndex++;
 							}
 
@@ -347,7 +346,6 @@
 	BTabView *tabView = new BTabView(&quot;tabview&quot;);
 
 	// Language tab
-
 	BView *tab = new BView(TR(&quot;Language&quot;), B_WILL_DRAW);
 	tab-&gt;SetViewColor(tabView-&gt;ViewColor());
 	tab-&gt;SetLayout(new BGroupLayout(B_VERTICAL, 0));
@@ -357,7 +355,7 @@
 		// first list: available languages
 		LanguageListView *listView = new LanguageListView(&quot;available&quot;,
 			B_MULTIPLE_SELECTION_LIST);
-		BScrollView *scrollView = new BScrollView(&quot;scroller&quot;, listView, 
+		BScrollView *scrollView = new BScrollView(&quot;scroller&quot;, listView,
 			0, false, true, B_FANCY_BORDER);
 
 		// Fill the language list from the LocaleRoster data
@@ -378,13 +376,13 @@
 				BStringByteSink bbs(&amp;str);
 				currentLocale.getDisplayName(languageFullName);
 				languageFullName.toUTF8(bbs);
-				LanguageListItem* si = 
-					new LanguageListItem(str, currentLanguage.String());
+				LanguageListItem* si
+					= new LanguageListItem(str, currentLanguage.String());
 				listView-&gt;AddItem(si);
 			}
 
 		} else {
-			BAlert* myAlert = new BAlert(&quot;Error&quot;, 
+			BAlert* myAlert = new BAlert(&quot;Error&quot;,
 				TR(&quot;Unable to find the available languages! You can't use this&quot;
 					&quot;preflet!&quot;),
 				TR(&quot;Ok&quot;), NULL, NULL,
@@ -403,13 +401,13 @@
 		BMessage msg;
 		be_locale_roster-&gt;GetPreferredLanguages(&amp;msg);
 		BString langCode;
-		for (int index = 0; msg.FindString(&quot;language&quot;, index, &amp;langCode) 
+		for (int index = 0; msg.FindString(&quot;language&quot;, index, &amp;langCode)
 					== B_OK;
 				index++) {
 			for (int listPos = 0; LanguageListItem* lli
 					= static_cast&lt;LanguageListItem*&gt;(listView-&gt;ItemAt(listPos));
 					listPos++) {
-				if(langCode == lli-&gt;getLanguageCode()) {
+				if (langCode == lli-&gt;getLanguageCode()) {
 					fPreferredListView-&gt;AddItem(lli);
 					listView-&gt;RemoveItem(lli);
 				}
@@ -417,11 +415,11 @@
 		}
 
 		tab-&gt;AddChild(BGroupLayoutBuilder(B_HORIZONTAL, 10)
-			.Add(BGroupLayoutBuilder(B_VERTICAL,10)
+			.Add(BGroupLayoutBuilder(B_VERTICAL, 10)
 				.Add(new BStringView(&quot;&quot;, TR(&quot;Available languages&quot;)))
 				.Add(scrollView)
 			)
-			.Add(BGroupLayoutBuilder(B_VERTICAL,10)
+			.Add(BGroupLayoutBuilder(B_VERTICAL, 10)
 				.Add(new BStringView(&quot;&quot;, TR(&quot;Preferred languages&quot;)))
 				.Add(scrollViewEnabled)
 			)
@@ -430,7 +428,6 @@
 	}
 
 	// Country tab
-
 	tab = new BView(TR(&quot;Country&quot;), B_WILL_DRAW);
 	tab-&gt;SetViewColor(tabView-&gt;ViewColor());
 	tab-&gt;SetLayout(new BGroupLayout(B_VERTICAL, 0));
@@ -454,27 +451,27 @@
 		BCountry* defaultCountry;
 		be_locale_roster-&gt;GetDefaultCountry(&amp;defaultCountry);
 
-		for(int index = 0; index &lt; localeCount; index++)
+		for (int index = 0; index &lt; localeCount; index++)
 		{
 			UnicodeString countryFullName;
 			BString str;
 			BStringByteSink bbs(&amp;str);
 			currentLocale[index].getDisplayName(countryFullName);
 			countryFullName.toUTF8(bbs);
-			LanguageListItem* si = 
-				new LanguageListItem(str, currentLocale[index].getName());
+			LanguageListItem* si
+				= new LanguageListItem(str, currentLocale[index].getName());
 			listView-&gt;AddItem(si);
-			if (strcmp(currentLocale[index].getName(), 
+			if (strcmp(currentLocale[index].getName(),
 					defaultCountry-&gt;Code()) == 0)
 				listView-&gt;Select(listView-&gt;CountItems() - 1);
 		}
 
-		fTimeFormatSettings = 
-			new TimeFormatSettingsView(defaultCountry);
+		fTimeFormatSettings
+			= new TimeFormatSettingsView(defaultCountry);
 
-		tab-&gt;AddChild(BGroupLayoutBuilder(B_HORIZONTAL,5)
+		tab-&gt;AddChild(BGroupLayoutBuilder(B_HORIZONTAL, 5)
 			.Add(scrollView)
-			.Add(new BScrollView(&quot;advanced&quot;, fTimeFormatSettings, 0, 
+			.Add(new BScrollView(&quot;advanced&quot;, fTimeFormatSettings, 0,
 				false, true, B_NO_BORDER))
 		);
 
@@ -482,7 +479,6 @@
 	}
 
 	// check if the window is on screen
-
 	rect = BScreen().Frame();
 	rect.right -= 20;
 	rect.bottom -= 20;
@@ -519,6 +515,7 @@
 			(fPreferredListView-&gt;ItemAt(index))-&gt;getLanguageCode());
 		index++;
 	}
+	// TODO also save Country tab settings
 	be_app_messenger.SendMessage(&amp;update);
 
 	be_app_messenger.SendMessage(B_QUIT_REQUESTED);

Modified: haiku/branches/components/gsoc-locale-kit/src/preferences/locale/TimeFormatSettingsView.cpp
===================================================================
--- haiku/branches/components/gsoc-locale-kit/src/preferences/locale/TimeFormatSettingsView.cpp	2009-08-12 14:17:05 UTC (rev 32277)
+++ haiku/branches/components/gsoc-locale-kit/src/preferences/locale/TimeFormatSettingsView.cpp	2009-08-12 14:19:17 UTC (rev 32278)
@@ -42,10 +42,10 @@
 
 class DateMenuItem: public BMenuItem {
 	public:
-		DateMenuItem(const char* label, const char* code, BMenuField* field) 
+		DateMenuItem(const char* label, const char* code, BMenuField* field)
 			:
 			BMenuItem(label, MenuMessage(code, field))
-		{ 
+		{
 			icuCode = code;
 		}
 
@@ -64,7 +64,7 @@
 	// other things if you ever need.
 	menu-&gt;AddItem(dayMenu);
 		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day in month&quot;, &quot;d&quot;, *field));
-		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day in month (2 digits)&quot;, &quot;dd&quot;, 
+		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day in month (2 digits)&quot;, &quot;dd&quot;,
 			*field));
 		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day in year&quot;, &quot;D&quot;, *field));
 		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day in year (2 digits)&quot;, &quot;DD&quot;,
@@ -77,7 +77,7 @@
 		//	*field));
 		//dayMenu-&gt;AddItem(new DateMenuItem(&quot;day of week (full text)&quot;, &quot;eeee&quot;,
 		//	*field));
-		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day of week (short name)&quot;, &quot;E&quot;, 
+		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day of week (short name)&quot;, &quot;E&quot;,
 			*field));
 		dayMenu-&gt;AddItem(new DateMenuItem(&quot;day of week (name)&quot;, &quot;EEEE&quot;,
 			*field));
@@ -178,7 +178,7 @@
 		f12HrRadioButton = new BRadioButton(&quot;&quot;, &quot;12 Hour&quot;,
 				new BMessage(kSettingsContentsModified));
 
-		clockBox-&gt;AddChild(BGroupLayoutBuilder(B_VERTICAL,10)
+		clockBox-&gt;AddChild(BGroupLayoutBuilder(B_VERTICAL, 10)
 				.Add(f24HrRadioButton)
 				.Add(f12HrRadioButton)
 		);
@@ -251,7 +251,7 @@
 
 		.Add(currencyHeader)
 		.AddGlue()
-		.SetInsets(5,5,5,5)
+		.SetInsets(5, 5, 5, 5)
 	);
 }
 
@@ -279,7 +279,7 @@
 	for (int i = 0; i &lt; 4; i++)
 	{
 		fieldBegin = parsePointer;
-		while (*parsePointer == *(parsePointer+1)) parsePointer++ ;
+		while (*parsePointer == *(parsePointer + 1)) parsePointer++ ;
 		parsePointer++;
 		BString str;
 		str.Append(fieldBegin, parsePointer - fieldBegin);
@@ -306,8 +306,8 @@
 			fLongDateMenu[i]-&gt;MenuItem()-&gt;SetLabel(str.Append(&quot;*&quot;));
 
 		fieldBegin = parsePointer;
-		while ((!IsSpecialDateChar(*parsePointer)) &amp;&amp; *parsePointer != '\0' 
-				&amp;&amp; *(parsePointer-1) &gt;= 0) {
+		while ((!IsSpecialDateChar(*parsePointer)) &amp;&amp; *parsePointer != '\0'
+				&amp;&amp; *(parsePointer - 1) &gt;= 0) {
 			if (*parsePointer == '\'') {
 				parsePointer++;
 				while (*parsePointer != '\'') parsePointer++;
@@ -347,7 +347,7 @@
 		newDateFormat.Append(fLongDateSeparator[i]-&gt;Text());
 	}
 
-	// TODO create a &quot;custom&quot; country and save it ...
+	// TODO save this in the settings preflet and make the roster load it back
 	fCountry-&gt;SetDateFormat(newDateFormat.String());
 }
 
@@ -361,12 +361,12 @@
 			// Update one of the dropdown menus
 			void* pointerFromMessage;
 			message-&gt;FindPointer(&quot;dest&quot;,&amp;pointerFromMessage);
-			BMenuField* menuField =
-				static_cast&lt;BMenuField*&gt;(pointerFromMessage);
+			BMenuField* menuField
+			= static_cast&lt;BMenuField*&gt;(pointerFromMessage);
 			BString format;
 			message-&gt;FindString(&quot;format&quot;,&amp;format);
 
-			for (int i=0; i &lt; 4; i++) {
+			for (int i = 0; i &lt; 4; i++) {
 				if (fLongDateMenu[i]==menuField) {
 					fLongDateString[i] = format;
 					break;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019051.html">[Haiku-commits] r32277 - haiku/trunk/src/system/libroot/os/arch/arm
</A></li>
	<LI>Next message: <A HREF="019053.html">[Haiku-commits] r32279 - haiku/trunk/src/bin/rc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19052">[ date ]</a>
              <a href="thread.html#19052">[ thread ]</a>
              <a href="subject.html#19052">[ subject ]</a>
              <a href="author.html#19052">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
