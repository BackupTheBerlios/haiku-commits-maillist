<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r32069 - haiku/trunk/src/apps/haiku3d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32069%20-%20haiku/trunk/src/apps/haiku3d&In-Reply-To=%3C200908031055.n73AtM20020147%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018681.html">
   <LINK REL="Next"  HREF="018683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r32069 - haiku/trunk/src/apps/haiku3d</H1>
    <B>aldeck at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32069%20-%20haiku/trunk/src/apps/haiku3d&In-Reply-To=%3C200908031055.n73AtM20020147%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r32069 - haiku/trunk/src/apps/haiku3d">aldeck at mail.berlios.de
       </A><BR>
    <I>Mon Aug  3 12:55:22 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="018681.html">[Haiku-commits] r32068 - haiku/trunk/src/apps/mediaconverter
</A></li>
        <LI>Next message: <A HREF="018683.html">[Haiku-commits] r32070 - in	haiku/branches/components/gsoc-locale-kit:	headers/private/shared src/kits/locale src/preferences/locale	src/tools/locale
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18682">[ date ]</a>
              <a href="thread.html#18682">[ thread ]</a>
              <a href="subject.html#18682">[ subject ]</a>
              <a href="author.html#18682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aldeck
Date: 2009-08-03 12:55:13 +0200 (Mon, 03 Aug 2009)
New Revision: 32069
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=32069&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=32069&amp;view=rev</A>

Modified:
   haiku/trunk/src/apps/haiku3d/Mesh.h
   haiku/trunk/src/apps/haiku3d/MeshInstance.cpp
   haiku/trunk/src/apps/haiku3d/RenderView.cpp
   haiku/trunk/src/apps/haiku3d/Texture.cpp
   haiku/trunk/src/apps/haiku3d/Texture.h
Log:
* Style fixes
* Moved the wait_for_thread in _StopRenderThread()


Modified: haiku/trunk/src/apps/haiku3d/Mesh.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/Mesh.h	2009-08-03 10:33:52 UTC (rev 32068)
+++ haiku/trunk/src/apps/haiku3d/Mesh.h	2009-08-03 10:55:13 UTC (rev 32069)
@@ -29,7 +29,7 @@
 
 class Mesh : public Referenceable {
 public:
-	virtual	~Mesh();
+	virtual			~Mesh();
 
 	virtual Face&amp;	GetFace(uint32 index) const = 0;
 	virtual uint32	FaceCount() const = 0;

Modified: haiku/trunk/src/apps/haiku3d/MeshInstance.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/MeshInstance.cpp	2009-08-03 10:33:52 UTC (rev 32068)
+++ haiku/trunk/src/apps/haiku3d/MeshInstance.cpp	2009-08-03 10:55:13 UTC (rev 32069)
@@ -105,50 +105,50 @@
 
 		// draw face
 		glNormal3f(normal.x(), normal.y(),  normal.z());
-   		glTexCoord2f(face.v[0].u, face.v[0].v);
-   		glVertex3f(face.v[0].p.x(), face.v[0].p.y(),  face.v[0].p.z());
+		glTexCoord2f(face.v[0].u, face.v[0].v);
+		glVertex3f(face.v[0].p.x(), face.v[0].p.y(), face.v[0].p.z());
 
-   		glNormal3f(normal.x(), normal.y(),  normal.z());
-   		glTexCoord2f(face.v[1].u, face.v[1].v);
-   		glVertex3f(face.v[1].p.x(), face.v[1].p.y(),  face.v[1].p.z());
+		glNormal3f(normal.x(), normal.y(),  normal.z());
+		glTexCoord2f(face.v[1].u, face.v[1].v);
+		glVertex3f(face.v[1].p.x(), face.v[1].p.y(), face.v[1].p.z());
 
-   		glNormal3f(normal.x(), normal.y(),  normal.z());
-   		glTexCoord2f(face.v[2].u, face.v[2].v);
-   		glVertex3f(face.v[2].p.x(), face.v[2].p.y(),  face.v[2].p.z());
+		glNormal3f(normal.x(), normal.y(),  normal.z());
+		glTexCoord2f(face.v[2].u, face.v[2].v);
+		glVertex3f(face.v[2].p.x(), face.v[2].p.y(), face.v[2].p.z());
 
-   		if (face.vertexCount == 4) {
-   			glNormal3f(normal.x(), normal.y(),  normal.z());
-   			glTexCoord2f(face.v[3].u, face.v[3].v);
-   			glVertex3f(face.v[3].p.x(), face.v[3].p.y(),  face.v[3].p.z());
-   		}
+		if (face.vertexCount == 4) {
+			glNormal3f(normal.x(), normal.y(), normal.z());
+			glTexCoord2f(face.v[3].u, face.v[3].v);
+			glVertex3f(face.v[3].p.x(), face.v[3].p.y(), face.v[3].p.z());
+		}
 
-   		if (fDoubleSided) {
-	   		if (face.vertexCount == 4) {
-		   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
-		   		glTexCoord2f(face.v[3].u, face.v[3].v);
-		   		glVertex3f(face.v[3].p.x(), face.v[3].p.y(),  face.v[3].p.z());
-	   		}
+		if (fDoubleSided) {
+			if (face.vertexCount == 4) {
+				glNormal3f(-normal.x(), -normal.y(), -normal.z());
+				glTexCoord2f(face.v[3].u, face.v[3].v);
+				glVertex3f(face.v[3].p.x(), face.v[3].p.y(), face.v[3].p.z());
+			}
 
-	   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
-	   		glTexCoord2f(face.v[2].u, face.v[2].v);
-	   		glVertex3f(face.v[2].p.x(), face.v[2].p.y(),  face.v[2].p.z());
+			glNormal3f(-normal.x(), -normal.y(), -normal.z());
+			glTexCoord2f(face.v[2].u, face.v[2].v);
+			glVertex3f(face.v[2].p.x(), face.v[2].p.y(), face.v[2].p.z());
 
-	   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
-	   		glTexCoord2f(face.v[1].u, face.v[1].v);
-	   		glVertex3f(face.v[1].p.x(), face.v[1].p.y(),  face.v[1].p.z());
+			glNormal3f(-normal.x(), -normal.y(), -normal.z());
+			glTexCoord2f(face.v[1].u, face.v[1].v);
+			glVertex3f(face.v[1].p.x(), face.v[1].p.y(), face.v[1].p.z());
 
-	   		glNormal3f(-normal.x(), -normal.y(),  -normal.z());
-	   		glTexCoord2f(face.v[0].u, face.v[0].v);
-	   		glVertex3f(face.v[0].p.x(), face.v[0].p.y(),  face.v[0].p.z());
-   		}
-   		lastVertexCount = face.vertexCount;
+			glNormal3f(-normal.x(), -normal.y(), -normal.z());
+			glTexCoord2f(face.v[0].u, face.v[0].v);
+			glVertex3f(face.v[0].p.x(), face.v[0].p.y(), face.v[0].p.z());
+		}
+		lastVertexCount = face.vertexCount;
 	}
 	glEnd();
 	//printf(&quot;batchCount %d\n&quot;, batchCount);
 
-   	if (fDrawNormals) {
-   		glBegin(GL_LINES);
-	   	for(uint32 i = 0; i &lt; fMeshReference-&gt;FaceCount(); i++) {
+	if (fDrawNormals) {
+		glBegin(GL_LINES);
+		for(uint32 i = 0; i &lt; fMeshReference-&gt;FaceCount(); i++) {
 
 			const Face&amp; face = fMeshReference-&gt;GetFace(i);
 

Modified: haiku/trunk/src/apps/haiku3d/RenderView.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/RenderView.cpp	2009-08-03 10:33:52 UTC (rev 32068)
+++ haiku/trunk/src/apps/haiku3d/RenderView.cpp	2009-08-03 10:55:13 UTC (rev 32069)
@@ -39,10 +39,6 @@
 RenderView::~RenderView()
 {
 	_StopRenderThread();
-
-	if (fRenderThread &gt;= 0)
-		wait_for_thread(fRenderThread, NULL);
-
 	_DeleteScene();
 }
 
@@ -62,10 +58,9 @@
 uint32
 RenderView::_CreateRenderThread()
 {
-	fRenderThread = spawn_thread(RenderView::_RenderThreadEntry,
-								&quot;renderThread&quot;,
-								B_NORMAL_PRIORITY,
-								this);
+	fRenderThread = spawn_thread(RenderView::_RenderThreadEntry, &quot;renderThread&quot;,
+		B_NORMAL_PRIORITY, this);
+
 	if (fRenderThread &lt; 0)
 		return fRenderThread;
 
@@ -79,6 +74,9 @@
 	LockGL();
 	fStopRendering = true;
 	UnlockGL();
+
+	if (fRenderThread &gt;= 0)
+		wait_for_thread(fRenderThread, NULL);
 }
 
 
@@ -178,10 +176,9 @@
 		Quaternion(0, 0, 0, 1), 4.0f * timeSpacing);
 	fMeshInstances.push_back(instance);
 	mesh-&gt;ReleaseReference();
+	texture-&gt;ReleaseReference();
 
 	fMainCamera = new Camera(Vector3(0, 0, 0), Quaternion(0, 0, 0, 1), 50);
-
-	texture-&gt;ReleaseReference();
 }
 
 
@@ -200,7 +197,7 @@
 RenderView::_UpdateViewport()
 {
 	if (fNextRes != fRes &amp;&amp; fNextRes.x &gt;= 1.0 &amp;&amp; fNextRes.y &gt;= 1.0) {
-		glViewport(0, 0, (GLint)fNextRes.x + 1, (GLint)fNextRes.y + 1);
+		glViewport(0, 0, (GLint) fNextRes.x + 1, (GLint) fNextRes.y + 1);
 		fRes = fNextRes;
 		_UpdateCamera();
 	}
@@ -227,10 +224,10 @@
 	_UpdateViewport();
 
 	glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
-    glLoadIdentity();
+	glLoadIdentity();
 
-    bigtime_t time = system_time();
-    float deltaTime = 0.000001 * (float)(time - fLastFrameTime);
+	bigtime_t time = system_time();
+	float deltaTime = 0.000001 * (float)(time - fLastFrameTime);
 	fLastFrameTime = time;
 
 	MeshInstanceList::iterator it = fMeshInstances.begin();
@@ -243,7 +240,7 @@
 		UnlockGL();
 		return false;
 	}
-    UnlockGL();
+	UnlockGL();
 	SwapBuffers(false); // true = vsync
 	return true;
 }

Modified: haiku/trunk/src/apps/haiku3d/Texture.cpp
===================================================================
--- haiku/trunk/src/apps/haiku3d/Texture.cpp	2009-08-03 10:33:52 UTC (rev 32068)
+++ haiku/trunk/src/apps/haiku3d/Texture.cpp	2009-08-03 10:55:13 UTC (rev 32069)
@@ -32,3 +32,9 @@
 {
 	return fId;
 }
+
+
+void
+Texture::Update(float dt)
+{
+}

Modified: haiku/trunk/src/apps/haiku3d/Texture.h
===================================================================
--- haiku/trunk/src/apps/haiku3d/Texture.h	2009-08-03 10:33:52 UTC (rev 32068)
+++ haiku/trunk/src/apps/haiku3d/Texture.h	2009-08-03 10:55:13 UTC (rev 32069)
@@ -20,7 +20,7 @@
 
 	GLuint		 	Id();
 
-	virtual	void	Update(float dt) {};
+	virtual	void	Update(float dt);
 
 protected:
 	GLuint			fId;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018681.html">[Haiku-commits] r32068 - haiku/trunk/src/apps/mediaconverter
</A></li>
	<LI>Next message: <A HREF="018683.html">[Haiku-commits] r32070 - in	haiku/branches/components/gsoc-locale-kit:	headers/private/shared src/kits/locale src/preferences/locale	src/tools/locale
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18682">[ date ]</a>
              <a href="thread.html#18682">[ thread ]</a>
              <a href="subject.html#18682">[ subject ]</a>
              <a href="author.html#18682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
