<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r32594 - in haiku/trunk: build/jam	headers/private/kernel/boot/platform	headers/private/kernel/boot/platform/routerboard_mipsel	src/system/boot/platform src/system/boot/platform/routerboard_mipsel	src/system/kernel/platform	src/system/kernel/platform/routerboard_mipsel	src/system/ldscripts src/system/ldscripts/mipsel
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32594%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/kernel/boot/platform%0A%09headers/private/kernel/boot/platform/routerboard_mipsel%0A%09src/system/boot/platform%20src/system/boot/platform/routerboard_mipsel%0A%09src/system/kernel/platform%0A%09src/system/kernel/platform/routerboard_mipsel%0A%09src/system/ldscripts%20src/system/ldscripts/mipsel&In-Reply-To=%3C200908220148.n7M1mKgu012232%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019762.html">
   <LINK REL="Next"  HREF="019760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r32594 - in haiku/trunk: build/jam	headers/private/kernel/boot/platform	headers/private/kernel/boot/platform/routerboard_mipsel	src/system/boot/platform src/system/boot/platform/routerboard_mipsel	src/system/kernel/platform	src/system/kernel/platform/routerboard_mipsel	src/system/ldscripts src/system/ldscripts/mipsel</H1>
    <B>kirilla at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32594%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/kernel/boot/platform%0A%09headers/private/kernel/boot/platform/routerboard_mipsel%0A%09src/system/boot/platform%20src/system/boot/platform/routerboard_mipsel%0A%09src/system/kernel/platform%0A%09src/system/kernel/platform/routerboard_mipsel%0A%09src/system/ldscripts%20src/system/ldscripts/mipsel&In-Reply-To=%3C200908220148.n7M1mKgu012232%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r32594 - in haiku/trunk: build/jam	headers/private/kernel/boot/platform	headers/private/kernel/boot/platform/routerboard_mipsel	src/system/boot/platform src/system/boot/platform/routerboard_mipsel	src/system/kernel/platform	src/system/kernel/platform/routerboard_mipsel	src/system/ldscripts src/system/ldscripts/mipsel">kirilla at mail.berlios.de
       </A><BR>
    <I>Sat Aug 22 03:48:20 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="019762.html">[Haiku-commits] r32593 -	haiku/trunk/src/add-ons/accelerants/common
</A></li>
        <LI>Next message: <A HREF="019760.html">[Haiku-commits] r32595 - haiku/trunk/src/system/kernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19759">[ date ]</a>
              <a href="thread.html#19759">[ thread ]</a>
              <a href="subject.html#19759">[ subject ]</a>
              <a href="author.html#19759">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kirilla
Date: 2009-08-22 03:48:18 +0200 (Sat, 22 Aug 2009)
New Revision: 32594
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=32594&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=32594&amp;view=rev</A>

Added:
   haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/
   haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_arch.h
   haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_kernel_args.h
   haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_stage2_args.h
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/Jamfile
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.cpp
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.h
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.cpp
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.h
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/debug.c
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/devices.cpp
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.cpp
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.h
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/menu.cpp
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.cpp
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.h
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.cpp
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.h
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/start.c
   haiku/trunk/src/system/boot/platform/routerboard_mipsel/video.cpp
   haiku/trunk/src/system/kernel/platform/routerboard_mipsel/
   haiku/trunk/src/system/kernel/platform/routerboard_mipsel/Jamfile
   haiku/trunk/src/system/kernel/platform/routerboard_mipsel/platform.cpp
   haiku/trunk/src/system/ldscripts/mipsel/
   haiku/trunk/src/system/ldscripts/mipsel/boot_loader_routerboard_mipsel.ld
Modified:
   haiku/trunk/build/jam/BuildSetup
Log:
Adding routerboard_mipsel platform stubs and linker script.

Modified: haiku/trunk/build/jam/BuildSetup
===================================================================
--- haiku/trunk/build/jam/BuildSetup	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/build/jam/BuildSetup	2009-08-22 01:48:18 UTC (rev 32594)
@@ -233,10 +233,11 @@
 	{
 		HAIKU_DEFINES += __MIPSEL__ ;
 		# RouterBOARD firmware (ELF image over TFTP)
-		HAIKU_BOOT_PLATFORM = routerboot_mipsel ;
+		HAIKU_BOOT_PLATFORM = routerboard_mipsel ;
 		# offset in floppy image (&gt;= sizeof(haiku_loader))
-		HAIKU_BOOT_ARCHIVE_IMAGE_OFFSET = 192 ; # in kB - todo/fixme
-		HAIKU_NO_WERROR = 1 ; # we use #warning as placeholders for things to write...
+		HAIKU_BOOT_ARCHIVE_IMAGE_OFFSET = 192 ; # in kB
+		HAIKU_NO_WERROR = 1 ;
+			# we use #warning as placeholders for things to write...
 	}
 	case * :
 		Exit &quot;Currently unsupported target CPU:&quot; $(HAIKU_CPU) ;

Added: haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_arch.h
===================================================================
--- haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_arch.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_arch.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,40 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_ARCH_H
+#define _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_ARCH_H
+
+#include &lt;SupportDefs.h&gt;
+
+#warning IMPLEMENT platform_arch.h
+
+struct kernel_args;
+
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+
+/* memory management */
+	
+extern status_t arch_set_callback(void);
+extern void *arch_mmu_allocate(void *address, size_t size, uint8 protection,
+	bool exactAddress);
+extern status_t arch_mmu_free(void *address, size_t size);
+extern status_t arch_mmu_init(void);
+
+/* CPU */
+
+extern status_t boot_arch_cpu_init(void);
+
+/* kernel start */
+
+status_t arch_start_kernel(struct kernel_args *kernelArgs, addr_t kernelEntry,
+	addr_t kernelStackTop);
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif /* _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_ARCH_H */
+

Added: haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_kernel_args.h
===================================================================
--- haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_kernel_args.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_kernel_args.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,27 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_KERNEL_ARGS_H
+#define _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_KERNEL_ARGS_H
+
+#ifndef KERNEL_BOOT_KERNEL_ARGS_H
+#	error This file is included from &lt;boot/kernel_args.h&gt; only
+#endif
+
+#warning IMPLEMENT platform_kernel_args.h
+
+// must match SMP_MAX_CPUS in arch_smp.h
+#define MAX_BOOT_CPUS 1
+#define MAX_PHYSICAL_MEMORY_RANGE 4
+#define MAX_PHYSICAL_ALLOCATED_RANGE 8
+#define MAX_VIRTUAL_ALLOCATED_RANGE 32
+
+
+typedef struct {
+	void*	whateverPointer;
+	char	whateverPath[128];
+} platform_kernel_args;
+
+#endif /* _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_KERNEL_ARGS_H */
+

Added: haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_stage2_args.h
===================================================================
--- haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_stage2_args.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/headers/private/kernel/boot/platform/routerboard_mipsel/platform_stage2_args.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,18 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_STAGE2_ARGS_H
+#define _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_STAGE2_ARGS_H
+
+#ifndef KERNEL_BOOT_STAGE2_ARGS_H
+#	error This file is included from &lt;boot/stage2_args.h&gt; only
+#endif
+
+#warning IMPLEMENT platform_stage2_args.h
+
+struct platform_stage2_args {
+};
+
+#endif /* _KERNEL_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_STAGE2_ARGS_H */
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/Jamfile
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/Jamfile	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/Jamfile	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,50 @@
+SubDir HAIKU_TOP src system boot platform routerboard_mipsel ;
+
+SubDirHdrs $(HAIKU_TOP) headers private kernel boot platform $(TARGET_BOOT_PLATFORM) ;
+
+UsePrivateHeaders [ FDirName kernel disk_device_manager ] ;
+UsePrivateHeaders [ FDirName graphics common ] ;
+UsePrivateHeaders [ FDirName graphics vesa ] ;
+UsePrivateHeaders [ FDirName storage ] ;
+
+{
+	local defines = _BOOT_MODE ;
+
+	defines = [ FDefines $(defines) ] ;
+	SubDirCcFlags $(defines) -Wall -Wno-multichar ;
+	SubDirC++Flags $(defines) -Wall -Wno-multichar -fno-rtti ;
+}
+
+SEARCH_SOURCE += [ FDirName $(HAIKU_TOP) src add-ons accelerants common ] ;
+
+local genericPlatformSources = 
+	text_menu.cpp
+#	video_blit.cpp
+#	video_splash.cpp
+#	video_rle.cpp
+;
+
+KernelMergeObject boot_platform_routerboard_mipsel.o :
+	console.cpp
+	cpu.cpp
+	debug.c
+	devices.cpp
+	keyboard.cpp
+	menu.cpp
+	mmu.cpp
+	serial.cpp
+	start.c
+	video.cpp
+
+	$(genericPlatformSources)
+
+	: -fno-pic -G0
+;
+
+SEARCH on [ FGristFiles $(genericPlatformSources) ]
+	= [ FDirName $(HAIKU_TOP) src system boot platform generic ] ;
+
+# Tell the build system to where stage1.bin can be found, so it can be used
+# elsewhere.
+SEARCH on stage1.bin = $(SUBDIR) ;
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,116 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &quot;console.h&quot;
+
+#include &lt;SupportDefs.h&gt;
+
+#include &quot;keyboard.h&quot;
+
+
+class Console : public ConsoleNode {
+public:
+								Console();
+
+	virtual	ssize_t				ReadAt(void* cookie, off_t pos, void* buffer,
+									size_t bufferSize);
+	virtual	ssize_t				WriteAt(void* cookie, off_t pos,
+									const void* buffer, size_t bufferSize);
+};
+
+static uint32 sScreenWidth = 80;
+static uint32 sScreenHeight = 25;
+static uint32 sScreenOffset = 0;
+static uint16 sColor = 0x0f00;
+
+static Console sInput, sOutput;
+
+FILE* stdin;
+FILE* stdout;
+FILE* stderr;
+
+
+//	#pragma mark -
+
+
+Console::Console()
+	: ConsoleNode()
+{
+}
+
+
+ssize_t
+Console::ReadAt(void* cookie, off_t pos, void* buffer, size_t bufferSize)
+{
+#warning IMPLEMENT ReadAt
+	return 0;
+}
+
+
+ssize_t
+Console::WriteAt(void* cookie, off_t /*pos*/, const void* buffer, size_t bufferSize)
+{
+#warning IMPLEMENT WriteAt
+	return 0;
+}
+
+
+//	#pragma mark -
+
+
+void
+console_clear_screen(void)
+{
+#warning IMPLEMENT console_clear_screen
+}
+
+
+int32
+console_width(void)
+{
+#warning IMPLEMENT console_width
+	return 0;
+}
+
+
+int32
+console_height(void)
+{
+#warning IMPLEMENT console_height
+	return 0;
+}
+
+
+void 
+console_set_cursor(int32 x, int32 y)
+{
+#warning IMPLEMENT console_set_cursor
+}
+
+
+void 
+console_set_color(int32 foreground, int32 background)
+{
+#warning IMPLEMENT console_set_color
+}
+
+
+int
+console_wait_for_key(void)
+{
+#warning IMPLEMENT console_wait_for_key
+	union key key;
+	return key.code.ascii;
+}
+
+
+status_t
+console_init(void)
+{
+#warning IMPLEMENT console_init
+	return B_OK;
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.h
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/console.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,21 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_CONSOLE_H
+#define _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_CONSOLE_H
+
+#include &lt;boot/platform/generic/text_console.h&gt;
+
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+
+extern status_t console_init(void);
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif /* _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_CONSOLE_H */
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,40 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &quot;cpu.h&quot;
+
+#include &lt;OS.h&gt;
+#include &lt;arch/cpu.h&gt;
+#include &lt;arch_kernel.h&gt;
+#include &lt;arch_system_info.h&gt;
+
+#include &lt;string.h&gt;
+
+
+static status_t
+check_cpu_features()
+{
+#warning IMPLEMENT check_cpu_features
+	return B_ERROR;
+}
+
+
+//	#pragma mark -
+
+
+extern &quot;C&quot; void
+spin(bigtime_t microseconds)
+{
+#warning IMPLEMENT spin
+}
+
+
+extern &quot;C&quot; void
+cpu_init()
+{
+#warning IMPLEMENT cpu_init
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.h
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/cpu.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,23 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_CPU_H
+#define _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_CPU_H
+
+
+#include &lt;SupportDefs.h&gt;
+
+
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+
+extern void cpu_init(void);
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif /* _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_CPU_H */
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/debug.c
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/debug.c	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/debug.c	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,24 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &lt;boot/platform.h&gt;
+#include &lt;boot/stdio.h&gt;
+#include &lt;stdarg.h&gt;
+
+
+void
+panic(const char* format, ...)
+{
+#warning IMPLEMENT panic
+}
+
+
+void
+dprintf(const char* format, ...)
+{
+#warning IMPLEMENT dprintf
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/devices.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/devices.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/devices.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,47 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &lt;KernelExport.h&gt;
+#include &lt;boot/platform.h&gt;
+#include &lt;boot/partitions.h&gt;
+#include &lt;boot/stdio.h&gt;
+#include &lt;boot/stage2.h&gt;
+
+#include &lt;string.h&gt;
+
+
+status_t 
+platform_add_boot_device(struct stage2_args* args, NodeList* devicesList)
+{
+#warning IMPLEMENT platform_add_boot_device
+	return B_ERROR;
+}
+
+
+status_t
+platform_get_boot_partition(struct stage2_args* args, Node* bootDevice,
+	NodeList* list, boot::Partition** _partition)
+{
+#warning IMPLEMENT platform_get_boot_partition
+	return B_ERROR;
+}
+
+
+status_t
+platform_add_block_devices(stage2_args* args, NodeList* devicesList)
+{
+#warning IMPLEMENT platform_add_block_devices
+	return B_ERROR;
+}
+
+
+status_t 
+platform_register_boot_device(Node* device)
+{
+#warning IMPLEMENT platform_register_boot_device
+	return B_ERROR;
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,44 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &quot;keyboard.h&quot;
+
+#include &lt;boot/platform.h&gt;
+
+
+static uint16
+check_for_key(void)
+{
+#warning IMPLEMENT check_for_key
+	return 0;
+}
+
+
+extern &quot;C&quot; void
+clear_key_buffer(void)
+{
+#warning IMPLEMENT clear_key_buffer
+	while (check_for_key() != 0)
+		;
+}
+
+
+extern &quot;C&quot; union key
+wait_for_key(void)
+{
+#warning IMPLEMENT wait_for_key
+	union key key;
+	return key;
+}
+
+
+extern &quot;C&quot; uint32
+check_for_boot_keys(void)
+{
+#warning IMPLEMENT check_for_boot_keys
+	return 0;
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.h
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/keyboard.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,34 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_KEYBOARD_H
+#define _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_KEYBOARD_H
+
+
+#include &lt;SupportDefs.h&gt;
+
+
+union key {
+	uint16 ax;
+	struct {
+		uint8 ascii;
+		uint8 bios;
+	} code;
+};
+
+
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+
+extern void clear_key_buffer(void);
+extern union key wait_for_key(void);
+extern uint32 check_for_boot_keys(void);
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif /* _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_KEYBOARD_H */
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/menu.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/menu.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/menu.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,46 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &lt;boot/menu.h&gt;
+#include &lt;boot/platform/generic/text_menu.h&gt;
+
+
+void
+platform_add_menus(Menu* menu)
+{
+	MenuItem* item;
+
+	switch (menu-&gt;Type()) {
+		case MAIN_MENU:
+		case SAFE_MODE_MENU:
+			menu-&gt;AddItem(item = new(nothrow) MenuItem(&quot;A menu item&quot;));
+			item-&gt;SetType(MENU_ITEM_MARKABLE);
+			item-&gt;SetData(0);
+			item-&gt;SetHelpText(&quot;A helpful text.&quot;);
+
+			menu-&gt;AddItem(item = new(nothrow) MenuItem(&quot;Another menu item&quot;));
+			item-&gt;SetHelpText(&quot;Some more helpful text.&quot;);
+			item-&gt;SetType(MENU_ITEM_MARKABLE);
+			break;
+		default:
+			break;
+	}
+}
+
+
+void 
+platform_update_menu_item(Menu* menu, MenuItem* item)
+{
+	platform_generic_update_text_menu_item(menu, item);
+}
+
+
+void
+platform_run_menu(Menu* menu)
+{
+	platform_generic_run_text_menu(menu);
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,95 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &quot;mmu.h&quot;
+
+#include &lt;boot/platform.h&gt;
+#include &lt;boot/stdio.h&gt;
+#include &lt;boot/kernel_args.h&gt;
+#include &lt;boot/stage2.h&gt;
+#include &lt;arch/cpu.h&gt;
+#include &lt;arch_kernel.h&gt;
+#include &lt;kernel.h&gt;
+
+#include &lt;OS.h&gt;
+
+#include &lt;string.h&gt;
+
+
+//	#pragma mark -
+
+
+extern &quot;C&quot; addr_t
+mmu_map_physical_memory(addr_t physicalAddress, size_t size, uint32 flags)
+{
+#warning IMPLEMENT mmu_map_physical_memory
+	return 0;
+}
+
+
+extern &quot;C&quot; void*
+mmu_allocate(void* virtualAddress, size_t size)
+{
+#warning IMPLEMENT mmu_allocate
+	return 0;
+}
+
+
+extern &quot;C&quot; void
+mmu_free(void* virtualAddress, size_t size)
+{
+#warning IMPLEMENT mmu_free
+}
+
+
+extern &quot;C&quot; void
+mmu_init_for_kernel(void)
+{
+#warning IMPLEMENT mmu_init_for_kernel
+}
+
+
+extern &quot;C&quot; void
+mmu_init(void)
+{
+#warning IMPLEMENT mmu_init
+}
+
+
+//	#pragma mark -
+
+
+extern &quot;C&quot; status_t
+platform_allocate_region(void** _address, size_t size, uint8 protection,
+	bool /*exactAddress*/)
+{
+#warning IMPLEMENT platform_allocate_region
+	return B_ERROR;
+}
+
+
+extern &quot;C&quot; status_t
+platform_free_region(void* address, size_t size)
+{
+#warning IMPLEMENT platform_free_region
+	return B_ERROR;
+}
+
+
+void
+platform_release_heap(struct stage2_args* args, void* base)
+{
+#warning IMPLEMENT platform_release_heap
+}
+
+
+status_t
+platform_init_heap(struct stage2_args* args, void** _base, void** _top)
+{
+#warning IMPLEMENT platform_init_heap
+	return B_ERROR;
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.h
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/mmu.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,30 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_MMU_H
+#define _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_MMU_H
+
+
+#include &lt;SupportDefs.h&gt;
+
+
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+
+extern void mmu_init(void);
+extern void mmu_init_for_kernel(void);
+
+extern addr_t mmu_map_physical_memory(addr_t physicalAddress, size_t size,
+	uint32 flags);
+
+extern void* mmu_allocate(void* virtualAddress, size_t size);
+extern void mmu_free(void* virtualAddress, size_t size);
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif /* _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_MMU_H */
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,56 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &quot;serial.h&quot;
+
+#include &lt;boot/platform.h&gt;
+#include &lt;arch/cpu.h&gt;
+#include &lt;boot/stage2.h&gt;
+
+#include &lt;string.h&gt;
+
+
+static void
+serial_putc(char c)
+{
+#warning IMPLEMENT serial_putc
+}
+
+
+extern &quot;C&quot; void
+serial_puts(const char* string, size_t size)
+{
+#warning IMPLEMENT serial_puts
+}
+
+
+extern &quot;C&quot; void 
+serial_disable(void)
+{
+#warning IMPLEMENT serial_disable
+}
+
+
+extern &quot;C&quot; void 
+serial_enable(void)
+{
+#warning IMPLEMENT serial_enable
+}
+
+
+extern &quot;C&quot; void
+serial_cleanup(void)
+{
+#warning IMPLEMENT serial_cleanup
+}
+
+
+extern &quot;C&quot; void
+serial_init(void)
+{
+#warning IMPLEMENT serial_init
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.h
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.h	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/serial.h	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,27 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_SERIAL_H
+#define _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_SERIAL_H
+
+
+#include &lt;SupportDefs.h&gt;
+
+
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+
+extern void serial_init(void);
+extern void serial_cleanup(void);
+extern void serial_puts(const char *string, size_t size);
+extern void serial_disable(void);
+extern void serial_enable(void);
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif /* _SYSTEM_BOOT_PLATFORM_ROUTERBOARD_MIPSEL_SERIAL_H */
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/start.c
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/start.c	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/start.c	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,110 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * Copyright 2003-2008 Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &quot;serial.h&quot;
+#include &quot;console.h&quot;
+#include &quot;cpu.h&quot;
+#include &quot;mmu.h&quot;
+#include &quot;keyboard.h&quot;
+
+#include &lt;KernelExport.h&gt;
+#include &lt;boot/platform.h&gt;
+#include &lt;boot/heap.h&gt;
+#include &lt;boot/stage2.h&gt;
+#include &lt;arch/cpu.h&gt;
+
+#include &lt;string.h&gt;
+
+
+#define HEAP_SIZE 65536
+
+
+// GCC defined globals
+extern void (*__ctor_list)(void);
+extern void (*__ctor_end)(void);
+extern uint8 __bss_start;
+extern uint8 _end;
+
+extern int main(stage2_args *args);
+void _start(void);
+
+
+static void
+clear_bss(void)
+{
+	/* TODO: fix boot_loader_routerboard_mipsel.ld
+	 * so this code works, or find a workaround.
+	 */
+/*
+	memset(&amp;__bss_start, 0, &amp;_end - &amp;__bss_start);
+*/
+}
+
+
+static void
+call_ctors(void)
+{
+	/* TODO: fix boot_loader_routerboard_mipsel.ld
+	 * so this code works, or find a workaround.
+	 */
+/*
+	void (**f)(void);
+
+	for (f = &amp;__ctor_list; f &lt; &amp;__ctor_end; f++) {
+		(**f)();
+	}
+*/
+}
+
+
+//	#pragma mark -
+
+
+uint32
+platform_boot_options(void)
+{
+#warning IMPLEMENT platform_boot_options
+	return 0;
+}
+
+
+void
+platform_start_kernel(void)
+{
+#warning IMPLEMENT platform_start_kernel
+	panic(&quot;kernel returned!\n&quot;);
+}
+
+
+void
+platform_exit(void)
+{
+#warning IMPLEMENT platform_exit
+}
+
+
+void
+_start(void)
+{
+#warning IMPLEMENT _start
+	stage2_args args;
+
+	clear_bss();
+	call_ctors();
+
+	cpu_init();
+	mmu_init();
+	serial_init();
+	console_init();
+	serial_enable();
+
+	args.heap_size = HEAP_SIZE;
+	args.arguments = NULL;
+
+	main(&amp;args);
+}
+

Added: haiku/trunk/src/system/boot/platform/routerboard_mipsel/video.cpp
===================================================================
--- haiku/trunk/src/system/boot/platform/routerboard_mipsel/video.cpp	2009-08-22 01:03:10 UTC (rev 32593)
+++ haiku/trunk/src/system/boot/platform/routerboard_mipsel/video.cpp	2009-08-22 01:48:18 UTC (rev 32594)
@@ -0,0 +1,37 @@
+/*
+ * Copyright 2009 Jonas Sundstr&#246;m, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jonas at kirilla.com</A>
+ * All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+
+#include &lt;SupportDefs.h&gt;
+
+
+extern &quot;C&quot; void
+platform_set_palette(const uint8* palette)
+{
+#warning IMPLEMENT platform_set_palette
+}
+
+
+extern &quot;C&quot; void
+platform_switch_to_logo(void)
+{

[... truncated: 84 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019762.html">[Haiku-commits] r32593 -	haiku/trunk/src/add-ons/accelerants/common
</A></li>
	<LI>Next message: <A HREF="019760.html">[Haiku-commits] r32595 - haiku/trunk/src/system/kernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19759">[ date ]</a>
              <a href="thread.html#19759">[ thread ]</a>
              <a href="subject.html#19759">[ subject ]</a>
              <a href="author.html#19759">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
