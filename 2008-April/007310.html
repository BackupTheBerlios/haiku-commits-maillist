<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r24715 - in haiku/trunk/src/apps/mediaplayer: .	playlist
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r24715%20-%20in%20haiku/trunk/src/apps/mediaplayer%3A%20.%0A%09playlist&In-Reply-To=%3C200804010742.m317gadm010372%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007312.html">
   <LINK REL="Next"  HREF="007311.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r24715 - in haiku/trunk/src/apps/mediaplayer: .	playlist</H1>
    <B>stippi at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r24715%20-%20in%20haiku/trunk/src/apps/mediaplayer%3A%20.%0A%09playlist&In-Reply-To=%3C200804010742.m317gadm010372%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r24715 - in haiku/trunk/src/apps/mediaplayer: .	playlist">stippi at mail.berlios.de
       </A><BR>
    <I>Tue Apr  1 09:42:36 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="007312.html">[Haiku-commits] r24671 - in haiku/trunk: headers/private/media src/kits/media
</A></li>
        <LI>Next message: <A HREF="007311.html">[Haiku-commits] r24716 - in haiku/trunk/src/apps/mediaplayer: .	settings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7310">[ date ]</a>
              <a href="thread.html#7310">[ thread ]</a>
              <a href="subject.html#7310">[ subject ]</a>
              <a href="author.html#7310">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: stippi
Date: 2008-04-01 09:42:35 +0200 (Tue, 01 Apr 2008)
New Revision: 24715
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=24715&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=24715&amp;view=rev</A>

Modified:
   haiku/trunk/src/apps/mediaplayer/Jamfile
   haiku/trunk/src/apps/mediaplayer/MainWin.cpp
   haiku/trunk/src/apps/mediaplayer/MainWin.h
   haiku/trunk/src/apps/mediaplayer/playlist/Playlist.cpp
   haiku/trunk/src/apps/mediaplayer/playlist/Playlist.h
   haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.cpp
   haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.h
Log:
Applied Patch by Frederik Modeen with some changes by myself:
* Created Settings window similar to R5 MediaPlayer.
* Prepared loading and saving of settings.
* Settings menu entry is hidden for the time being, since these new settings
  do not actually have any effect yet.
* Prepared loading and saving of Playlists.
* ZETA Playlists can be dropped on the Player and should load fine.
Myself:
* Cleanup in MainWindow.cpp for line width limit.

To Frederik: I removed the buttons again from the Playlist window, since they
don't do anything yet, and the features are available from the menu as well.
An icon bar would be better, IMHO.


Modified: haiku/trunk/src/apps/mediaplayer/Jamfile
===================================================================
--- haiku/trunk/src/apps/mediaplayer/Jamfile	2008-03-31 21:23:38 UTC (rev 24714)
+++ haiku/trunk/src/apps/mediaplayer/Jamfile	2008-04-01 07:42:35 UTC (rev 24715)
@@ -9,6 +9,7 @@
 	playlist
 	supplier
 	support
+	settings
 ;
 
 local sourceDir ;
@@ -29,6 +30,10 @@
 	RemovePLItemsCommand.cpp
 
 	# supplier
+	Settings.cpp
+	SettingsWindow.cpp
+
+	# supplier
 	AudioSupplier.cpp
 	MediaTrackAudioSupplier.cpp
 	MediaTrackVideoSupplier.cpp
@@ -42,6 +47,8 @@
 	ListenerAdapter.cpp
 	Notifier.cpp
 	RWLocker.cpp
+	FileReadWrite.cpp
+	TPreferences.cpp
 
 	# .
 	Controller.cpp
@@ -59,7 +66,7 @@
 	VideoView.cpp
 	VolumeSlider.cpp
 
-	: be media tracker translation $(TARGET_LIBSTDC++)
+	: be media tracker translation textencoding $(TARGET_LIBSTDC++)
 	: MediaPlayer.rdef
 ;
 

Modified: haiku/trunk/src/apps/mediaplayer/MainWin.cpp
===================================================================
--- haiku/trunk/src/apps/mediaplayer/MainWin.cpp	2008-03-31 21:23:38 UTC (rev 24714)
+++ haiku/trunk/src/apps/mediaplayer/MainWin.cpp	2008-04-01 07:42:35 UTC (rev 24715)
@@ -2,8 +2,8 @@
  * MainWin.cpp - Media Player for the Haiku Operating System
  *
  * Copyright (C) 2006 Marcus Overhagen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">marcus at overhagen.de</A>&gt;
- * Copyright (C) 2007 Stephan A&#223;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
- * Copyright (C) 2007 Fredrik Mod&#233;en &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">fredrik at modeen.se</A>&gt;
+ * Copyright (C) 2007-2008 Stephan A&#223;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt; (GPL-&gt;MIT ok)
+ * Copyright (C) 2007-2008 Fredrik Mod&#233;en &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">fredrik at modeen.se</A>&gt;
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -16,7 +16,8 @@
  *
  * You should have received a copy of the GNU General Public License
  * along with this program; if not, write to the Free Software
- * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
+ * USA.
  *
  */
 #include &quot;MainWin.h&quot;
@@ -42,6 +43,7 @@
 #include &quot;MainApp.h&quot;
 #include &quot;PlaylistObserver.h&quot;
 #include &quot;PlaylistWindow.h&quot;
+#include &quot;SettingsWindow.h&quot;
 
 #define NAME &quot;MediaPlayer&quot;
 #define MIN_WIDTH 250
@@ -70,7 +72,7 @@
 	M_TOGGLE_NO_BORDER_NO_MENU_NO_CONTROLS,
 	M_TOGGLE_ALWAYS_ON_TOP,
 	M_TOGGLE_KEEP_ASPECT_RATIO,
-	M_PREFERENCES,
+	M_SETTINGS,
 	M_VOLUME_UP,
 	M_VOLUME_DOWN,
 	M_SKIP_NEXT,
@@ -94,10 +96,12 @@
 
 
 MainWin::MainWin()
- :	BWindow(BRect(100,100,350,300), NAME, B_TITLED_WINDOW, B_ASYNCHRONOUS_CONTROLS /* | B_WILL_ACCEPT_FIRST_CLICK */)
+ :	BWindow(BRect(100,100,400,300), NAME, B_TITLED_WINDOW,
+ 		B_ASYNCHRONOUS_CONTROLS /* | B_WILL_ACCEPT_FIRST_CLICK */)
  ,  fFilePanel(NULL)
  ,	fInfoWin(NULL)
  ,	fPlaylistWindow(NULL)
+ ,	fSettingsWindow(NULL)
  ,	fHasFile(false)
  ,	fHasVideo(false)
  ,	fHasAudio(false)
@@ -127,7 +131,8 @@
 	BRect rect = Bounds();
 
 	// background
-	fBackground = new BView(rect, &quot;background&quot;, B_FOLLOW_ALL, B_WILL_DRAW | B_FULL_UPDATE_ON_RESIZE);
+	fBackground = new BView(rect, &quot;background&quot;, B_FOLLOW_ALL,
+		B_WILL_DRAW | B_FULL_UPDATE_ON_RESIZE);
 	fBackground-&gt;SetViewColor(0,0,0);
 	AddChild(fBackground);
 
@@ -141,12 +146,15 @@
 	fMenuBar-&gt;SetResizingMode(B_FOLLOW_NONE);
 
 	// video view
-	rect = BRect(0, fMenuBarHeight, fBackground-&gt;Bounds().right, fMenuBarHeight + 10);
-	fVideoView = new VideoView(rect, &quot;video display&quot;, B_FOLLOW_NONE, B_WILL_DRAW | B_FULL_UPDATE_ON_RESIZE);
+	rect = BRect(0, fMenuBarHeight, fBackground-&gt;Bounds().right,
+		fMenuBarHeight + 10);
+	fVideoView = new VideoView(rect, &quot;video display&quot;, B_FOLLOW_NONE,
+		B_WILL_DRAW | B_FULL_UPDATE_ON_RESIZE);
 	fBackground-&gt;AddChild(fVideoView);
 	
 	// controls
-	rect = BRect(0, fMenuBarHeight + 11, fBackground-&gt;Bounds().right, fBackground-&gt;Bounds().bottom);
+	rect = BRect(0, fMenuBarHeight + 11, fBackground-&gt;Bounds().right,
+		fBackground-&gt;Bounds().bottom);
 	fControls = new ControllerView(rect, fController, fPlaylist);
 	fBackground-&gt;AddChild(fControls);
 	fControls-&gt;ResizeToPreferred();
@@ -155,7 +163,8 @@
 	fControls-&gt;SetResizingMode(B_FOLLOW_BOTTOM | B_FOLLOW_LEFT_RIGHT);
 //	fControls-&gt;MoveTo(0, fBackground-&gt;Bounds().bottom - fControlsHeight + 1);
 	
-//	fVideoView-&gt;ResizeTo(fBackground-&gt;Bounds().Width(), fBackground-&gt;Bounds().Height() - fMenuBarHeight - fControlsHeight);
+//	fVideoView-&gt;ResizeTo(fBackground-&gt;Bounds().Width(),
+//		fBackground-&gt;Bounds().Height() - fMenuBarHeight - fControlsHeight);
 
 	fPlaylist-&gt;AddListener(fPlaylistObserver);
 	fController-&gt;SetVideoView(fVideoView);
@@ -168,9 +177,15 @@
 
 	_SetupWindow();
 
+	// setup the settings window now, we need to have it 
+	fSettingsWindow = new SettingsWindow(BRect(150, 150, 450, 520));
+	fSettingsWindow-&gt;Hide();
+	fSettingsWindow-&gt;Show();
+
 	// setup the playlist window now, we need to have it 
 	// running for the undo/redo playlist editing
-	fPlaylistWindow = new PlaylistWindow(BRect(150, 150, 400, 500), fPlaylist, fController);
+	fPlaylistWindow = new PlaylistWindow(BRect(150, 150, 500, 600), fPlaylist,
+		fController);
 	fPlaylistWindow-&gt;Hide();
 	fPlaylistWindow-&gt;Show();
 		// this makes sure the window thread is running without
@@ -200,6 +215,11 @@
 		fPlaylistWindow-&gt;Lock();
 		fPlaylistWindow-&gt;Quit();
 	}
+	
+	if (fSettingsWindow) {
+		fSettingsWindow-&gt;Lock();
+		fSettingsWindow-&gt;Quit();
+	}
 
 	delete fPlaylist;
 	delete fController;
@@ -220,10 +240,13 @@
 	bool no_menu = fNoMenu || fIsFullscreen;
 	bool no_controls = fNoControls || fIsFullscreen;
 	
-	printf(&quot;FrameResized enter: new_width %.0f, new_height %.0f\n&quot;, new_width, new_height);
+	printf(&quot;FrameResized enter: new_width %.0f, new_height %.0f\n&quot;,
+		new_width, new_height);
 	
 	int max_video_width  = int(new_width) + 1;
-	int max_video_height = int(new_height) + 1 - (no_menu  ? 0 : fMenuBarHeight) - (no_controls ? 0 : fControlsHeight);
+	int max_video_height = int(new_height) + 1
+		- (no_menu  ? 0 : fMenuBarHeight)
+		- (no_controls ? 0 : fControlsHeight);
 
 	ASSERT(max_video_height &gt;= 0);
 	
@@ -374,7 +397,8 @@
 			fPlaylist-&gt;SetCurrentRefIndex(fPlaylist-&gt;CurrentRefIndex() + 1);
 			break;
 		case MSG_CONTROLLER_FILE_CHANGED:
-			// TODO: move all other GUI changes as a reaction to this notification
+			// TODO: move all other GUI changes as a reaction to this
+			// notification
 //			_UpdatePlaylistMenu();
 			break;
 		case MSG_CONTROLLER_VIDEO_TRACK_CHANGED: {
@@ -441,7 +465,7 @@
 		case B_ABOUT_REQUESTED:
 			BAlert *alert;
 			alert = new BAlert(&quot;about&quot;, NAME&quot;\n\n Written by Marcus Overhagen &quot;
-				&quot;and Stephan A&#223;mus&quot;, &quot;Thanks&quot;);
+				&quot;, Stephan A&#223;mus and Frederik Mod&#233;en&quot;, &quot;Thanks&quot;);
 			if (fAlwaysOnTop) {
 				_ToggleAlwaysOnTop();
 				alert-&gt;Go();
@@ -536,7 +560,7 @@
 			printf(&quot;B_RELEASE_OVERLAY_LOCK\n&quot;);
 			fVideoView-&gt;OverlayLockRelease();
 			break;
-			
+	
 		case B_MOUSE_WHEEL_CHANGED:
 		{
 			printf(&quot;B_MOUSE_WHEEL_CHANGED\n&quot;);
@@ -593,16 +617,19 @@
 		case M_ASPECT_544_576:
 			VideoFormatChange(544, 576, 1.41176, 1.0);
 			break;
-/*
-		case M_PREFERENCES:
+
+		case M_SETTINGS:
+			ShowSettingsWindow();
 			break;
-			
+/*			
 		default:
-			if (msg-&gt;what &gt;= M_SELECT_CHANNEL &amp;&amp; msg-&gt;what &lt;= M_SELECT_CHANNEL_END) {
+			if (msg-&gt;what &gt;= M_SELECT_CHANNEL
+				&amp;&amp; msg-&gt;what &lt;= M_SELECT_CHANNEL_END) {
 				SelectChannel(msg-&gt;what - M_SELECT_CHANNEL);
 				break;
 			}
-			if (msg-&gt;what &gt;= M_SELECT_INTERFACE &amp;&amp; msg-&gt;what &lt;= M_SELECT_INTERFACE_END) {
+			if (msg-&gt;what &gt;= M_SELECT_INTERFACE
+				&amp;&amp; msg-&gt;what &lt;= M_SELECT_INTERFACE_END) {
 				SelectInterface(msg-&gt;what - M_SELECT_INTERFACE - 1);
 				break;
 			}
@@ -647,8 +674,6 @@
 			(new BAlert(&quot;error&quot;, s, &quot;OK&quot;))-&gt;Go();
 		} else {
 			// just go to the next file and don't bother user
-			// TODO: this makes it impossible to skip backwards
-			// over a non recognized file!
 			fPlaylist-&gt;SetCurrentRefIndex(fPlaylist-&gt;CurrentRefIndex() + 1);
 		}
 		fHasFile = false;
@@ -664,6 +689,7 @@
 	_SetupWindow();
 }
 
+
 void
 MainWin::ShowFileInfo()
 {
@@ -694,16 +720,32 @@
 
 
 void
-MainWin::VideoFormatChange(int width, int height, float width_scale, float height_scale)
+MainWin::ShowSettingsWindow()
 {
+	if (fSettingsWindow-&gt;Lock()) {
+		if (fSettingsWindow-&gt;IsHidden())
+			fSettingsWindow-&gt;Show();
+		else
+			fSettingsWindow-&gt;Activate();
+		fSettingsWindow-&gt;Unlock();
+	}
+}
+
+
+void
+MainWin::VideoFormatChange(int width, int height, float width_scale,
+	float height_scale)
+{
 	// called when video format or aspect ratio changes
 	
-	printf(&quot;VideoFormatChange enter: width %d, height %d, width_scale %.6f, height_scale %.6f\n&quot;, width, height, width_scale, height_scale);
+	printf(&quot;VideoFormatChange enter: width %d, height %d, width_scale %.6f, &quot;
+		&quot;height_scale %.6f\n&quot;, width, height, width_scale, height_scale);
 
 	if (width_scale &lt; 1.0 &amp;&amp; height_scale &gt;= 1.0) {
 		width_scale  = 1.0 / width_scale;
 		height_scale = 1.0 / height_scale;
-		printf(&quot;inverting! new values: width_scale %.6f, height_scale %.6f\n&quot;, width_scale, height_scale);
+		printf(&quot;inverting! new values: width_scale %.6f, height_scale %.6f\n&quot;,
+			width_scale, height_scale);
 	}
 	
  	fSourceWidth  = width;
@@ -740,7 +782,6 @@
 MainWin::_SetupWindow()
 {
 	printf(&quot;MainWin::_SetupWindow\n&quot;);	
-
 	// Populate the track menus
 	_SetupTrackMenus();
 	// Enable both if a file was loaded
@@ -752,8 +793,7 @@
 
 	fVideoMenu-&gt;SetEnabled(fHasVideo);
 	fAudioMenu-&gt;SetEnabled(fHasAudio);
-	fDebugMenu-&gt;SetEnabled(fHasVideo);
-	
+//	fDebugMenu-&gt;SetEnabled(fHasVideo);
 	if (fHasVideo) {
 		fController-&gt;GetSize(&amp;fSourceWidth, &amp;fSourceHeight);
 		fWidthScale = 1.0;
@@ -764,7 +804,6 @@
 		fWidthScale = 1.0;
 		fHeightScale = 1.0;
 	}
-
 	_UpdateControlsEnabledStatus();
 
 	_ResizeWindow(100);
@@ -783,7 +822,7 @@
 	fSettingsMenu = new BMenu(&quot;Settings&quot;);
 	fAudioTrackMenu = new BMenu(&quot;Track&quot;);
 	fVideoTrackMenu = new BMenu(&quot;Track&quot;);
-	fDebugMenu = new BMenu(&quot;Debug&quot;);
+//	fDebugMenu = new BMenu(&quot;Debug&quot;);
 
 	fMenuBar-&gt;AddItem(fFileMenu);
 	fMenuBar-&gt;AddItem(fAudioMenu);
@@ -791,10 +830,13 @@
 	fMenuBar-&gt;AddItem(fSettingsMenu);
 //	fMenuBar-&gt;AddItem(fDebugMenu);
 
-	fFileMenu-&gt;AddItem(new BMenuItem(&quot;New Player&quot;B_UTF8_ELLIPSIS, new BMessage(M_FILE_NEWPLAYER), 'N', B_COMMAND_KEY));
+	fFileMenu-&gt;AddItem(new BMenuItem(&quot;New Player&quot;B_UTF8_ELLIPSIS,
+		new BMessage(M_FILE_NEWPLAYER), 'N'));
 	fFileMenu-&gt;AddSeparatorItem();
-	fFileMenu-&gt;AddItem(new BMenuItem(&quot;Open File&quot;B_UTF8_ELLIPSIS, new BMessage(M_FILE_OPEN), 'O', B_COMMAND_KEY));
-	fFileMenu-&gt;AddItem(new BMenuItem(&quot;File Info&quot;B_UTF8_ELLIPSIS, new BMessage(M_FILE_INFO), 'I', B_COMMAND_KEY));
+	fFileMenu-&gt;AddItem(new BMenuItem(&quot;Open File&quot;B_UTF8_ELLIPSIS,
+		new BMessage(M_FILE_OPEN), 'O'));
+	fFileMenu-&gt;AddItem(new BMenuItem(&quot;File Info&quot;B_UTF8_ELLIPSIS,
+		new BMessage(M_FILE_INFO), 'I'));
 	fFileMenu-&gt;AddItem(fPlaylistMenu);
 	fPlaylistMenu-&gt;Superitem()-&gt;SetShortcut('P', B_COMMAND_KEY);
 	fPlaylistMenu-&gt;Superitem()-&gt;SetMessage(new BMessage(M_FILE_PLAYLIST));
@@ -803,8 +845,8 @@
 	fFileMenu-&gt;AddItem(new BMenuItem(&quot;About&quot; NAME B_UTF8_ELLIPSIS,
 		new BMessage(B_ABOUT_REQUESTED)));
 	fFileMenu-&gt;AddSeparatorItem();
-	fFileMenu-&gt;AddItem(new BMenuItem(&quot;Close&quot;, new BMessage(M_FILE_CLOSE), 'W', B_COMMAND_KEY));
-	fFileMenu-&gt;AddItem(new BMenuItem(&quot;Quit&quot;, new BMessage(M_FILE_QUIT), 'Q', B_COMMAND_KEY));
+	fFileMenu-&gt;AddItem(new BMenuItem(&quot;Close&quot;, new BMessage(M_FILE_CLOSE), 'W'));
+	fFileMenu-&gt;AddItem(new BMenuItem(&quot;Quit&quot;, new BMessage(M_FILE_QUIT), 'Q'));
 
 	fPlaylistMenu-&gt;SetRadioMode(true);
 
@@ -812,40 +854,51 @@
 
 	fVideoMenu-&gt;AddItem(fVideoTrackMenu);
 	fVideoMenu-&gt;AddSeparatorItem();
-	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;50% scale&quot;, new BMessage(M_VIEW_50), '0', B_COMMAND_KEY));
-	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;100% scale&quot;, new BMessage(M_VIEW_100), '1', B_COMMAND_KEY));
-	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;200% scale&quot;, new BMessage(M_VIEW_200), '2', B_COMMAND_KEY));
-	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;300% scale&quot;, new BMessage(M_VIEW_300), '3', B_COMMAND_KEY));
-	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;400% scale&quot;, new BMessage(M_VIEW_400), '4', B_COMMAND_KEY));
+	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;50% scale&quot;,
+		new BMessage(M_VIEW_50), '0'));
+	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;100% scale&quot;,
+		new BMessage(M_VIEW_100), '1'));
+	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;200% scale&quot;,
+		new BMessage(M_VIEW_200), '2'));
+	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;300% scale&quot;,
+		new BMessage(M_VIEW_300), '3'));
+	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;400% scale&quot;,
+		new BMessage(M_VIEW_400), '4'));
 	fVideoMenu-&gt;AddSeparatorItem();
-	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;Full Screen&quot;, new BMessage(M_TOGGLE_FULLSCREEN), 'F', B_COMMAND_KEY));
-	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;Keep Aspect Ratio&quot;, new BMessage(M_TOGGLE_KEEP_ASPECT_RATIO), 'K', B_COMMAND_KEY));
+	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;Full Screen&quot;,
+		new BMessage(M_TOGGLE_FULLSCREEN), 'F'));
+	fVideoMenu-&gt;AddItem(new BMenuItem(&quot;Keep Aspect Ratio&quot;,
+		new BMessage(M_TOGGLE_KEEP_ASPECT_RATIO), 'K'));
 
-	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;No Menu&quot;, new BMessage(M_TOGGLE_NO_MENU), 'M', B_COMMAND_KEY));
-	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;No Border&quot;, new BMessage(M_TOGGLE_NO_BORDER), 'B', B_COMMAND_KEY));
-	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;No Controls&quot;, new BMessage(M_TOGGLE_NO_CONTROLS), 'C', B_COMMAND_KEY));
-	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;Always on Top&quot;, new BMessage(M_TOGGLE_ALWAYS_ON_TOP), 'T', B_COMMAND_KEY));
+	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;No Menu&quot;,
+		new BMessage(M_TOGGLE_NO_MENU), 'M'));
+	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;No Border&quot;,
+		new BMessage(M_TOGGLE_NO_BORDER), 'B'));
+	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;No Controls&quot;,
+		new BMessage(M_TOGGLE_NO_CONTROLS), 'C'));
+	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;Always on Top&quot;,
+		new BMessage(M_TOGGLE_ALWAYS_ON_TOP), 'T'));
 //	fSettingsMenu-&gt;AddSeparatorItem();
-//	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;Preferences&quot;B_UTF8_ELLIPSIS, new BMessage(M_PREFERENCES), 'P', B_COMMAND_KEY));
+//	fSettingsMenu-&gt;AddItem(new BMenuItem(&quot;Settings&quot;B_UTF8_ELLIPSIS,
+//		new BMessage(M_SETTINGS), 'S'));
 
-	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.00000:1&quot;, new BMessage(M_ASPECT_100000_1)));
-	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.06666:1&quot;, new BMessage(M_ASPECT_106666_1)));
-	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.09091:1&quot;, new BMessage(M_ASPECT_109091_1)));
-	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.41176:1&quot;, new BMessage(M_ASPECT_141176_1)));
-	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;force 720 x 576, display aspect 4:3&quot;, new BMessage(M_ASPECT_720_576)));
-	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;force 704 x 576, display aspect 4:3&quot;, new BMessage(M_ASPECT_704_576)));
-	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;force 544 x 576, display aspect 4:3&quot;, new BMessage(M_ASPECT_544_576)));
+//	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.00000:1&quot;,
+//		new BMessage(M_ASPECT_100000_1)));
+//	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.06666:1&quot;,
+//		new BMessage(M_ASPECT_106666_1)));
+//	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.09091:1&quot;,
+//		new BMessage(M_ASPECT_109091_1)));
+//	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.41176:1&quot;,
+//		new BMessage(M_ASPECT_141176_1)));
+//	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;force 720 x 576, display aspect 4:3&quot;,
+//		new BMessage(M_ASPECT_720_576)));
+//	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;force 704 x 576, display aspect 4:3&quot;,
+//		new BMessage(M_ASPECT_704_576)));
+//	fDebugMenu-&gt;AddItem(new BMenuItem(&quot;force 544 x 576, display aspect 4:3&quot;,
+//		new BMessage(M_ASPECT_544_576)));
 
 	fAudioTrackMenu-&gt;SetRadioMode(true);
 	fVideoTrackMenu-&gt;SetRadioMode(true);
-/*	
-	fSettingsMenu-&gt;ItemAt(3)-&gt;SetMarked(fIsFullscreen);
-	fSettingsMenu-&gt;ItemAt(5)-&gt;SetMarked(fNoMenu);
-	fSettingsMenu-&gt;ItemAt(6)-&gt;SetMarked(fNoBorder);
-	fSettingsMenu-&gt;ItemAt(7)-&gt;SetMarked(fAlwaysOnTop);
-	fSettingsMenu-&gt;ItemAt(8)-&gt;SetMarked(fKeepAspectRatio);
-	fSettingsMenu-&gt;ItemAt(10)-&gt;SetEnabled(false); // XXX disable unused preference menu
-*/
 }
 
 
@@ -861,7 +914,8 @@
 	c = fController-&gt;AudioTrackCount();
 	for (i = 0; i &lt; c; i++) {
 		sprintf(s, &quot;Track %d&quot;, i + 1);
-		fAudioTrackMenu-&gt;AddItem(new BMenuItem(s, new BMessage(M_SELECT_AUDIO_TRACK + i)));
+		fAudioTrackMenu-&gt;AddItem(new BMenuItem(s,
+			new BMessage(M_SELECT_AUDIO_TRACK + i)));
 	}
 	if (!c)
 		fAudioTrackMenu-&gt;AddItem(new BMenuItem(&quot;none&quot;, new BMessage(M_DUMMY)));
@@ -869,7 +923,8 @@
 	c = fController-&gt;VideoTrackCount();
 	for (i = 0; i &lt; c; i++) {
 		sprintf(s, &quot;Track %d&quot;, i + 1);
-		fVideoTrackMenu-&gt;AddItem(new BMenuItem(s, new BMessage(M_SELECT_VIDEO_TRACK + i)));
+		fVideoTrackMenu-&gt;AddItem(new BMenuItem(s,
+			new BMessage(M_SELECT_VIDEO_TRACK + i)));
 	}
 	if (!c)
 		fVideoTrackMenu-&gt;AddItem(new BMenuItem(&quot;none&quot;, new BMessage(M_DUMMY)));
@@ -882,9 +937,11 @@
 	int minWidth = fNoControls  ? MIN_WIDTH : fControlsWidth;
 	if (!fNoMenu)
 		minWidth = max_c(minWidth, fMenuBarWidth);
-	int minHeight = (fNoMenu ? 0 : fMenuBarHeight) + (fNoControls ? 0 : fControlsHeight);
+	int minHeight = (fNoMenu ? 0 : fMenuBarHeight)
+		+ (fNoControls ? 0 : fControlsHeight);
 	
-	SetSizeLimits(minWidth - 1, 32000, minHeight - 1, fHasVideo ? 32000 : minHeight - 1);
+	SetSizeLimits(minWidth - 1, 32000, minHeight - 1, fHasVideo ?
+		32000 : minHeight - 1);
 }
 
 
@@ -916,7 +973,8 @@
 void
 MainWin::_ResizeVideoView(int x, int y, int width, int height)
 {
-	printf(&quot;_ResizeVideoView: %d,%d, width %d, height %d\n&quot;, x, y, width, height);
+	printf(&quot;_ResizeVideoView: %d,%d, width %d, height %d\n&quot;, x, y,
+		width, height);
 	
 	if (fKeepAspectRatio) {
 		// Keep aspect ratio, place video view inside
@@ -953,7 +1011,8 @@
 	BPoint screen_where;
 	uint32 buttons = msg-&gt;FindInt32(&quot;buttons&quot;);
 
-	// On Zeta, only &quot;screen_where&quot; is relyable, &quot;where&quot; and &quot;be:view_where&quot; seem to be broken
+	// On Zeta, only &quot;screen_where&quot; is relyable, &quot;where&quot; and &quot;be:view_where&quot;
+	// seem to be broken
 	if (B_OK != msg-&gt;FindPoint(&quot;screen_where&quot;, &amp;screen_where)) {
 		// Workaround for BeOS R5, it has no &quot;screen_where&quot;
 		if (!originalHandler || msg-&gt;FindPoint(&quot;where&quot;, &amp;screen_where) &lt; B_OK)
@@ -966,7 +1025,8 @@
 //	if (1 == msg-&gt;FindInt32(&quot;buttons&quot;) &amp;&amp; msg-&gt;FindInt32(&quot;clicks&quot;) == 1) {
 
 	if (1 == buttons &amp;&amp; msg-&gt;FindInt32(&quot;clicks&quot;) % 2 == 0) {
-		BRect r(screen_where.x - 1, screen_where.y - 1, screen_where.x + 1, screen_where.y + 1);
+		BRect r(screen_where.x - 1, screen_where.y - 1, screen_where.x + 1,
+			screen_where.y + 1);
 		if (r.Contains(fMouseDownMousePos)) {
 			PostMessage(M_TOGGLE_FULLSCREEN);
 			return;
@@ -974,7 +1034,8 @@
 	}
 	
 	if (2 == buttons &amp;&amp; msg-&gt;FindInt32(&quot;clicks&quot;) % 2 == 0) {
-		BRect r(screen_where.x - 1, screen_where.y - 1, screen_where.x + 1, screen_where.y + 1);
+		BRect r(screen_where.x - 1, screen_where.y - 1, screen_where.x + 1,
+			screen_where.y + 1);
 		if (r.Contains(fMouseDownMousePos)) {
 			PostMessage(M_TOGGLE_NO_BORDER_NO_MENU_NO_CONTROLS);
 			return;
@@ -983,14 +1044,16 @@
 
 /*
 		// very broken in Zeta:
-		fMouseDownMousePos = fVideoView-&gt;ConvertToScreen(msg-&gt;FindPoint(&quot;where&quot;));
+		fMouseDownMousePos = fVideoView-&gt;ConvertToScreen(
+			msg-&gt;FindPoint(&quot;where&quot;));
 */
 	fMouseDownMousePos = screen_where;
 	fMouseDownWindowPos = Frame().LeftTop();
 
 	if (buttons == 1 &amp;&amp; !fIsFullscreen) {
 		// start mouse tracking
-		fVideoView-&gt;SetMouseEventMask(B_POINTER_EVENTS | B_NO_POINTER_HISTORY /* | B_LOCK_WINDOW_FOCUS */);
+		fVideoView-&gt;SetMouseEventMask(B_POINTER_EVENTS | B_NO_POINTER_HISTORY
+			/* | B_LOCK_WINDOW_FOCUS */);
 		fMouseDownTracking = true;
 	}
 
@@ -1061,38 +1124,51 @@
 	printf(&quot;Show context menu\n&quot;);
 	BPopUpMenu *menu = new BPopUpMenu(&quot;context menu&quot;, false, false);
 	BMenuItem *item;
-	menu-&gt;AddItem(item = new BMenuItem(&quot;Full Screen&quot;, new BMessage(M_TOGGLE_FULLSCREEN), 'F', B_COMMAND_KEY));
+	menu-&gt;AddItem(item = new BMenuItem(&quot;Full Screen&quot;,
+		new BMessage(M_TOGGLE_FULLSCREEN), 'F'));
 	item-&gt;SetMarked(fIsFullscreen);
 	item-&gt;SetEnabled(fHasVideo);
-	menu-&gt;AddItem(item = new BMenuItem(&quot;Keep Aspect Ratio&quot;, new BMessage(M_TOGGLE_KEEP_ASPECT_RATIO), 'K', B_COMMAND_KEY));
+	menu-&gt;AddItem(item = new BMenuItem(&quot;Keep Aspect Ratio&quot;,
+		new BMessage(M_TOGGLE_KEEP_ASPECT_RATIO), 'K'));
 	item-&gt;SetMarked(fKeepAspectRatio);
 	item-&gt;SetEnabled(fHasVideo);
 
 	menu-&gt;AddSeparatorItem();
-	menu-&gt;AddItem(item = new BMenuItem(&quot;No Menu&quot;, new BMessage(M_TOGGLE_NO_MENU), 'M', B_COMMAND_KEY));
+	menu-&gt;AddItem(item = new BMenuItem(&quot;No Menu&quot;,
+		new BMessage(M_TOGGLE_NO_MENU), 'M'));
 	item-&gt;SetMarked(fNoMenu);
-	menu-&gt;AddItem(item = new BMenuItem(&quot;No Border&quot;, new BMessage(M_TOGGLE_NO_BORDER), 'B', B_COMMAND_KEY));
+	menu-&gt;AddItem(item = new BMenuItem(&quot;No Border&quot;,
+		new BMessage(M_TOGGLE_NO_BORDER), 'B'));
 	item-&gt;SetMarked(fNoBorder);
-	menu-&gt;AddItem(item = new BMenuItem(&quot;Always on Top&quot;, new BMessage(M_TOGGLE_ALWAYS_ON_TOP), 'T', B_COMMAND_KEY));
+	menu-&gt;AddItem(item = new BMenuItem(&quot;Always on Top&quot;,
+		new BMessage(M_TOGGLE_ALWAYS_ON_TOP), 'T'));
 	item-&gt;SetMarked(fAlwaysOnTop);
 
 	menu-&gt;AddSeparatorItem();
 	menu-&gt;AddItem(new BMenuItem(&quot;About&quot; NAME B_UTF8_ELLIPSIS,
 		new BMessage(B_ABOUT_REQUESTED)));
 	menu-&gt;AddSeparatorItem();
-	menu-&gt;AddItem(new BMenuItem(&quot;Quit&quot;, new BMessage(M_FILE_QUIT), 'Q', B_COMMAND_KEY));
+	menu-&gt;AddItem(new BMenuItem(&quot;Quit&quot;, new BMessage(M_FILE_QUIT), 'Q'));
 
 	menu-&gt;AddSeparatorItem();
-	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.00000:1&quot;, new BMessage(M_ASPECT_100000_1)));
-	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.06666:1&quot;, new BMessage(M_ASPECT_106666_1)));
-	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.09091:1&quot;, new BMessage(M_ASPECT_109091_1)));
-	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.41176:1&quot;, new BMessage(M_ASPECT_141176_1)));
-	menu-&gt;AddItem(new BMenuItem(&quot;force 720 x 576, display aspect 4:3&quot;, new BMessage(M_ASPECT_720_576)));
-	menu-&gt;AddItem(new BMenuItem(&quot;force 704 x 576, display aspect 4:3&quot;, new BMessage(M_ASPECT_704_576)));
-	menu-&gt;AddItem(new BMenuItem(&quot;force 544 x 576, display aspect 4:3&quot;, new BMessage(M_ASPECT_544_576)));
+	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.00000:1&quot;,
+		new BMessage(M_ASPECT_100000_1)));
+	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.06666:1&quot;,
+		new BMessage(M_ASPECT_106666_1)));
+	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.09091:1&quot;,
+		new BMessage(M_ASPECT_109091_1)));
+	menu-&gt;AddItem(new BMenuItem(&quot;pixel aspect ratio 1.41176:1&quot;,
+		new BMessage(M_ASPECT_141176_1)));
+	menu-&gt;AddItem(new BMenuItem(&quot;force 720 x 576, display aspect 4:3&quot;,
+		new BMessage(M_ASPECT_720_576)));
+	menu-&gt;AddItem(new BMenuItem(&quot;force 704 x 576, display aspect 4:3&quot;,
+		new BMessage(M_ASPECT_704_576)));
+	menu-&gt;AddItem(new BMenuItem(&quot;force 544 x 576, display aspect 4:3&quot;,
+		new BMessage(M_ASPECT_544_576)));
 
 	menu-&gt;SetTargetForItems(this);
-	BRect r(screen_point.x - 5, screen_point.y - 5, screen_point.x + 5, screen_point.y + 5);
+	BRect r(screen_point.x - 5, screen_point.y - 5, screen_point.x + 5,
+		screen_point.y + 5);
 	menu-&gt;Go(screen_point, true, true, r, true);
 }
 
@@ -1109,7 +1185,8 @@
 	uint32 raw_char  = msg-&gt;FindInt32(&quot;raw_char&quot;);
 	uint32 modifiers = msg-&gt;FindInt32(&quot;modifiers&quot;);
 	
-	printf(&quot;key 0x%lx, raw_char 0x%lx, modifiers 0x%lx\n&quot;, key, raw_char, modifiers);
+	printf(&quot;key 0x%lx, raw_char 0x%lx, modifiers 0x%lx\n&quot;, key, raw_char,
+		modifiers);
 	
 	switch (raw_char) {
 		case B_SPACE:
@@ -1134,7 +1211,8 @@
 				break;
 				
 		case B_TAB:
-			if ((modifiers &amp; (B_COMMAND_KEY | B_CONTROL_KEY | B_OPTION_KEY | B_MENU_KEY)) == 0) {
+			if ((modifiers &amp; (B_COMMAND_KEY | B_CONTROL_KEY | B_OPTION_KEY
+					| B_MENU_KEY)) == 0) {
 				PostMessage(M_TOGGLE_FULLSCREEN);
 				return B_OK;
 			} else
@@ -1260,7 +1338,9 @@
 		// switch to fullscreen
 		
 		fSavedFrame = Frame();
-		printf(&quot;saving current frame: %d %d %d %d\n&quot;, int(fSavedFrame.left), int(fSavedFrame.top), int(fSavedFrame.right), int(fSavedFrame.bottom));
+		printf(&quot;saving current frame: %d %d %d %d\n&quot;, int(fSavedFrame.left),
+			int(fSavedFrame.top), int(fSavedFrame.right),
+			int(fSavedFrame.bottom));
 		BScreen screen(this);
 		BRect rect(screen.Frame());
 

Modified: haiku/trunk/src/apps/mediaplayer/MainWin.h
===================================================================
--- haiku/trunk/src/apps/mediaplayer/MainWin.h	2008-03-31 21:23:38 UTC (rev 24714)
+++ haiku/trunk/src/apps/mediaplayer/MainWin.h	2008-04-01 07:42:35 UTC (rev 24715)
@@ -32,10 +32,10 @@
 #include &quot;VideoView.h&quot;
 #include &quot;Playlist.h&quot;
 
-
 class ControllerObserver;
 class PlaylistObserver;
 class PlaylistWindow;
+class SettingsWindow;
 
 class MainWin : public BWindow {
 public:
@@ -54,6 +54,7 @@
 			
 			void				ShowFileInfo();
 			void				ShowPlaylistWindow();
+			void				ShowSettingsWindow();
 		
 			void				VideoFormatChange(int width, int height,
 									float widthScale, float heightScale);
@@ -100,6 +101,7 @@
 			ControllerView*		fControls;
 			InfoWin*			fInfoWin;
 			PlaylistWindow*		fPlaylistWindow;
+			SettingsWindow*		fSettingsWindow;
 		
 			BMenu*				fFileMenu;
 			BMenu*				fAudioMenu;

Modified: haiku/trunk/src/apps/mediaplayer/playlist/Playlist.cpp
===================================================================
--- haiku/trunk/src/apps/mediaplayer/playlist/Playlist.cpp	2008-03-31 21:23:38 UTC (rev 24714)
+++ haiku/trunk/src/apps/mediaplayer/playlist/Playlist.cpp	2008-04-01 07:42:35 UTC (rev 24715)
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2006 Marcus Overhagen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">marcus at overhagen.de</A>&gt;
  * Copyright (C) 2007 Stephan A&#223;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
- * Copyright (C) 2007 Fredrik Mod&#233;en &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">fredrik at modeen.se</A>&gt;
+ * Copyright (C) 2008 Fredrik Mod&#233;en 	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">fredrik at modeen.se</A>&gt; (I have no problem changing my things to MIT)
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -34,6 +34,8 @@
 #include &lt;Message.h&gt;
 #include &lt;Path.h&gt;
 
+#include &quot;FileReadWrite.h&quot;
+
 using std::nothrow;
 
 // TODO: using BList for objects is bad, replace it with a template
@@ -281,8 +283,7 @@
 
 	entry_ref ref;
 	for (int i = 0; refsReceivedMessage-&gt;FindRef(&quot;refs&quot;, i, &amp;ref) == B_OK; i++) 
-		AppendToPlaylistRecursive(ref, playlist);	
-
+		AppendToPlaylistRecursive(ref, playlist);
 	playlist-&gt;Sort();
 
 	if (add)
@@ -300,10 +301,17 @@
 {
 	// recursively append the ref (dive into folders)
 	BEntry entry(&amp;ref, true);
-	if (entry.InitCheck() &lt; B_OK)
+	if (entry.InitCheck() &lt; B_OK) {
+		printf(&quot;Not OK\n&quot;);
 		return;
-	if (!entry.Exists())
+	}
+	
+	if (!entry.Exists()) {
+		BPath path = BPath(&amp;ref);
+		//printf(&quot;Don't exist - %s\n&quot;, path.Path());
 		return;
+	}
+	
 	if (entry.IsDirectory()) {
 		BDirectory dir(&amp;entry);
 		if (dir.InitCheck() &lt; B_OK)
@@ -313,13 +321,35 @@
 		while (dir.GetNextRef(&amp;subRef) == B_OK)
 			AppendToPlaylistRecursive(subRef, playlist);
 	} else if (entry.IsFile()) {
+		//printf(&quot;Is File\n&quot;);
 		BString mimeString = _MIMEString(&amp;ref);
-		if (_IsMediaFile(mimeString))
+		if (_IsMediaFile(mimeString)) {
+			//printf(&quot;Adding\n&quot;);
 			playlist-&gt;AddRef(ref);
-		else if (_IsPlaylist(mimeString)) {
-			printf(&quot;Playlist::AppendToPlaylistRecursive() - &quot;
-				&quot;TODO: implement playlist file loading\n&quot;);
-		}
+		} else if (_IsPlaylist(mimeString)) {
+			//printf(&quot;RunPlaylist thing\n&quot;);
+			BFile file(&amp;ref, B_READ_ONLY);
+			FileReadWrite lineReader(&amp;file);
+	
+			BString str;
+			entry_ref refPath; 
+			status_t err; 
+			BPath path;
+			while (lineReader.Next(str)) {
+				str = str.RemoveFirst(&quot;<A HREF="file://">file://</A>&quot;);
+				str = str.RemoveLast(&quot;..&quot;);
+				path = BPath(str.String());
+				printf(&quot;Line %s\n&quot;, path.Path());
+				if (path.Path() != NULL) {
+					if ((err = get_ref_for_path(path.Path(), &amp;refPath)) == B_OK) {
+						playlist-&gt;AddRef(refPath);
+					} else			
+						printf(&quot;Error - %s: [%lx]\n&quot;, strerror(err), (int32) err);
+				} else
+					printf(&quot;Error - No File Found in playlist\n&quot;);
+			}
+		} else
+			printf(&quot;MIME Type = %s\n&quot;, mimeString.String());
 	}
 }
 
@@ -331,7 +361,6 @@
 Playlist::playlist_cmp(const void *p1, const void *p2)
 {
 	// compare complete path
-
 	BEntry a(*(const entry_ref **)p1, false);
 	BEntry b(*(const entry_ref **)p2, false);
 
@@ -342,6 +371,30 @@
 }
 
 
+/*static*/ void
+Playlist::_AddPlayListFileToPlayList(const entry_ref&amp; ref, Playlist* playlist)
+{
+	
+	BFile file(&amp;ref, B_READ_ONLY);
+	FileReadWrite lineReader(&amp;file);
+	
+	BString str;
+	while (lineReader.Next(str)) {
+		BPath path = BPath(str.String());
+		entry_ref refPath; 
+		status_t err; 
+		if ((err = get_ref_for_path(path.Path(), &amp;refPath)) == B_OK) {
+			AppendToPlaylistRecursive(refPath, playlist);
+		} else			
+			printf(&quot;Error - %s: [%lx]\n&quot;, strerror(err), (int32) err);
+	}
+	/*
+		Read line for x to the end of file (while?)
+		make a enty_ref and call AppendToPlaylistRecursive(with new entry, playlist)
+	*/
+}
+
+
 /*static*/ bool
 Playlist::_IsMediaFile(const BString&amp; mimeString)
 {

Modified: haiku/trunk/src/apps/mediaplayer/playlist/Playlist.h
===================================================================
--- haiku/trunk/src/apps/mediaplayer/playlist/Playlist.h	2008-03-31 21:23:38 UTC (rev 24714)
+++ haiku/trunk/src/apps/mediaplayer/playlist/Playlist.h	2008-04-01 07:42:35 UTC (rev 24715)
@@ -1,8 +1,9 @@
 /*
  * Playlist.h - Media Player for the Haiku Operating System
  *
- * Copyright (C) 2006 Marcus Overhagen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">marcus at overhagen.de</A>&gt;
- * Copyright (C) 2007 Stephan A&#223;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ * Copyright (C) 2006 Marcus Overhagen 	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">marcus at overhagen.de</A>&gt;
+ * Copyright (C) 2007 Stephan A&#223;mus 	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ * Copyright (C) 2008 Fredrik Mod&#233;en 	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">fredrik at modeen.se</A>&gt; (I have no problem changing my things to MIT)
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -88,7 +89,8 @@
 			static bool 		_IsMediaFile(const BString&amp; mimeString);
 			static bool			_IsPlaylist(const BString&amp; mimeString);
 			static BString		_MIMEString(const entry_ref* entry);
-
+			static void 		_AddPlayListFileToPlayList(const entry_ref&amp; ref,
+									Playlist* playlist);
 			void				_NotifyRefAdded(const entry_ref&amp; ref,
 									int32 index) const;
 			void				_NotifyRefRemoved(int32 index) const;

Modified: haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.cpp
===================================================================
--- haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.cpp	2008-03-31 21:23:38 UTC (rev 24714)
+++ haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.cpp	2008-04-01 07:42:35 UTC (rev 24715)
@@ -3,22 +3,41 @@
  * Distributed under the terms of the MIT License.
  *
  * Authors:
- *		Stephan A&#223;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ *		Stephan A&#223;mus 	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ *		Fredrik Mod&#233;en	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">fredrik at modeen.se</A>&gt;
  */
+ 
 #include &quot;PlaylistWindow.h&quot;
 
+#include &lt;stdio.h&gt;
+
+#include &lt;Application.h&gt;
+#include &lt;Roster.h&gt;
+#include &lt;Path.h&gt;
 #include &lt;Menu.h&gt;
 #include &lt;MenuBar.h&gt;
 #include &lt;MenuItem.h&gt;
 #include &lt;ScrollBar.h&gt;
 #include &lt;ScrollView.h&gt;
 #include &lt;String.h&gt;
+#include &lt;Box.h&gt;
+#include &lt;Button.h&gt;
+#include &lt;FilePanel.h&gt;
 
 #include &quot;CommandStack.h&quot;
 #include &quot;PlaylistListView.h&quot;
 #include &quot;RWLocker.h&quot;
 
+#define DEBUG 1
 
+enum {
+	M_PLAYLIST_OPEN		= 'open',
+	M_PLAYLIST_SAVE		= 'save',
+	M_PLAYLIST_EMPTY	= 'emty'
+};
+
+#define SPACE 5
+
 PlaylistWindow::PlaylistWindow(BRect frame, Playlist* playlist,
 		Controller* controller)
 	: BWindow(frame, &quot;Playlist&quot;, B_DOCUMENT_WINDOW_LOOK, B_NORMAL_WINDOW_FEEL,
@@ -28,18 +47,19 @@
 	, fCommandStack(new CommandStack(fLocker))
 	, fCommandStackListener(this)
 {
-	frame = Bounds();
-
+	frame = Bounds();	
+	
 	_CreateMenu(frame);
-
+		// will adjust frame to account for menubar
+	
 	frame.right -= B_V_SCROLL_BAR_WIDTH;
 	fListView = new PlaylistListView(frame, playlist, controller,
 		fCommandStack);
 
-	BScrollView* scrollView = new BScrollView(&quot;playlist scrollview&quot;,
-		fListView, B_FOLLOW_ALL, 0, false, true, B_NO_BORDER);
+	BScrollView* scrollView = new BScrollView(&quot;playlist scrollview&quot;, fListView, 
+		B_FOLLOW_ALL_SIDES, 0, false, true, B_NO_BORDER);
 
-	fTopView = scrollView;
+	fTopView = 	scrollView;
 	AddChild(fTopView);
 
 	// small visual tweak
@@ -109,7 +129,23 @@
 			}
 			break;
 		}
-
+		
+		case M_PLAYLIST_SAVE:
+			if (!fSavePanel)
+				fSavePanel = new BFilePanel(B_SAVE_PANEL);
+			fSavePanel-&gt;Show();
+			break;
+		case B_SAVE_REQUESTED:
+			printf(&quot;We are saving\n&quot;);
+			//Use fListView and have a SaveToFile?
+			break;		
+		case M_PLAYLIST_OPEN:
+			if (!fOpenPanel)
+				fOpenPanel = new BFilePanel(B_OPEN_PANEL);
+			fOpenPanel-&gt;Show();
+			break;						
+		case M_PLAYLIST_EMPTY:
+			break;						
 		default:
 			BWindow::MessageReceived(message);
 			break;
@@ -127,15 +163,22 @@
 	BMenuBar* menuBar = new BMenuBar(frame, &quot;main menu&quot;);
 	BMenu* fileMenu = new BMenu(&quot;Playlist&quot;);
 	menuBar-&gt;AddItem(fileMenu);
-	// TODO add some items: &quot;Open&quot;, &quot;Save&quot;, &quot;Make Empty&quot;...
+//	fileMenu-&gt;AddItem(new BMenuItem(&quot;Open&quot;B_UTF8_ELLIPSIS,
+//		new BMessage(M_PLAYLIST_OPEN), 'O'));
+//	fileMenu-&gt;AddItem(new BMenuItem(&quot;Save&quot;B_UTF8_ELLIPSIS,
+//		new BMessage(M_PLAYLIST_SAVE), 'S'));	
+//	fileMenu-&gt;AddSeparatorItem();
+	fileMenu-&gt;AddItem(new BMenuItem(&quot;Close&quot;,
+		new BMessage(B_QUIT_REQUESTED), 'W'));
 
 	BMenu* editMenu = new BMenu(&quot;Edit&quot;);
-	BMessage* message = new BMessage(B_UNDO);
-	fUndoMI = new BMenuItem(&quot;Undo&quot;, message);
+	fUndoMI = new BMenuItem(&quot;Undo&quot;, new BMessage(B_UNDO), 'Z');
 	editMenu-&gt;AddItem(fUndoMI);
-	message = new BMessage(B_REDO);
-	fRedoMI = new BMenuItem(&quot;Undo&quot;, message);
+	fRedoMI = new BMenuItem(&quot;Redo&quot;, new BMessage(B_REDO), 'Z', B_SHIFT_KEY);
 	editMenu-&gt;AddItem(fRedoMI);
+	editMenu-&gt;AddSeparatorItem();
+	editMenu-&gt;AddItem(new BMenuItem(&quot;Make Empty&quot;,
+		new BMessage(M_PLAYLIST_EMPTY), 'N'));
 	menuBar-&gt;AddItem(editMenu);
 
 	AddChild(menuBar);

Modified: haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.h
===================================================================
--- haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.h	2008-03-31 21:23:38 UTC (rev 24714)
+++ haiku/trunk/src/apps/mediaplayer/playlist/PlaylistWindow.h	2008-04-01 07:42:35 UTC (rev 24715)
@@ -3,8 +3,10 @@
  * Distributed under the terms of the MIT License.
  *
  * Authors:
- *		Stephan A&#223;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ *		Stephan A&#223;mus 	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ *		Fredrik Mod&#233;en 	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">fredrik at modeen.se</A>&gt;
  */
+ 
 #ifndef PLAYLIST_WINDOW_H
 #define PLAYLIST_WINDOW_H
 
@@ -21,6 +23,7 @@
 class Playlist;
 class PlaylistListView;
 class RWLocker;
+class BButton;
 
 class PlaylistWindow : public BWindow {
  public:
@@ -42,6 +45,9 @@
 			BView*				fTopView;
 			BMenuItem*			fUndoMI;
 			BMenuItem*			fRedoMI;
+			
+			BFilePanel*			fOpenPanel;
+			BFilePanel*			fSavePanel;
 
 			RWLocker*			fLocker;
 			CommandStack*		fCommandStack;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007312.html">[Haiku-commits] r24671 - in haiku/trunk: headers/private/media src/kits/media
</A></li>
	<LI>Next message: <A HREF="007311.html">[Haiku-commits] r24716 - in haiku/trunk/src/apps/mediaplayer: .	settings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7310">[ date ]</a>
              <a href="thread.html#7310">[ thread ]</a>
              <a href="subject.html#7310">[ subject ]</a>
              <a href="author.html#7310">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
