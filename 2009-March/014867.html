<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r29534 -	haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-March/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29534%20-%0A%09haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale&In-Reply-To=%3C200903150134.n2F1YPV5011682%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014866.html">
   <LINK REL="Next"  HREF="014868.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r29534 -	haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale</H1>
    <B>dlmcpaul at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29534%20-%0A%09haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale&In-Reply-To=%3C200903150134.n2F1YPV5011682%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r29534 -	haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale">dlmcpaul at mail.berlios.de
       </A><BR>
    <I>Sun Mar 15 02:34:25 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="014866.html">[Haiku-commits] r29533 - haiku/trunk/src/apps/terminal
</A></li>
        <LI>Next message: <A HREF="014868.html">[Haiku-commits] r29535 - in	haiku/trunk/src/add-ons/media/plugins/avcodec/libavutil: . x86
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14867">[ date ]</a>
              <a href="thread.html#14867">[ thread ]</a>
              <a href="subject.html#14867">[ subject ]</a>
              <a href="author.html#14867">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dlmcpaul
Date: 2009-03-15 02:34:21 +0100 (Sun, 15 Mar 2009)
New Revision: 29534
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=29534&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=29534&amp;view=rev</A>

Removed:
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/cs_test.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale-example.c
Modified:
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/Jamfile
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.h
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb_template.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale.h
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale_altivec_template.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale_avoption.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale_bfin.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale_internal.h
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/swscale_template.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/yuv2rgb.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/yuv2rgb_altivec.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/yuv2rgb_bfin.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/yuv2rgb_mlib.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/yuv2rgb_template.c
   haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/yuv2rgb_vis.c
Log:
sync with ffmpeg 0.5 release

Modified: haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/Jamfile	2009-03-14 22:19:35 UTC (rev 29533)
+++ haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/Jamfile	2009-03-15 01:34:21 UTC (rev 29534)
@@ -1,5 +1,6 @@
 SubDir HAIKU_TOP src add-ons media plugins avcodec libswscale ;
 
+SubDirHdrs [ FDirName $(SUBDIR) .. ] ;
 SubDirHdrs [ FDirName $(SUBDIR) ../libavutil ] ;
 SubDirHdrs [ FDirName $(SUBDIR) ../libavcodec ] ;
 
@@ -8,7 +9,7 @@
 	: -Wall -Wmissing-prototypes -Wsign-compare -Wpointer-arith ] ;
 
 SubDirCcFlags -fomit-frame-pointer -DPIC ;
-SubDirCcFlags -DHAVE_AV_CONFIG_H=1 ;
+#SubDirCcFlags -DHAVE_AV_CONFIG_H=1 ;
 
 StaticLibrary libswscale.a :
 	rgb2rgb.c

Deleted: haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/cs_test.c

Modified: haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.c
===================================================================
--- haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.c	2009-03-14 22:19:35 UTC (rev 29533)
+++ haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.c	2009-03-15 01:34:21 UTC (rev 29534)
@@ -27,32 +27,30 @@
  */
 #include &lt;inttypes.h&gt;
 #include &quot;config.h&quot;
-#include &quot;x86_cpu.h&quot;
-#include &quot;bswap.h&quot;
+#include &quot;libavutil/x86_cpu.h&quot;
+#include &quot;libavutil/bswap.h&quot;
 #include &quot;rgb2rgb.h&quot;
 #include &quot;swscale.h&quot;
 #include &quot;swscale_internal.h&quot;
 
 #define FAST_BGR2YV12 // use 7-bit instead of 15-bit coefficients
 
-void (*rgb24to32)(const uint8_t *src, uint8_t *dst, long src_size);
-void (*rgb24to16)(const uint8_t *src, uint8_t *dst, long src_size);
-void (*rgb24to15)(const uint8_t *src, uint8_t *dst, long src_size);
-void (*rgb32to24)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb24tobgr32)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb24tobgr16)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb24tobgr15)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb32tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb32to16)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb32to15)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb15to16)(const uint8_t *src, uint8_t *dst, long src_size);
-void (*rgb15to24)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb15tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb15to32)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb16to15)(const uint8_t *src, uint8_t *dst, long src_size);
-void (*rgb16to24)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb16tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb16to32)(const uint8_t *src, uint8_t *dst, long src_size);
-//void (*rgb24tobgr32)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb24tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
-void (*rgb24tobgr16)(const uint8_t *src, uint8_t *dst, long src_size);
-void (*rgb24tobgr15)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb24to16)(const uint8_t *src, uint8_t *dst, long src_size);
+void (*rgb24to15)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb32tobgr32)(const uint8_t *src, uint8_t *dst, long src_size);
-//void (*rgb32tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb32tobgr16)(const uint8_t *src, uint8_t *dst, long src_size);
 void (*rgb32tobgr15)(const uint8_t *src, uint8_t *dst, long src_size);
 
@@ -65,6 +63,9 @@
 void (*yuv422ptoyuy2)(const uint8_t *ysrc, const uint8_t *usrc, const uint8_t *vsrc, uint8_t *dst,
                       long width, long height,
                       long lumStride, long chromStride, long dstStride);
+void (*yuv422ptouyvy)(const uint8_t *ysrc, const uint8_t *usrc, const uint8_t *vsrc, uint8_t *dst,
+                      long width, long height,
+                      long lumStride, long chromStride, long dstStride);
 void (*yuy2toyv12)(const uint8_t *src, uint8_t *ydst, uint8_t *udst, uint8_t *vdst,
                    long width, long height,
                    long lumStride, long chromStride, long srcStride);
@@ -87,12 +88,13 @@
                      long srcStride1, long srcStride2,
                      long srcStride3, long dstStride);
 
-#if defined(ARCH_X86) &amp;&amp; defined(CONFIG_GPL)
+#if ARCH_X86 &amp;&amp; CONFIG_GPL
 DECLARE_ASM_CONST(8, uint64_t, mmx_null)     = 0x0000000000000000ULL;
 DECLARE_ASM_CONST(8, uint64_t, mmx_one)      = 0xFFFFFFFFFFFFFFFFULL;
 DECLARE_ASM_CONST(8, uint64_t, mask32b)      = 0x000000FF000000FFULL;
 DECLARE_ASM_CONST(8, uint64_t, mask32g)      = 0x0000FF000000FF00ULL;
 DECLARE_ASM_CONST(8, uint64_t, mask32r)      = 0x00FF000000FF0000ULL;
+DECLARE_ASM_CONST(8, uint64_t, mask32a)      = 0xFF000000FF000000ULL;
 DECLARE_ASM_CONST(8, uint64_t, mask32)       = 0x00FFFFFF00FFFFFFULL;
 DECLARE_ASM_CONST(8, uint64_t, mask3216br)   = 0x00F800F800F800F8ULL;
 DECLARE_ASM_CONST(8, uint64_t, mask3216g)    = 0x0000FC000000FC00ULL;
@@ -121,23 +123,8 @@
 DECLARE_ASM_CONST(8, uint64_t, red_15mask)   = 0x00007c0000007c00ULL;
 DECLARE_ASM_CONST(8, uint64_t, green_15mask) = 0x000003e0000003e0ULL;
 DECLARE_ASM_CONST(8, uint64_t, blue_15mask)  = 0x0000001f0000001fULL;
+#endif /* ARCH_X86 */
 
-#if 0
-static volatile uint64_t __attribute__((aligned(8))) b5Dither;
-static volatile uint64_t __attribute__((aligned(8))) g5Dither;
-static volatile uint64_t __attribute__((aligned(8))) g6Dither;
-static volatile uint64_t __attribute__((aligned(8))) r5Dither;
-
-static uint64_t __attribute__((aligned(8))) dither4[2]={
-    0x0103010301030103LL,
-    0x0200020002000200LL,};
-
-static uint64_t __attribute__((aligned(8))) dither8[2]={
-    0x0602060206020602LL,
-    0x0004000400040004LL,};
-#endif
-#endif /* defined(ARCH_X86) */
-
 #define RGB2YUV_SHIFT 8
 #define BY ((int)( 0.098*(1&lt;&lt;RGB2YUV_SHIFT)+0.5))
 #define BV ((int)(-0.071*(1&lt;&lt;RGB2YUV_SHIFT)+0.5))
@@ -153,37 +140,37 @@
 //plain C versions
 #undef HAVE_MMX
 #undef HAVE_MMX2
-#undef HAVE_3DNOW
+#undef HAVE_AMD3DNOW
 #undef HAVE_SSE2
+#define HAVE_MMX 0
+#define HAVE_MMX2 0
+#define HAVE_AMD3DNOW 0
+#define HAVE_SSE2 0
 #define RENAME(a) a ## _C
 #include &quot;rgb2rgb_template.c&quot;
 
-#if defined(ARCH_X86) &amp;&amp; defined(CONFIG_GPL)
+#if ARCH_X86 &amp;&amp; CONFIG_GPL
 
 //MMX versions
 #undef RENAME
-#define HAVE_MMX
-#undef HAVE_MMX2
-#undef HAVE_3DNOW
-#undef HAVE_SSE2
+#undef HAVE_MMX
+#define HAVE_MMX 1
 #define RENAME(a) a ## _MMX
 #include &quot;rgb2rgb_template.c&quot;
 
 //MMX2 versions
 #undef RENAME
-#define HAVE_MMX
-#define HAVE_MMX2
-#undef HAVE_3DNOW
-#undef HAVE_SSE2
+#undef HAVE_MMX2
+#define HAVE_MMX2 1
 #define RENAME(a) a ## _MMX2
 #include &quot;rgb2rgb_template.c&quot;
 
 //3DNOW versions
 #undef RENAME
-#define HAVE_MMX
 #undef HAVE_MMX2
-#define HAVE_3DNOW
-#undef HAVE_SSE2
+#undef HAVE_AMD3DNOW
+#define HAVE_MMX2 0
+#define HAVE_AMD3DNOW 1
 #define RENAME(a) a ## _3DNOW
 #include &quot;rgb2rgb_template.c&quot;
 
@@ -197,7 +184,7 @@
 */
 
 void sws_rgb2rgb_init(int flags){
-#if (defined(HAVE_MMX2) || defined(HAVE_3DNOW) || defined(HAVE_MMX))  &amp;&amp; defined(CONFIG_GPL)
+#if (HAVE_MMX2 || HAVE_AMD3DNOW || HAVE_MMX)  &amp;&amp; CONFIG_GPL
     if (flags &amp; SWS_CPU_CAPS_MMX2)
         rgb2rgb_init_MMX2();
     else if (flags &amp; SWS_CPU_CAPS_3DNOW)
@@ -205,90 +192,29 @@
     else if (flags &amp; SWS_CPU_CAPS_MMX)
         rgb2rgb_init_MMX();
     else
-#endif /* defined(HAVE_MMX2) || defined(HAVE_3DNOW) || defined(HAVE_MMX) */
+#endif /* HAVE_MMX2 || HAVE_AMD3DNOW || HAVE_MMX */
         rgb2rgb_init_C();
 }
 
 /**
- * Palette is assumed to contain BGR32.
+ * Convert the palette to the same packet 32-bit format as the palette
  */
-void palette8torgb32(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette)
+void palette8topacked32(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette)
 {
     long i;
 
-/*
     for (i=0; i&lt;num_pixels; i++)
-        ((unsigned *)dst)[i] = ((unsigned *)palette)[src[i]];
-*/
-
-    for (i=0; i&lt;num_pixels; i++)
-    {
-        #ifdef WORDS_BIGENDIAN
-            dst[3]= palette[src[i]*4+2];
-            dst[2]= palette[src[i]*4+1];
-            dst[1]= palette[src[i]*4+0];
-        #else
-        //FIXME slow?
-            dst[0]= palette[src[i]*4+2];
-            dst[1]= palette[src[i]*4+1];
-            dst[2]= palette[src[i]*4+0];
-            //dst[3]= 0; /* do we need this cleansing? */
-        #endif
-        dst+= 4;
-    }
+        ((uint32_t *) dst)[i] = ((const uint32_t *) palette)[src[i]];
 }
 
-void palette8tobgr32(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette)
-{
-    long i;
-    for (i=0; i&lt;num_pixels; i++)
-    {
-        #ifdef WORDS_BIGENDIAN
-            dst[3]= palette[src[i]*4+0];
-            dst[2]= palette[src[i]*4+1];
-            dst[1]= palette[src[i]*4+2];
-        #else
-            //FIXME slow?
-            dst[0]= palette[src[i]*4+0];
-            dst[1]= palette[src[i]*4+1];
-            dst[2]= palette[src[i]*4+2];
-            //dst[3]= 0; /* do we need this cleansing? */
-        #endif
-
-        dst+= 4;
-    }
-}
-
 /**
- * Palette is assumed to contain BGR32.
+ * Palette format: ABCD -&gt; dst format: ABC
  */
-void palette8torgb24(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette)
+void palette8topacked24(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette)
 {
     long i;
-/*
-    Writes 1 byte too much and might cause alignment issues on some architectures?
-    for (i=0; i&lt;num_pixels; i++)
-        ((unsigned *)(&amp;dst[i*3])) = ((unsigned *)palette)[src[i]];
-*/
-    for (i=0; i&lt;num_pixels; i++)
-    {
-        //FIXME slow?
-        dst[0]= palette[src[i]*4+2];
-        dst[1]= palette[src[i]*4+1];
-        dst[2]= palette[src[i]*4+0];
-        dst+= 3;
-    }
-}
 
-void palette8tobgr24(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette)
-{
-    long i;
-/*
-    Writes 1 byte too much and might cause alignment issues on some architectures?
     for (i=0; i&lt;num_pixels; i++)
-        ((unsigned *)(&amp;dst[i*3])) = ((unsigned *)palette)[src[i]];
-*/
-    for (i=0; i&lt;num_pixels; i++)
     {
         //FIXME slow?
         dst[0]= palette[src[i]*4+0];
@@ -330,7 +256,7 @@
         ((uint16_t *)dst)[i] = bswap_16(((const uint16_t *)palette)[src[i]]);
 }
 
-void rgb32tobgr24(const uint8_t *src, uint8_t *dst, long src_size)
+void rgb32to24(const uint8_t *src, uint8_t *dst, long src_size)
 {
     long i;
     long num_pixels = src_size &gt;&gt; 2;
@@ -349,14 +275,14 @@
     }
 }
 
-void rgb24tobgr32(const uint8_t *src, uint8_t *dst, long src_size)
+void rgb24to32(const uint8_t *src, uint8_t *dst, long src_size)
 {
     long i;
     for (i=0; 3*i&lt;src_size; i++)
     {
         #ifdef WORDS_BIGENDIAN
             /* RGB24 (= R,G,B) -&gt; BGR32 (= A,R,G,B) */
-            dst[4*i + 0] = 0;
+            dst[4*i + 0] = 255;
             dst[4*i + 1] = src[3*i + 0];
             dst[4*i + 2] = src[3*i + 1];
             dst[4*i + 3] = src[3*i + 2];
@@ -364,7 +290,7 @@
             dst[4*i + 0] = src[3*i + 2];
             dst[4*i + 1] = src[3*i + 1];
             dst[4*i + 2] = src[3*i + 0];
-            dst[4*i + 3] = 0;
+            dst[4*i + 3] = 255;
         #endif
     }
 }
@@ -380,7 +306,7 @@
         register uint16_t bgr;
         bgr = *s++;
         #ifdef WORDS_BIGENDIAN
-            *d++ = 0;
+            *d++ = 255;
             *d++ = (bgr&amp;0x1F)&lt;&lt;3;
             *d++ = (bgr&amp;0x7E0)&gt;&gt;3;
             *d++ = (bgr&amp;0xF800)&gt;&gt;8;
@@ -388,12 +314,12 @@
             *d++ = (bgr&amp;0xF800)&gt;&gt;8;
             *d++ = (bgr&amp;0x7E0)&gt;&gt;3;
             *d++ = (bgr&amp;0x1F)&lt;&lt;3;
-            *d++ = 0;
+            *d++ = 255;
         #endif
     }
 }
 
-void rgb16tobgr24(const uint8_t *src, uint8_t *dst, long src_size)
+void rgb16to24(const uint8_t *src, uint8_t *dst, long src_size)
 {
     const uint16_t *end;
     uint8_t *d = dst;
@@ -416,13 +342,8 @@
 
     for (i=0; i&lt;num_pixels; i++)
     {
-        unsigned b,g,r;
-        register uint16_t rgb;
-        rgb = src[2*i];
-        r = rgb&amp;0x1F;
-        g = (rgb&amp;0x7E0)&gt;&gt;5;
-        b = (rgb&amp;0xF800)&gt;&gt;11;
-        dst[2*i] = (b&amp;0x1F) | ((g&amp;0x3F)&lt;&lt;5) | ((r&amp;0x1F)&lt;&lt;11);
+        unsigned rgb = ((const uint16_t*)src)[i];
+        ((uint16_t*)dst)[i] = (rgb&gt;&gt;11) | (rgb&amp;0x7E0) | (rgb&lt;&lt;11);
     }
 }
 
@@ -433,13 +354,8 @@
 
     for (i=0; i&lt;num_pixels; i++)
     {
-        unsigned b,g,r;
-        register uint16_t rgb;
-        rgb = src[2*i];
-        r = rgb&amp;0x1F;
-        g = (rgb&amp;0x7E0)&gt;&gt;5;
-        b = (rgb&amp;0xF800)&gt;&gt;11;
-        dst[2*i] = (b&amp;0x1F) | ((g&amp;0x1F)&lt;&lt;5) | ((r&amp;0x1F)&lt;&lt;10);
+        unsigned rgb = ((const uint16_t*)src)[i];
+        ((uint16_t*)dst)[i] = (rgb&gt;&gt;11) | ((rgb&amp;0x7C0)&gt;&gt;1) | ((rgb&amp;0x1F)&lt;&lt;10);
     }
 }
 
@@ -454,7 +370,7 @@
         register uint16_t bgr;
         bgr = *s++;
         #ifdef WORDS_BIGENDIAN
-            *d++ = 0;
+            *d++ = 255;
             *d++ = (bgr&amp;0x1F)&lt;&lt;3;
             *d++ = (bgr&amp;0x3E0)&gt;&gt;2;
             *d++ = (bgr&amp;0x7C00)&gt;&gt;7;
@@ -462,12 +378,12 @@
             *d++ = (bgr&amp;0x7C00)&gt;&gt;7;
             *d++ = (bgr&amp;0x3E0)&gt;&gt;2;
             *d++ = (bgr&amp;0x1F)&lt;&lt;3;
-            *d++ = 0;
+            *d++ = 255;
         #endif
     }
 }
 
-void rgb15tobgr24(const uint8_t *src, uint8_t *dst, long src_size)
+void rgb15to24(const uint8_t *src, uint8_t *dst, long src_size)
 {
     const uint16_t *end;
     uint8_t *d = dst;
@@ -490,13 +406,8 @@
 
     for (i=0; i&lt;num_pixels; i++)
     {
-        unsigned b,g,r;
-        register uint16_t rgb;
-        rgb = src[2*i];
-        r = rgb&amp;0x1F;
-        g = (rgb&amp;0x3E0)&gt;&gt;5;
-        b = (rgb&amp;0x7C00)&gt;&gt;10;
-        dst[2*i] = (b&amp;0x1F) | ((g&amp;0x3F)&lt;&lt;5) | ((r&amp;0x1F)&lt;&lt;11);
+        unsigned rgb = ((const uint16_t*)src)[i];
+        ((uint16_t*)dst)[i] = ((rgb&amp;0x7C00)&gt;&gt;10) | ((rgb&amp;0x3E0)&lt;&lt;1) | (rgb&lt;&lt;11);
     }
 }
 
@@ -507,17 +418,14 @@
 
     for (i=0; i&lt;num_pixels; i++)
     {
-        unsigned b,g,r;
-        register uint16_t rgb;
-        rgb = src[2*i];
-        r = rgb&amp;0x1F;
-        g = (rgb&amp;0x3E0)&gt;&gt;5;
-        b = (rgb&amp;0x7C00)&gt;&gt;10;
-        dst[2*i] = (b&amp;0x1F) | ((g&amp;0x1F)&lt;&lt;5) | ((r&amp;0x1F)&lt;&lt;10);
+        unsigned br;
+        unsigned rgb = ((const uint16_t*)src)[i];
+        br = rgb&amp;0x7c1F;
+        ((uint16_t*)dst)[i] = (br&gt;&gt;10) | (rgb&amp;0x3E0) | (br&lt;&lt;10);
     }
 }
 
-void rgb8tobgr8(const uint8_t *src, uint8_t *dst, long src_size)
+void bgr8torgb8(const uint8_t *src, uint8_t *dst, long src_size)
 {
     long i;
     long num_pixels = src_size;

Modified: haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.h
===================================================================
--- haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.h	2009-03-14 22:19:35 UTC (rev 29533)
+++ haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb.h	2009-03-15 01:34:21 UTC (rev 29534)
@@ -23,58 +23,56 @@
  * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
  */
 
-#ifndef FFMPEG_RGB2RGB_H
-#define FFMPEG_RGB2RGB_H
+#ifndef SWSCALE_RGB2RGB_H
+#define SWSCALE_RGB2RGB_H
 
 #include &lt;inttypes.h&gt;
 
 /* A full collection of RGB to RGB(BGR) converters */
-extern void (*rgb24to32)   (const uint8_t *src, uint8_t *dst, long src_size);
-extern void (*rgb24to16)   (const uint8_t *src, uint8_t *dst, long src_size);
-extern void (*rgb24to15)   (const uint8_t *src, uint8_t *dst, long src_size);
-extern void (*rgb32to24)   (const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb24tobgr32)(const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb24tobgr16)(const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb24tobgr15)(const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb32tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb32to16)   (const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb32to15)   (const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb15to16)   (const uint8_t *src, uint8_t *dst, long src_size);
-extern void (*rgb15to24)   (const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb15tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb15to32)   (const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb16to15)   (const uint8_t *src, uint8_t *dst, long src_size);
-extern void (*rgb16to24)   (const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb16tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb16to32)   (const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb24tobgr24)(const uint8_t *src, uint8_t *dst, long src_size);
-extern void (*rgb24tobgr16)(const uint8_t *src, uint8_t *dst, long src_size);
-extern void (*rgb24tobgr15)(const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb24to16)   (const uint8_t *src, uint8_t *dst, long src_size);
+extern void (*rgb24to15)   (const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb32tobgr32)(const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb32tobgr16)(const uint8_t *src, uint8_t *dst, long src_size);
 extern void (*rgb32tobgr15)(const uint8_t *src, uint8_t *dst, long src_size);
 
-extern void rgb24tobgr32(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb32tobgr24(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb16tobgr32(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb16tobgr24(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb16tobgr16(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb16tobgr15(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb15tobgr32(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb15tobgr24(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb15tobgr16(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb15tobgr15(const uint8_t *src, uint8_t *dst, long src_size);
-extern void rgb8tobgr8  (const uint8_t *src, uint8_t *dst, long src_size);
+void rgb24to32   (const uint8_t *src, uint8_t *dst, long src_size);
+void rgb32to24   (const uint8_t *src, uint8_t *dst, long src_size);
+void rgb16tobgr32(const uint8_t *src, uint8_t *dst, long src_size);
+void rgb16to24   (const uint8_t *src, uint8_t *dst, long src_size);
+void rgb16tobgr16(const uint8_t *src, uint8_t *dst, long src_size);
+void rgb16tobgr15(const uint8_t *src, uint8_t *dst, long src_size);
+void rgb15tobgr32(const uint8_t *src, uint8_t *dst, long src_size);
+void rgb15to24   (const uint8_t *src, uint8_t *dst, long src_size);
+void rgb15tobgr16(const uint8_t *src, uint8_t *dst, long src_size);
+void rgb15tobgr15(const uint8_t *src, uint8_t *dst, long src_size);
+void bgr8torgb8  (const uint8_t *src, uint8_t *dst, long src_size);
 
 
-extern void palette8torgb32(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
-extern void palette8tobgr32(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
-extern void palette8torgb24(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
-extern void palette8tobgr24(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
-extern void palette8torgb16(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
-extern void palette8tobgr16(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
-extern void palette8torgb15(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
-extern void palette8tobgr15(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
+void palette8topacked32(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
+void palette8topacked24(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
+void palette8torgb16(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
+void palette8tobgr16(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
+void palette8torgb15(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
+void palette8tobgr15(const uint8_t *src, uint8_t *dst, long num_pixels, const uint8_t *palette);
 
 /**
  * Height should be a multiple of 2 and width should be a multiple of 16.
  * (If this is a problem for anyone then tell me, and I will fix it.)
  * Chrominance data is only taken from every second line, others are ignored.
- * FIXME: Write HQ version.
+ * FIXME: Write high quality version.
  */
 //void uyvytoyv12(const uint8_t *src, uint8_t *ydst, uint8_t *udst, uint8_t *vdst,
 
@@ -110,10 +108,17 @@
                           long lumStride, long chromStride, long dstStride);
 
 /**
+ * Width should be a multiple of 16.
+ */
+extern void (*yuv422ptouyvy)(const uint8_t *ysrc, const uint8_t *usrc, const uint8_t *vsrc, uint8_t *dst,
+                             long width, long height,
+                             long lumStride, long chromStride, long dstStride);
+
+/**
  * Height should be a multiple of 2 and width should be a multiple of 2.
  * (If this is a problem for anyone then tell me, and I will fix it.)
  * Chrominance data is only taken from every second line, others are ignored.
- * FIXME: Write HQ version.
+ * FIXME: Write high quality version.
  */
 extern void (*rgb24toyv12)(const uint8_t *src, uint8_t *ydst, uint8_t *udst, uint8_t *vdst,
                            long width, long height,
@@ -139,4 +144,4 @@
 
 void sws_rgb2rgb_init(int flags);
 
-#endif /* FFMPEG_RGB2RGB_H */
+#endif /* SWSCALE_RGB2RGB_H */

Modified: haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb_template.c
===================================================================
--- haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb_template.c	2009-03-14 22:19:35 UTC (rev 29533)
+++ haiku/trunk/src/add-ons/media/plugins/avcodec/libswscale/rgb2rgb_template.c	2009-03-15 01:34:21 UTC (rev 29534)
@@ -28,13 +28,7 @@
  */
 
 #include &lt;stddef.h&gt;
-#include &lt;inttypes.h&gt; /* for __WORDSIZE */
 
-#ifndef __WORDSIZE
-// #warning You have a misconfigured system and will probably lose performance!
-#define __WORDSIZE MP_WORDSIZE
-#endif
-
 #undef PREFETCH
 #undef MOVNTQ
 #undef EMMS
@@ -43,38 +37,33 @@
 #undef PREFETCHW
 #undef PAVGB
 
-#ifdef HAVE_SSE2
+#if HAVE_SSE2
 #define MMREG_SIZE 16
 #else
 #define MMREG_SIZE 8
 #endif
 
-#ifdef HAVE_3DNOW
+#if HAVE_AMD3DNOW
 #define PREFETCH  &quot;prefetch&quot;
 #define PREFETCHW &quot;prefetchw&quot;
 #define PAVGB     &quot;pavgusb&quot;
-#elif defined (HAVE_MMX2)
+#elif HAVE_MMX2
 #define PREFETCH &quot;prefetchnta&quot;
 #define PREFETCHW &quot;prefetcht0&quot;
 #define PAVGB     &quot;pavgb&quot;
 #else
-#ifdef __APPLE__
-#define PREFETCH &quot;#&quot;
-#define PREFETCHW &quot;#&quot;
-#else
 #define PREFETCH  &quot; # nop&quot;
 #define PREFETCHW &quot; # nop&quot;
 #endif
-#endif
 
-#ifdef HAVE_3DNOW
-/* On K6 femms is faster than emms. On K7 femms is directly mapped on emms. */
+#if HAVE_AMD3DNOW
+/* On K6 femms is faster than emms. On K7 femms is directly mapped to emms. */
 #define EMMS     &quot;femms&quot;
 #else
 #define EMMS     &quot;emms&quot;
 #endif
 
-#ifdef HAVE_MMX2
+#if HAVE_MMX2
 #define MOVNTQ &quot;movntq&quot;
 #define SFENCE &quot;sfence&quot;
 #else
@@ -82,22 +71,22 @@
 #define SFENCE &quot; # nop&quot;
 #endif
 
-static inline void RENAME(rgb24to32)(const uint8_t *src, uint8_t *dst, long src_size)
+static inline void RENAME(rgb24tobgr32)(const uint8_t *src, uint8_t *dst, long src_size)
 {
     uint8_t *dest = dst;
     const uint8_t *s = src;
     const uint8_t *end;
-    #ifdef HAVE_MMX
+    #if HAVE_MMX
         const uint8_t *mm_end;
     #endif
     end = s + src_size;
-    #ifdef HAVE_MMX
-        asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s):&quot;memory&quot;);
+    #if HAVE_MMX
+        __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s):&quot;memory&quot;);
         mm_end = end - 23;
-        asm volatile(&quot;movq        %0, %%mm7&quot;::&quot;m&quot;(mask32):&quot;memory&quot;);
+        __asm__ volatile(&quot;movq        %0, %%mm7&quot;::&quot;m&quot;(mask32a):&quot;memory&quot;);
         while (s &lt; mm_end)
         {
-            asm volatile(
+            __asm__ volatile(
             PREFETCH&quot;    32%1           \n\t&quot;
             &quot;movd          %1, %%mm0    \n\t&quot;
             &quot;punpckldq    3%1, %%mm0    \n\t&quot;
@@ -107,10 +96,10 @@
             &quot;punpckldq   15%1, %%mm2    \n\t&quot;
             &quot;movd        18%1, %%mm3    \n\t&quot;
             &quot;punpckldq   21%1, %%mm3    \n\t&quot;
-            &quot;pand       %%mm7, %%mm0    \n\t&quot;
-            &quot;pand       %%mm7, %%mm1    \n\t&quot;
-            &quot;pand       %%mm7, %%mm2    \n\t&quot;
-            &quot;pand       %%mm7, %%mm3    \n\t&quot;
+            &quot;por        %%mm7, %%mm0    \n\t&quot;
+            &quot;por        %%mm7, %%mm1    \n\t&quot;
+            &quot;por        %%mm7, %%mm2    \n\t&quot;
+            &quot;por        %%mm7, %%mm3    \n\t&quot;
             MOVNTQ&quot;     %%mm0,   %0     \n\t&quot;
             MOVNTQ&quot;     %%mm1,  8%0     \n\t&quot;
             MOVNTQ&quot;     %%mm2, 16%0     \n\t&quot;
@@ -121,14 +110,14 @@
             dest += 32;
             s += 24;
         }
-        asm volatile(SFENCE:::&quot;memory&quot;);
-        asm volatile(EMMS:::&quot;memory&quot;);
+        __asm__ volatile(SFENCE:::&quot;memory&quot;);
+        __asm__ volatile(EMMS:::&quot;memory&quot;);
     #endif
     while (s &lt; end)
     {
     #ifdef WORDS_BIGENDIAN
         /* RGB24 (= R,G,B) -&gt; RGB32 (= A,B,G,R) */
-        *dest++ = 0;
+        *dest++ = 255;
         *dest++ = s[2];
         *dest++ = s[1];
         *dest++ = s[0];
@@ -137,26 +126,26 @@
         *dest++ = *s++;
         *dest++ = *s++;
         *dest++ = *s++;
-        *dest++ = 0;
+        *dest++ = 255;
     #endif
     }
 }
 
-static inline void RENAME(rgb32to24)(const uint8_t *src, uint8_t *dst, long src_size)
+static inline void RENAME(rgb32tobgr24)(const uint8_t *src, uint8_t *dst, long src_size)
 {
     uint8_t *dest = dst;
     const uint8_t *s = src;
     const uint8_t *end;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     const uint8_t *mm_end;
 #endif
     end = s + src_size;
-#ifdef HAVE_MMX
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s):&quot;memory&quot;);
+#if HAVE_MMX
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s):&quot;memory&quot;);
     mm_end = end - 31;
     while (s &lt; mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;    32%1           \n\t&quot;
         &quot;movq          %1, %%mm0    \n\t&quot;
         &quot;movq         8%1, %%mm1    \n\t&quot;
@@ -207,8 +196,8 @@
         dest += 24;
         s += 32;
     }
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     while (s &lt; end)
     {
@@ -241,13 +230,13 @@
     register const uint8_t *end;
     const uint8_t *mm_end;
     end = s + src_size;
-#ifdef HAVE_MMX
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s));
-    asm volatile(&quot;movq        %0, %%mm4&quot;::&quot;m&quot;(mask15s));
+#if HAVE_MMX
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s));
+    __asm__ volatile(&quot;movq        %0, %%mm4&quot;::&quot;m&quot;(mask15s));
     mm_end = end - 15;
     while (s&lt;mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;  32%1         \n\t&quot;
         &quot;movq        %1, %%mm0  \n\t&quot;
         &quot;movq       8%1, %%mm2  \n\t&quot;
@@ -265,8 +254,8 @@
         d+=16;
         s+=16;
     }
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     mm_end = end - 3;
     while (s &lt; mm_end)
@@ -290,14 +279,14 @@
     register const uint8_t *end;
     const uint8_t *mm_end;
     end = s + src_size;
-#ifdef HAVE_MMX
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s));
-    asm volatile(&quot;movq        %0, %%mm7&quot;::&quot;m&quot;(mask15rg));
-    asm volatile(&quot;movq        %0, %%mm6&quot;::&quot;m&quot;(mask15b));
+#if HAVE_MMX
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*s));
+    __asm__ volatile(&quot;movq        %0, %%mm7&quot;::&quot;m&quot;(mask15rg));
+    __asm__ volatile(&quot;movq        %0, %%mm6&quot;::&quot;m&quot;(mask15b));
     mm_end = end - 15;
     while (s&lt;mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;  32%1         \n\t&quot;
         &quot;movq        %1, %%mm0  \n\t&quot;
         &quot;movq       8%1, %%mm2  \n\t&quot;
@@ -319,8 +308,8 @@
         d+=16;
         s+=16;
     }
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     mm_end = end - 3;
     while (s &lt; mm_end)
@@ -343,15 +332,15 @@
 {
     const uint8_t *s = src;
     const uint8_t *end;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     const uint8_t *mm_end;
 #endif
     uint16_t *d = (uint16_t *)dst;
     end = s + src_size;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     mm_end = end - 15;
 #if 1 //is faster only if multiplies are reasonably fast (FIXME figure out on which CPUs this is faster, on Athlon it is slightly faster)
-    asm volatile(
+    __asm__ volatile(
     &quot;movq           %3, %%mm5   \n\t&quot;
     &quot;movq           %4, %%mm6   \n\t&quot;
     &quot;movq           %5, %%mm7   \n\t&quot;
@@ -386,14 +375,14 @@
     : &quot;r&quot; (mm_end), &quot;m&quot; (mask3216g), &quot;m&quot; (mask3216br), &quot;m&quot; (mul3216)
     );
 #else
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
-    asm volatile(
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
+    __asm__ volatile(
         &quot;movq    %0, %%mm7    \n\t&quot;
         &quot;movq    %1, %%mm6    \n\t&quot;
         ::&quot;m&quot;(red_16mask),&quot;m&quot;(green_16mask));
     while (s &lt; mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;    32%1           \n\t&quot;
         &quot;movd          %1, %%mm0    \n\t&quot;
         &quot;movd         4%1, %%mm3    \n\t&quot;
@@ -427,8 +416,8 @@
         s += 16;
     }
 #endif
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     while (s &lt; end)
     {
@@ -441,21 +430,21 @@
 {
     const uint8_t *s = src;
     const uint8_t *end;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     const uint8_t *mm_end;
 #endif
     uint16_t *d = (uint16_t *)dst;
     end = s + src_size;
-#ifdef HAVE_MMX
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
-    asm volatile(
+#if HAVE_MMX
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
+    __asm__ volatile(
         &quot;movq          %0, %%mm7    \n\t&quot;
         &quot;movq          %1, %%mm6    \n\t&quot;
         ::&quot;m&quot;(red_16mask),&quot;m&quot;(green_16mask));
     mm_end = end - 15;
     while (s &lt; mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;    32%1           \n\t&quot;
         &quot;movd          %1, %%mm0    \n\t&quot;
         &quot;movd         4%1, %%mm3    \n\t&quot;
@@ -488,8 +477,8 @@
         d += 4;
         s += 16;
     }
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     while (s &lt; end)
     {
@@ -502,15 +491,15 @@
 {
     const uint8_t *s = src;
     const uint8_t *end;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     const uint8_t *mm_end;
 #endif
     uint16_t *d = (uint16_t *)dst;
     end = s + src_size;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     mm_end = end - 15;
 #if 1 //is faster only if multiplies are reasonably fast (FIXME figure out on which CPUs this is faster, on Athlon it is slightly faster)
-    asm volatile(
+    __asm__ volatile(
     &quot;movq           %3, %%mm5   \n\t&quot;
     &quot;movq           %4, %%mm6   \n\t&quot;
     &quot;movq           %5, %%mm7   \n\t&quot;
@@ -545,14 +534,14 @@
     : &quot;r&quot; (mm_end), &quot;m&quot; (mask3215g), &quot;m&quot; (mask3216br), &quot;m&quot; (mul3215)
     );
 #else
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
-    asm volatile(
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
+    __asm__ volatile(
         &quot;movq          %0, %%mm7    \n\t&quot;
         &quot;movq          %1, %%mm6    \n\t&quot;
         ::&quot;m&quot;(red_15mask),&quot;m&quot;(green_15mask));
     while (s &lt; mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;    32%1           \n\t&quot;
         &quot;movd          %1, %%mm0    \n\t&quot;
         &quot;movd         4%1, %%mm3    \n\t&quot;
@@ -586,8 +575,8 @@
         s += 16;
     }
 #endif
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     while (s &lt; end)
     {
@@ -600,21 +589,21 @@
 {
     const uint8_t *s = src;
     const uint8_t *end;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     const uint8_t *mm_end;
 #endif
     uint16_t *d = (uint16_t *)dst;
     end = s + src_size;
-#ifdef HAVE_MMX
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
-    asm volatile(
+#if HAVE_MMX
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
+    __asm__ volatile(
         &quot;movq          %0, %%mm7    \n\t&quot;
         &quot;movq          %1, %%mm6    \n\t&quot;
         ::&quot;m&quot;(red_15mask),&quot;m&quot;(green_15mask));
     mm_end = end - 15;
     while (s &lt; mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;    32%1           \n\t&quot;
         &quot;movd          %1, %%mm0    \n\t&quot;
         &quot;movd         4%1, %%mm3    \n\t&quot;
@@ -647,8 +636,8 @@
         d += 4;
         s += 16;
     }
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     while (s &lt; end)
     {
@@ -657,25 +646,25 @@
     }
 }
 
-static inline void RENAME(rgb24to16)(const uint8_t *src, uint8_t *dst, long src_size)
+static inline void RENAME(rgb24tobgr16)(const uint8_t *src, uint8_t *dst, long src_size)
 {
     const uint8_t *s = src;
     const uint8_t *end;
-#ifdef HAVE_MMX
+#if HAVE_MMX
     const uint8_t *mm_end;
 #endif
     uint16_t *d = (uint16_t *)dst;
     end = s + src_size;
-#ifdef HAVE_MMX
-    asm volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
-    asm volatile(
+#if HAVE_MMX
+    __asm__ volatile(PREFETCH&quot;    %0&quot;::&quot;m&quot;(*src):&quot;memory&quot;);
+    __asm__ volatile(
         &quot;movq         %0, %%mm7     \n\t&quot;
         &quot;movq         %1, %%mm6     \n\t&quot;
         ::&quot;m&quot;(red_16mask),&quot;m&quot;(green_16mask));
     mm_end = end - 11;
     while (s &lt; mm_end)
     {
-        asm volatile(
+        __asm__ volatile(
         PREFETCH&quot;    32%1           \n\t&quot;
         &quot;movd          %1, %%mm0    \n\t&quot;
         &quot;movd         3%1, %%mm3    \n\t&quot;
@@ -708,8 +697,8 @@
         d += 4;
         s += 12;
     }
-    asm volatile(SFENCE:::&quot;memory&quot;);
-    asm volatile(EMMS:::&quot;memory&quot;);
+    __asm__ volatile(SFENCE:::&quot;memory&quot;);
+    __asm__ volatile(EMMS:::&quot;memory&quot;);
 #endif
     while (s &lt; end)
     {
@@ -720,25 +709,25 @@
     }
 }
 
-static inline void RENAME(rgb24tobgr16)(const uint8_t *src, uint8_t *dst, long src_size)
+static inline void RENAME(rgb24to16)(const uint8_t *src, uint8_t *dst, long src_size)
 {

[... truncated: 8438 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014866.html">[Haiku-commits] r29533 - haiku/trunk/src/apps/terminal
</A></li>
	<LI>Next message: <A HREF="014868.html">[Haiku-commits] r29535 - in	haiku/trunk/src/add-ons/media/plugins/avcodec/libavutil: . x86
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14867">[ date ]</a>
              <a href="thread.html#14867">[ thread ]</a>
              <a href="subject.html#14867">[ subject ]</a>
              <a href="author.html#14867">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
