<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r29719 - in haiku/trunk: headers/os/drivers	headers/private/fs_shell headers/private/userlandfs/private	src/add-ons/kernel/file_systems/bfs	src/add-ons/kernel/file_systems/fat	src/add-ons/kernel/file_systems/layers/attribute_overlay	src/add-ons/kernel/file_systems/layers/write_overlay	src/add-ons/kernel/file_systems/nfs	src/add-ons/kernel/file_systems/ntfs	src/add-ons/kernel/file_systems/ramfs	src/add-ons/kernel/file_systems/userlandfs/kernel_add_on	src/add-ons/kernel/file_systems/userlandfs/server	src/add-ons/kernel/file_systems/userlandfs/server/beos	src/add-ons/kernel/file_systems/userlandfs/server/fuse	src/add-ons/kernel/file_systems/userlandfs/server/haiku	src/system/kernel/device_manager src/system/kernel/fs	src/tools/fs_shell
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-March/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29719%20-%20in%20haiku/trunk%3A%20headers/os/drivers%0A%09headers/private/fs_shell%20headers/private/userlandfs/private%0A%09src/add-ons/kernel/file_systems/bfs%0A%09src/add-ons/kernel/file_systems/fat%0A%09src/add-ons/kernel/file_systems/layers/attribute_overlay%0A%09src/add-ons/kernel/file_systems/layers/write_overlay%0A%09src/add-ons/kernel/file_systems/nfs%0A%09src/add-ons/kernel/file_systems/ntfs%0A%09src/add-ons/kernel/file_systems/ramfs%0A%09src/add-ons/kernel/file_systems/userlandfs/kernel_add_on%0A%09src/add-ons/kernel/file_systems/userlandfs/server%0A%09src/add-ons/kernel/file_systems/userlandfs/server/beos%0A%09src/add-ons/kernel/file_systems/userlandfs/server/fuse%0A%09src/add-ons/kernel/file_systems/userlandfs/server/haiku%0A%09src/system/kernel/device_manager%20src/system/kernel/fs%0A%09src/tools/fs_shell&In-Reply-To=%3C200903260016.n2Q0Ggn3014900%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015166.html">
   <LINK REL="Next"  HREF="015155.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r29719 - in haiku/trunk: headers/os/drivers	headers/private/fs_shell headers/private/userlandfs/private	src/add-ons/kernel/file_systems/bfs	src/add-ons/kernel/file_systems/fat	src/add-ons/kernel/file_systems/layers/attribute_overlay	src/add-ons/kernel/file_systems/layers/write_overlay	src/add-ons/kernel/file_systems/nfs	src/add-ons/kernel/file_systems/ntfs	src/add-ons/kernel/file_systems/ramfs	src/add-ons/kernel/file_systems/userlandfs/kernel_add_on	src/add-ons/kernel/file_systems/userlandfs/server	src/add-ons/kernel/file_systems/userlandfs/server/beos	src/add-ons/kernel/file_systems/userlandfs/server/fuse	src/add-ons/kernel/file_systems/userlandfs/server/haiku	src/system/kernel/device_manager src/system/kernel/fs	src/tools/fs_shell</H1>
    <B>bonefish at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29719%20-%20in%20haiku/trunk%3A%20headers/os/drivers%0A%09headers/private/fs_shell%20headers/private/userlandfs/private%0A%09src/add-ons/kernel/file_systems/bfs%0A%09src/add-ons/kernel/file_systems/fat%0A%09src/add-ons/kernel/file_systems/layers/attribute_overlay%0A%09src/add-ons/kernel/file_systems/layers/write_overlay%0A%09src/add-ons/kernel/file_systems/nfs%0A%09src/add-ons/kernel/file_systems/ntfs%0A%09src/add-ons/kernel/file_systems/ramfs%0A%09src/add-ons/kernel/file_systems/userlandfs/kernel_add_on%0A%09src/add-ons/kernel/file_systems/userlandfs/server%0A%09src/add-ons/kernel/file_systems/userlandfs/server/beos%0A%09src/add-ons/kernel/file_systems/userlandfs/server/fuse%0A%09src/add-ons/kernel/file_systems/userlandfs/server/haiku%0A%09src/system/kernel/device_manager%20src/system/kernel/fs%0A%09src/tools/fs_shell&In-Reply-To=%3C200903260016.n2Q0Ggn3014900%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r29719 - in haiku/trunk: headers/os/drivers	headers/private/fs_shell headers/private/userlandfs/private	src/add-ons/kernel/file_systems/bfs	src/add-ons/kernel/file_systems/fat	src/add-ons/kernel/file_systems/layers/attribute_overlay	src/add-ons/kernel/file_systems/layers/write_overlay	src/add-ons/kernel/file_systems/nfs	src/add-ons/kernel/file_systems/ntfs	src/add-ons/kernel/file_systems/ramfs	src/add-ons/kernel/file_systems/userlandfs/kernel_add_on	src/add-ons/kernel/file_systems/userlandfs/server	src/add-ons/kernel/file_systems/userlandfs/server/beos	src/add-ons/kernel/file_systems/userlandfs/server/fuse	src/add-ons/kernel/file_systems/userlandfs/server/haiku	src/system/kernel/device_manager src/system/kernel/fs	src/tools/fs_shell">bonefish at mail.berlios.de
       </A><BR>
    <I>Thu Mar 26 01:16:42 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="015166.html">[Haiku-commits] r29718 - in	haiku/trunk/src/add-ons/screen_savers: . flurry
</A></li>
        <LI>Next message: <A HREF="015155.html">[Haiku-commits] r29720 -	haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15153">[ date ]</a>
              <a href="thread.html#15153">[ thread ]</a>
              <a href="subject.html#15153">[ subject ]</a>
              <a href="author.html#15153">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2009-03-26 01:16:34 +0100 (Thu, 26 Mar 2009)
New Revision: 29719
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=29719&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=29719&amp;view=rev</A>

Modified:
   haiku/trunk/headers/os/drivers/fs_interface.h
   haiku/trunk/headers/private/fs_shell/fssh_fs_interface.h
   haiku/trunk/headers/private/userlandfs/private/Requests.h
   haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/fat/file.c
   haiku/trunk/src/add-ons/kernel/file_systems/fat/file.h
   haiku/trunk/src/add-ons/kernel/file_systems/layers/attribute_overlay/attribute_overlay.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/layers/write_overlay/write_overlay.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/nfs/nfs_add_on.c
   haiku/trunk/src/add-ons/kernel/file_systems/ntfs/fs_func.c
   haiku/trunk/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.h
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/kernel_interface.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.h
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.h
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.h
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.h
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.cpp
   haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.h
   haiku/trunk/src/system/kernel/device_manager/devfs.cpp
   haiku/trunk/src/system/kernel/fs/rootfs.cpp
   haiku/trunk/src/system/kernel/fs/vfs.cpp
   haiku/trunk/src/tools/fs_shell/vfs.cpp
Log:
Removed the fs_vnode_ops::create_dir() parameter for returning the ID of the
newly created dir. The VFS really doesn't need it and for some file systems
it might not be easy to get by. Several file systems (e.g. rootfs and fat)
were ignoring the parameter anyway.


Modified: haiku/trunk/headers/os/drivers/fs_interface.h
===================================================================
--- haiku/trunk/headers/os/drivers/fs_interface.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/headers/os/drivers/fs_interface.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -184,7 +184,7 @@
 
 	/* directory operations */
 	status_t (*create_dir)(fs_volume *volume, fs_vnode *parent,
-				const char *name, int perms, ino_t *_newVnodeID);
+				const char *name, int perms);
 	status_t (*remove_dir)(fs_volume *volume, fs_vnode *parent,
 				const char *name);
 	status_t (*open_dir)(fs_volume *volume, fs_vnode *vnode,

Modified: haiku/trunk/headers/private/fs_shell/fssh_fs_interface.h
===================================================================
--- haiku/trunk/headers/private/fs_shell/fssh_fs_interface.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/headers/private/fs_shell/fssh_fs_interface.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -205,7 +205,7 @@
 
 	/* directory operations */
 	fssh_status_t (*create_dir)(fssh_fs_volume *volume, fssh_fs_vnode *parent,
-				const char *name, int perms, fssh_vnode_id *_newVnodeID);
+				const char *name, int perms);
 	fssh_status_t (*remove_dir)(fssh_fs_volume *volume, fssh_fs_vnode *parent,
 				const char *name);
 	fssh_status_t (*open_dir)(fssh_fs_volume *volume, fssh_fs_vnode *vnode,

Modified: haiku/trunk/headers/private/userlandfs/private/Requests.h
===================================================================
--- haiku/trunk/headers/private/userlandfs/private/Requests.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/headers/private/userlandfs/private/Requests.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -954,8 +954,6 @@
 class CreateDirReply : public ReplyRequest {
 public:
 	CreateDirReply() : ReplyRequest(CREATE_DIR_REPLY) {}
-
-	ino_t		newDir;
 };
 
 // RemoveDirRequest

Modified: haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -1439,7 +1439,7 @@
 
 static status_t
 bfs_create_dir(fs_volume* _volume, fs_vnode* _directory, const char* name,
-	int mode, ino_t* _newVnodeID)
+	int mode)
 {
 	FUNCTION_START((&quot;name = \&quot;%s\&quot;, perms = %d\n&quot;, name, mode));
 
@@ -1464,7 +1464,6 @@
 	status = Inode::Create(transaction, directory, name,
 		S_DIRECTORY | (mode &amp; S_IUMSK), 0, 0, NULL, &amp;id);
 	if (status == B_OK) {
-		*_newVnodeID = id;
 		put_vnode(volume-&gt;FSVolume(), id);
 
 		entry_cache_add(volume-&gt;ID(), directory-&gt;ID(), name, id);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/fat/file.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/fat/file.c	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/fat/file.c	2009-03-26 00:16:34 UTC (rev 29719)
@@ -925,8 +925,7 @@
 
 
 status_t
-dosfs_mkdir(fs_volume *_vol, fs_vnode *_dir, const char *name, int perms,
-	ino_t *_vnid)
+dosfs_mkdir(fs_volume *_vol, fs_vnode *_dir, const char *name, int perms)
 {
 	nspace *vol = (nspace *)_vol-&gt;private_volume;
 	vnode *dir = (vnode *)_dir-&gt;private_node, dummy;

Modified: haiku/trunk/src/add-ons/kernel/file_systems/fat/file.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/fat/file.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/fat/file.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -24,7 +24,7 @@
 status_t	dosfs_create(fs_volume *vol, fs_vnode *dir, const char *name,
 				int omode, int perms, void **cookie, ino_t *vnid);
 status_t	dosfs_mkdir(fs_volume *vol, fs_vnode *dir, const char *name,
-				int perms, ino_t *_vnid);
+				int perms);
 status_t	dosfs_rename(fs_volume *vol, fs_vnode *olddir, const char *oldname,
 				fs_vnode *newdir, const char *newname);
 status_t	dosfs_unlink(fs_volume *vol, fs_vnode *dir, const char *name);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/layers/attribute_overlay/attribute_overlay.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/layers/attribute_overlay/attribute_overlay.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/layers/attribute_overlay/attribute_overlay.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -527,9 +527,17 @@
 
 		// create the attribute directory
 		result = currentVnode.ops-&gt;create_dir(volume, &amp;currentVnode,
-			ATTRIBUTE_OVERLAY_ATTRIBUTE_DIR_NAME, S_IRWXU | S_IRWXG | S_IRWXO,
-			&amp;fAttributeDirInode);
+			ATTRIBUTE_OVERLAY_ATTRIBUTE_DIR_NAME, S_IRWXU | S_IRWXG | S_IRWXO);
 
+		if (result == B_OK) {
+			result = currentVnode.ops-&gt;lookup(volume, &amp;currentVnode,
+				ATTRIBUTE_OVERLAY_ATTRIBUTE_DIR_NAME, &amp;fAttributeDirInode);
+
+			// lookup() got us a reference we don't need -- put it
+			if (result == B_OK)
+				put_vnode(volume, fAttributeDirInode);
+		}
+
 		put_vnode(volume, fDirectoryInode);
 
 		if (result != B_OK) {
@@ -1290,9 +1298,9 @@
 
 static status_t
 overlay_create_dir(fs_volume *volume, fs_vnode *vnode, const char *name,
-	int perms, ino_t *newVnodeID)
+	int perms)
 {
-	OVERLAY_CALL(create_dir, name, perms, newVnodeID)
+	OVERLAY_CALL(create_dir, name, perms)
 	return B_UNSUPPORTED;
 }
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/layers/write_overlay/write_overlay.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/layers/write_overlay/write_overlay.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/layers/write_overlay/write_overlay.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -118,8 +118,7 @@
 		status_t			Write(void *cookie, off_t position,
 								const void *buffer, size_t *length);
 
-		status_t			CreateDir(const char *name,
-								int perms, ino_t *newInodeNumber);
+		status_t			CreateDir(const char *name, int perms);
 		status_t			RemoveDir(const char *name);
 		status_t			OpenDir(void **cookie);
 		status_t			CloseDir(void *cookie);
@@ -565,9 +564,9 @@
 
 
 status_t
-OverlayInode::CreateDir(const char *name, int perms, ino_t *newInodeNumber)
+OverlayInode::CreateDir(const char *name, int perms)
 {
-	return _CreateCommon(name, S_IFDIR, perms, newInodeNumber, NULL);
+	return _CreateCommon(name, S_IFDIR, perms, NULL, NULL);
 }
 
 
@@ -1247,11 +1246,10 @@
 
 static status_t
 overlay_create_dir(fs_volume *volume, fs_vnode *vnode, const char *name,
-	int perms, ino_t *newVnodeID)
+	int perms)
 {
 	TRACE(&quot;create_dir: \&quot;%s\&quot;\n&quot;, name);
-	return ((OverlayInode *)vnode-&gt;private_node)-&gt;CreateDir(name, perms,
-		newVnodeID);
+	return ((OverlayInode *)vnode-&gt;private_node)-&gt;CreateDir(name, perms);
 }
 
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/nfs/nfs_add_on.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/nfs/nfs_add_on.c	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/nfs/nfs_add_on.c	2009-03-26 00:16:34 UTC (rev 29719)
@@ -1979,7 +1979,7 @@
 }
 
 static status_t
-fs_mkdir(fs_volume *_volume, fs_vnode *_dir, const char *name, int perms, ino_t *_newVnodeID)
+fs_mkdir(fs_volume *_volume, fs_vnode *_dir, const char *name, int perms)
 {
 	fs_nspace *ns;
 	fs_node *dir;
@@ -2066,8 +2066,6 @@
 	newNode-&gt;fhandle=fhandle;
 	newNode-&gt;vnid=st.st_ino;
 
-	*_newVnodeID = newNode-&gt;vnid;
-
 	insert_node (ns,newNode);
 
 	XDRInPacketDestroy (&amp;reply);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/ntfs/fs_func.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/ntfs/fs_func.c	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/ntfs/fs_func.c	2009-03-26 00:16:34 UTC (rev 29719)
@@ -410,7 +410,7 @@
 
 	_node-&gt;private_node = NULL;
 	_node-&gt;ops = &gNTFSVnodeOps;
-	_flags = 0;	
+	_flags = 0;
 
 	newNode = (vnode*)ntfs_calloc( sizeof(vnode) );
 	if ( newNode != NULL ) {
@@ -1285,7 +1285,7 @@
 
 
 status_t
-fs_mkdir(fs_volume *_vol, fs_vnode *_dir, const char *name,	int perms, ino_t *_vnid)
+fs_mkdir(fs_volume *_vol, fs_vnode *_dir, const char *name,	int perms)
 {
 	nspace		*ns = (nspace*)_vol-&gt;private_volume;
 	vnode		*dir = (vnode*)_dir-&gt;private_node;
@@ -1345,8 +1345,6 @@
 
 		result = publish_vnode(_vol, vnid, (void*)newNode,&amp;gNTFSVnodeOps, 0777, 0);
 
-		*_vnid = vnid;
-
 		put_vnode(_vol, MREF(ni-&gt;mft_no));
 
 		ntfs_mark_free_space_outdated(ns);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -1075,8 +1075,7 @@
 
 // ramfs_create_dir
 static status_t
-ramfs_create_dir(fs_volume fs, fs_vnode _dir, const char *name,
-	int mode, ino_t *_vnid)
+ramfs_create_dir(fs_volume fs, fs_vnode _dir, const char *name, int mode)
 {
 	FUNCTION((&quot;name: `%s', mode: %x\n&quot;, name, mode));
 	Volume *volume = (Volume*)fs;
@@ -1115,7 +1114,6 @@
 					node-&gt;SetGID(getegid());
 					// put the node
 					volume-&gt;PutVNode(node-&gt;GetID());
-					*_vnid = node-&gt;GetID();
 				}
 			}
 		}

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -2182,7 +2182,7 @@
 
 // CreateDir
 status_t
-Volume::CreateDir(void* _dir, const char* name, int mode, ino_t *newDir)
+Volume::CreateDir(void* _dir, const char* name, int mode)
 {
 	VNode* vnode = (VNode*)_dir;
 
@@ -2221,7 +2221,6 @@
 	// process the reply
 	if (reply-&gt;error != B_OK)
 		return reply-&gt;error;
-	*newDir = reply-&gt;newDir;
 	return error;
 }
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/Volume.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -147,7 +147,7 @@
 
 			// directories
 			status_t			CreateDir(void* dir, const char* name,
-									int mode, ino_t *newDir);
+									int mode);
 			status_t			RemoveDir(void* dir, const char* name);
 			status_t			OpenDir(void* node, void** cookie);
 			status_t			CloseDir(void* node, void* cookie);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/kernel_interface.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/kernel_interface.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/kernel_add_on/kernel_interface.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -545,14 +545,13 @@
 // userlandfs_create_dir
 static status_t
 userlandfs_create_dir(fs_volume* fsVolume, fs_vnode* fsParent, const char* name,
-	int perms, ino_t* newDir)
+	int perms)
 {
 	Volume* volume = (Volume*)fsVolume-&gt;private_volume;
-	PRINT((&quot;userlandfs_create_dir(%p, %p, `%s', %d, %p)\n&quot;, volume,
-		fsParent-&gt;private_node, name, perms, newDir));
-	status_t error = volume-&gt;CreateDir(fsParent-&gt;private_node, name, perms,
-		newDir);
-	PRINT((&quot;userlandfs_create_dir() done: (%lx, %lld)\n&quot;, error, *newDir));
+	PRINT((&quot;userlandfs_create_dir(%p, %p, `%s', %#x)\n&quot;, volume,
+		fsParent-&gt;private_node, name, perms));
+	status_t error = volume-&gt;CreateDir(fsParent-&gt;private_node, name, perms);
+	PRINT((&quot;userlandfs_create_dir() done: (%lx)\n&quot;, error));
 	return error;
 }
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -1,4 +1,7 @@
-// UserlandRequestHandler.cpp
+/*
+ * Copyright 2001-2009, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">ingo_weinhold at gmx.de.</A>
+ * Distributed under the terms of the MIT License.
+ */
 
 #include &quot;UserlandRequestHandler.h&quot;
 
@@ -1314,11 +1317,10 @@
 	if (!volume)
 		result = B_BAD_VALUE;
 
-	ino_t newDir = 0;
 	if (result == B_OK) {
 		RequestThreadContext context(volume);
 		result = volume-&gt;CreateDir(request-&gt;node,
-			(const char*)request-&gt;name.GetData(), request-&gt;mode, &amp;newDir);
+			(const char*)request-&gt;name.GetData(), request-&gt;mode);
 	}
 
 	// prepare the reply
@@ -1329,7 +1331,6 @@
 		RETURN_ERROR(error);
 
 	reply-&gt;error = result;
-	reply-&gt;newDir = newDir;
 
 	// send the reply
 	return _SendReply(allocator, false);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/UserlandRequestHandler.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -1,5 +1,7 @@
-// UserlandRequestHandler.h
-
+/*
+ * Copyright 2001-2009, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">ingo_weinhold at gmx.de.</A>
+ * Distributed under the terms of the MIT License.
+ */
 #ifndef USERLAND_FS_USERLAND_REQUEST_HANDLER_H
 #define USERLAND_FS_USERLAND_REQUEST_HANDLER_H
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -378,7 +378,7 @@
 
 // CreateDir
 status_t
-Volume::CreateDir(void* dir, const char* name, int mode, ino_t *newDir)
+Volume::CreateDir(void* dir, const char* name, int mode)
 {
 	return B_BAD_VALUE;
 }

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/Volume.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -114,7 +114,7 @@
 
 	// directories
 	virtual	status_t			CreateDir(void* dir, const char* name,
-									int mode, ino_t *newDir);
+									int mode);
 	virtual	status_t			RemoveDir(void* dir, const char* name);
 	virtual	status_t			OpenDir(void* node, void** cookie);
 	virtual	status_t			CloseDir(void* node, void* cookie);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -431,27 +431,12 @@
 
 // CreateDir
 status_t
-BeOSKernelVolume::CreateDir(void* dir, const char* name, int mode,
-	ino_t *newDir)
+BeOSKernelVolume::CreateDir(void* dir, const char* name, int mode)
 {
-	if (!fFSOps-&gt;mkdir || !fFSOps-&gt;walk)	// we need walk() too
+	if (!fFSOps-&gt;mkdir)
 		return B_BAD_VALUE;
 
-	status_t error = fFSOps-&gt;mkdir(fVolumeCookie, dir, name, mode);
-	if (error != B_OK)
-		return error;
-
-	// we need to get the node ID by invoking walk()
-	ino_t id;
-	error = fFSOps-&gt;walk(fVolumeCookie, dir, name, NULL, &amp;id);
-	if (error != B_OK)
-		return error;
-
-	// put the node for walk()'s get_vnode()
-	UserlandFS::KernelEmu::put_vnode(GetID(), id);
-
-	*newDir = id;
-	return B_OK;
+	return fFSOps-&gt;mkdir(fVolumeCookie, dir, name, mode);
 }
 
 // RemoveDir

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/beos/BeOSKernelVolume.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -88,7 +88,7 @@
 
 	// directories
 	virtual	status_t			CreateDir(void* dir, const char* name,
-									int mode, ino_t *newDir);
+									int mode);
 	virtual	status_t			RemoveDir(void* dir, const char* name);
 	virtual	status_t			OpenDir(void* node, void** cookie);
 	virtual	status_t			CloseDir(void* node, void* cookie);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -1155,7 +1155,7 @@
 
 
 status_t
-FUSEVolume::CreateDir(void* _dir, const char* name, int mode, ino_t *newDir)
+FUSEVolume::CreateDir(void* _dir, const char* name, int mode)
 {
 	FUSENode* dir = (FUSENode*)_dir;
 PRINT((&quot;FUSEVolume::CreateDir(%p (%lld), \&quot;%s\&quot;, %#x)\n&quot;, dir, dir-&gt;id, name,
@@ -1184,9 +1184,6 @@
 
 // TODO: Node monitoring!
 
-	*newDir = 0;
-		// TODO: This is really superfluous!
-
 	return B_OK;
 }
 

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse/FUSEVolume.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -103,7 +103,7 @@
 
 	// directories
 	virtual	status_t			CreateDir(void* dir, const char* name,
-									int mode, ino_t *newDir);
+									int mode);
 	virtual	status_t			RemoveDir(void* dir, const char* name);
 	virtual	status_t			OpenDir(void* node, void** cookie);
 	virtual	status_t			CloseDir(void* node, void* cookie);

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.cpp
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -738,14 +738,13 @@
 
 // CreateDir
 status_t
-HaikuKernelVolume::CreateDir(void* _dir, const char* name, int mode,
-	ino_t *newDir)
+HaikuKernelVolume::CreateDir(void* _dir, const char* name, int mode)
 {
 	HaikuKernelNode* dir = (HaikuKernelNode*)_dir;
 
 	if (!dir-&gt;ops-&gt;create_dir)
 		return B_BAD_VALUE;
-	return dir-&gt;ops-&gt;create_dir(&amp;fVolume, dir, name, mode, newDir);
+	return dir-&gt;ops-&gt;create_dir(&amp;fVolume, dir, name, mode);
 }
 
 // RemoveDir

Modified: haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.h
===================================================================
--- haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.h	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/haiku/HaikuKernelVolume.h	2009-03-26 00:16:34 UTC (rev 29719)
@@ -121,7 +121,7 @@
 
 	// directories
 	virtual	status_t			CreateDir(void* dir, const char* name,
-									int mode, ino_t *newDir);
+									int mode);
 	virtual	status_t			RemoveDir(void* dir, const char* name);
 	virtual	status_t			OpenDir(void* node, void** cookie);
 	virtual	status_t			CloseDir(void* node, void* cookie);

Modified: haiku/trunk/src/system/kernel/device_manager/devfs.cpp
===================================================================
--- haiku/trunk/src/system/kernel/device_manager/devfs.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/system/kernel/device_manager/devfs.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -1271,7 +1271,7 @@
 
 static status_t
 devfs_create_dir(fs_volume *_volume, fs_vnode *_dir, const char *name,
-	int perms, ino_t *_newVnodeID)
+	int perms)
 {
 	struct devfs *fs = (struct devfs *)_volume-&gt;private_volume;
 	struct devfs_vnode *dir = (struct devfs_vnode *)_dir-&gt;private_node;
@@ -1294,7 +1294,6 @@
 	hash_insert(sDeviceFileSystem-&gt;vnode_hash, vnode);
 	devfs_insert_in_dir(dir, vnode);
 
-	*_newVnodeID = vnode-&gt;id;
 	return B_OK;
 }
 

Modified: haiku/trunk/src/system/kernel/fs/rootfs.cpp
===================================================================
--- haiku/trunk/src/system/kernel/fs/rootfs.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/system/kernel/fs/rootfs.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -607,15 +607,15 @@
 
 static status_t
 rootfs_create_dir(fs_volume *_volume, fs_vnode *_dir, const char *name,
-	int mode, ino_t *_newID)
+	int mode)
 {
 	struct rootfs *fs = (rootfs*)_volume-&gt;private_volume;
 	struct rootfs_vnode *dir = (rootfs_vnode*)_dir-&gt;private_node;
 	struct rootfs_vnode *vnode;
 	status_t status = 0;
 
-	TRACE((&quot;rootfs_create_dir: dir %p, name = '%s', perms = %d, id = 0x%Lx pointer id = %p\n&quot;,
-		dir, name, mode,*_newID, _newID));
+	TRACE((&quot;rootfs_create_dir: dir %p, name = '%s', perms = %d\n&quot;, dir, name,
+		mode));
 
 	mutex_lock(&amp;fs-&gt;lock);
 

Modified: haiku/trunk/src/system/kernel/fs/vfs.cpp
===================================================================
--- haiku/trunk/src/system/kernel/fs/vfs.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/system/kernel/fs/vfs.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -5394,7 +5394,6 @@
 	bool kernel)
 {
 	struct vnode* vnode;
-	ino_t newID;
 	status_t status;
 
 	if (name == NULL || *name == '\0')
@@ -5408,7 +5407,7 @@
 		return status;
 
 	if (HAS_FS_CALL(vnode, create_dir))
-		status = FS_CALL(vnode, create_dir, name, perms, &amp;newID);
+		status = FS_CALL(vnode, create_dir, name, perms);
 	else
 		status = EROFS;
 
@@ -5422,7 +5421,6 @@
 {
 	char filename[B_FILE_NAME_LENGTH];
 	struct vnode* vnode;
-	ino_t newID;
 	status_t status;
 
 	FUNCTION((&quot;dir_create: path '%s', perms %d, kernel %d\n&quot;, path, perms, kernel));
@@ -5432,7 +5430,7 @@
 		return status;
 
 	if (HAS_FS_CALL(vnode, create_dir)) {
-		status = FS_CALL(vnode, create_dir, filename, perms, &amp;newID);
+		status = FS_CALL(vnode, create_dir, filename, perms);
 	} else
 		status = EROFS;
 

Modified: haiku/trunk/src/tools/fs_shell/vfs.cpp
===================================================================
--- haiku/trunk/src/tools/fs_shell/vfs.cpp	2009-03-25 23:49:41 UTC (rev 29718)
+++ haiku/trunk/src/tools/fs_shell/vfs.cpp	2009-03-26 00:16:34 UTC (rev 29719)
@@ -3221,7 +3221,6 @@
 dir_create_entry_ref(fssh_mount_id mountID, fssh_vnode_id parentID, const char *name, int perms, bool kernel)
 {
 	struct vnode *vnode;
-	fssh_vnode_id newID;
 	fssh_status_t status;
 
 	if (name == NULL || *name == '\0')
@@ -3234,7 +3233,7 @@
 		return status;
 
 	if (HAS_FS_CALL(vnode, create_dir))
-		status = FS_CALL(vnode, create_dir, name, perms, &amp;newID);
+		status = FS_CALL(vnode, create_dir, name, perms);
 	else
 		status = FSSH_EROFS;
 
@@ -3248,7 +3247,6 @@
 {
 	char filename[FSSH_B_FILE_NAME_LENGTH];
 	struct vnode *vnode;
-	fssh_vnode_id newID;
 	fssh_status_t status;
 
 	FUNCTION((&quot;dir_create: path '%s', perms %d, kernel %d\n&quot;, path, perms, kernel));
@@ -3258,7 +3256,7 @@
 		return status;
 
 	if (HAS_FS_CALL(vnode, create_dir))
-		status = FS_CALL(vnode, create_dir, filename, perms, &amp;newID);
+		status = FS_CALL(vnode, create_dir, filename, perms);
 	else
 		status = FSSH_EROFS;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015166.html">[Haiku-commits] r29718 - in	haiku/trunk/src/add-ons/screen_savers: . flurry
</A></li>
	<LI>Next message: <A HREF="015155.html">[Haiku-commits] r29720 -	haiku/trunk/src/add-ons/kernel/file_systems/userlandfs/server/fuse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15153">[ date ]</a>
              <a href="thread.html#15153">[ thread ]</a>
              <a href="subject.html#15153">[ subject ]</a>
              <a href="author.html#15153">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
