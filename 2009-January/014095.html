<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r29034 - in buildtools/trunk/gcc: . gcc gcc/config	gcc/config/i386 gcc/ginclude intl libgcc libgomp libiberty	libmudflap libssp libstdc++-v3 libstdc++-v3/libsupc++
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29034%20-%20in%20buildtools/trunk/gcc%3A%20.%20gcc%20gcc/config%0A%09gcc/config/i386%20gcc/ginclude%20intl%20libgcc%20libgomp%20libiberty%0A%09libmudflap%20libssp%20libstdc%2B%2B-v3%20libstdc%2B%2B-v3/libsupc%2B%2B&In-Reply-To=%3C200901260510.n0Q5AdPt030853%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014094.html">
   <LINK REL="Next"  HREF="014096.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r29034 - in buildtools/trunk/gcc: . gcc gcc/config	gcc/config/i386 gcc/ginclude intl libgcc libgomp libiberty	libmudflap libssp libstdc++-v3 libstdc++-v3/libsupc++</H1>
    <B>mmlr at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29034%20-%20in%20buildtools/trunk/gcc%3A%20.%20gcc%20gcc/config%0A%09gcc/config/i386%20gcc/ginclude%20intl%20libgcc%20libgomp%20libiberty%0A%09libmudflap%20libssp%20libstdc%2B%2B-v3%20libstdc%2B%2B-v3/libsupc%2B%2B&In-Reply-To=%3C200901260510.n0Q5AdPt030853%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r29034 - in buildtools/trunk/gcc: . gcc gcc/config	gcc/config/i386 gcc/ginclude intl libgcc libgomp libiberty	libmudflap libssp libstdc++-v3 libstdc++-v3/libsupc++">mmlr at mail.berlios.de
       </A><BR>
    <I>Mon Jan 26 06:10:39 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="014094.html">[Haiku-commits] r29033 - buildtools/trunk
</A></li>
        <LI>Next message: <A HREF="014096.html">[Haiku-commits] r29035 - haiku/trunk/build/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14095">[ date ]</a>
              <a href="thread.html#14095">[ thread ]</a>
              <a href="subject.html#14095">[ subject ]</a>
              <a href="author.html#14095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mmlr
Date: 2009-01-26 06:09:46 +0100 (Mon, 26 Jan 2009)
New Revision: 29034
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=29034&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=29034&amp;view=rev</A>

Added:
   buildtools/trunk/gcc/gcc/config/haiku.h
   buildtools/trunk/gcc/gcc/config/i386/haiku.h
   buildtools/trunk/gcc/gcc/config/i386/t-haiku
Modified:
   buildtools/trunk/gcc/config.guess
   buildtools/trunk/gcc/config.rpath
   buildtools/trunk/gcc/configure
   buildtools/trunk/gcc/gcc/Makefile.in
   buildtools/trunk/gcc/gcc/config.gcc
   buildtools/trunk/gcc/gcc/configure
   buildtools/trunk/gcc/gcc/configure.ac
   buildtools/trunk/gcc/gcc/crtstuff.c
   buildtools/trunk/gcc/gcc/defaults.h
   buildtools/trunk/gcc/gcc/ginclude/stdarg.h
   buildtools/trunk/gcc/gcc/ginclude/stddef.h
   buildtools/trunk/gcc/intl/loadmsgcat.c
   buildtools/trunk/gcc/libgcc/config.host
   buildtools/trunk/gcc/libgomp/configure
   buildtools/trunk/gcc/libiberty/make-relative-prefix.c
   buildtools/trunk/gcc/libmudflap/configure
   buildtools/trunk/gcc/libssp/configure
   buildtools/trunk/gcc/libstdc++-v3/configure
   buildtools/trunk/gcc/libstdc++-v3/crossconfig.m4
   buildtools/trunk/gcc/libstdc++-v3/libsupc++/tinfo.cc
   buildtools/trunk/gcc/libtool.m4
   buildtools/trunk/gcc/ltmain.sh
Log:
Applying Haiku compatibility.

Modified: buildtools/trunk/gcc/config.guess
===================================================================
--- buildtools/trunk/gcc/config.guess	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/config.guess	2009-01-26 05:09:46 UTC (rev 29034)
@@ -1216,6 +1216,9 @@
     BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
 	echo i586-pc-beos
 	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
 	exit ;;

Modified: buildtools/trunk/gcc/config.rpath
===================================================================
--- buildtools/trunk/gcc/config.rpath	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/config.rpath	2009-01-26 05:09:46 UTC (rev 29034)
@@ -161,6 +161,8 @@
       ;;
     netbsd*)
       ;;
+    haiku*)
+      ;;
     solaris* | sysv5*)
       if $LD -v 2&gt;&amp;1 | egrep 'BFD 2\.8' &gt; /dev/null; then
         ld_shlibs=no

Modified: buildtools/trunk/gcc/configure
===================================================================
--- buildtools/trunk/gcc/configure	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/configure	2009-01-26 05:09:46 UTC (rev 29034)
@@ -2044,6 +2044,9 @@
   *-*-cygwin*)
     noconfigdirs=&quot;$noconfigdirs autoconf automake send-pr rcs guile perl&quot;
     ;;
+  *-*-haiku*)
+    noconfigdirs=&quot;$noconfigdirs tk itcl libgui gdb&quot;
+    ;;
   *-*-netbsd*)
     noconfigdirs=&quot;$noconfigdirs rcs&quot;
     ;;
@@ -2161,6 +2164,9 @@
 	;;
     esac
     ;;
+  *-*-haiku)
+    noconfigdirs=&quot;$noconfigdirs target-libiberty&quot;
+    ;;
   *-*-kaos*)
     # Remove unsupported stuff on all kaOS configurations.
     skipdirs=&quot;target-libiberty ${libgcj} target-libstdc++-v3 target-librx&quot;
@@ -2603,6 +2609,9 @@
   ip2k-*-*)
     noconfigdirs=&quot;$noconfigdirs target-libiberty target-libstdc++-v3 ${libgcj}&quot;
     ;;
+  *-*-haiku*)
+    noconfigdirs=&quot;$noconfigdirs gdb target-newlib target-libgloss ${libgcj}&quot;
+    ;;
   *-*-linux* | *-*-gnu* | *-*-k*bsd*-gnu)
     noconfigdirs=&quot;$noconfigdirs target-newlib target-libgloss&quot;
     ;;

Modified: buildtools/trunk/gcc/gcc/Makefile.in
===================================================================
--- buildtools/trunk/gcc/gcc/Makefile.in	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/Makefile.in	2009-01-26 05:09:46 UTC (rev 29034)
@@ -3265,7 +3265,7 @@
 $(genprogmd:%=build/gen%$(build_exeext)): $(BUILD_RTL) $(BUILD_ERRORS)
 
 # These programs need libs over and above what they get from the above list.
-build/genautomata$(build_exeext) : BUILD_LIBS += -lm
+#build/genautomata$(build_exeext) : BUILD_LIBS += -lm
 
 # These programs are not linked with the MD reader.
 build/gengenrtl$(build_exeext) : $(BUILD_ERRORS)

Added: buildtools/trunk/gcc/gcc/config/haiku.h
===================================================================
--- buildtools/trunk/gcc/gcc/config/haiku.h	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/config/haiku.h	2009-01-26 05:09:46 UTC (rev 29034)
@@ -0,0 +1,172 @@
+/* Definitions of target machine for GCC.
+   Common Haiku definitions for all architectures.
+   Copyright (C) 1998, 1999, 2000, 2001, 2002, 2004, 2005
+   Free Software Foundation, Inc.
+
+This file is part of GCC.
+
+GCC is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2, or (at your option)
+any later version.
+
+GCC is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with GCC; see the file COPYING.  If not, write to
+the Free Software Foundation, 59 Temple Place - Suite 330,
+Boston, MA 02111-1307, USA.  */
+
+
+/* Change debugging to Dwarf2.  */
+#undef PREFERRED_DEBUGGING_TYPE
+#define PREFERRED_DEBUGGING_TYPE DWARF2_DEBUG
+
+#undef ASM_COMMENT_START
+#define ASM_COMMENT_START &quot; #&quot;
+
+/* Output assembler code to FILE to increment profiler label # LABELNO
+   for profiling a function entry.  */
+
+#undef MCOUNT_NAME
+#define MCOUNT_NAME &quot;_mcount&quot;
+
+#define TARGET_DECLSPEC 1
+
+/* Haiku uses lots of multichars, so don't warn about them unless the
+   user explicitly asks for the warnings with -Wmultichar.  Note that
+   CC1_SPEC is used for both cc1 and cc1plus.  */
+
+#undef CC1_SPEC
+#define CC1_SPEC &quot;%{!no-fpic:%{!fno-pic:%{!fno-pie:%{!fpie:%{!fPIC:%{!fPIE:-fpic}}}}}} %{!Wmultichar: -Wno-multichar} %(cc1_cpu) %{profile:-p}&quot;
+
+#undef CC1PLUS_SPEC
+#define CC1PLUS_SPEC &quot;%{!Wctor-dtor-privacy:-Wno-ctor-dtor-privacy}&quot;
+
+/* Provide start and end file specs appropriate to glibc.  */
+
+/* LIB_SPEC for Haiku */
+#undef LIB_SPEC
+#define LIB_SPEC &quot;-lroot&quot;
+
+/* gcc runtime lib is built into libroot.so on Haiku */
+/* ??? This is gonna be lovely when the next release of gcc has 
+   some new symbol in, so that links start failing.  */
+#undef LIBGCC_SPEC
+#define LIBGCC_SPEC &quot;&quot;
+
+/* Note: There currently is no mcount.o on Haiku. In the BeOS specification
+   it was i386-mcount.o, but that doesn't exist in gcc 2.95.3 either. */
+
+#undef  STARTFILE_SPEC
+#define STARTFILE_SPEC &quot;crti.o%s crtbegin.o%s %{!nostart:start_dyn.o%s} init_term_dyn.o%s %{p:mcount.o%s}&quot;
+
+#undef  ENDFILE_SPEC
+#define ENDFILE_SPEC &quot;crtend.o%s crtn.o%s&quot;
+
+/* For native compiler, use standard Haiku include file search paths
+   rooted in /boot/develop/headers.  For a cross compiler, don't
+   expect the host to use the Haiku directory scheme, and instead look
+   for the Haiku include files relative to TOOL_INCLUDE_DIR.  Yes, we
+   use ANSI string concatenation here (FIXME) */
+
+#ifndef CROSS_COMPILE
+#undef INCLUDE_DEFAULTS
+#define INCLUDE_DEFAULTS \
+    { \
+    { GPLUSPLUS_INCLUDE_DIR, &quot;G++&quot;, 1, 1 },\
+    { GCC_INCLUDE_DIR, &quot;GCC&quot;, 0, 0 },\
+    { TOOL_INCLUDE_DIR, &quot;BINUTILS&quot;, 0, 1}, \
+    { &quot;/boot/develop/headers/os/add-ons/graphics&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/devel&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/translation&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/mail&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/drivers&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/opengl&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/game&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/support&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/storage&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/kernel&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/net&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/midi&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/midi2&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/media&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/interface&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/device&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/app&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/precompiled&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/add-ons/input_server&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/add-ons/net_server&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/add-ons/screen_saver&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/add-ons/tracker&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/be_apps/Deskbar&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/be_apps/NetPositive&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/be_apps/Tracker&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/drivers/tty&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/net/netinet&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os/storage&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/os&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/gnu&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/cpp&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/bsd&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers/posix&quot;, 0, 0, 0 },\
+    { &quot;/boot/develop/headers&quot;, 0, 0, 0 }, \
+    { 0, 0, 0, 0 } \
+    }
+#else /* CROSS_COMPILE */
+#undef	INCLUDE_DEFAULTS
+#define INCLUDE_DEFAULTS				\
+    { \
+    { GPLUSPLUS_INCLUDE_DIR, &quot;G++&quot;, 1, 1 },\
+    { GCC_INCLUDE_DIR, &quot;GCC&quot;, 0, 0 },\
+    { TOOL_INCLUDE_DIR, &quot;BINUTILS&quot;, 0, 1}, \
+    { CROSS_INCLUDE_DIR &quot;/os/add-ons/graphics&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/devel&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/translation&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/mail&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/drivers&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/opengl&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/game&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/support&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/storage&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/kernel&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/net&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/midi&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/midi2&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/media&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/interface&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/device&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/app&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/precompiled&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/add-ons/input_server&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/add-ons/net_server&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/add-ons/screen_saver&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/add-ons/tracker&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/be_apps/Deskbar&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/be_apps/NetPositive&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/be_apps/Tracker&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/drivers/tty&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/net/netinet&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os/storage&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/os&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/gnu&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/cpp&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/bsd&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR &quot;/posix&quot;, 0, 0, 0 },\
+    { CROSS_INCLUDE_DIR , 0, 0, 0 }, \
+    { 0, 0, 0, 0 } \
+    }
+#endif
+
+/* Whee.  LIBRARY_PATH is Be's LD_LIBRARY_PATH, which of course will
+   cause nasty problems if we override it.  */
+#define LIBRARY_PATH_ENV        &quot;BELIBRARIES&quot;
+
+/* Haiku doesn't have a separate math library.  */
+#define MATH_LIBRARY &quot;&quot;
+
+/* Haiku headers are C++-aware (and often use C++).  */
+#define NO_IMPLICIT_EXTERN_C

Added: buildtools/trunk/gcc/gcc/config/i386/haiku.h
===================================================================
--- buildtools/trunk/gcc/gcc/config/i386/haiku.h	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/config/i386/haiku.h	2009-01-26 05:09:46 UTC (rev 29034)
@@ -0,0 +1,94 @@
+/* Definitions for Intel x86 running Haiku
+   Copyright (C) 1998, 1999, 2000, 2001, 2002, 2004
+   Free Software Foundation, Inc.
+
+This file is part of GCC.
+
+GCC is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2, or (at your option)
+any later version.
+
+GCC is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with GCC; see the file COPYING.  If not, write to
+the Free Software Foundation, 59 Temple Place - Suite 330,
+Boston, MA 02111-1307, USA.  */
+
+
+#define TARGET_VERSION fprintf (stderr, &quot; (i386 Haiku/ELF)&quot;);
+
+/* The SVR4 ABI for the i386 says that records and unions are returned
+   in memory.  */
+#undef DEFAULT_PCC_STRUCT_RETURN
+#define DEFAULT_PCC_STRUCT_RETURN 1
+
+#undef DBX_REGISTER_NUMBER
+#define DBX_REGISTER_NUMBER(n) \
+  (TARGET_64BIT ? dbx64_register_map[n] : svr4_dbx_register_map[n])
+
+#undef SIZE_TYPE
+#define SIZE_TYPE &quot;long unsigned int&quot;
+ 
+#undef PTRDIFF_TYPE
+#define PTRDIFF_TYPE &quot;long int&quot;
+  
+#undef WCHAR_TYPE
+#define WCHAR_TYPE &quot;short unsigned int&quot;
+   
+#undef WCHAR_TYPE_SIZE
+#define WCHAR_TYPE_SIZE 16
+
+#define TARGET_OS_CPP_BUILTINS()					\
+  do									\
+    {									\
+	builtin_define (&quot;__BEOS__&quot;);					\
+	builtin_define (&quot;__HAIKU__&quot;);					\
+	builtin_define (&quot;__INTEL__&quot;);					\
+	builtin_define (&quot;_X86_&quot;);					\
+	builtin_define (&quot;__stdcall=__attribute__((__stdcall__))&quot;);	\
+	builtin_define (&quot;__cdecl=__attribute__((__cdecl__))&quot;);		\
+	builtin_assert (&quot;system=haiku&quot;);					\
+    /* Haiku apparently doesn't support merging of symbols across shared \
+       object boundaries. Hence we need to explicitly specify that \
+       type_infos are not merged, so that they get compared by name \
+       instead of by pointer. */ \
+    builtin_define (&quot;__GXX_MERGED_TYPEINFO_NAMES=0&quot;); \
+    builtin_define (&quot;__GXX_TYPEINFO_EQUALITY_INLINE=0&quot;); \
+    }									\
+  while (0)
+
+/* Provide a LINK_SPEC appropriate for Haiku.  Here we provide support
+   for the special GCC options -static and -shared, which allow us to
+   link things in one of these three modes by applying the appropriate
+   combinations of options at link-time.  */
+
+/* If ELF is the default format, we should not use /lib/elf.  */
+
+#undef	LINK_SPEC
+#define LINK_SPEC &quot;%{!o*:-o %b} -m elf_i386_haiku -shared -no-undefined -Bsymbolic %{nostart:-e 0}&quot;
+
+/* A C statement (sans semicolon) to output to the stdio stream
+   FILE the assembler definition of uninitialized global DECL named
+   NAME whose size is SIZE bytes and alignment is ALIGN bytes.
+   Try to use asm_output_aligned_bss to implement this macro.  */
+
+#define ASM_OUTPUT_ALIGNED_BSS(FILE, DECL, NAME, SIZE, ALIGN) \
+  asm_output_aligned_bss (FILE, DECL, NAME, SIZE, ALIGN)
+
+/* A C statement to output to the stdio stream FILE an assembler
+   command to advance the location counter to a multiple of 1&lt;&lt;LOG
+   bytes if it is within MAX_SKIP bytes.
+
+   This is used to align code labels according to Intel recommendations.  */
+
+#ifdef HAVE_GAS_MAX_SKIP_P2ALIGN
+#define ASM_OUTPUT_MAX_SKIP_ALIGN(FILE,LOG,MAX_SKIP) \
+  if ((LOG)!=0) \
+    if ((MAX_SKIP)==0) fprintf ((FILE), &quot;\t.p2align %d\n&quot;, (LOG)); \
+    else fprintf ((FILE), &quot;\t.p2align %d,,%d\n&quot;, (LOG), (MAX_SKIP))
+#endif

Added: buildtools/trunk/gcc/gcc/config/i386/t-haiku
===================================================================
--- buildtools/trunk/gcc/gcc/config/i386/t-haiku	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/config/i386/t-haiku	2009-01-26 05:09:46 UTC (rev 29034)
@@ -0,0 +1,4 @@
+# There are system headers elsewhere, but these are the ones that
+# we are most likely to want to apply any fixes to.
+SYSTEM_HEADER_DIR = /boot/develop/headers/posix
+CROSS_SYSTEM_HEADER_DIR = $(tooldir)/sys-include/posix

Modified: buildtools/trunk/gcc/gcc/config.gcc
===================================================================
--- buildtools/trunk/gcc/gcc/config.gcc	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/config.gcc	2009-01-26 05:09:46 UTC (rev 29034)
@@ -1121,6 +1121,11 @@
 	tm_file=&quot;${tm_file} i386/unix.h i386/att.h dbxelf.h elfos.h ${fbsd_tm_file} i386/x86-64.h i386/freebsd.h i386/freebsd64.h&quot;
 	tmake_file=&quot;${tmake_file} i386/t-crtstuff&quot;
 	;;
+i[34567]86-*-haiku*)
+	tmake_file='i386/t-haiku i386/t-crtpic'
+	tm_file=&quot;${tm_file} i386/unix.h i386/att.h dbxelf.h elfos.h svr4.h haiku.h i386/haiku.h&quot;
+	extra_parts='crtbegin.o crtend.o'
+	;;
 i[34567]86-*-netbsdelf*)
 	tm_file=&quot;${tm_file} i386/unix.h i386/att.h dbxelf.h elfos.h netbsd.h netbsd-elf.h i386/netbsd-elf.h&quot;
 	;;

Modified: buildtools/trunk/gcc/gcc/configure
===================================================================
--- buildtools/trunk/gcc/gcc/configure	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/configure	2009-01-26 05:09:46 UTC (rev 29034)
@@ -12635,7 +12635,7 @@
     # default
     target_thread_file='single'
     ;;
-  aix | dce | gnat | irix | posix | posix95 | rtems | \
+  aix | dce | gnat | haiku | irix | posix | posix95 | rtems | \
   single | solaris | vxworks | win32 | mipssde)
     target_thread_file=${enable_threads}
     ;;
@@ -15807,7 +15807,7 @@
       fi
       ;;
 
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
 
@@ -16443,6 +16443,11 @@
       fi
       ;;
 
+    haiku*)
+      allow_undefined_flag=unsupported
+      archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      ;;
+
     interix[3-9]*)
       hardcode_direct=no
       hardcode_shlibpath_var=no
@@ -17907,6 +17912,12 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker=&quot;$host_os ld.so&quot;
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.

Modified: buildtools/trunk/gcc/gcc/configure.ac
===================================================================
--- buildtools/trunk/gcc/gcc/configure.ac	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/configure.ac	2009-01-26 05:09:46 UTC (rev 29034)
@@ -1369,7 +1369,7 @@
     # default
     target_thread_file='single'
     ;;
-  aix | dce | gnat | irix | posix | posix95 | rtems | \
+  aix | dce | gnat | haiku | irix | posix | posix95 | rtems | \
   single | solaris | vxworks | win32 | mipssde)
     target_thread_file=${enable_threads}
     ;;

Modified: buildtools/trunk/gcc/gcc/crtstuff.c
===================================================================
--- buildtools/trunk/gcc/gcc/crtstuff.c	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/crtstuff.c	2009-01-26 05:09:46 UTC (rev 29034)
@@ -91,7 +91,9 @@
     &amp;&amp; defined(HAVE_LD_EH_FRAME_HDR) \
     &amp;&amp; !defined(inhibit_libc) &amp;&amp; !defined(CRTSTUFFT_O) \
     &amp;&amp; defined(__GLIBC__) &amp;&amp; __GLIBC__ &gt;= 2
+#if !(defined(__BEOS__) || defined(__HAIKU__))
 #include &lt;link.h&gt;
+#endif
 /* uClibc pretends to be glibc 2.2 and DT_CONFIG is defined in its link.h.
    But it doesn't use PT_GNU_EH_FRAME ELF segment currently.  */
 # if !defined(__UCLIBC__) \
@@ -148,7 +150,9 @@
 extern void __do_global_ctors_1 (void);
 
 /* Likewise for _Jv_RegisterClasses.  */
+#ifdef JCR_SECTION_NAME
 extern void _Jv_RegisterClasses (void *) TARGET_ATTRIBUTE_WEAK;
+#endif
 
 #ifdef OBJECT_FORMAT_ELF
 

Modified: buildtools/trunk/gcc/gcc/defaults.h
===================================================================
--- buildtools/trunk/gcc/gcc/defaults.h	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/defaults.h	2009-01-26 05:09:46 UTC (rev 29034)
@@ -360,9 +360,13 @@
    at program start-up time.  */
 #if defined (TARGET_ASM_NAMED_SECTION) &amp;&amp; SUPPORTS_WEAK
 #ifndef JCR_SECTION_NAME
+/* Hack to remove _Jv crap on BeOS. i know it should be made somehow through
+	config files, but i don't know how (in which file ;) */
+#if !defined(__BEOS__) &amp;&amp; !defined(__HAIKU__)
 #define JCR_SECTION_NAME &quot;.jcr&quot;
 #endif
 #endif
+#endif
 
 /* This decision to use a .jcr section can be overridden by defining
    USE_JCR_SECTION to 0 in target file.  This is necessary if target

Modified: buildtools/trunk/gcc/gcc/ginclude/stdarg.h
===================================================================
--- buildtools/trunk/gcc/gcc/ginclude/stdarg.h	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/ginclude/stdarg.h	2009-01-26 05:09:46 UTC (rev 29034)
@@ -100,7 +100,7 @@
 #ifndef _VA_LIST
 /* The macro _VA_LIST_T_H is used in the Bull dpx2  */
 #ifndef _VA_LIST_T_H
-/* The macro __va_list__ is used by BeOS.  */
+/* The macro __va_list__ is used by BeOS and Haiku.  */
 #ifndef __va_list__
 typedef __gnuc_va_list va_list;
 #endif /* not __va_list__ */

Modified: buildtools/trunk/gcc/gcc/ginclude/stddef.h
===================================================================
--- buildtools/trunk/gcc/gcc/ginclude/stddef.h	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/gcc/ginclude/stddef.h	2009-01-26 05:09:46 UTC (rev 29034)
@@ -169,7 +169,7 @@
 /* Define this type if we are doing the whole job,
    or if we want this type in particular.  */
 #if defined (_STDDEF_H) || defined (__need_size_t)
-#ifndef __size_t__	/* BeOS */
+#ifndef __size_t__	/* BeOS, Haiku */
 #ifndef __SIZE_T__	/* Cray Unicos/Mk */
 #ifndef _SIZE_T	/* in case &lt;sys/types.h&gt; has defined it. */
 #ifndef _SYS_SIZE_T_H
@@ -186,7 +186,7 @@
 #ifndef _GCC_SIZE_T
 #ifndef _SIZET_
 #ifndef __size_t
-#define __size_t__	/* BeOS */
+#define __size_t__	/* BeOS, Haiku */
 #define __SIZE_T__	/* Cray Unicos/Mk */
 #define _SIZE_T
 #define _SYS_SIZE_T_H
@@ -212,9 +212,9 @@
 #endif
 #if !(defined (__GNUG__) &amp;&amp; defined (size_t))
 typedef __SIZE_TYPE__ size_t;
-#ifdef __BEOS__
+#if defined(__BEOS__) || defined(__HAIKU__)
 typedef long ssize_t;
-#endif /* __BEOS__ */
+#endif /* __BEOS__ || __HAIKU__ */
 #endif /* !(defined (__GNUG__) &amp;&amp; defined (size_t)) */
 #endif /* __size_t */
 #endif /* _SIZET_ */
@@ -245,7 +245,7 @@
 /* Define this type if we are doing the whole job,
    or if we want this type in particular.  */
 #if defined (_STDDEF_H) || defined (__need_wchar_t)
-#ifndef __wchar_t__	/* BeOS */
+#ifndef __wchar_t__	/* BeOS, Haiku */
 #ifndef __WCHAR_T__	/* Cray Unicos/Mk */
 #ifndef _WCHAR_T
 #ifndef _T_WCHAR_
@@ -262,7 +262,7 @@
 #ifndef ___int_wchar_t_h
 #ifndef __INT_WCHAR_T_H
 #ifndef _GCC_WCHAR_T
-#define __wchar_t__	/* BeOS */
+#define __wchar_t__	/* BeOS, Haiku */
 #define __WCHAR_T__	/* Cray Unicos/Mk */
 #define _WCHAR_T
 #define _T_WCHAR_

Modified: buildtools/trunk/gcc/intl/loadmsgcat.c
===================================================================
--- buildtools/trunk/gcc/intl/loadmsgcat.c	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/intl/loadmsgcat.c	2009-01-26 05:09:46 UTC (rev 29034)
@@ -480,8 +480,8 @@
 # define O_BINARY _O_BINARY
 # define O_TEXT _O_TEXT
 #endif
-#ifdef __BEOS__
-  /* BeOS 5 has O_BINARY and O_TEXT, but they have no effect.  */
+#if defined(__BEOS__) || defined(__HAIKU__)
+  /* BeOS 5 and Haiku R1 have O_BINARY and O_TEXT, but they have no effect.  */
 # undef O_BINARY
 # undef O_TEXT
 #endif

Modified: buildtools/trunk/gcc/libgcc/config.host
===================================================================
--- buildtools/trunk/gcc/libgcc/config.host	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libgcc/config.host	2009-01-26 05:09:46 UTC (rev 29034)
@@ -313,6 +313,8 @@
 	;;
 x86_64-*-freebsd*)
 	;;
+i[34567]86-*-haikuelf* | i[34567]86-*-haiku*)
+	;;
 i[34567]86-*-netbsdelf*)
 	;;
 i[34567]86-*-netbsd*)

Modified: buildtools/trunk/gcc/libgomp/configure
===================================================================
--- buildtools/trunk/gcc/libgomp/configure	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libgomp/configure	2009-01-26 05:09:46 UTC (rev 29034)
@@ -6443,7 +6443,7 @@
       fi
       ;;
 
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
 
@@ -7079,6 +7079,11 @@
       fi
       ;;
 
+    haiku*)
+      allow_undefined_flag=unsupported
+      archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      ;;
+
     interix[3-9]*)
       hardcode_direct=no
       hardcode_shlibpath_var=no
@@ -8543,6 +8548,12 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker=&quot;$host_os ld.so&quot;
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.

Modified: buildtools/trunk/gcc/libiberty/make-relative-prefix.c
===================================================================
--- buildtools/trunk/gcc/libiberty/make-relative-prefix.c	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libiberty/make-relative-prefix.c	2009-01-26 05:09:46 UTC (rev 29034)
@@ -57,6 +57,9 @@
 #ifdef HAVE_UNISTD_H
 #include &lt;unistd.h&gt;
 #endif
+#ifdef HAVE_SYS_STAT_H
+#include &lt;sys/stat.h&gt;
+#endif
 
 #include &lt;string.h&gt;
 
@@ -254,6 +257,7 @@
 	    {
 	      if (*endp == PATH_SEPARATOR || *endp == 0)
 		{
+		  struct stat st;
 		  if (endp == startp)
 		    {
 		      nstore[0] = '.';
@@ -271,10 +275,11 @@
 		      else
 			nstore[endp - startp] = 0;
 		    }
+
 		  strcat (nstore, progname);
-		  if (! access (nstore, X_OK)
+		  if ((! stat(nstore, &amp;st) &amp;&amp; S_ISREG (st.st_mode) &amp;&amp; ! access (nstore, X_OK))
 #ifdef HAVE_HOST_EXECUTABLE_SUFFIX
-                      || ! access (strcat (nstore, HOST_EXECUTABLE_SUFFIX), X_OK)
+                      || (! stat (strcat (nstore, HOST_EXECUTABLE_SUFFIX)) &amp;&amp; S_ISREG (st.st_mode) &amp;&amp; ! access (nstore, X_OK))
 #endif
 		      )
 		    {

Modified: buildtools/trunk/gcc/libmudflap/configure
===================================================================
--- buildtools/trunk/gcc/libmudflap/configure	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libmudflap/configure	2009-01-26 05:09:46 UTC (rev 29034)
@@ -7585,7 +7585,7 @@
       fi
       ;;
 
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
 
@@ -8221,6 +8221,11 @@
       fi
       ;;
 
+    haiku*)
+      allow_undefined_flag=unsupported
+      archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      ;;
+
     interix[3-9]*)
       hardcode_direct=no
       hardcode_shlibpath_var=no
@@ -9685,6 +9690,12 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker=&quot;$host_os ld.so&quot;
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.

Modified: buildtools/trunk/gcc/libssp/configure
===================================================================
--- buildtools/trunk/gcc/libssp/configure	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libssp/configure	2009-01-26 05:09:46 UTC (rev 29034)
@@ -6567,7 +6567,7 @@
       fi
       ;;
 
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
 
@@ -7203,6 +7203,11 @@
       fi
       ;;
 
+    haiku*)
+      allow_undefined_flag=unsupported
+      archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      ;;
+
     interix[3-9]*)
       hardcode_direct=no
       hardcode_shlibpath_var=no
@@ -8682,6 +8687,12 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker=&quot;$host_os ld.so&quot;
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.

Modified: buildtools/trunk/gcc/libstdc++-v3/configure
===================================================================
--- buildtools/trunk/gcc/libstdc++-v3/configure	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libstdc++-v3/configure	2009-01-26 05:09:46 UTC (rev 29034)
@@ -7221,7 +7221,7 @@
       fi
       ;;
 
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
 
@@ -7857,6 +7857,11 @@
       fi
       ;;
 
+    haiku*)
+      allow_undefined_flag=unsupported
+      archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      ;;
+
     interix[3-9]*)
       hardcode_direct=no
       hardcode_shlibpath_var=no
@@ -9336,6 +9341,12 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker=&quot;$host_os ld.so&quot;
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.
@@ -11491,6 +11502,11 @@
       gnu*)
         ;;
 
+      haiku*)
+        allow_undefined_flag=unsupported
+        archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        ;;
+
       hpux9*)
         hardcode_libdir_flag_spec_CXX='${wl}+b ${wl}$libdir'
         hardcode_libdir_separator_CXX=:
@@ -12323,7 +12339,7 @@
         lt_prog_compiler_pic_CXX='-m68020 -resident32 -malways-restore-a4'
       fi
       ;;
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
     mingw* | cygwin* | os2* | pw32*)
@@ -13250,6 +13266,12 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker=&quot;$host_os ld.so&quot;
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.

Modified: buildtools/trunk/gcc/libstdc++-v3/crossconfig.m4
===================================================================
--- buildtools/trunk/gcc/libstdc++-v3/crossconfig.m4	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libstdc++-v3/crossconfig.m4	2009-01-26 05:09:46 UTC (rev 29034)
@@ -170,6 +170,48 @@
       AC_DEFINE(HAVE_ISNANL)
     fi
     ;;
+
+  *-haiku*)
+    AC_CHECK_HEADERS([nan.h ieeefp.h endian.h sys/isa_defs.h \
+      machine/endian.h machine/param.h sys/machine.h sys/types.h \
+      fp.h float.h endian.h inttypes.h locale.h float.h stdint.h])
+    SECTION_FLAGS='-ffunction-sections -fdata-sections'
+    AC_SUBST(SECTION_FLAGS)
+
+    AC_DEFINE(HAVE_INT64_T)
+
+    AC_DEFINE(HAVE_ACOSF)
+    AC_DEFINE(HAVE_ASINF)
+    AC_DEFINE(HAVE_ATANF)
+    AC_DEFINE(HAVE_ATAN2F)
+    AC_DEFINE(HAVE_CEILF)
+    AC_DEFINE(HAVE_COPYSIGN)
+    AC_DEFINE(HAVE_COPYSIGNF)
+    AC_DEFINE(HAVE_COSF)
+    AC_DEFINE(HAVE_COSHF)
+    AC_DEFINE(HAVE_EXPF)
+    AC_DEFINE(HAVE_FABSF)
+    AC_DEFINE(HAVE_FINITE)
+    AC_DEFINE(HAVE_FINITEF)
+    AC_DEFINE(HAVE_FLOORF)
+    AC_DEFINE(HAVE_FMODF)
+    AC_DEFINE(HAVE_FREXPF)
+    AC_DEFINE(HAVE_HYPOT)
+    AC_DEFINE(HAVE_HYPOTF)
+    AC_DEFINE(HAVE_ISINF)
+    AC_DEFINE(HAVE_ISINFF)
+    AC_DEFINE(HAVE_ISNAN)
+    AC_DEFINE(HAVE_ISNANF)
+    AC_DEFINE(HAVE_LOGF)
+    AC_DEFINE(HAVE_LOG10F)
+    AC_DEFINE(HAVE_MODFF)
+    AC_DEFINE(HAVE_SINF)
+    AC_DEFINE(HAVE_SINHF)
+    AC_DEFINE(HAVE_SQRTF)
+    AC_DEFINE(HAVE_TANF)
+    AC_DEFINE(HAVE_TANHF)
+    ;;
+
   *-hpux*)
     AC_CHECK_HEADERS([nan.h ieeefp.h endian.h sys/isa_defs.h \
       machine/endian.h machine/param.h sys/machine.h sys/types.h \

Modified: buildtools/trunk/gcc/libstdc++-v3/libsupc++/tinfo.cc
===================================================================
--- buildtools/trunk/gcc/libstdc++-v3/libsupc++/tinfo.cc	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libstdc++-v3/libsupc++/tinfo.cc	2009-01-26 05:09:46 UTC (rev 29034)
@@ -37,6 +37,15 @@
 ~type_info ()
 { }
 
+#ifdef __HAIKU__
+#ifndef __GXX_MERGED_TYPEINFO_NAMES
+#define __GXX_MERGED_TYPEINFO_NAMES 0
+#endif
+#ifndef __GXX_TYPEINFO_EQUALITY_INLINE
+#define __GXX_TYPEINFO_EQUALITY_INLINE 0
+#endif
+#endif
+
 #if !__GXX_TYPEINFO_EQUALITY_INLINE
 
 // We can't rely on common symbols being shared between shared objects.

Modified: buildtools/trunk/gcc/libtool.m4
===================================================================
--- buildtools/trunk/gcc/libtool.m4	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/libtool.m4	2009-01-26 05:09:46 UTC (rev 29034)
@@ -2211,6 +2211,12 @@
   hardcode_into_libs=yes
   ;;
 
+haiku*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker=&quot;$host_os ld.so&quot;
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
 hpux9* | hpux10* | hpux11*)
   # Give a soname corresponding to the major version so that dld.sl refuses to
   # link against other versions.
@@ -3110,7 +3116,7 @@
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 LIBM=
 case $host in
-*-*-beos* | *-*-cygwin* | *-*-pw32* | *-*-darwin*)
+*-*-beos* | *-*-haiku* | *-*-cygwin* | *-*-pw32* | *-*-darwin*)
   # These system don't have libm, or don't need it
   ;;
 *-ncr-sysv4.3*)
@@ -3411,7 +3417,7 @@
         _LT_TAGVAR(lt_prog_compiler_pic, $1)='-m68020 -resident32 -malways-restore-a4'
       fi
       ;;
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
     mingw* | cygwin* | os2* | pw32*)
@@ -3707,7 +3713,7 @@
       fi
       ;;
 
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | haiku* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
 
@@ -4163,6 +4169,11 @@
       fi
       ;;
 
+    haiku*)
+      _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+      _LT_TAGVAR(archive_cmds, $1)='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      ;;
+
     interix[[3-9]]*)
       _LT_TAGVAR(hardcode_direct, $1)=no
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no

Modified: buildtools/trunk/gcc/ltmain.sh
===================================================================
--- buildtools/trunk/gcc/ltmain.sh	2009-01-26 05:03:14 UTC (rev 29033)
+++ buildtools/trunk/gcc/ltmain.sh	2009-01-26 05:09:46 UTC (rev 29034)
@@ -3073,7 +3073,7 @@
       -l*)
 	if test &quot;X$arg&quot; = &quot;X-lc&quot; || test &quot;X$arg&quot; = &quot;X-lm&quot;; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-*-haiku*)
 	    # These systems don't actually have a C or math library (as such)
 	    continue
 	    ;;
@@ -4996,7 +4996,7 @@
       if test &quot;$build_libtool_libs&quot; = yes; then
 	if test -n &quot;$rpath&quot;; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-*-haiku*)
 	    # these systems don't actually have a c library (as such)!
 	    ;;
 	  *-*-rhapsody* | *-*-darwin1.[012])


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014094.html">[Haiku-commits] r29033 - buildtools/trunk
</A></li>
	<LI>Next message: <A HREF="014096.html">[Haiku-commits] r29035 - haiku/trunk/build/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14095">[ date ]</a>
              <a href="thread.html#14095">[ thread ]</a>
              <a href="subject.html#14095">[ subject ]</a>
              <a href="author.html#14095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
