<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r30224 -	haiku/trunk/src/add-ons/media/media-add-ons/mixer
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30224%20-%0A%09haiku/trunk/src/add-ons/media/media-add-ons/mixer&In-Reply-To=%3C200904170957.n3H9v0eS029044%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015918.html">
   <LINK REL="Next"  HREF="015920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r30224 -	haiku/trunk/src/add-ons/media/media-add-ons/mixer</H1>
    <B>stippi at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30224%20-%0A%09haiku/trunk/src/add-ons/media/media-add-ons/mixer&In-Reply-To=%3C200904170957.n3H9v0eS029044%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r30224 -	haiku/trunk/src/add-ons/media/media-add-ons/mixer">stippi at mail.berlios.de
       </A><BR>
    <I>Fri Apr 17 11:57:00 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="015918.html">[Haiku-commits] r30223 -	haiku/trunk/src/add-ons/media/media-add-ons/mixer
</A></li>
        <LI>Next message: <A HREF="015920.html">[Haiku-commits] r30225 -	haiku/trunk/src/add-ons/kernel/bus_managers/ide
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15919">[ date ]</a>
              <a href="thread.html#15919">[ thread ]</a>
              <a href="subject.html#15919">[ subject ]</a>
              <a href="author.html#15919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: stippi
Date: 2009-04-17 11:56:58 +0200 (Fri, 17 Apr 2009)
New Revision: 30224
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=30224&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=30224&amp;view=rev</A>

Modified:
   haiku/trunk/src/add-ons/media/media-add-ons/mixer/MixerCore.h
Log:
Coding style consistency.


Modified: haiku/trunk/src/add-ons/media/media-add-ons/mixer/MixerCore.h
===================================================================
--- haiku/trunk/src/add-ons/media/media-add-ons/mixer/MixerCore.h	2009-04-17 09:55:38 UTC (rev 30223)
+++ haiku/trunk/src/add-ons/media/media-add-ons/mixer/MixerCore.h	2009-04-17 09:56:58 UTC (rev 30224)
@@ -1,5 +1,5 @@
 /*
- * Copyright 2007 Haiku Inc. All rights reserved.
+ * Copyright 2007-2009 Haiku Inc. All rights reserved.
  * Distributed under the terms of the MIT License.
  */
 #ifndef _MIXER_CORE_H
@@ -24,88 +24,91 @@
 //     but for now we redefine type 12 
 #define B_CHANNEL_MONO		B_CHANNEL_TOP_CENTER
 
-class MixerCore
-{
-	public:
-										MixerCore(AudioMixer *node);
-										~MixerCore();
+class MixerCore {
+public:
+								MixerCore(AudioMixer *node);
+	virtual						~MixerCore();
 	
-		MixerSettings					*Settings();
+			MixerSettings*		Settings();
 
-		// To avoid calling Settings()-&gt;AttenuateOutput() for every outgoing
-		// buffer, this setting is cached in fOutputGain and must be set by
-		// the audio mixer node using SetOutputAttenuation()
-		void							SetOutputAttenuation(float gain);
-		MixerInput *					AddInput(const media_input &amp;input);
-		MixerOutput *					AddOutput(const media_output &amp;output);
+	// To avoid calling Settings()-&gt;AttenuateOutput() for every outgoing
+	// buffer, this setting is cached in fOutputGain and must be set by
+	// the audio mixer node using SetOutputAttenuation()
+			void				SetOutputAttenuation(float gain);
+			MixerInput*			AddInput(const media_input&amp; input);
+			MixerOutput*		AddOutput(const media_output&amp; output);
 
-		bool							RemoveInput(int32 inputID);
-		bool							RemoveOutput();
-		int32							CreateInputID();
+			bool				RemoveInput(int32 inputID);
+			bool				RemoveOutput();
+			int32				CreateInputID();
 	
- 		// index = 0 to count-1, NOT inputID
-		MixerInput *					Input(int index);
-		MixerOutput *					Output();
+	// index = 0 to count-1, NOT inputID
+			MixerInput*			Input(int index);
+			MixerOutput*		Output();
 	
-		void							Lock();
-		bool							LockWithTimeout(bigtime_t timeout);
-		bool							LockFromMixThread();
-		void							Unlock();
+			void				Lock();
+			bool				LockWithTimeout(bigtime_t timeout);
+			bool				LockFromMixThread();
+			void				Unlock();
 
-		void							BufferReceived(BBuffer *buffer,
-														bigtime_t lateness);
+			void				BufferReceived(BBuffer* buffer,
+									bigtime_t lateness);
 	
-		void							InputFormatChanged(int32 inputID, 
-											const media_multi_audio_format &amp;format);
-		void							OutputFormatChanged(
-											const media_multi_audio_format &amp;format);
+			void				InputFormatChanged(int32 inputID, 
+									const media_multi_audio_format&amp; format);
+			void				OutputFormatChanged(
+									const media_multi_audio_format&amp; format);
 
-		void							SetOutputBufferGroup(BBufferGroup *group);
-		void							SetTimingInfo(BTimeSource *ts, 
-											bigtime_t downstream_latency);
-		void							EnableOutput(bool enabled);
-		bool							Start();
-		bool							Stop();
+			void				SetOutputBufferGroup(BBufferGroup* group);
+			void				SetTimingInfo(BTimeSource* timeSource, 
+									bigtime_t downstream_latency);
+			void				EnableOutput(bool enabled);
+			bool				Start();
+			bool				Stop();
 	
-		void							StartMixThread();
-		void							StopMixThread();	
-		uint32							OutputChannelCount();
+			void				StartMixThread();
+			void				StopMixThread();	
+			uint32				OutputChannelCount();
 
-	private:
-		void							ApplyOutputFormat();
-		static int32					_mix_thread_(void *arg);
-		void							MixThread();
+private:
+			void				ApplyOutputFormat();
+	static	int32				_mix_thread_(void* arg);
+			void				MixThread();
 	
-	private:
-		BLocker							*fLocker;
-		BList							*fInputs;
-		MixerOutput						*fOutput;
-		int32							fNextInputID;
-										// true = the mix thread is running
-		bool							fRunning;
-										// true = mix thread should be 
-										// started of it is not running
-		bool							fStarted;
-										// true = mix thread should be
-										// started of it is not running
-		bool							fOutputEnabled;
-		Resampler						**fResampler; // array
-		float							*fMixBuffer;
-		int32							fMixBufferFrameRate;
-		int32							fMixBufferFrameCount;
-		int32							fMixBufferChannelCount;
-		int32							*fMixBufferChannelTypes; //array
-		bool							fDoubleRateMixing;
-		bigtime_t						fDownstreamLatency;
-		MixerSettings					*fSettings;
-		AudioMixer						*fNode;
-		BBufferGroup					*fBufferGroup;
-		BTimeSource						*fTimeSource;
-		thread_id						fMixThread;
-		sem_id							fMixThreadWaitSem;	
-		float							fOutputGain;
+private:
+			BLocker*			fLocker;
+			BList*				fInputs;
+			MixerOutput*		fOutput;
+			int32				fNextInputID;
+			bool				fRunning;
+									// true = the mix thread is running
 
-		friend class 					MixerInput; // XXX debug only
+			bool				fStarted;
+									// true = mix thread should be 
+									// started of it is not running
+
+			bool				fOutputEnabled;
+									// true = mix thread should be
+									// started of it is not running
+
+			Resampler**			fResampler; // array
+			float*				fMixBuffer;
+			int32				fMixBufferFrameRate;
+			int32				fMixBufferFrameCount;
+			int32				fMixBufferChannelCount;
+			int32*				fMixBufferChannelTypes; //array
+			bool				fDoubleRateMixing;
+			bigtime_t			fDownstreamLatency;
+			MixerSettings*		fSettings;
+			AudioMixer*			fNode;
+			BBufferGroup*		fBufferGroup;
+			BTimeSource*		fTimeSource;
+			thread_id			fMixThread;
+			sem_id				fMixThreadWaitSem;	
+			float				fOutputGain;
+
+	friend class MixerInput;
+		// NOTE: debug only
 };
 
 
@@ -115,18 +118,21 @@
 	fLocker-&gt;Lock();
 }
 
+
 inline bool 
 MixerCore::LockWithTimeout(bigtime_t timeout)
 {
-	return B_OK == fLocker-&gt;LockWithTimeout(timeout);
+	return fLocker-&gt;LockWithTimeout(timeout) == B_OK;
 }
 
+
 inline void 
 MixerCore::Unlock()
 {
 	fLocker-&gt;Unlock();
 }
 
+
 inline bool 
 MixerCore::LockFromMixThread()
 {
@@ -134,8 +140,12 @@
 		if (LockWithTimeout(10000))
 			return true;
 		// XXX accessing fMixThreadWaitSem is still a race condition :(
-		if (B_WOULD_BLOCK != acquire_sem_etc(fMixThreadWaitSem, 1, B_RELATIVE_TIMEOUT, 0))
+		if (acquire_sem_etc(fMixThreadWaitSem, 1, B_RELATIVE_TIMEOUT, 0)
+				!= B_WOULD_BLOCK) {
 			return false;
+		}
 	}
 }
-#endif
+
+
+#endif // _MIXER_CORE_H


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015918.html">[Haiku-commits] r30223 -	haiku/trunk/src/add-ons/media/media-add-ons/mixer
</A></li>
	<LI>Next message: <A HREF="015920.html">[Haiku-commits] r30225 -	haiku/trunk/src/add-ons/kernel/bus_managers/ide
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15919">[ date ]</a>
              <a href="thread.html#15919">[ thread ]</a>
              <a href="subject.html#15919">[ subject ]</a>
              <a href="author.html#15919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
