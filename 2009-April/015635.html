<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r30060 - haiku/trunk/src/bin/desklink
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30060%20-%20haiku/trunk/src/bin/desklink&In-Reply-To=%3C200904091125.n39BPQjd015017%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015634.html">
   <LINK REL="Next"  HREF="015636.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r30060 - haiku/trunk/src/bin/desklink</H1>
    <B>axeld at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30060%20-%20haiku/trunk/src/bin/desklink&In-Reply-To=%3C200904091125.n39BPQjd015017%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r30060 - haiku/trunk/src/bin/desklink">axeld at mail.berlios.de
       </A><BR>
    <I>Thu Apr  9 13:25:26 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="015634.html">[Haiku-commits] r30059 - in buildtools/trunk: . yasm yasm/Mkfiles yasm/Mkfiles/dj yasm/Mkfiles/vc yasm/Mkfiles/vc/genmacro yasm/Mkfiles/vc/genmodule yasm/Mkfiles/vc/genperf yasm/Mkfiles/vc/genstring yasm/Mkfiles/vc/genversion yasm/Mkfiles/vc/libyasm yasm/Mkfiles/vc/modules yasm/Mkfiles/vc/re2c yasm/Mkfiles/vc8 yasm/Mkfiles/vc8/genmacro yasm/Mkfiles/vc8/genmodule yasm/Mkfiles/vc8/genperf yasm/Mkfiles/vc8/genstring yasm/Mkfiles/vc8/genversion yasm/Mkfiles/vc8/libyasm yasm/Mkfiles/vc8/modules yasm/Mkfiles/vc8/re2c yasm/Mkfiles/vc9 yasm/Mkfiles/vc9/genmacro yasm/Mkfiles/vc9/genmodule yasm/Mkfiles/vc9/genperf yasm/Mkfiles/vc9/genstring yasm/Mkfiles/vc9/genversion yasm/Mkfiles/vc9/libyasm yasm/Mkfiles/vc9/modules yasm/Mkfiles/vc9/re2c yasm/config yasm/frontends yasm/frontends/yasm yasm/libyasm yasm/libyasm/tests yasm/m4 yasm/modules yasm/modules/arch yasm/modules/arch/lc3b yasm/modules/arch/lc3b/tests yasm/modules/arch/x86 yasm/modules/arch/x86/tests yasm/modules/arch/x86/tests/gas32 yas! m/modules/arch/x86/tests/gas64 yasm/modules/dbgfmts yasm/modules/dbgfmts/codeview yasm/modules/dbgfmts/dwarf2 yasm/modules/dbgfmts/dwarf2/tests yasm/modules/dbgfmts/dwarf2/tests/pass32 yasm/modules/dbgfmts/dwarf2/tests/pass64 yasm/modules/dbgfmts/dwarf2/tests/passwin64 yasm/modules/dbgfmts/null yasm/modules/dbgfmts/stabs yasm/modules/dbgfmts/stabs/tests yasm/modules/listfmts yasm/modules/listfmts/nasm yasm/modules/objfmts yasm/modules/objfmts/bin yasm/modules/objfmts/bin/tests yasm/modules/objfmts/bin/tests/multisect yasm/modules/objfmts/coff yasm/modules/objfmts/coff/tests yasm/modules/objfmts/dbg yasm/modules/objfmts/elf yasm/modules/objfmts/elf/tests yasm/modules/objfmts/elf/tests/amd64 yasm/modules/objfmts/elf/tests/gas32 yasm/modules/objfmts/elf/tests/gas64 yasm/modules/objfmts/macho yasm/modules/objfmts/macho/tests yasm/modules/objfmts/macho/tests/gas32 yasm/modules/objfmts/macho/tests/gas64 yasm/modules/objfmts/macho/tests/nasm32 yasm/modules/objfmts/macho/tests/nasm! 64 yasm/modules/objfmts/rdf yasm/modules/objfmts/rdf/tests yas! m/module
</A></li>
        <LI>Next message: <A HREF="015636.html">[Haiku-commits] r30061 - haiku/trunk/src/bin/desklink
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15635">[ date ]</a>
              <a href="thread.html#15635">[ thread ]</a>
              <a href="subject.html#15635">[ subject ]</a>
              <a href="author.html#15635">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: axeld
Date: 2009-04-09 13:25:23 +0200 (Thu, 09 Apr 2009)
New Revision: 30060
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=30060&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=30060&amp;view=rev</A>

Modified:
   haiku/trunk/src/bin/desklink/MixerControl.cpp
   haiku/trunk/src/bin/desklink/MixerControl.h
Log:
* The mixer node is now exported.
* The node is no longer allocated separately.
* Cleanup.


Modified: haiku/trunk/src/bin/desklink/MixerControl.cpp
===================================================================
--- haiku/trunk/src/bin/desklink/MixerControl.cpp	2009-04-09 11:16:39 UTC (rev 30059)
+++ haiku/trunk/src/bin/desklink/MixerControl.cpp	2009-04-09 11:25:23 UTC (rev 30060)
@@ -21,7 +21,7 @@
 		const char** _error)
 	:
 	fVolumeWhich(volumeWhich),
-	fAudioMixerNode(NULL),
+	fGainMediaNode(media_node::null),
 	fParameterWeb(NULL),
 	fMixerParameter(NULL),
 	fMin(0.0f),
@@ -29,7 +29,6 @@
 	fStep(0.0f)
 {
 	bool retrying = false;
-	fAudioMixerNode = new media_node();
 
 	status_t err = B_OK;
 		/* BMediaRoster::Roster() doesn't set it if all is ok */
@@ -56,14 +55,14 @@
 	if (roster &amp;&amp; err == B_OK) {
 		switch (volumeWhich) {
 			case VOLUME_USE_MIXER:
-				err = roster-&gt;GetAudioMixer(fAudioMixerNode);
+				err = roster-&gt;GetAudioMixer(&amp;fGainMediaNode);
 				break;
 			case VOLUME_USE_PHYS_OUTPUT:
-				err = roster-&gt;GetAudioOutput(fAudioMixerNode);
+				err = roster-&gt;GetAudioOutput(&amp;fGainMediaNode);
 				break;
 		}
 		if (err == B_OK) {
-			err = roster-&gt;GetParameterWebFor(*fAudioMixerNode, &amp;fParameterWeb);
+			err = roster-&gt;GetParameterWebFor(fGainMediaNode, &amp;fParameterWeb);
 			if (err == B_OK) {
 				// Finding the Mixer slider in the audio output ParameterWeb 
 				int32 numParams = fParameterWeb-&gt;CountParameters();
@@ -112,11 +111,11 @@
 					p = NULL;
 				}
 				if (p == NULL) {
-					errorString = volumeWhich
-						? &quot;Could not find the soundcard&quot;:&quot;Could not find the mixer&quot;;
+					errorString = volumeWhich ? &quot;Could not find the soundcard&quot;
+						: &quot;Could not find the mixer&quot;;
 				} else if (p-&gt;Type() != BParameter::B_CONTINUOUS_PARAMETER) {
-					errorString = volumeWhich
-						? &quot;Soundcard control unknown&quot;:&quot;Mixer control unknown&quot;;
+					errorString = volumeWhich ? &quot;Soundcard control unknown&quot;
+						: &quot;Mixer control unknown&quot;;
 				} else {
 					fMixerParameter = dynamic_cast&lt;BContinuousParameter*&gt;(p);
 					fMin = fMixerParameter-&gt;MinValue();
@@ -150,10 +149,9 @@
 		errorString = &quot;No Media Roster&quot;;
 	}
 
-	if (err != B_OK) {
-		delete fAudioMixerNode;
-		fAudioMixerNode = NULL;
-	}
+	if (err != B_OK)
+		fGainMediaNode = media_node::null;
+
 	if (errorString) {
 		fprintf(stderr, &quot;MixerControl: %s.\n&quot;, errorString);
 		if (_error)
@@ -169,8 +167,8 @@
 	delete fParameterWeb;
 
 	BMediaRoster* roster = BMediaRoster::CurrentRoster();
-	if (roster != NULL &amp;&amp; fAudioMixerNode != NULL)
-		roster-&gt;ReleaseNode(*fAudioMixerNode);
+	if (roster != NULL &amp;&amp; fGainMediaNode != media_node::null)
+		roster-&gt;ReleaseNode(fGainMediaNode);
 }
 
 

Modified: haiku/trunk/src/bin/desklink/MixerControl.h
===================================================================
--- haiku/trunk/src/bin/desklink/MixerControl.h	2009-04-09 11:16:39 UTC (rev 30059)
+++ haiku/trunk/src/bin/desklink/MixerControl.h	2009-04-09 11:25:23 UTC (rev 30060)
@@ -37,9 +37,11 @@
 			float			Minimum() const { return fMin; }
 			float			Maximum() const { return fMax; }
 
+			media_node		GainNode() { return fGainMediaNode; }
+
 private:
 			int32			fVolumeWhich;
-			media_node*		fAudioMixerNode;
+			media_node		fGainMediaNode;
 			BParameterWeb*	fParameterWeb;
 			BContinuousParameter* fMixerParameter;
 			float			fMin;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015634.html">[Haiku-commits] r30059 - in buildtools/trunk: . yasm yasm/Mkfiles yasm/Mkfiles/dj yasm/Mkfiles/vc yasm/Mkfiles/vc/genmacro yasm/Mkfiles/vc/genmodule yasm/Mkfiles/vc/genperf yasm/Mkfiles/vc/genstring yasm/Mkfiles/vc/genversion yasm/Mkfiles/vc/libyasm yasm/Mkfiles/vc/modules yasm/Mkfiles/vc/re2c yasm/Mkfiles/vc8 yasm/Mkfiles/vc8/genmacro yasm/Mkfiles/vc8/genmodule yasm/Mkfiles/vc8/genperf yasm/Mkfiles/vc8/genstring yasm/Mkfiles/vc8/genversion yasm/Mkfiles/vc8/libyasm yasm/Mkfiles/vc8/modules yasm/Mkfiles/vc8/re2c yasm/Mkfiles/vc9 yasm/Mkfiles/vc9/genmacro yasm/Mkfiles/vc9/genmodule yasm/Mkfiles/vc9/genperf yasm/Mkfiles/vc9/genstring yasm/Mkfiles/vc9/genversion yasm/Mkfiles/vc9/libyasm yasm/Mkfiles/vc9/modules yasm/Mkfiles/vc9/re2c yasm/config yasm/frontends yasm/frontends/yasm yasm/libyasm yasm/libyasm/tests yasm/m4 yasm/modules yasm/modules/arch yasm/modules/arch/lc3b yasm/modules/arch/lc3b/tests yasm/modules/arch/x86 yasm/modules/arch/x86/tests yasm/modules/arch/x86/tests/gas32 yas! m/modules/arch/x86/tests/gas64 yasm/modules/dbgfmts yasm/modules/dbgfmts/codeview yasm/modules/dbgfmts/dwarf2 yasm/modules/dbgfmts/dwarf2/tests yasm/modules/dbgfmts/dwarf2/tests/pass32 yasm/modules/dbgfmts/dwarf2/tests/pass64 yasm/modules/dbgfmts/dwarf2/tests/passwin64 yasm/modules/dbgfmts/null yasm/modules/dbgfmts/stabs yasm/modules/dbgfmts/stabs/tests yasm/modules/listfmts yasm/modules/listfmts/nasm yasm/modules/objfmts yasm/modules/objfmts/bin yasm/modules/objfmts/bin/tests yasm/modules/objfmts/bin/tests/multisect yasm/modules/objfmts/coff yasm/modules/objfmts/coff/tests yasm/modules/objfmts/dbg yasm/modules/objfmts/elf yasm/modules/objfmts/elf/tests yasm/modules/objfmts/elf/tests/amd64 yasm/modules/objfmts/elf/tests/gas32 yasm/modules/objfmts/elf/tests/gas64 yasm/modules/objfmts/macho yasm/modules/objfmts/macho/tests yasm/modules/objfmts/macho/tests/gas32 yasm/modules/objfmts/macho/tests/gas64 yasm/modules/objfmts/macho/tests/nasm32 yasm/modules/objfmts/macho/tests/nasm! 64 yasm/modules/objfmts/rdf yasm/modules/objfmts/rdf/tests yas! m/module
</A></li>
	<LI>Next message: <A HREF="015636.html">[Haiku-commits] r30061 - haiku/trunk/src/bin/desklink
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15635">[ date ]</a>
              <a href="thread.html#15635">[ thread ]</a>
              <a href="subject.html#15635">[ subject ]</a>
              <a href="author.html#15635">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
