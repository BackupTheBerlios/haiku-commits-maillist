<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r29973 - in haiku/trunk: headers/libs/png	src/libs/png
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29973%20-%20in%20haiku/trunk%3A%20headers/libs/png%0A%09src/libs/png&In-Reply-To=%3C200904061933.n36JXVBL012292%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015503.html">
   <LINK REL="Next"  HREF="015505.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r29973 - in haiku/trunk: headers/libs/png	src/libs/png</H1>
    <B>korli at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r29973%20-%20in%20haiku/trunk%3A%20headers/libs/png%0A%09src/libs/png&In-Reply-To=%3C200904061933.n36JXVBL012292%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r29973 - in haiku/trunk: headers/libs/png	src/libs/png">korli at mail.berlios.de
       </A><BR>
    <I>Mon Apr  6 21:33:31 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="015503.html">[Haiku-commits] r29972 - in haiku/trunk: headers/os/interface	headers/private/shared src/kits/interface src/kits/shared
</A></li>
        <LI>Next message: <A HREF="015505.html">[Haiku-commits] r29974 - haiku/trunk/src/kits/tracker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15504">[ date ]</a>
              <a href="thread.html#15504">[ thread ]</a>
              <a href="subject.html#15504">[ subject ]</a>
              <a href="author.html#15504">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: korli
Date: 2009-04-06 21:33:30 +0200 (Mon, 06 Apr 2009)
New Revision: 29973
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=29973&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=29973&amp;view=rev</A>

Modified:
   haiku/trunk/headers/libs/png/png.h
   haiku/trunk/headers/libs/png/pngconf.h
   haiku/trunk/src/libs/png/LICENSE
   haiku/trunk/src/libs/png/png.c
   haiku/trunk/src/libs/png/pngget.c
   haiku/trunk/src/libs/png/pngread.c
   haiku/trunk/src/libs/png/pngrtran.c
   haiku/trunk/src/libs/png/pngrutil.c
   haiku/trunk/src/libs/png/pngset.c
   haiku/trunk/src/libs/png/pngwio.c
   haiku/trunk/src/libs/png/pngwrite.c
Log:
updated libpng to 1.2.35


Modified: haiku/trunk/headers/libs/png/png.h
===================================================================
--- haiku/trunk/headers/libs/png/png.h	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/headers/libs/png/png.h	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1,14 +1,14 @@
 /* png.h - header file for PNG reference library
  *
- * libpng version 1.2.34 - December 18, 2008
- * Copyright (c) 1998-2008 Glenn Randers-Pehrson
+ * libpng version 1.2.35 - February 14, 2009
+ * Copyright (c) 1998-2009 Glenn Randers-Pehrson
  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)
  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)
  *
  * Authors and maintainers:
  *  libpng versions 0.71, May 1995, through 0.88, January 1996: Guy Schalnat
  *  libpng versions 0.89c, June 1996, through 0.96, May 1997: Andreas Dilger
- *  libpng versions 0.97, January 1998, through 1.2.34 - December 18, 2008: Glenn
+ *  libpng versions 0.97, January 1998, through 1.2.35 - February 14, 2009: Glenn
  *  See also &quot;Contributing Authors&quot;, below.
  *
  * Note about libpng version numbers:
@@ -217,6 +217,11 @@
  *    1.2.34rc01              13    10234  12.so.0.34[.0]
  *    1.0.42                  10    10042  10.so.0.42[.0]
  *    1.2.34                  13    10234  12.so.0.34[.0]
+ *    1.2.35beta01-03         13    10235  12.so.0.35[.0]
+ *    1.0.43rc01-02           10    10043  10.so.0.43[.0]
+ *    1.2.35rc01-02           13    10235  12.so.0.35[.0]
+ *    1.0.43                  10    10043  10.so.0.43[.0]
+ *    1.2.35                  13    10235  12.so.0.35[.0]
  *
  *    Henceforth the source version will match the shared-library major
  *    and minor numbers; the shared-library major version number will be
@@ -246,7 +251,7 @@
  * If you modify libpng you may insert additional notices immediately following
  * this sentence.
  *
- * libpng versions 1.2.6, August 15, 2004, through 1.2.34, December 18, 2008, are
+ * libpng versions 1.2.6, August 15, 2004, through 1.2.35, February 14, 2009, are
  * Copyright (c) 2004, 2006-2008 Glenn Randers-Pehrson, and are
  * distributed according to the same disclaimer and license as libpng-1.2.5
  * with the following individual added to the list of Contributing Authors:
@@ -358,13 +363,13 @@
  * Y2K compliance in libpng:
  * =========================
  *
- *    December 18, 2008
+ *    February 14, 2009
  *
  *    Since the PNG Development group is an ad-hoc body, we can't make
  *    an official declaration.
  *
  *    This is your unofficial assurance that libpng from version 0.71 and
- *    upward through 1.2.34 are Y2K compliant.  It is my belief that earlier
+ *    upward through 1.2.35 are Y2K compliant.  It is my belief that earlier
  *    versions were also Y2K compliant.
  *
  *    Libpng only has three year fields.  One is a 2-byte unsigned integer
@@ -420,9 +425,9 @@
  */
 
 /* Version information for png.h - this should match the version in png.c */
-#define PNG_LIBPNG_VER_STRING &quot;1.2.34&quot;
+#define PNG_LIBPNG_VER_STRING &quot;1.2.35&quot;
 #define PNG_HEADER_VERSION_STRING \
-   &quot; libpng version 1.2.34 - December 18, 2008\n&quot;
+   &quot; libpng version 1.2.35 - February 14, 2009\n&quot;
 
 #define PNG_LIBPNG_VER_SONUM   0
 #define PNG_LIBPNG_VER_DLLNUM  13
@@ -430,7 +435,7 @@
 /* These should match the first 3 components of PNG_LIBPNG_VER_STRING: */
 #define PNG_LIBPNG_VER_MAJOR   1
 #define PNG_LIBPNG_VER_MINOR   2
-#define PNG_LIBPNG_VER_RELEASE 34
+#define PNG_LIBPNG_VER_RELEASE 35
 /* This should match the numeric part of the final component of
  * PNG_LIBPNG_VER_STRING, omitting any leading zero: */
 
@@ -458,7 +463,7 @@
  * Versions 0.7 through 1.0.0 were in the range 0 to 100 here (only
  * version 1.0.0 was mis-numbered 100 instead of 10000).  From
  * version 1.0.1 it's    xxyyzz, where x=major, y=minor, z=release */
-#define PNG_LIBPNG_VER 10234 /* 1.2.34 */
+#define PNG_LIBPNG_VER 10235 /* 1.2.35 */
 
 #ifndef PNG_VERSION_INFO_ONLY
 /* include the compression library's header */
@@ -1482,7 +1487,7 @@
 /* This triggers a compiler error in png.c, if png.c and png.h
  * do not agree upon the version number.
  */
-typedef png_structp version_1_2_34;
+typedef png_structp version_1_2_35;
 
 typedef png_struct FAR * FAR * png_structpp;
 

Modified: haiku/trunk/headers/libs/png/pngconf.h
===================================================================
--- haiku/trunk/headers/libs/png/pngconf.h	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/headers/libs/png/pngconf.h	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1,9 +1,9 @@
 
 /* pngconf.h - machine configurable file for libpng
  *
- * libpng version 1.2.34 - December 18, 2008
+ * libpng version 1.2.35 - February 14, 2009
  * For conditions of distribution and use, see copyright notice in png.h
- * Copyright (c) 1998-2008 Glenn Randers-Pehrson
+ * Copyright (c) 1998-2009 Glenn Randers-Pehrson
  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)
  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)
  */
@@ -233,6 +233,8 @@
 #  include &lt;windows.h&gt;
    /* Console I/O functions are not supported on WindowsCE */
 #  define PNG_NO_CONSOLE_IO
+   /* abort() may not be supported on some/all Windows CE platforms */
+#  define PNG_ABORT() exit(-1)
 #  ifdef PNG_DEBUG
 #    undef PNG_DEBUG
 #  endif

Modified: haiku/trunk/src/libs/png/LICENSE
===================================================================
--- haiku/trunk/src/libs/png/LICENSE	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/LICENSE	2009-04-06 19:33:30 UTC (rev 29973)
@@ -8,7 +8,7 @@
 If you modify libpng you may insert additional notices immediately following
 this sentence.
 
-libpng versions 1.2.6, August 15, 2004, through 1.2.33, October 31, 2008, are
+libpng versions 1.2.6, August 15, 2004, through 1.2.35, February 14, 2009, are
 Copyright (c) 2004, 2006-2008 Glenn Randers-Pehrson, and are
 distributed according to the same disclaimer and license as libpng-1.2.5
 with the following individual added to the list of Contributing Authors
@@ -106,4 +106,4 @@
 
 Glenn Randers-Pehrson
 glennrp at users.sourceforge.net
-October 31, 2008
+February 14, 2009

Modified: haiku/trunk/src/libs/png/png.c
===================================================================
--- haiku/trunk/src/libs/png/png.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/png.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -13,7 +13,7 @@
 #include &quot;png.h&quot;
 
 /* Generate a compiler error if there is an old png.h in the search path. */
-typedef version_1_2_34 Your_png_h_is_not_version_1_2_34;
+typedef version_1_2_35 Your_png_h_is_not_version_1_2_35;
 
 /* Version information for C files.  This had better match the version
  * string defined in png.h.  */
@@ -694,7 +694,7 @@
 png_get_copyright(png_structp png_ptr)
 {
    png_ptr = png_ptr;  /* silence compiler warning about unused png_ptr */
-   return ((png_charp) &quot;\n libpng version 1.2.34 - December 18, 2008\n\
+   return ((png_charp) &quot;\n libpng version 1.2.35 - February 14, 2009\n\
    Copyright (c) 1998-2008 Glenn Randers-Pehrson\n\
    Copyright (c) 1996-1997 Andreas Dilger\n\
    Copyright (c) 1995-1996 Guy Eric Schalnat, Group 42, Inc.\n&quot;);

Modified: haiku/trunk/src/libs/png/pngget.c
===================================================================
--- haiku/trunk/src/libs/png/pngget.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/pngget.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -883,7 +883,7 @@
 #endif /* ?PNG_ASSEMBLER_CODE_SUPPORTED */
 
 #ifdef PNG_SET_USER_LIMITS_SUPPORTED
-/* these functions were added to libpng 1.2.6 */
+/* These functions were added to libpng 1.2.6 */
 png_uint_32 PNGAPI
 png_get_user_width_max (png_structp png_ptr)
 {

Modified: haiku/trunk/src/libs/png/pngread.c
===================================================================
--- haiku/trunk/src/libs/png/pngread.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/pngread.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1,9 +1,9 @@
 
 /* pngread.c - read a PNG file
  *
- * Last changed in libpng 1.2.30 [August 15, 2008]
+ * Last changed in libpng 1.2.35 [February 14, 2009]
  * For conditions of distribution and use, see copyright notice in png.h
- * Copyright (c) 1998-2008 Glenn Randers-Pehrson
+ * Copyright (c) 1998-2009 Glenn Randers-Pehrson
  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)
  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)
  *
@@ -1437,11 +1437,11 @@
 #ifdef PNG_FREE_ME_SUPPORTED
       info_ptr-&gt;free_me |= PNG_FREE_ROWS;
 #endif
+      png_memset(info_ptr-&gt;row_pointers, 0, info_ptr-&gt;height
+         * png_sizeof(png_bytep));
       for (row = 0; row &lt; (int)info_ptr-&gt;height; row++)
-      {
          info_ptr-&gt;row_pointers[row] = (png_bytep)png_malloc(png_ptr,
             png_get_rowbytes(png_ptr, info_ptr));
-      }
    }
 
    png_read_image(png_ptr, info_ptr-&gt;row_pointers);

Modified: haiku/trunk/src/libs/png/pngrtran.c
===================================================================
--- haiku/trunk/src/libs/png/pngrtran.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/pngrtran.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1,9 +1,9 @@
 
 /* pngrtran.c - transforms the data in a row for PNG readers
  *
- * Last changed in libpng 1.2.30 [August 15, 2008]
+ * Last changed in libpng 1.2.35 [February 14, 2009]
  * For conditions of distribution and use, see copyright notice in png.h
- * Copyright (c) 1998-2008 Glenn Randers-Pehrson
+ * Copyright (c) 1998-2009 Glenn Randers-Pehrson
  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)
  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)
  *
@@ -309,9 +309,7 @@
 
          hash = (png_dsortpp)png_malloc(png_ptr, (png_uint_32)(769 *
             png_sizeof(png_dsortp)));
-         for (i = 0; i &lt; 769; i++)
-            hash[i] = NULL;
-/*         png_memset(hash, 0, 769 * png_sizeof(png_dsortp)); */
+         png_memset(hash, 0, 769 * png_sizeof(png_dsortp));
 
          num_new_palette = num_palette;
 
@@ -684,7 +682,7 @@
       }
       png_ptr-&gt;rgb_to_gray_red_coeff   = red_int;
       png_ptr-&gt;rgb_to_gray_green_coeff = green_int;
-      png_ptr-&gt;rgb_to_gray_blue_coeff  = 
+      png_ptr-&gt;rgb_to_gray_blue_coeff  =
          (png_uint_16)(32768 - red_int - green_int);
    }
 }
@@ -1329,7 +1327,7 @@
       if (rgb_error)
       {
          png_ptr-&gt;rgb_to_gray_status=1;
-         if ((png_ptr-&gt;transformations &amp; PNG_RGB_TO_GRAY) == 
+         if ((png_ptr-&gt;transformations &amp; PNG_RGB_TO_GRAY) ==
              PNG_RGB_TO_GRAY_WARN)
             png_warning(png_ptr, &quot;png_do_rgb_to_gray found nongray pixel&quot;);
          if ((png_ptr-&gt;transformations &amp; PNG_RGB_TO_GRAY) ==
@@ -3836,7 +3834,7 @@
                dp = row + (row_info-&gt;rowbytes &lt;&lt; 1) - 1;
                for (i = 0; i &lt; row_width; i++)
                {
-                  if (*(sp - 1) == gray_high &amp;&amp; *(sp) == gray_low) 
+                  if (*(sp - 1) == gray_high &amp;&amp; *(sp) == gray_low)
                   {
                      *dp-- = 0;
                      *dp-- = 0;
@@ -4133,6 +4131,8 @@
         double fin, fout;
         png_uint_32 last, max;
 
+        png_memset(png_ptr-&gt;gamma_16_table, 0, num * png_sizeof(png_uint_16p)); 
+
         for (i = 0; i &lt; num; i++)
         {
            png_ptr-&gt;gamma_16_table[i] = (png_uint_16p)png_malloc(png_ptr,
@@ -4188,6 +4188,8 @@
         png_ptr-&gt;gamma_16_to_1 = (png_uint_16pp)png_malloc(png_ptr,
            (png_uint_32)(num * png_sizeof(png_uint_16p )));
 
+        png_memset(png_ptr-&gt;gamma_16_to_1, 0, num * png_sizeof(png_uint_16p)); 
+
         for (i = 0; i &lt; num; i++)
         {
            png_ptr-&gt;gamma_16_to_1[i] = (png_uint_16p)png_malloc(png_ptr,
@@ -4211,6 +4213,9 @@
         png_ptr-&gt;gamma_16_from_1 = (png_uint_16pp)png_malloc(png_ptr,
            (png_uint_32)(num * png_sizeof(png_uint_16p)));
 
+        png_memset(png_ptr-&gt;gamma_16_from_1, 0,
+           num * png_sizeof(png_uint_16p)); 
+
         for (i = 0; i &lt; num; i++)
         {
            png_ptr-&gt;gamma_16_from_1[i] = (png_uint_16p)png_malloc(png_ptr,

Modified: haiku/trunk/src/libs/png/pngrutil.c
===================================================================
--- haiku/trunk/src/libs/png/pngrutil.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/pngrutil.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1118,6 +1118,7 @@
 
    png_debug(1, &quot;in png_handle_sPLT&quot;);
 
+
    if (!(png_ptr-&gt;mode &amp; PNG_HAVE_IHDR))
       png_error(png_ptr, &quot;Missing IHDR before sPLT&quot;);
    else if (png_ptr-&gt;mode &amp; PNG_HAVE_IDAT)
@@ -1904,6 +1905,7 @@
 
    png_debug(1, &quot;in png_handle_tEXt&quot;);
 
+
    if (!(png_ptr-&gt;mode &amp; PNG_HAVE_IHDR))
       png_error(png_ptr, &quot;Missing IHDR before tEXt&quot;);
 
@@ -1920,6 +1922,7 @@
 #endif
 
    png_free(png_ptr, png_ptr-&gt;chunkdata);
+
    png_ptr-&gt;chunkdata = (png_charp)png_malloc_warn(png_ptr, length + 1);
    if (png_ptr-&gt;chunkdata == NULL)
    {
@@ -1937,6 +1940,7 @@
    }
 
    key = png_ptr-&gt;chunkdata;
+
    key[slength] = 0x00;
 
    for (text = key; *text; text++)
@@ -1986,6 +1990,8 @@
    png_size_t slength, prefix_len, data_len;
 
    png_debug(1, &quot;in png_handle_zTXt&quot;);
+
+
    if (!(png_ptr-&gt;mode &amp; PNG_HAVE_IHDR))
       png_error(png_ptr, &quot;Missing IHDR before zTXt&quot;);
 
@@ -2090,6 +2096,7 @@
 
    png_debug(1, &quot;in png_handle_iTXt&quot;);
 
+
    if (!(png_ptr-&gt;mode &amp; PNG_HAVE_IHDR))
       png_error(png_ptr, &quot;Missing IHDR before iTXt&quot;);
 
@@ -2216,6 +2223,7 @@
 
    png_debug(1, &quot;in png_handle_unknown&quot;);
 
+
    if (png_ptr-&gt;mode &amp; PNG_HAVE_IDAT)
    {
 #ifdef PNG_USE_LOCAL_ARRAYS
@@ -3204,9 +3212,9 @@
    png_debug1(3, &quot;width = %lu,&quot;, png_ptr-&gt;width);
    png_debug1(3, &quot;height = %lu,&quot;, png_ptr-&gt;height);
    png_debug1(3, &quot;iwidth = %lu,&quot;, png_ptr-&gt;iwidth);
-   png_debug1(3, &quot;num_rows = %lu&quot;, png_ptr-&gt;num_rows);
+   png_debug1(3, &quot;num_rows = %lu,&quot;, png_ptr-&gt;num_rows);
    png_debug1(3, &quot;rowbytes = %lu,&quot;, png_ptr-&gt;rowbytes);
-   png_debug1(3, &quot;irowbytes = %lu,&quot;, png_ptr-&gt;irowbytes);
+   png_debug1(3, &quot;irowbytes = %lu&quot;, png_ptr-&gt;irowbytes);
 
    png_ptr-&gt;flags |= PNG_FLAG_ROW_INIT;
 }

Modified: haiku/trunk/src/libs/png/pngset.c
===================================================================
--- haiku/trunk/src/libs/png/pngset.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/pngset.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1,9 +1,9 @@
 
 /* pngset.c - storage of image information into info struct
  *
- * Last changed in libpng 1.2.34 [December 18, 2008]
+ * Last changed in libpng 1.2.35 [February 14, 2009]
  * For conditions of distribution and use, see copyright notice in png.h
- * Copyright (c) 1998-2008 Glenn Randers-Pehrson
+ * Copyright (c) 1998-2009 Glenn Randers-Pehrson
  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)
  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)
  *
@@ -61,7 +61,8 @@
 #endif
    info_ptr-&gt;valid |= PNG_INFO_cHRM;
 }
-#endif
+#endif /* PNG_FLOATING_POINT_SUPPORTED */
+
 #ifdef PNG_FIXED_POINT_SUPPORTED
 void PNGAPI
 png_set_cHRM_fixed(png_structp png_ptr, png_infop info_ptr,
@@ -382,8 +383,12 @@
       return;
    }
 
-   info_ptr-&gt;pcal_params[nparams] = NULL;
+#ifdef PNG_FREE_ME_SUPPORTED
+   info_ptr-&gt;free_me |= PNG_FREE_PCAL;
+#endif
 
+   png_memset(info_ptr-&gt;pcal_params, 0, (nparams + 1) * png_sizeof(png_charp));
+
    for (i = 0; i &lt; nparams; i++)
    {
       length = png_strlen(params[i]) + 1;
@@ -399,9 +404,6 @@
    }
 
    info_ptr-&gt;valid |= PNG_INFO_pCAL;
-#ifdef PNG_FREE_ME_SUPPORTED
-   info_ptr-&gt;free_me |= PNG_FREE_PCAL;
-#endif
 }
 #endif
 
@@ -635,7 +637,7 @@
    }
 #endif /* cHRM */
 }
-#endif
+#endif /* sRGB */
 
 
 #if defined(PNG_iCCP_SUPPORTED)
@@ -959,6 +961,7 @@
 
     png_memcpy(np, info_ptr-&gt;splt_palettes,
            info_ptr-&gt;splt_palettes_num * png_sizeof(png_sPLT_t));
+
     png_free(png_ptr, info_ptr-&gt;splt_palettes);
     info_ptr-&gt;splt_palettes=NULL;
 

Modified: haiku/trunk/src/libs/png/pngwio.c
===================================================================
--- haiku/trunk/src/libs/png/pngwio.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/pngwio.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1,9 +1,9 @@
 
 /* pngwio.c - functions for data output
  *
- * Last changed in libpng 1.2.30 [August 15, 2008]
+ * Last changed in libpng 1.2.35 [February 14, 2009]
  * For conditions of distribution and use, see copyright notice in png.h
- * Copyright (c) 1998-2008 Glenn Randers-Pehrson
+ * Copyright (c) 1998-2009 Glenn Randers-Pehrson
  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)
  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)
  *
@@ -137,7 +137,7 @@
    if (png_ptr == NULL) return;
 #if !defined(_WIN32_WCE)
    io_ptr = (png_FILE_p)CVT_PTR((png_ptr-&gt;io_ptr));
-   if (io_ptr != NULL)
+   if (io_ptr != NULL &amp;&amp; fileno(io_ptr) != -1)
       fflush(io_ptr);
 #endif
 }

Modified: haiku/trunk/src/libs/png/pngwrite.c
===================================================================
--- haiku/trunk/src/libs/png/pngwrite.c	2009-04-06 19:15:00 UTC (rev 29972)
+++ haiku/trunk/src/libs/png/pngwrite.c	2009-04-06 19:33:30 UTC (rev 29973)
@@ -1,7 +1,7 @@
 
 /* pngwrite.c - general routines to write a PNG file
  *
- * Last changed in libpng 1.2.31 [August 19, 2008]
+ * Last changed in libpng 1.2.34 [December 18, 2008]
  * For conditions of distribution and use, see copyright notice in png.h
  * Copyright (c) 1998-2008 Glenn Randers-Pehrson
  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015503.html">[Haiku-commits] r29972 - in haiku/trunk: headers/os/interface	headers/private/shared src/kits/interface src/kits/shared
</A></li>
	<LI>Next message: <A HREF="015505.html">[Haiku-commits] r29974 - haiku/trunk/src/kits/tracker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15504">[ date ]</a>
              <a href="thread.html#15504">[ thread ]</a>
              <a href="subject.html#15504">[ subject ]</a>
              <a href="author.html#15504">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
