<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r26858 - in haiku/trunk/src/add-ons/kernel: bus_managers/firewire  bus_managers/scsi bus_managers/usb busses/ide/silicon_image_3112  busses/scsi/ahci drivers/audio/ac97/auich drivers/audio/ac97/auvia drivers/audio/ac97/es1370 drivers/audio/ac97/ich drivers/audio/ac97/ichaudio/lala  drivers/audio/echo drivers/audio/emuxki drivers/audio/hda drivers/audio/ice1712 drivers/dvb/cx23882 drivers/graphics/matrox drivers/graphics/nvidia  drivers/graphics/nvidia_gpgpu drivers/network/bcm570x drivers/network/dp83815 drivers/network/ipro1000 drivers/network/ipw2100 drivers/network/rtl8169 generic/block_io generic/ide_adapter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%0A%20%3D%3Futf-8%3Fq%3Fr26858_-_in_haiku/trunk/src/add-ons/ker%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fnel%3D3A_bus%3D5Fmanagers/firewire__bus%3D5Fmanagers/scsi_bus%3D5Fmanag%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fers/usb_busses/ide/silicon%3D5Fimage%3D5F3112__busses/scsi/ahci_dri%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fvers/audio/ac97/auich_drivers/audio/ac97/auvia_drivers/audio/ac%3F%3D%0A%20%3D%3Futf-8%3Fq%3F97/es1370_drivers/audio/ac97/ich_drivers/audio/ac97/ichaudio/la%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fla__drivers/audio/echo_drivers/audio/emuxki_drivers/audio/hda_d%3F%3D%0A%20%3D%3Futf-8%3Fq%3Frivers/audio/ice1712_drivers/dvb/cx23882_drivers/graphics/matro%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fx_drivers/graphics/nvidia__drivers/graphics/nvidia%3D5Fgpgpu_driv%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fers/network/bcm570x_drivers/network/dp83815_drivers/network/ipr%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fo1000_drivers/network/ipw2100_drivers/network/rtl8169_generic/b%3F%3D%0A%20%3D%3Futf-8%3Fq%3Flock%3D5Fio_generic/ide%3D5Fadapter%3F%3D&In-Reply-To=%3C46621678902-BeMail%40zon%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010909.html">
   <LINK REL="Next"  HREF="010937.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r26858 - in haiku/trunk/src/add-ons/kernel: bus_managers/firewire  bus_managers/scsi bus_managers/usb busses/ide/silicon_image_3112  busses/scsi/ahci drivers/audio/ac97/auich drivers/audio/ac97/auvia drivers/audio/ac97/es1370 drivers/audio/ac97/ich drivers/audio/ac97/ichaudio/lala  drivers/audio/echo drivers/audio/emuxki drivers/audio/hda drivers/audio/ice1712 drivers/dvb/cx23882 drivers/graphics/matrox drivers/graphics/nvidia  drivers/graphics/nvidia_gpgpu drivers/network/bcm570x drivers/network/dp83815 drivers/network/ipro1000 drivers/network/ipw2100 drivers/network/rtl8169 generic/block_io generic/ide_adapter</H1>
    <B>Axel D&#246;rfler</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%0A%20%3D%3Futf-8%3Fq%3Fr26858_-_in_haiku/trunk/src/add-ons/ker%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fnel%3D3A_bus%3D5Fmanagers/firewire__bus%3D5Fmanagers/scsi_bus%3D5Fmanag%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fers/usb_busses/ide/silicon%3D5Fimage%3D5F3112__busses/scsi/ahci_dri%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fvers/audio/ac97/auich_drivers/audio/ac97/auvia_drivers/audio/ac%3F%3D%0A%20%3D%3Futf-8%3Fq%3F97/es1370_drivers/audio/ac97/ich_drivers/audio/ac97/ichaudio/la%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fla__drivers/audio/echo_drivers/audio/emuxki_drivers/audio/hda_d%3F%3D%0A%20%3D%3Futf-8%3Fq%3Frivers/audio/ice1712_drivers/dvb/cx23882_drivers/graphics/matro%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fx_drivers/graphics/nvidia__drivers/graphics/nvidia%3D5Fgpgpu_driv%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fers/network/bcm570x_drivers/network/dp83815_drivers/network/ipr%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fo1000_drivers/network/ipw2100_drivers/network/rtl8169_generic/b%3F%3D%0A%20%3D%3Futf-8%3Fq%3Flock%3D5Fio_generic/ide%3D5Fadapter%3F%3D&In-Reply-To=%3C46621678902-BeMail%40zon%3E"
       TITLE="[Haiku-commits] r26858 - in haiku/trunk/src/add-ons/kernel: bus_managers/firewire  bus_managers/scsi bus_managers/usb busses/ide/silicon_image_3112  busses/scsi/ahci drivers/audio/ac97/auich drivers/audio/ac97/auvia drivers/audio/ac97/es1370 drivers/audio/ac97/ich drivers/audio/ac97/ichaudio/lala  drivers/audio/echo drivers/audio/emuxki drivers/audio/hda drivers/audio/ice1712 drivers/dvb/cx23882 drivers/graphics/matrox drivers/graphics/nvidia  drivers/graphics/nvidia_gpgpu drivers/network/bcm570x drivers/network/dp83815 drivers/network/ipro1000 drivers/network/ipw2100 drivers/network/rtl8169 generic/block_io generic/ide_adapter">axeld at pinc-software.de
       </A><BR>
    <I>Thu Aug  7 21:19:18 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="010909.html">[Haiku-commits] r26858 - in haiku/trunk/src/add-ons/kernel:	bus_managers/firewire bus_managers/scsi bus_managers/usb	busses/ide/silicon_image_3112 busses/scsi/ahci drivers/audio/ac97/auich drivers/audio/ac97/auvia	drivers/audio/ac97/es1370 drivers/audio/ac97/ich	drivers/audio/ac97/ichaudio/lala drivers/audio/echo drivers/audio/emuxki drivers/audio/hda drivers/audio/ice1712	drivers/dvb/cx23882 drivers/graphics/matrox	drivers/graphics/nvidia drivers/graphics/nvidia_gpgpu drivers/network/bcm570x drivers/network/dp83815	drivers/network/ipro1000 drivers/network/ipw2100	drivers/network/rtl8169 generic/block_io generic/ide_adapter
</A></li>
        <LI>Next message: <A HREF="010937.html">[Haiku-commits] r26858 - in haiku/trunk/src/add-ons/kernel: bus_managers/firewire bus_managers/scsi bus_managers/usb busses/ide/silicon_image_3112 busses/scsi/ahci drivers/audio/ac97/auich drivers/audio/ac97/auvia drivers/audio/ac97/es1370 drivers/audio/ac97/ich drivers/audio/ac97/ichaudio/lala drivers/audio/echo drivers/audio/emuxki drivers/audio/hda drivers/audio/ice1712 drivers/dvb/cx23882 drivers/graphics/matrox drivers/graphics/nvidia drivers/graphics/nvidia_gpgpu drivers/network/bcm570x drivers/network/dp83815 drivers/network/ipro1000 drivers/network/ipw2100 drivers/network/rtl8169 generic/block_io generic/ide_adapter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10936">[ date ]</a>
              <a href="thread.html#10936">[ thread ]</a>
              <a href="subject.html#10936">[ subject ]</a>
              <a href="author.html#10936">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Marcus Overhagen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">marcusoverhagen at arcor.de</A>&gt; wrote:
&gt;<i> axeld at BerliOS schrieb:
</I>[...]
&gt;<i> &gt;    haiku/trunk/src/add-ons/kernel/drivers/network/rtl8169/util.c
</I>&gt;<i> Looks like I'm guilty for all of these.
</I>
Well, at least you layed the groundwork and wrote often copied code :-)

&gt;<i> &gt; * The use of B_{READ|WRITE}_AREA throughout the drivers is surely 
</I>&gt;<i> &gt; alarming.
</I>&gt;<i> Thats probably because of the BeBook create_area() description:
</I>&gt;<i> 
</I>&gt;<i>    protection
</I>&gt;<i>       Is a mask that describes whether the memory can be written and
</I>&gt;<i>       read. You form the mask by adding the constants B_READ_AREA 
</I>&gt;<i> (the
</I>&gt;<i>       area can be read) and B_WRITE_AREA (it can be written). The
</I>&gt;<i>       protection you describe applies only to this area. If your area 
</I>&gt;<i> is
</I>&gt;<i>       cloned, the clone can specify a different protection.
</I>
I know that the BeBook is quite unprecise there (and other places). 
It's not that I didn't make this mistake either in my driver code :-)

&gt;<i> &gt;   Defining these flags means that *every user* application can 
</I>&gt;<i> &gt; access these
</I>&gt;<i> &gt;   buffers read/write, it becomes visible in userspace like any 
</I>&gt;<i> &gt; other memory
</I>&gt;<i> Thats bad in some cases.
</I>
That's why I didn't just change it; it might actually be the wanted 
behaviour at times.

&gt;<i> &gt;   (just shared among all apps). I would like to ask each driver 
</I>&gt;<i> &gt; maintainer
</I>&gt;<i> &gt;   to see if that is really wished here. If you only need one app to 
</I>&gt;<i> &gt; be able
</I>&gt;<i> &gt;   to access it, cloning the area would be more appropriate.
</I>&gt;<i> Has cloning any negative impact?
</I>
Besides the additional creation overhead, the only disadvantage are the 
local TLBs; the CPU is likely to rebuild the TLB; SMP could help here a 
tiny bit, but not with our scheduler.
That's why it might be a good idea to keep the ring buffers of audio 
drivers writable instead - it doesn't really hurt when an applications 
accidently overwrites that memory either (unlike register mappings, for 
example).

&gt;<i> &gt; * I came across the use of B_ANY_KERNEL_BLOCK_ADDRESS a number of 
</I>&gt;<i> &gt; times. This
</I>&gt;<i> &gt;   is almost completely useless for most usages, as it tries to 
</I>&gt;<i> &gt; align the
</I>&gt;<i> &gt;   virtual to a multiple of the size of the area. It just makes the 
</I>&gt;<i> &gt; allocation
</I>&gt;<i> I used that multiple times to get an aligment of 4k. The BeBook
</I>&gt;<i> descripton on map_physical_memory says:
</I>&gt;<i> 
</I>&gt;<i>    spec
</I>&gt;<i>       must be either B_ANY_KERNEL_ADDRESS or 
</I>&gt;<i> B_ANY_KERNEL_BLOCK_ADDRESS.
</I>&gt;<i>       If spec is B_ANY_KERNEL_ADDRESS, the memory will begin at an
</I>&gt;<i>       arbitrary location in the kernel address space. If spec is
</I>&gt;<i>       B_ANY_KERNEL_BLOCK_ADDRESS, then the memory will be mapped into 
</I>&gt;<i> a
</I>&gt;<i>       memory location aligned on a multiple of B_PAGE_SIZE.
</I>
In BeOS/Haiku all areas are always B_PAGE_SIZE aligned. The 
B_ANY_KERNEL_BLOCK_ADDRESS description is really pretty much useless, 
even though it's indeed a multiple of B_PAGE_SIZE :-)
I only found out about what it does exactly by trying in BeOS.

Bye,
   Axel.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010909.html">[Haiku-commits] r26858 - in haiku/trunk/src/add-ons/kernel:	bus_managers/firewire bus_managers/scsi bus_managers/usb	busses/ide/silicon_image_3112 busses/scsi/ahci drivers/audio/ac97/auich drivers/audio/ac97/auvia	drivers/audio/ac97/es1370 drivers/audio/ac97/ich	drivers/audio/ac97/ichaudio/lala drivers/audio/echo drivers/audio/emuxki drivers/audio/hda drivers/audio/ice1712	drivers/dvb/cx23882 drivers/graphics/matrox	drivers/graphics/nvidia drivers/graphics/nvidia_gpgpu drivers/network/bcm570x drivers/network/dp83815	drivers/network/ipro1000 drivers/network/ipw2100	drivers/network/rtl8169 generic/block_io generic/ide_adapter
</A></li>
	<LI>Next message: <A HREF="010937.html">[Haiku-commits] r26858 - in haiku/trunk/src/add-ons/kernel: bus_managers/firewire bus_managers/scsi bus_managers/usb busses/ide/silicon_image_3112 busses/scsi/ahci drivers/audio/ac97/auich drivers/audio/ac97/auvia drivers/audio/ac97/es1370 drivers/audio/ac97/ich drivers/audio/ac97/ichaudio/lala drivers/audio/echo drivers/audio/emuxki drivers/audio/hda drivers/audio/ice1712 drivers/dvb/cx23882 drivers/graphics/matrox drivers/graphics/nvidia drivers/graphics/nvidia_gpgpu drivers/network/bcm570x drivers/network/dp83815 drivers/network/ipro1000 drivers/network/ipw2100 drivers/network/rtl8169 generic/block_io generic/ide_adapter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10936">[ date ]</a>
              <a href="thread.html#10936">[ thread ]</a>
              <a href="subject.html#10936">[ subject ]</a>
              <a href="author.html#10936">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
