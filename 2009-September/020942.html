<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r33322 - in haiku/trunk: build/jam	headers/private/locale src/kits/locale	src/preferences/bluetooth src/preferences/cpufrequency	src/preferences/locale src/tools/locale
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r33322%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/locale%20src/kits/locale%0A%09src/preferences/bluetooth%20src/preferences/cpufrequency%0A%09src/preferences/locale%20src/tools/locale&In-Reply-To=%3C200909272119.n8RLJrGg011866%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020941.html">
   <LINK REL="Next"  HREF="020943.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r33322 - in haiku/trunk: build/jam	headers/private/locale src/kits/locale	src/preferences/bluetooth src/preferences/cpufrequency	src/preferences/locale src/tools/locale</H1>
    <B>pulkomandy at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r33322%20-%20in%20haiku/trunk%3A%20build/jam%0A%09headers/private/locale%20src/kits/locale%0A%09src/preferences/bluetooth%20src/preferences/cpufrequency%0A%09src/preferences/locale%20src/tools/locale&In-Reply-To=%3C200909272119.n8RLJrGg011866%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r33322 - in haiku/trunk: build/jam	headers/private/locale src/kits/locale	src/preferences/bluetooth src/preferences/cpufrequency	src/preferences/locale src/tools/locale">pulkomandy at mail.berlios.de
       </A><BR>
    <I>Sun Sep 27 23:19:53 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020941.html">[Haiku-commits] r33321 - haiku/trunk/src/servers/bluetooth
</A></li>
        <LI>Next message: <A HREF="020943.html">[Haiku-commits] r33323 - haiku/trunk/src/preferences/bluetooth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20942">[ date ]</a>
              <a href="thread.html#20942">[ thread ]</a>
              <a href="subject.html#20942">[ subject ]</a>
              <a href="author.html#20942">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pulkomandy
Date: 2009-09-27 23:19:52 +0200 (Sun, 27 Sep 2009)
New Revision: 33322
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=33322&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=33322&amp;view=rev</A>

Modified:
   haiku/trunk/build/jam/BeOSRules
   haiku/trunk/headers/private/locale/HashMapCatalog.h
   haiku/trunk/src/kits/locale/DefaultCatalog.cpp
   haiku/trunk/src/kits/locale/HashMapCatalog.cpp
   haiku/trunk/src/preferences/bluetooth/BluetoothMain.cpp
   haiku/trunk/src/preferences/bluetooth/BluetoothSettingsView.cpp
   haiku/trunk/src/preferences/bluetooth/fr.catkeys
   haiku/trunk/src/preferences/cpufrequency/fr.catkeys
   haiku/trunk/src/preferences/locale/fr.catkeys
   haiku/trunk/src/tools/locale/PlainTextCatalog.cpp
   haiku/trunk/src/tools/locale/collectcatkeys.cpp
Log:
Cleanup of the locale kit tools :
-Jamrule for collectcatkeys no longer print all the strings, only a message when it can't parse one (happens for TR(variable) basically)
-Added fingerprint check in the plaintext catalog ReadFromFile. However, the adler checksum is different each time the catalog is loaded because it relies on the string being iterated always in the same order, but this is not always the case with an HashMap ! Some rethinking is needed, so disabled the check for now so it does not breaks the build
-Some try to debug the bluetooth preflet localization. Still buggy, but I wanted to commit all this mess before I break everything up again.
-Also sorted the fr.catkeys files to be in the same order as the autogenerated en.catkeys (this is useless but makes them easier to check) and updated their fingerprint even if they are still not checked.
-Miscelaneous style fixes, small bugfixes, more error checking and error messages saying where they come from.


Modified: haiku/trunk/build/jam/BeOSRules
===================================================================
--- haiku/trunk/build/jam/BeOSRules	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/build/jam/BeOSRules	2009-09-27 21:19:52 UTC (rev 33322)
@@ -333,7 +333,7 @@
 {
 	$(HOST_ADD_BUILD_COMPATIBILITY_LIB_DIR)
 		cat &quot;$(2[2-])&quot; | $(CC) -E $(CCDEFS) $(HDRS) - &gt; &quot;$(1)&quot;.pre
-		$(2[1]) -s $(LOCALE_KIT_SIGNATURE) -p -o &quot;$(1)&quot; &quot;$(1)&quot;.pre
+		$(2[1]) -s $(LOCALE_KIT_SIGNATURE) -w -o &quot;$(1)&quot; &quot;$(1)&quot;.pre
 }
 
 # Link catalog entries from given catkey file into output compiled catalog file.
@@ -352,7 +352,7 @@
 actions LinkApplicationCatalog1
 {
 	$(HOST_ADD_BUILD_COMPATIBILITY_LIB_DIR)
-		$(2[1]) &quot;$(2[3-])&quot; -l $(2[2]:B) -v -s $(LOCALE_KIT_SIGNATURE) -o &quot;$(1)&quot;
+	$(2[1]) &quot;$(2[3-])&quot; -l $(2[2]:B) -v -s $(LOCALE_KIT_SIGNATURE) -o &quot;$(1)&quot;
 }
 
 # General rules to invoke from jamfiles and that do (almost) everything related

Modified: haiku/trunk/headers/private/locale/HashMapCatalog.h
===================================================================
--- haiku/trunk/headers/private/locale/HashMapCatalog.h	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/headers/private/locale/HashMapCatalog.h	2009-09-27 21:19:52 UTC (rev 33322)
@@ -54,7 +54,7 @@
 		bool operator== (const CatKey&amp; right) const;
 		bool operator!= (const CatKey&amp; right) const;
 		status_t GetStringParts(BString* str, BString* ctx, BString* cmt) const;
-		static uint32 HashFun(const char* s, int startvalue=0);
+		static uint32 HashFun(const char* s, int startvalue = 0);
 			// The hash function is called 3 times, cumulating the 3 strings to
 			// calculate the key
 		uint32 GetHashCode() const { return fHashVal; }
@@ -68,7 +68,7 @@
 class BHashMapCatalog: public BCatalogAddOn {
 	protected:
 		uint32 ComputeFingerprint() const;
-		typedef HashMap&lt;CatKey,BString&gt; CatMap;
+		typedef HashMap&lt;CatKey, BString&gt; CatMap;
 		CatMap 				fCatMap;
 
 	public:

Modified: haiku/trunk/src/kits/locale/DefaultCatalog.cpp
===================================================================
--- haiku/trunk/src/kits/locale/DefaultCatalog.cpp	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/kits/locale/DefaultCatalog.cpp	2009-09-27 21:19:52 UTC (rev 33322)
@@ -160,34 +160,37 @@
 	BFile catalogFile;
 	status_t res = catalogFile.SetTo(path, B_READ_ONLY);
 	if (res != B_OK) {
-		log_team(LOG_DEBUG, &quot;no catalog at %s&quot;, path);
+		log_team(LOG_DEBUG, &quot;LocaleKit DefaultCatalog: no catalog at %s&quot;, path);
 		return B_ENTRY_NOT_FOUND;
 	}
 
 	fPath = path;
-	log_team(LOG_DEBUG, &quot;found catalog at %s&quot;, path);
+	log_team(LOG_DEBUG, &quot;LocaleKit DefaultCatalog: found catalog at %s&quot;, path);
 
 	off_t sz = 0;
 	res = catalogFile.GetSize(&amp;sz);
 	if (res != B_OK) {
-		log_team(LOG_ERR, &quot;couldn't get size for catalog-file %s&quot;, path);
+		log_team(LOG_ERR, &quot;LocaleKit DefaultCatalog: couldn't get size for &quot;
+			&quot;catalog-file %s&quot;, path);
 		return res;
 	}
 
 	auto_ptr&lt;char&gt; buf(new(std::nothrow) char [sz]);
 	if (buf.get() == NULL) {
-		log_team(LOG_ERR, &quot;couldn't allocate array of %d chars&quot;, sz);
+		log_team(LOG_ERR, &quot;LocaleKit DefaultCatalog: couldn't allocate array &quot;
+			&quot;of %d chars&quot;, sz);
 		return B_NO_MEMORY;
 	}
 	res = catalogFile.Read(buf.get(), sz);
 	if (res &lt; B_OK) {
-		log_team(LOG_ERR, &quot;couldn't read from catalog-file %s&quot;, path);
+		log_team(LOG_ERR, &quot;LocaleKit DefaultCatalog: couldn't read from &quot;
+			&quot;catalog-file %s&quot;, path);
 		return res;
 	}
 	if (res &lt; sz) {
 		log_team(LOG_ERR,
-			&quot;only got %lu instead of %Lu bytes from catalog-file %s&quot;, res, sz,
-			path);
+			&quot;LocaleKit DefaultCatalog: only got %lu instead of %Lu bytes from &quot;
+			&quot;catalog-file %s&quot;, res, sz, path);
 		return res;
 	}
 	BMemoryIO memIO(buf.get(), sz);

Modified: haiku/trunk/src/kits/locale/HashMapCatalog.cpp
===================================================================
--- haiku/trunk/src/kits/locale/HashMapCatalog.cpp	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/kits/locale/HashMapCatalog.cpp	2009-09-27 21:19:52 UTC (rev 33322)
@@ -79,21 +79,21 @@
 status_t
 CatKey::GetStringParts(BString* str, BString* ctx, BString* cmt) const
 {
-	if(str) *str = fString;
-	if(ctx) *ctx = fContext;
-	if(cmt) *cmt = fComment;
+	if (str) *str = fString;
+	if (ctx) *ctx = fContext;
+	if (cmt) *cmt = fComment;
 
 	return B_OK;
 }
 
 
-size_t CatKey::HashFun(const char* s, int startValue) {
+uint32 CatKey::HashFun(const char* s, int startValue) {
 	unsigned long h = startValue;
 	for ( ; *s; ++s)
-		h = 5*h + *s;
+		h = 5 * h + *s;
 
 	// Add 1 to differenciate (&quot;ab&quot;,&quot;cd&quot;,&quot;ef&quot;) from (&quot;abcd&quot;,&quot;e&quot;,&quot;f&quot;)
-	h = 5*h + 1;
+	h = 5 * h + 1;
 
 	return size_t(h);
 }
@@ -136,7 +136,11 @@
 const char *
 BHashMapCatalog::GetString(const CatKey&amp; key)
 {
-	return fCatMap.Get(key);
+	BString value = fCatMap.Get(key);
+	if (value.Length() == 0)
+		return NULL;
+	else
+		return value.String();
 }
 
 
@@ -230,7 +234,8 @@
 	int32 hash;
 	CatMap::Iterator iter = fCatMap.GetIterator();
 	CatMap::Entry entry;
-	while(iter.HasNext()) {
+	while (iter.HasNext())
+	{
 		entry = iter.Next();
 		hash = B_HOST_TO_LENDIAN_INT32(entry.key.fHashVal);
 		adler = adler32(adler, reinterpret_cast&lt;uint8*&gt;(&amp;hash), sizeof(int32));

Modified: haiku/trunk/src/preferences/bluetooth/BluetoothMain.cpp
===================================================================
--- haiku/trunk/src/preferences/bluetooth/BluetoothMain.cpp	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/preferences/bluetooth/BluetoothMain.cpp	2009-09-27 21:19:52 UTC (rev 33322)
@@ -30,7 +30,7 @@
 BluetoothApplication::AboutRequested()
 {
 	
-	(new BAlert(&quot;about&quot;, TR(&quot;Haiku Bluetooth System, (ARCE)\n\n&quot;
+	(new BAlert(&quot;about&quot;, /*TR*/(&quot;Haiku Bluetooth System, (ARCE)\n\n&quot;
                              &quot;Created by Oliver Ruiz Dorantes\n\n&quot;
                              &quot;With support of:\n&quot;
                              &quot;	- Mika Lindqvist\n&quot;
@@ -54,7 +54,7 @@
                              &quot;	- Fredrik Ekdahl\n&quot;
                              &quot;	- Raynald Lesieur\n&quot;
                              &quot;	- Andreas F&#195;&#164;rber\n&quot;
-                             &quot;	- J&#195;&#182;rg Meyer\n&quot;
+                             &quot;	- Joerg Meyer\n&quot;
                              &quot;Testing:\n&quot;
                              &quot;	- Petter H. Juliussen\n&quot;
                              &quot;	- Adrien Destugues\n\n&quot;

Modified: haiku/trunk/src/preferences/bluetooth/BluetoothSettingsView.cpp
===================================================================
--- haiku/trunk/src/preferences/bluetooth/BluetoothSettingsView.cpp	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/preferences/bluetooth/BluetoothSettingsView.cpp	2009-09-27 21:19:52 UTC (rev 33322)
@@ -42,7 +42,7 @@
 static const char* kTrustedLabel = TR_MARK(&quot;Only from Trusted devices&quot;);
 static const char* kAlwaysLabel = TR_MARK(&quot;Always ask&quot;);
 
-static const char* kDesktopLabel = TR_MARK(&quot;Desktop&quot;);
+static const char* kDesktopLabel = /*TR_MARK*/(&quot;Desktop&quot;);
 static const char* kServerLabel = TR_MARK(&quot;Server&quot;);
 static const char* kLaptopLabel = TR_MARK(&quot;Laptop&quot;);
 static const char* kHandheldLabel = TR_MARK(&quot;Handheld&quot;);
@@ -62,7 +62,7 @@
 	fAverageWeightControl = new BSlider(&quot;averageWeightControl&quot;,
 		TR(&quot;Default Inquiry time:&quot;), new BMessage(kMsgSetAverageWeight), 0, 255,
 		B_HORIZONTAL);
-	fAverageWeightControl-&gt;SetLimitLabels(TR(&quot;15 secs&quot;), TR(&quot;61 secs&quot;));
+	fAverageWeightControl-&gt;SetLimitLabels(/*TR*/(&quot;15 secs&quot;), /*TR*/(&quot;61 secs&quot;));
 	fAverageWeightControl-&gt;SetHashMarks(B_HASH_MARKS_BOTTOM);
 	fAverageWeightControl-&gt;SetHashMarkCount(255 / 15);
 	fAverageWeightControl-&gt;SetEnabled(true);

Modified: haiku/trunk/src/preferences/bluetooth/fr.catkeys
===================================================================
--- haiku/trunk/src/preferences/bluetooth/fr.catkeys	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/preferences/bluetooth/fr.catkeys	2009-09-27 21:19:52 UTC (rev 33322)
@@ -1,4 +1,4 @@
-1	french	x-vnd.Haiku-BluetoothPrefs	3058329015
+1	french	x-vnd.Haiku-BluetoothPrefs	4182662743
 Handheld	Settings view		Appareil de poche
 Only from Trusted devices	Settings view		Seulement les appareils de confiance
 Refresh LocalDevicesxE2x80xA6	Window		Rafra&#238;chir LocalDevicexE2x80xA6
@@ -20,16 +20,13 @@
 Scanning completed.	Inquiry panel		Recherche compl&#232;te.
 Start Bluetooth ServicesxE2x80xA6	Window		D&#233;marrer les services bluetoothxE2x80xA6
 Remove	Remote devices		Enlever
-15 secs	Settings view		15 secs
 Policy...	Settings view		Attitude...
-61 secs	Settings view		61 secs
 AddxE2x80xA6	Remote devices		AjouterxE2x80xA6
 Identify us as...	Settings view		S'identifier comme...
 Remaining 	Inquiry panel		Restant 
 Pick LocalDevice...	Settings view		Choisir LocalDevice...
 Defaults	Window		D&#233;fauts
 Inquiry	Inquiry panel		Requ&#234;te
-Desktop	Settings view		Bureau
 Revert	Window		D&#233;faire
 AboutxE2x80xA6	Window		&#192; proposxE2x80xA6
 Remote Devices ListxE2x80xA6	Window		Liste d'appareils distantsxE2x80xA6
@@ -45,7 +42,6 @@
 Check that the bluetooth capabilities of your remote device are activated. Press Inquiry to start scanning. The needed time for the retrieval of the names is unknown, although should not take more than 3 seconds per device. Afterwards you will be able to add them to your main list, where you will be able to pair with them	Inquiry panel		V&#233;rifiez que les fonctionnalit&#233;s bluetooth de votre appareil distant sont activ&#233;es. Appuyez sur &quot;Requ&#234;te&quot; pour lancer la recherche. Le temps n&#233;cessaire pour r&#233;cup&#233;rer les noms n'est pas connu, mais &#231;a ne devrait pas prendre plus de 3 secondes par appareil. Ensuite vous pourrez les ajouter &#224; la liste principale, o&#249; vous pourrez vous associer avec eux.
 Scanning progress	Inquiry panel		Avanc&#233;e de la recherche
 Always ask	Settings view		Toujours demander
-Haiku Bluetooth System, (ARCE)\n\nCreated by Oliver Ruiz Dorantes\n\nWith support of:\n\t- Mika Lindqvist\n\t- Maksym Yevmenkin\n\nThanks to the individuals who helped...\n\nShipping/donating hardware:\n\t- Henry Jair Abril Florez(el Colombian)\n\t\t &amp; Stefanie Bartolich\n\t- Edwin Erik Amsler\n\t- Dennis d'Entremont\n\t- Luroh\n\t- Pieter Panman\n\nEconomically:\n\t- Karl vom Dorff, Andrea Bernardi (OSDrawer),\n\t- Matt M, Doug F, Hubert H,\n\t- Sebastian B, Andrew M, Jared E,\n\t- Frederik H, Tom S, Ferry B,\n\t- Greg G, David F, Richard S, Martin W:\n\nWith patches:\n\t- Michael Weirauch\n\t- Fredrik Ekdahl\n\t- Raynald Lesieur\n\t- Andreas F&#195;&#164;rber\n\t- J&#195;&#182;rg Meyer\nTesting:\n\t- Petter H. Juliussen\n\t- Adrien Destugues\n\nWho gave me all the knowledge:\n\t- the yellowTAB team	main		Syst&#232;me bluetooth Haiku, (ARCE)\n\nCr&#233;&#233; par Oliver Ruiz Dorantes\n\nAvec l'aide de :\n\t- Mika Lindqvist\n\t- Maksym Yevmenkin\n\nMerci &#224; tous ceux qui ont aid&#233;...\n\nEnvoi.don de mat&#233;riel :!
 \n\t- Henry Jair Abril Florez(el Colombian)\n\t\t &amp; Stefanie Bartolich\n\t- Edwin Erik Amsler\n\t- Dennis d'Entremont\n\t- Luroh\n\t- Pieter Panman\n\n&#201;conomiquement:\n\t- Karl vom Dorff, Andrea Bernardi (OSDrawer),\n\t- Matt M, Doug F, Hubert H,\n\t- Sebastian B, Andrew M, Jared E,\n\t- Frederik H, Tom S, Ferry B,\n\t- Greg G, David F, Richard S, Martin W:\n\nAvec des patches:\n\t- Michael Weirauch\n\t- Fredrik Ekdahl\n\t- Raynald Lesieur\n\t- Andreas F&#195;&#164;rber\n\t- J&#195;&#182;rg Meyer\nTesting:\n\t- Petter H. Juliussen\n\t- Adrien Destugues\n\nQui m'ont tout appris:\n\t- l'&#233;quipe yellowTAB
 Retrieving names...	Inquiry panel		R&#233;cup&#233;ration des noms...
 Help	Window		Aide
 Ok	main		Ok

Modified: haiku/trunk/src/preferences/cpufrequency/fr.catkeys
===================================================================
--- haiku/trunk/src/preferences/cpufrequency/fr.catkeys	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/preferences/cpufrequency/fr.catkeys	2009-09-27 21:19:52 UTC (rev 33322)
@@ -1,7 +1,8 @@
-1	french	x-vnd.Haiku-CPUFrequencyPref	1947607562
+1	french	x-vnd.Haiku-CPUFrequencyPref	2148935007
 Ok	Status view		Ok
-Integration Time [ms]	CPU Frequency View	Temps d'int&#195;&#169;gration	 [ms]
+Integration Time [ms]	CPU Frequency View		Temps d'int&#195;&#169;gration	 [ms]
 High Performance	Status view		Haute performance
+Defaults	Pref Window		D&#195;&#169;faire
 CPU Frequency Status View	CPU Frequency View		&#195;&#137;tat de la fr&#195;&#169;quence du processeur
 Dynamic Performance	Status view		Performance dynamique
 Step up by CPU usage:	Color Step View		Acc&#195;&#169;l&#195;&#169;ration par utilisation processeur:
@@ -11,8 +12,7 @@
 Launching the CPU Frequency preflet failed.\n\nError: 	Status view		&#195;&#137;chec de lancement des pr&#195;&#169;f&#195;&#169;rences de fr&#195;&#169;quence du processeur.\n\nErreur: 
 Install Replicant into Deskbar	CPU Frequency View		Installer le r&#195;&#169;plicant dans la Deskbar
 Low Energy	Status view		Basse consommation
+Revert	Pref Window		D&#195;&#169;faire
 Dynamic Stepping	CPU Frequency View		Acc&#195;&#169;l&#195;&#169;ration dynamique
 CPU Frequency\n\twritten by Clemens Zeidler\n\tCopyright 2009, Haiku, Inc.\n	Status view		Fr&#195;&#169;quence du processeur\n\t&#195;&#169;crit par Clemens Zeidler\n\tCopyright 2009, Haiku, Inc.\n
 CPU Frequency	Main window		Fr&#195;&#169;quence du processeur
-Defaults	Pref Window		D&#195;&#169;faire
-Revert	Pref Window		D&#195;&#169;faire

Modified: haiku/trunk/src/preferences/locale/fr.catkeys
===================================================================
--- haiku/trunk/src/preferences/locale/fr.catkeys	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/preferences/locale/fr.catkeys	2009-09-27 21:19:52 UTC (rev 33322)
@@ -1,8 +1,4 @@
-1	fr	x-vnd.Haiku-Locale	2841580836
-Revert	Locale Preflet Window		D&#195;&#169;faire
-Country	Locale Preflet Window		Pays
-Language	Locale Preflet Window		Langage
-Preferred languages	Locale Preflet Window		Langues pr&#195;&#169;f&#195;&#169;r&#195;&#169;es
+1	french	x-vnd.Haiku-Locale	1616861198
 day of week (short name)	TimeFormatSettings		jour de la semaine (abr&#195;&#169;g&#195;&#169;)
 Available languages	Locale Preflet Window		Langues disponibles
 Decimal separator	TimeFormatSettings		S&#195;&#169;parateur d&#195;&#169;cimal
@@ -10,14 +6,16 @@
 Year (4 digits)	TimeFormatSettings		Ann&#195;&#169;e (4 chiffres)
 After	TimeFormatSettings		Apr&#195;&#168;s
 Long format:	TimeFormatSettings		Format long:
+Before	TimeFormatSettings		Avant
 Currency	TimeFormatSettings		Avant
 Year	TimeFormatSettings		Ann&#195;&#169;e
 Short format:	TimeFormatSettings		Format court:
 Currency symbol:	TimeFormatSettings		Symbole mon&#195;&#169;taire:
-Example:	TimeFormatSettings		Exemple:
 Space	TimeFormatSettings		Espace
+Language	Locale Preflet Window		Langage
 Thousand separator	TimeFormatSettings		S&#195;&#169;parateur de milliers
 Year (2 digits)	TimeFormatSettings		Ann&#195;&#169;e (2 chiffres)
+Preferred languages	Locale Preflet Window		Langues pr&#195;&#169;f&#195;&#169;r&#195;&#169;es
 Symbol position	TimeFormatSettings		Position du symbole
 month number	TimeFormatSettings		num&#195;&#169;ro du mois
 month number (2 digits)	TimeFormatSettings		num&#195;&#169;ro du mois (2 chiffres)
@@ -28,9 +26,11 @@
 Defaults	Locale Preflet Window		D&#195;&#169;fauts
 Locale\n\twritten by Axel D&#195;&#182;rfler\n\tCopyright 2005, Haiku.\n\n	Locale Preflet		Locale\n\t&#195;&#169;crit par Axel D&#195;&#182;rfler\n\tCopyright 2009, Haiku.\n\n
 Separator	TimeFormatSettings		Separateur
-Negative marker	TimeFormatSettings		Marqueur de nombres n&#233;gatifs
+Country	Locale Preflet Window		Pays
+Revert	Locale Preflet Window		D&#195;&#169;faire
 day in month	TimeFormatSettings		jour du mois
 day of week in month	TimeFormatSettings		jour de la semaine dans le mois
+Negative marker	TimeFormatSettings		Marqueur de nombres n&#233;gatifs
 Ok	Locale Preflet Window		Ok
 Time	TimeFormatSettings		Heure
 Date	TimeFormatSettings		Date
@@ -39,6 +39,7 @@
 None	TimeFormatSettings		Aucun
 day in month (2 digits)	TimeFormatSettings		jour du mois (2 chiffres)
 Clock	TimeFormatSettings		Horloge
+Example:	TimeFormatSettings		Exemple:
 day of week (name)	TimeFormatSettings		jour de la semaine (nom)
 month name	TimeFormatSettings		nom du mois
 Day	TimeFormatSettings		Jour

Modified: haiku/trunk/src/tools/locale/PlainTextCatalog.cpp
===================================================================
--- haiku/trunk/src/tools/locale/PlainTextCatalog.cpp	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/tools/locale/PlainTextCatalog.cpp	2009-09-27 21:19:52 UTC (rev 33322)
@@ -122,7 +122,7 @@
 	// Now read all the data from the file
 
 	// The first line holds some info about the catalog :
-	// ArchiveVersion \t LanguageName \t Signature \t FingerPrint
+	// ArchiveVersion \t LanguageName \t AppSignature \t FingerPrint
 	if (std::getline(catalogFile, currentItem, '\t').good()) {
 		// Get the archive version
 		int arcver= -1;
@@ -150,7 +150,7 @@
 
 	if (std::getline(catalogFile, currentItem, '\t').good()) {
 		// Get the language
-		fLanguageName &lt;&lt; currentItem.c_str() ;
+		fLanguageName = currentItem.c_str() ;
 	} else {
 		fprintf(stderr, &quot;Unable to get language from %s\n&quot;, path);
 		return B_ERROR;
@@ -158,7 +158,7 @@
 
 	if (std::getline(catalogFile, currentItem, '\t').good()) {
 		// Get the signature
-		fSignature &lt;&lt; currentItem.c_str() ;
+		fSignature = currentItem.c_str() ;
 	} else {
 		fprintf(stderr, &quot;Unable to get signature from %s\n&quot;, path);
 		return B_ERROR;
@@ -175,7 +175,10 @@
 			return B_ERROR;
 		}
 
-		if (fFingerprint!=0 &amp;&amp; fFingerprint != foundFingerprint) {
+		if (fFingerprint == 0)
+			fFingerprint = foundFingerprint;
+
+		if (fFingerprint != foundFingerprint) {
 			return B_MISMATCHED_VALUES;
 		}
 	} else {
@@ -185,7 +188,7 @@
 
 	// We managed to open the file, so we remember it's the one we are using
 	fPath = path;
-	fprintf(stderr, &quot;found plaintext catalog at %s\n&quot;, path);
+	fprintf(stderr, &quot;LocaleKit Plaintext: found catalog at %s\n&quot;, path);
 
 	std::string originalString;
 	std::string context;
@@ -224,6 +227,23 @@
 
 	catalogFile.close();
 
+	uint32 checkFP = ComputeFingerprint();
+	if (fFingerprint != checkFP) {
+		fprintf(stderr, &quot;plaintext-catalog(sig=%s, lang=%s) &quot;
+			&quot;has wrong fingerprint after load (%lX instead of %lX). &quot;
+			&quot;The catalog data may be corrupted, so this catalog is &quot;
+			&quot;skipped.\n&quot;,
+			fSignature.String(), fLanguageName.String(), checkFP,
+			fFingerprint);
+		// TODO: This is what should be done if the fingerprint calculation
+		// actually worked. Unfortunately, adler32 will not give the same
+		// results if you swap strings, and an HashMap is not an ordered
+		// container so you can get a different result each time you iterate
+		// over it...
+
+		// return B_BAD_DATA;
+	}
+
 	// some information living in member variables needs to be copied
 	// to attributes. Although these attributes should have been written
 	// when creating the catalog, we make sure that they exist there:

Modified: haiku/trunk/src/tools/locale/collectcatkeys.cpp
===================================================================
--- haiku/trunk/src/tools/locale/collectcatkeys.cpp	2009-09-27 19:09:13 UTC (rev 33321)
+++ haiku/trunk/src/tools/locale/collectcatkeys.cpp	2009-09-27 21:19:52 UTC (rev 33322)
@@ -78,7 +78,7 @@
 			// string (skip escaped quotes)
 			while (*in != '&quot;' || quoted)
 			{
-				str.Append(in,1);
+				str.Append(in, 1);
 				if (*in == '\\' &amp;&amp; !quoted)
 					quoted = true ;
 				else
@@ -143,7 +143,6 @@
 	haveID = false;
 	// fetch native string or id:
 	if (!fetchStr(in, str, true)) {
-		fprintf(stderr,&quot;String parsing error\n&quot;);
 		return false;
 	}
 	if (*in == ',') {
@@ -187,8 +186,8 @@
 					printf(&quot;CatKey(%ld)\n&quot;, id);
 				res = catalog-&gt;SetString(id, &quot;&quot;);
 				if (res != B_OK) {
-					fprintf(stderr, &quot;couldn't add key %ld - error: %s\n&quot;,
-						id, strerror(res));
+					fprintf(stderr, &quot;Collectcatkeys: couldn't add key %ld - &quot;
+						&quot;error: %s\n&quot;, id, strerror(res));
 					exit(-1);
 				}
 			} else {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020941.html">[Haiku-commits] r33321 - haiku/trunk/src/servers/bluetooth
</A></li>
	<LI>Next message: <A HREF="020943.html">[Haiku-commits] r33323 - haiku/trunk/src/preferences/bluetooth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20942">[ date ]</a>
              <a href="thread.html#20942">[ thread ]</a>
              <a href="subject.html#20942">[ subject ]</a>
              <a href="author.html#20942">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
