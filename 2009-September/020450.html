<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r32997 - in haiku/branches/releases/r1alpha1:	build/jam docs/userguide/en docs/userguide/en/applications	docs/userguide/images docs/userguide/images/gui-images	headers/private/shared src/apps/installer src/kits/shared
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32997%20-%20in%20haiku/branches/releases/r1alpha1%3A%0A%09build/jam%20docs/userguide/en%20docs/userguide/en/applications%0A%09docs/userguide/images%20docs/userguide/images/gui-images%0A%09headers/private/shared%20src/apps/installer%20src/kits/shared&In-Reply-To=%3C200909081152.n88BquHL009862%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020465.html">
   <LINK REL="Next"  HREF="020451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r32997 - in haiku/branches/releases/r1alpha1:	build/jam docs/userguide/en docs/userguide/en/applications	docs/userguide/images docs/userguide/images/gui-images	headers/private/shared src/apps/installer src/kits/shared</H1>
    <B>stippi at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r32997%20-%20in%20haiku/branches/releases/r1alpha1%3A%0A%09build/jam%20docs/userguide/en%20docs/userguide/en/applications%0A%09docs/userguide/images%20docs/userguide/images/gui-images%0A%09headers/private/shared%20src/apps/installer%20src/kits/shared&In-Reply-To=%3C200909081152.n88BquHL009862%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r32997 - in haiku/branches/releases/r1alpha1:	build/jam docs/userguide/en docs/userguide/en/applications	docs/userguide/images docs/userguide/images/gui-images	headers/private/shared src/apps/installer src/kits/shared">stippi at mail.berlios.de
       </A><BR>
    <I>Tue Sep  8 13:52:56 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020465.html">[Haiku-commits] r32996 - haiku/trunk/build/jam
</A></li>
        <LI>Next message: <A HREF="020451.html">[Haiku-commits] r32998 - haiku/branches/releases/r1alpha1/build/jam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20450">[ date ]</a>
              <a href="thread.html#20450">[ thread ]</a>
              <a href="subject.html#20450">[ subject ]</a>
              <a href="author.html#20450">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: stippi
Date: 2009-09-08 13:52:36 +0200 (Tue, 08 Sep 2009)
New Revision: 32997
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=32997&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=32997&amp;view=rev</A>

Added:
   haiku/branches/releases/r1alpha1/docs/userguide/images/gui-images/
   haiku/branches/releases/r1alpha1/docs/userguide/images/gui-images/replicant.png
   haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.cpp
   haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.h
   haiku/branches/releases/r1alpha1/src/apps/installer/SemaphoreLocker.h
   haiku/branches/releases/r1alpha1/src/apps/installer/UnzipEngine.cpp
   haiku/branches/releases/r1alpha1/src/apps/installer/UnzipEngine.h
Modified:
   haiku/branches/releases/r1alpha1/build/jam/ImageRules
   haiku/branches/releases/r1alpha1/build/jam/OptionalPackages
   haiku/branches/releases/r1alpha1/docs/userguide/en/applications/activitymonitor.html
   haiku/branches/releases/r1alpha1/docs/userguide/en/applications/deskcalc.html
   haiku/branches/releases/r1alpha1/docs/userguide/en/contents.html
   haiku/branches/releases/r1alpha1/docs/userguide/en/deskbar.html
   haiku/branches/releases/r1alpha1/docs/userguide/en/gui.html
   haiku/branches/releases/r1alpha1/docs/userguide/en/workspaces.html
   haiku/branches/releases/r1alpha1/headers/private/shared/CommandPipe.h
   haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.cpp
   haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.h
   haiku/branches/releases/r1alpha1/src/apps/installer/Jamfile
   haiku/branches/releases/r1alpha1/src/apps/installer/WorkerThread.cpp
   haiku/branches/releases/r1alpha1/src/apps/installer/WorkerThread.h
   haiku/branches/releases/r1alpha1/src/kits/shared/CommandPipe.cpp
Log:
* Merged changesets r32903, r32926, r32957, r32959, r32967, r32986 and r32987
  (all the CommandPipe and Installer changes).
* Merged changeset r32968 (Haiku Guide).
* Merged changesets r32969, r32983, r32984 and r32992 (OptionalPackages).
* Merged changeset r32995 (Installer links fixes).
* Merged changeset r32996 (unzipping of packages at install time)
* Updated OptionalPackages warnings about packages that still need to be
  rebuilt.


Modified: haiku/branches/releases/r1alpha1/build/jam/ImageRules
===================================================================
--- haiku/branches/releases/r1alpha1/build/jam/ImageRules	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/build/jam/ImageRules	2009-09-08 11:52:36 UTC (rev 32997)
@@ -758,13 +758,18 @@
 	}
 }
 
-rule InstallOptionalHaikuImagePackage package : url : dirTokens
+rule InstallOptionalHaikuImagePackage package : url : dirTokens : isCDPackage
 {
 	# download zip file
 	local zipFile = [ DownloadOptionalPackage $(package) : $(url) ] ;
 
-	# unzip onto image
-	UnzipArchiveToHaikuImage $(dirTokens) : $(zipFile) ;
+	if $(isCDPackage) = true || $(isCDPackage) = 1 &amp;&amp; $(HAIKU_CD_NAME) {
+		# copy onto image
+		AddFilesToHaikuImage _packages_ : $(zipFile) ;
+	} else {
+		# unzip onto image
+		UnzipArchiveToHaikuImage $(dirTokens) : $(zipFile) ;
+	}
 }
 
 rule AddEntryToHaikuImageUserGroupFile file : entry

Modified: haiku/branches/releases/r1alpha1/build/jam/OptionalPackages
===================================================================
--- haiku/branches/releases/r1alpha1/build/jam/OptionalPackages	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/build/jam/OptionalPackages	2009-09-08 11:52:36 UTC (rev 32997)
@@ -12,7 +12,7 @@
 
 
 # Available Optional Packages:
-#	APR					- support libraries used for example by SVN
+#	APR					- support libraries used for example by Subversion
 #	APR-util
 #	Beam				- powerful native e-mail client
 #	BeBook				- the classic BeOS API documentation
@@ -81,26 +81,28 @@
 
 
 # APR
-if [ IsObsoleteOptionalHaikuImagePackageAdded APR ] {
+if [ IsOptionalHaikuImagePackageAdded APR ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package APR available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage apr-1.3.8-r1a1-x86-gcc2-2009-08-29
 			: $(baseURL)/apr-1.3.8-r1a1-x86-gcc2-2009-08-29.zip
 			:
+			: true
 		;
 	}
 }
 
 
 # APR-util
-if [ IsObsoleteOptionalHaikuImagePackageAdded APR-util ] {
+if [ IsOptionalHaikuImagePackageAdded APR-util ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package APR-util available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage apr-util-1.3.9-r1a1-x86-gcc2-2009-08-29
 			: $(baseURL)/apr-util-1.3.9-r1a1-x86-gcc2-2009-08-29.zip
 			:
+			: true
 		;
 	}
 }
@@ -170,7 +172,7 @@
 
 
 # BePDF
-if [ IsObsoleteOptionalHaikuImagePackageAdded BePDF ] {
+if [ IsOptionalHaikuImagePackageAdded BePDF ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package BePDF available for $(TARGET_ARCH)&quot; ;
 	} else if $(HAIKU_GCC_VERSION[1]) &gt;= 4 &amp;&amp; ! $(isHybridBuild) {
@@ -210,7 +212,7 @@
 
 
 # CDRecord
-if [ IsObsoleteOptionalHaikuImagePackageAdded CDRecord ] {
+if [ IsOptionalHaikuImagePackageAdded CDRecord ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package CDRecord available for $(TARGET_ARCH)&quot; ;
 	} else {
@@ -255,6 +257,7 @@
 			clucene-0.9.21svn-x86-gcc4-haiku-2009-08-11
 			: $(baseURL)/clucene-0.9.21-x86-gcc4-haiku-2009-08-11.zip
 			:
+			: true
 		;
 	}
 }
@@ -267,21 +270,22 @@
 	} else {
 		InstallOptionalHaikuImagePackage curl-7.19.6-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/curl-7.19.6-r1a1-x86-gcc2-2009-08-30.zip
-
 			:
+			: true
 		;
 	}
 }
 
 
 # CVS
-if [ IsObsoleteOptionalHaikuImagePackageAdded CVS ] {
+if [ IsOptionalHaikuImagePackageAdded CVS ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package CVS available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage cvs-1.12.13-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/cvs-1.12.13-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -291,18 +295,21 @@
 if [ IsOptionalHaikuImagePackageAdded Development ] &amp;&amp; $(TARGET_ARCH) = x86 {
 	# autotools
 	InstallOptionalHaikuImagePackage autoconf-2.64-r1a1-x86-gcc2-2009-08-27
-		: $(baseURL)/autoconf-2.64-r1a1-x86-gcc2-2009-08-27.zip ;
+		: $(baseURL)/autoconf-2.64-r1a1-x86-gcc2-2009-08-27.zip
+		:
+		: true ;
 	InstallOptionalHaikuImagePackage automake-1.11-r1a1-x86-gcc2-2009-08-27
-		: $(baseURL)/automake-1.11-r1a1-x86-gcc2-2009-08-27.zip ;
+		: $(baseURL)/automake-1.11-r1a1-x86-gcc2-2009-08-27.zip
+		:
+		: true ;
 	InstallOptionalHaikuImagePackage libtool-2.2.6a-r1a1-x86-gcc2-2009-08-28
-		: $(baseURL)/libtool-2.2.6a-r1a1-x86-gcc2-2009-08-28.zip ;
+		: $(baseURL)/libtool-2.2.6a-r1a1-x86-gcc2-2009-08-28.zip
+		:
+		: true ;
 	InstallOptionalHaikuImagePackage texinfo-4.13a-r1a1-x86-gcc2-2009-08-30
-		: $(baseURL)/texinfo-4.13a-r1a1-x86-gcc2-2009-08-30.zip ;
-
-ObsoleteOptionalPackageWarning autoconf ;
-ObsoleteOptionalPackageWarning automake ;
-ObsoleteOptionalPackageWarning libtool ;
-ObsoleteOptionalPackageWarning texinfo ;
+		: $(baseURL)/texinfo-4.13a-r1a1-x86-gcc2-2009-08-30.zip
+		:
+		: true ;
 }
 
 
@@ -446,6 +453,7 @@
 		InstallOptionalHaikuImagePackage expat-2.0.1-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/expat-2.0.1-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -482,27 +490,28 @@
 		InstallOptionalHaikuImagePackage git-1.6.4.2-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/git-1.6.4.2-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
 
 
 # KeymapSwitcher
-if [ IsObsoleteOptionalHaikuImagePackageAdded KeymapSwitcher ] {
+if [ IsOptionalHaikuImagePackageAdded KeymapSwitcher ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package KeymapSwitcher available for $(TARGET_ARCH)&quot; ;
 	} else if $(HAIKU_GCC_VERSION[1]) &gt;= 4 {
 		InstallOptionalHaikuImagePackage
 			KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31
-			:  $(baseURL)/KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31.zip
+			: $(baseURL)/KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31.zip
 			:
 		;
 		AddSymlinkToHaikuImage home config be Desktop\ Applets
 			: /boot/common/bin/KeymapSwitcher ;
 	} else {
 		InstallOptionalHaikuImagePackage
-			KeymapSwitcher-1.2.3-x86-gcc2-2009-05-31
-			:  $(baseURL)/KeymapSwitcher-1.2.3-x86-gcc2-2009-05-31.zip
+			KeymapSwitcher-1.2.4-r1a1-x86-gcc2-2009-09-06
+			: $(baseURL)/KeymapSwitcher-1.2.4-r1a1-x86-gcc2-2009-09-06.zip
 			:
 		;
 		AddSymlinkToHaikuImage home config be Desktop\ Applets
@@ -512,12 +521,12 @@
 
 
 # LibIconv
-if [ IsObsoleteOptionalHaikuImagePackageAdded LibIconv ] {
+if [ IsOptionalHaikuImagePackageAdded LibIconv ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package LibIconv available for $(TARGET_ARCH)&quot; ;
 	} else {
-		InstallOptionalHaikuImagePackage libiconv-1.13.1-x86-gcc2-2009-07-07
-			: $(baseURL)/libiconv-1.13.1-x86-gcc2-2009-07-07.zip
+		InstallOptionalHaikuImagePackage libiconv-1.13.1-r1a1-x86-gcc2-2009-09-08
+			: $(baseURL)/libiconv-1.13.1-r1a1-x86-gcc2-2009-09-08.zip
 			:
 		;
 	}
@@ -525,7 +534,7 @@
 
 
 # LibLayout library
-if [ IsObsoleteOptionalHaikuImagePackageAdded LibLayout ] {
+if [ IsOptionalHaikuImagePackageAdded LibLayout ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package LibLayout available for $(TARGET_ARCH)&quot; ;
 	} else if $(HAIKU_GCC_VERSION[1]) &gt;= 4 &amp;&amp; ! $(isHybridBuild) {
@@ -540,13 +549,14 @@
 
 
 # LibXML2
-if [ IsObsoleteOptionalHaikuImagePackageAdded LibXML2 ] {
+if [ IsOptionalHaikuImagePackageAdded LibXML2 ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package LibXML2 available for $(TARGET_ARCH)&quot; ;
 	} else {
-		InstallOptionalHaikuImagePackage libxml2-2.7.3-git-r1a1-x86-gcc2-2009-08-30
-			: $(baseURL)/libxml2-2.7.3-git-r1a1-x86-gcc2-2009-08-30.zip
+		InstallOptionalHaikuImagePackage libxml2-2.7.3-r1a1-x86-gcc2-2009-09-08
+			: $(baseURL)/libxml2-2.7.3-r1a1-x86-gcc2-2009-09-08.zip
 			:
+			: true
 		;
 	}
 }
@@ -577,13 +587,14 @@
 		InstallOptionalHaikuImagePackage mercurial-1.3.1-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/mercurial-1.3.1-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
 
 
 # Nano
-if [ IsObsoleteOptionalHaikuImagePackageAdded Nano ] {
+if [ IsOptionalHaikuImagePackageAdded Nano ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Nano available for $(TARGET_ARCH)&quot; ;
 	} else {
@@ -596,13 +607,14 @@
 
 
 # Neon
-if [ IsObsoleteOptionalHaikuImagePackageAdded Neon ] {
+if [ IsOptionalHaikuImagePackageAdded Neon ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Neon available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage neon-0.28.6-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/neon-0.28.6-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -640,7 +652,7 @@
 
 
 # OpenSSH
-if [ IsObsoleteOptionalHaikuImagePackageAdded OpenSSH ] {
+if [ IsOptionalHaikuImagePackageAdded OpenSSH ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package OpenSSH available for $(TARGET_ARCH)&quot; ;
 	} else {
@@ -674,7 +686,7 @@
 
 
 # P7zip
-if [ IsObsoleteOptionalHaikuImagePackageAdded P7zip ] {
+if [ IsOptionalHaikuImagePackageAdded P7zip ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package P7zip available for $(TARGET_ARCH)&quot; ;
 	} else if $(HAIKU_GCC_VERSION[1]) &gt;= 4 &amp;&amp; ! $(isHybridBuild) {
@@ -699,7 +711,7 @@
 
 
 # Pe text editor
-if [ IsObsoleteOptionalHaikuImagePackageAdded Pe ] {
+if [ IsOptionalHaikuImagePackageAdded Pe ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Pe available for $(TARGET_ARCH)&quot; ;
 	} else {
@@ -729,26 +741,28 @@
 		InstallOptionalHaikuImagePackage perl-5.10.0-gcc2-2008-10-29
 			: $(baseURL)/perl-5.10.0-gcc2-2008-10-29.zip
 			:
+			: true
 		;
 	}
 }
 
 
 # Python
-if [ IsObsoleteOptionalHaikuImagePackageAdded Python ] {
+if [ IsOptionalHaikuImagePackageAdded Python ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Python available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage python-2.6.2-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/python-2.6.2-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
 
 
 # Rsync
-if [ IsObsoleteOptionalHaikuImagePackageAdded Rsync ] {
+if [ IsOptionalHaikuImagePackageAdded Rsync ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Rsync available for $(TARGET_ARCH)&quot; ;
 	} else {
@@ -761,27 +775,28 @@
 
 
 # SQLite
-if [ IsObsoleteOptionalHaikuImagePackageAdded SQLite ] {
+if [ IsOptionalHaikuImagePackageAdded SQLite ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package SQLite available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage sqlite-3.6.17-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/sqlite-3.6.17-r1a1-x86-gcc2-2009-08-30.zip
-
 			:
+			: true
 		;
 	}
 }
 
 
 # Subversion
-if [ IsObsoleteOptionalHaikuImagePackageAdded Subversion ] {
+if [ IsOptionalHaikuImagePackageAdded Subversion ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Subversion available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage subversion-1.6.5-r1a1-x86-gcc2-2009-09-02
 			: $(baseURL)/subversion-1.6.5-r1a1-x86-gcc2-2009-09-02.zip
 			:
+			: true
 		;
 	}
 }
@@ -854,7 +869,7 @@
 
 
 # Vim
-if [ IsObsoleteOptionalHaikuImagePackageAdded Vim ] {
+if [ IsOptionalHaikuImagePackageAdded Vim ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Vim available for $(TARGET_ARCH)&quot; ;
 	} else if $(HAIKU_GCC_VERSION[1]) &gt;= 4 {
@@ -865,8 +880,8 @@
 		AddSymlinkToHaikuImage home config be Applications
 			: /boot/common/bin/gvim ;
 	} else {
-		InstallOptionalHaikuImagePackage vim-7.2-x86-gcc2-2009-05-31
-			:  $(baseURL)/vim-7.2-x86-gcc2-2009-05-31.zip
+		InstallOptionalHaikuImagePackage vim-7.2-r1a1-x86-gcc2-2009-09-06
+			:  $(baseURL)/vim-7.2-r1a1-x86-gcc2-2009-09-06.zip
 			:
 		;
 		AddSymlinkToHaikuImage home config be Applications
@@ -950,13 +965,12 @@
 
 
 # Yasm
-if [ IsObsoleteOptionalHaikuImagePackageAdded Yasm ] {
+if [ IsOptionalHaikuImagePackageAdded Yasm ] {
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Yasm available for $(TARGET_ARCH)&quot; ;
 	} else {
 		InstallOptionalHaikuImagePackage yasm-0.8.0-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/yasm-0.8.0-r1a1-x86-gcc2-2009-08-30.zip
-
 			:
 		;
 	}

Modified: haiku/branches/releases/r1alpha1/docs/userguide/en/applications/activitymonitor.html
===================================================================
--- haiku/branches/releases/r1alpha1/docs/userguide/en/applications/activitymonitor.html	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/docs/userguide/en/applications/activitymonitor.html	2009-09-08 11:52:36 UTC (rev 32997)
@@ -51,7 +51,7 @@
 &lt;p&gt;Below the graphics is a legend (hideable from the context menu). You can change their colors and that of the graph's background via drag&amp;drop from any color picker, e.g. from &lt;span class=&quot;app&quot;&gt;Icon-O-Matic&lt;/span&gt;.&lt;/p&gt;
 &lt;p&gt;You can add more views from the &lt;span class=&quot;menu&quot;&gt;File&lt;/span&gt; menu if it gets too crowded.&lt;/p&gt;
 &lt;p&gt;The &lt;span class=&quot;menu&quot;&gt;Settings&lt;/span&gt; menu opens a panel where you can set the update interval.&lt;/p&gt;
-&lt;p&gt;Each view has it's own Replicator handle and can thus be arranged, for example, on the Desktop.&lt;/p&gt;
+&lt;p&gt;Each view has it's own &lt;a href=&quot;../gui.html#replicants&quot;&gt;Replicant&lt;/a&gt; handle and can thus be arranged, for example, on the Desktop.&lt;/p&gt;
 
 &lt;/div&gt;
 

Modified: haiku/branches/releases/r1alpha1/docs/userguide/en/applications/deskcalc.html
===================================================================
--- haiku/branches/releases/r1alpha1/docs/userguide/en/applications/deskcalc.html	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/docs/userguide/en/applications/deskcalc.html	2009-09-08 11:52:36 UTC (rev 32997)
@@ -45,7 +45,7 @@
 &lt;/table&gt;
 &lt;p&gt;&lt;br/&gt;&lt;/p&gt;
 &lt;p&gt;DeskCalc is a simple calculator that nevertheless has some nice features that aren't apparent on first sight.&lt;/p&gt;
-&lt;img src=&quot;../images/apps-images/deskcalc.png&quot; alt=&quot;deskcalc.png&quot; /&gt;
+&lt;img src=&quot;../../images/apps-images/deskcalc.png&quot; alt=&quot;deskcalc.png&quot; /&gt;
 &lt;ul&gt;
 &lt;li&gt;&lt;p&gt;DeskCalc understands much more than its simple keypad suggests.&lt;br /&gt;
 Besides the operators &lt;tt&gt;+&lt;/tt&gt;, &lt;tt&gt;-&lt;/tt&gt;, &lt;tt&gt;*&lt;/tt&gt;, &lt;tt&gt;/&lt;/tt&gt;, &lt;tt&gt;%&lt;/tt&gt;, &lt;tt&gt;^&lt;/tt&gt; and the constants &lt;tt&gt;pi&lt;/tt&gt; and &lt;tt&gt;e&lt;/tt&gt; the following math functions are supported:&lt;br /&gt;
@@ -60,7 +60,7 @@
 &lt;tr&gt;&lt;td&gt;&lt;span class=&quot;menu&quot;&gt;Audio Feedback&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;plays a sound when showing a result&lt;/td&gt;&lt;/tr&gt;
 &lt;tr&gt;&lt;td&gt;&lt;span class=&quot;menu&quot;&gt;Show Keypad&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;hides the keypad when deactivated&lt;/td&gt;&lt;/tr&gt;
 &lt;/table&gt;&lt;/li&gt;
-&lt;li&gt;&lt;p&gt;You can resize the calculator until it fits your needs and then put it as Replicant onto the Desktop via drag&amp;drop of the symbol in the bottom right corner. Make sure &lt;span class=&quot;menu&quot;&gt;Show Replicants&lt;/span&gt; is activated in the Deskbar.&lt;/p&gt;&lt;/li&gt;
+&lt;li&gt;&lt;p&gt;You can resize the calculator until it fits your needs and then put it as &lt;a href=&quot;../gui.html#replicants&quot;&gt;Replicant&lt;/a&gt; onto the Desktop via drag&amp;drop of the symbol in the bottom right corner. Make sure &lt;span class=&quot;menu&quot;&gt;Show Replicants&lt;/span&gt; is activated in the Deskbar.&lt;/p&gt;&lt;/li&gt;
 &lt;li&gt;&lt;p&gt;The keypad can be colored with a drag&amp;drop from any color well, e.g. from &lt;span class=&quot;app&quot;&gt;Icon-O-Matic&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 &lt;li&gt;&lt;p&gt;You can move up and down in a history of past calculations with &lt;span class=&quot;key&quot;&gt;&#226;&#134;&#145;&lt;/span&gt;&lt;span class=&quot;key&quot;&gt;&#226;&#134;&#147;&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
 &lt;li&gt;&lt;p&gt;You can select DeskCalc's contents and drag&amp;drop it into any application. Or you drop it into a Tracker window or onto the Desktop and a text file with that clipping is created there.&lt;/p&gt;

Modified: haiku/branches/releases/r1alpha1/docs/userguide/en/contents.html
===================================================================
--- haiku/branches/releases/r1alpha1/docs/userguide/en/contents.html	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/docs/userguide/en/contents.html	2009-09-08 11:52:36 UTC (rev 32997)
@@ -56,7 +56,8 @@
 	&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;a href=&quot;gui.html&quot;&gt;Haiku's GUI&lt;/a&gt;&lt;ul&gt;
 		&lt;li&gt;&lt;a href=&quot;gui.html#open-save-panel&quot;&gt;Open and save panels&lt;/a&gt;&lt;br /&gt;
 		&lt;a href=&quot;gui.html#open-save-shortcuts&quot;&gt;- Keyboard shortcuts&lt;/a&gt;&lt;br /&gt;
-		&lt;a href=&quot;gui.html#favorites-recent&quot;&gt;- Favorites and recent folders&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;
+		&lt;a href=&quot;gui.html#favorites-recent&quot;&gt;- Favorites and recent folders&lt;/a&gt;&lt;/li&gt;
+		&lt;li&gt;&lt;a href=&quot;gui.html#replicants&quot;&gt;Replicants&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;
 		&lt;td valign=&quot;top&quot;&gt;Learn about the basic elements of the graphical user interface.&lt;/td&gt;&lt;/tr&gt;
 	&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;a href=&quot;workspaces.html&quot;&gt;Workspaces&lt;/a&gt;&lt;ul&gt;
 		&lt;li&gt;&lt;a href=&quot;workspaces.html#applet&quot;&gt;The Workspaces Applet&lt;/a&gt;&lt;/li&gt;

Modified: haiku/branches/releases/r1alpha1/docs/userguide/en/deskbar.html
===================================================================
--- haiku/branches/releases/r1alpha1/docs/userguide/en/deskbar.html	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/docs/userguide/en/deskbar.html	2009-09-08 11:52:36 UTC (rev 32997)
@@ -60,7 +60,7 @@
 &lt;li&gt;&lt;p&gt;&lt;b&gt;About This System...&lt;/b&gt; - Shows some basic information of the system, licenses and the credits of the Haiku project.&lt;/p&gt;&lt;/li&gt;
 
 &lt;li&gt;&lt;p&gt;&lt;b&gt;Find...&lt;/b&gt; - Opens the &lt;a href=&quot;queries.html&quot;&gt;Query&lt;/a&gt; dialog.&lt;/p&gt;&lt;/li&gt;
-&lt;li&gt;&lt;p&gt;&lt;b&gt;Show Replicants&lt;/b&gt; - Shows/hides the little Replicant widget you use to drag it around, remove or access its context menu.&lt;/p&gt;&lt;/li&gt;
+&lt;li&gt;&lt;p&gt;&lt;b&gt;Show Replicants&lt;/b&gt; - Shows/hides the little &lt;a href=&quot;gui.html#replicants&quot;&gt;Replicant&lt;/a&gt; widget you use to drag it around, remove or access its context menu.&lt;/p&gt;&lt;/li&gt;
 &lt;li&gt;&lt;p&gt;&lt;b&gt;Mount&lt;/b&gt; - Offers the same options as when invoked by right-clicking the Desktop (see &lt;a href=&quot;tracker.html#mounting-volumes&quot;&gt;Mounting Volumes&lt;/a&gt;).&lt;/p&gt;&lt;/li&gt;
 &lt;li&gt;&lt;p&gt;&lt;b&gt;Deskbar Settings&lt;/b&gt;&lt;/p&gt;
 &lt;table summary=&quot;layout&quot; border=&quot;0&quot; cellpadding=&quot;2&quot; cellspacing=&quot;0&quot;&gt;

Modified: haiku/branches/releases/r1alpha1/docs/userguide/en/gui.html
===================================================================
--- haiku/branches/releases/r1alpha1/docs/userguide/en/gui.html	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/docs/userguide/en/gui.html	2009-09-08 11:52:36 UTC (rev 32997)
@@ -84,6 +84,15 @@
 &lt;p&gt;To add a Favorite, you simply navigate to your destination and choose &lt;span class=&quot;menu&quot;&gt;Favorites | Add Current Folder&lt;/span&gt;. From now on it will appear in every open/save panel. To remove a Favorite, choose &lt;span class=&quot;menu&quot;&gt;Favorites | Configure Favorites...&lt;/span&gt; and delete its entry.&lt;br /&gt;
 All Favorites are kept in &lt;span class=&quot;path&quot;&gt;/boot/home/config/settings/Tracker/Go/&lt;/span&gt;. So you might as well add and remove links to files and folders there directly.&lt;/p&gt;
 
+&lt;h1&gt;
+&lt;a href=&quot;#logo&quot;&gt;&lt;img src=&quot;../images/up.png&quot; align=&quot;right&quot; alt=&quot;index&quot; border=&quot;0&quot; class=&quot;noprint&quot; /&gt;&lt;/a&gt;
+&lt;a id=&quot;replicants&quot; name=&quot;replicants&quot;&gt;Replicants&lt;/a&gt;&lt;/h1&gt;
+&lt;p&gt;Replicants are small self-contained parts of applications that can be integrated into other programs. Provided Deskbar's option to &lt;span class=&quot;menu&quot;&gt;Show Replicants&lt;/span&gt; is activated, you'll recognize a replicantable part of an appliction by its small handle, normally in the bottom right corner:&lt;/p&gt;
+&lt;img src=&quot;../images/gui-images/replicant.png&quot; alt=&quot;replicant.png&quot; /&gt;
+&lt;p&gt;The most prominent place that accepts Replicants is the Desktop: You simply drag&amp;drop the little handle onto it. From now on it's part of the Desktop and the Replicant's originating app doesn't have to be started for it to work.&lt;br /&gt;
+A right-click on a Replicant handle offers a context menu to show the originating app's &lt;span class=&quot;menu&quot;&gt;About&lt;/span&gt; window and to &lt;span class=&quot;menu&quot;&gt;Remove Replicant&lt;/span&gt;.&lt;/p&gt;
+&lt;p&gt;Examples for replicatable applications are the graphs of the &lt;a href=&quot;applications/activitymonitor.html&quot;&gt;ActivityMonitor&lt;/a&gt;, the &lt;a href=&quot;workspaces.html&quot;&gt;Workspaces applet&lt;/a&gt; or &lt;a href=&quot;applications/deskcalc.html&quot;&gt;DeskCalc&lt;/a&gt;.&lt;/p&gt;
+
 &lt;/div&gt;
 
 &lt;div class=&quot;bottomnav&quot;&gt;

Modified: haiku/branches/releases/r1alpha1/docs/userguide/en/workspaces.html
===================================================================
--- haiku/branches/releases/r1alpha1/docs/userguide/en/workspaces.html	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/docs/userguide/en/workspaces.html	2009-09-08 11:52:36 UTC (rev 32997)
@@ -51,7 +51,7 @@
 &lt;img src=&quot;images/workspaces-images/workspaces.png&quot; alt=&quot;workspaces.png&quot; /&gt;
 &lt;p&gt;You find the Workspaces applet with the other &lt;span class=&quot;menu&quot;&gt;Desktop Applets&lt;/span&gt; in the Deskbar. It shows a miniature version of all workspaces. There are several options available from the context menu of the applet's window, which are all pretty self-explaining.&lt;br /&gt;
 &lt;span class=&quot;menu&quot;&gt;Change Workspace Count...&lt;/span&gt; will open the &lt;a href=&quot;preferences/screen.html&quot;&gt;Screen&lt;/a&gt; preferences where you set the number of workspaces and their arrangement (how many rows and columns).&lt;/p&gt;
-&lt;p&gt;Since the applet is a Replicant, you can resize the window as desired and then drag&amp;drop it by its handle onto the desktop (make sure &quot;&lt;span class=&quot;menu&quot;&gt;Show Replicants&lt;/span&gt;&quot; is activated in the Deskbar menu).&lt;/p&gt;
+&lt;p&gt;Since the applet is a &lt;a href=&quot;gui.html#replicants&quot;&gt;Replicant&lt;/a&gt;, you can resize the window as desired and then drag&amp;drop it by its handle onto the desktop (make sure &quot;&lt;span class=&quot;menu&quot;&gt;Show Replicants&lt;/span&gt;&quot; is activated in the Deskbar menu).&lt;/p&gt;
 
 &lt;h2&gt;
 &lt;a href=&quot;#logo&quot;&gt;&lt;img src=&quot;../images/up.png&quot; align=&quot;right&quot; alt=&quot;index&quot; border=&quot;0&quot; class=&quot;noprint&quot; /&gt;&lt;/a&gt;

Added: haiku/branches/releases/r1alpha1/docs/userguide/images/gui-images/replicant.png
===================================================================
--- haiku/branches/releases/r1alpha1/docs/userguide/images/gui-images/replicant.png	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/docs/userguide/images/gui-images/replicant.png	2009-09-08 11:52:36 UTC (rev 32997)
@@ -0,0 +1,3 @@
+&#137;PNG
+
+
\ No newline at end of file

Modified: haiku/branches/releases/r1alpha1/headers/private/shared/CommandPipe.h
===================================================================
--- haiku/branches/releases/r1alpha1/headers/private/shared/CommandPipe.h	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/headers/private/shared/CommandPipe.h	2009-09-08 11:52:36 UTC (rev 32997)
@@ -22,63 +22,73 @@
 namespace BPrivate {
 
 class BCommandPipe {
-	public:
+public:
 								BCommandPipe();
 	virtual						~BCommandPipe();
-		
+
 			status_t			AddArg(const char* argv);
 			void				PrintToStream() const;
-		
+
 	// FlushArgs() deletes the commands while Close() explicity closes all
 	// pending pipe-ends
 	// Note: Internally FlushArgs() calls Close()
 			void				FlushArgs();
 			void				Close();
-		
+
+	// You MUST NOT free/delete the strings in the array, but you MUST free
+	// just the array itself.
+			const char**		Argv(int32&amp; _argc) const;
+
 	// If you use these, you must explicitly call &quot;close&quot; for the parameters
-	// (outdes/errdes) when you are done with them!
-			thread_id			Pipe(int* outdes, int* errdes) const;
-			thread_id			Pipe(int* outdes) const;
-			thread_id			PipeAll(int* outAndErrDes) const;
-		
+	// (stdOut/stdErr) when you are done with them!
+			thread_id			Pipe(int* stdOut, int* stdErr) const;
+			thread_id			Pipe(int* stdOut) const;
+			thread_id			PipeAll(int* stdOutAndErr) const;
+
 	// If you use these, you need NOT call &quot;fclose&quot; for the parameters
 	// (out/err) when you are done with them, also you need not do any
 	// allocation for these FILE* pointers, just use FILE* out = NULL
 	// and pass &amp;out and so on...
 			thread_id			PipeInto(FILE** _out, FILE** _err);
 			thread_id			PipeInto(FILE** _outAndErr);
-		
+
 	// Run() is a synchronous call, and waits till the command has finished
 	// executing RunAsync() is an asynchronous call that returns immediately
 	// after launching the command Neither of these bother about redirecting
 	// pipes for you to use
 			void				Run();
 			void				RunAsync();
-		
-	// This function reads line-by-line from &quot;file&quot;, cancels its reading
-	// when &quot;*cancel&quot; is true. It reports each line it has read to &quot;target&quot;
-	// using the supplied &quot;_message&quot; and string field name. &quot;cancel&quot; can be
-	// NULL
-			BString				ReadLines(FILE* file, bool* cancel,
-									BMessenger&amp; target, const BMessage&amp; message,
-									const BString&amp; stringFieldName);
-		
-	// You need NOT free/delete	the return array of strings
-			const char**		Argv(int32&amp; _argc) const;
-		
+
+	// Reading the Pipe output
+
+			class LineReader {
+			public:
+				virtual				~LineReader() {}
+				virtual	bool		IsCanceled() = 0;
+				virtual	status_t	ReadLine(const BString&amp; line) = 0;
+				// TODO: Add a Timeout() method.
+			};
+
+	// This function reads line-by-line from &quot;file&quot;. It calls IsCanceled()
+	// on the passed LineReader instance for each byte read from file
+	// (currently). And it calls ReadLine() for each complete line.
+			status_t			ReadLines(FILE* file, LineReader* lineReader);
+	// This method can be used to read the entire file into a BString.
+			BString				ReadLines(FILE* file);
+
 	// Stardard append operators, if you use pointers to a BCommandPipe,
 	// you must use *pipe &lt;&lt; &quot;command&quot;; and not pipe &lt;&lt; &quot;command&quot; (as it
 	// will not compile that way)
-			BCommandPipe&amp;		operator&lt;&lt;(const char *arg);
+			BCommandPipe&amp;		operator&lt;&lt;(const char* arg);
 			BCommandPipe&amp;		operator&lt;&lt;(const BString&amp; arg);
 			BCommandPipe&amp;		operator&lt;&lt;(const BCommandPipe&amp; arg);
-		
-	protected:
+
+protected:
 			BList				fArgList;
-			int					fOutDes[2];
-			int					fErrDes[2];
-			bool				fOutDesOpen;
-			bool				fErrDesOpen;
+			int					fStdOut[2];
+			int					fStdErr[2];
+			bool				fStdOutOpen;
+			bool				fStdErrOpen;
 };
 
 }	// namespace BPrivate

Modified: haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.cpp
===================================================================
--- haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.cpp	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.cpp	2009-09-08 11:52:36 UTC (rev 32997)
@@ -19,54 +19,25 @@
 #include &lt;String.h&gt;
 #include &lt;SymLink.h&gt;
 
-#include &quot;AutoLocker.h&quot;
 #include &quot;InstallerWindow.h&quot;
 	// TODO: For PACKAGES_DIRECTORY and VAR_DIRECTORY, not so nice...
+#include &quot;SemaphoreLocker.h&quot;
+#include &quot;ProgressReporter.h&quot;
 
+
 using std::nothrow;
 
 
-// SemaphoreLocking
-class SemaphoreLocking {
-public:
-	inline bool Lock(sem_id* lockable)
-	{
-		return acquire_sem(*lockable) == B_OK;
-	}
-
-	inline void Unlock(sem_id* lockable)
-	{
-		release_sem(*lockable);
-	}
-};
-
-// SemaphoreLocker
-class SemaphoreLocker : public AutoLocker&lt;sem_id, SemaphoreLocking&gt; {
-public:
-	inline SemaphoreLocker(sem_id semaphore, bool alreadyLocked = false,
-			bool lockIfNotLocked = true)
-		:
-		AutoLocker&lt;sem_id, SemaphoreLocking&gt;(),
-		fSem(semaphore)
-	{
-		SetTo(&amp;fSem, alreadyLocked, lockIfNotLocked);
-	}
-
-private:
-	sem_id	fSem;
-};
-
-
-
-
-CopyEngine::CopyEngine(const BMessenger&amp; messenger, BMessage* message)
+CopyEngine::CopyEngine(ProgressReporter* reporter)
 	:
 	fBufferQueue(),
 	fWriterThread(-1),
 	fQuitting(false),
 
 	fBytesRead(0),
+	fLastBytesRead(0),
 	fItemsCopied(0),
+	fLastItemsCopied(0),
 	fTimeRead(0),
 
 	fBytesWritten(0),
@@ -78,8 +49,7 @@
 	fCurrentTargetFolder(NULL),
 	fCurrentItem(NULL),
 
-	fMessenger(messenger),
-	fMessage(message)
+	fProgressReporter(reporter)
 {
 	fWriterThread = spawn_thread(_WriteThreadEntry, &quot;buffer writer&quot;,
 		B_NORMAL_PRIORITY, this);
@@ -105,16 +75,19 @@
 		int32 exitValue;
 		wait_for_thread(fWriterThread, &amp;exitValue);
 	}
-
-	delete fMessage;
 }
 
 
 void
 CopyEngine::ResetTargets()
 {
+	// TODO: One could subtract the bytes/items which were added to the
+	// ProgressReporter before resetting them...
+
 	fBytesRead = 0;
+	fLastBytesRead = 0;
 	fItemsCopied = 0;
+	fLastItemsCopied = 0;
 	fTimeRead = 0;
 
 	fBytesWritten = 0;
@@ -125,12 +98,6 @@
 
 	fCurrentTargetFolder = NULL;
 	fCurrentItem = NULL;
-
-	if (fMessage) {
-		BMessage message(*fMessage);
-		message.AddString(&quot;status&quot;, &quot;Collecting copy information.&quot;);
-		fMessenger.SendMessage(&amp;message);
-	}
 }
 
 
@@ -138,7 +105,10 @@
 CopyEngine::CollectTargets(const char* source, sem_id cancelSemaphore)
 {
 	int32 level = 0;
-	return _CollectCopyInfo(source, level, cancelSemaphore);
+	status_t ret = _CollectCopyInfo(source, level, cancelSemaphore);
+	if (ret == B_OK &amp;&amp; fProgressReporter != NULL)
+		fProgressReporter-&gt;AddItems(fItemsToCopy, fBytesToCopy);
+	return ret;
 }
 
 
@@ -146,14 +116,6 @@
 CopyEngine::CopyFolder(const char* source, const char* destination,
 	sem_id cancelSemaphore)
 {
-	printf(&quot;%lld bytes to read in %lld files\n&quot;, fBytesToCopy, fItemsToCopy);
-
-	if (fMessage) {
-		BMessage message(*fMessage);
-		message.AddString(&quot;status&quot;, &quot;Performing installation.&quot;);
-		fMessenger.SendMessage(&amp;message);
-	}
-
 	int32 level = 0;
 	return _CopyFolder(source, destination, level, cancelSemaphore);
 }
@@ -507,16 +469,23 @@
 void
 CopyEngine::_UpdateProgress()
 {
-	if (fMessage != NULL) {
-		BMessage message(*fMessage);
-		float progress = 100.0 * fBytesRead / fBytesToCopy;
-		message.AddFloat(&quot;progress&quot;, progress);
-		message.AddInt32(&quot;current&quot;, fItemsCopied);
-		message.AddInt32(&quot;maximum&quot;, fItemsToCopy);
-		message.AddString(&quot;item&quot;, fCurrentItem);
-		message.AddString(&quot;folder&quot;, fCurrentTargetFolder);
-		fMessenger.SendMessage(&amp;message);
+	if (fProgressReporter == NULL)
+		return;
+
+	uint64 items = 0;
+	if (fLastItemsCopied &lt; fItemsCopied) {
+		items = fItemsCopied - fLastItemsCopied;
+		fLastItemsCopied = fItemsCopied;
 	}
+
+	off_t bytes = 0;
+	if (fLastBytesRead &lt; fBytesRead) {
+		bytes = fBytesRead - fLastBytesRead;
+		fLastBytesRead = fBytesRead;
+	}
+
+	fProgressReporter-&gt;ItemsWritten(items, bytes, fCurrentItem,
+		fCurrentTargetFolder);
 }
 
 

Modified: haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.h
===================================================================
--- haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.h	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/src/apps/installer/CopyEngine.h	2009-09-08 11:52:36 UTC (rev 32997)
@@ -15,13 +15,12 @@
 #include &quot;BlockingQueue.h&quot;
 
 class BFile;
-class BMessage;
-class BMessenger;
+class ProgressReporter;
 
+
 class CopyEngine {
 public:
-								CopyEngine(const BMessenger&amp; messenger,
-									BMessage* message);
+								CopyEngine(ProgressReporter* reporter);
 	virtual						~CopyEngine();
 
 			void				ResetTargets();
@@ -92,7 +91,9 @@
 	volatile bool				fQuitting;
 
 			off_t				fBytesRead;
+			uint64				fLastBytesRead;
 			uint64				fItemsCopied;
+			uint64				fLastItemsCopied;
 			bigtime_t			fTimeRead;
 
 			off_t				fBytesWritten;
@@ -104,9 +105,8 @@
 			const char*			fCurrentTargetFolder;
 			const char*			fCurrentItem;
 
-			BMessenger			fMessenger;
-			BMessage*			fMessage;
+			ProgressReporter*	fProgressReporter;
 };
 
 
-#endif // COPY_ENGINE_2_H
+#endif // COPY_ENGINE_H

Modified: haiku/branches/releases/r1alpha1/src/apps/installer/Jamfile
===================================================================
--- haiku/branches/releases/r1alpha1/src/apps/installer/Jamfile	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/src/apps/installer/Jamfile	2009-09-08 11:52:36 UTC (rev 32997)
@@ -3,12 +3,14 @@
 UsePrivateHeaders shared storage tracker ;
 SubDirHdrs [ FDirName $(HAIKU_TOP) src kits tracker ] ;
 
-Application Installer : 
+Application Installer :
 	CopyEngine.cpp
 	InstallerApp.cpp
 	InstallerWindow.cpp
 	PackageViews.cpp
 	PartitionMenuItem.cpp
+	ProgressReporter.cpp
+	UnzipEngine.cpp
 	WorkerThread.cpp
-	: be tracker translation $(TARGET_LIBSTDC++)
+	: be tracker translation libshared.a $(TARGET_LIBSTDC++)
 	: Installer.rdef ;

Added: haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.cpp
===================================================================
--- haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.cpp	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.cpp	2009-09-08 11:52:36 UTC (rev 32997)
@@ -0,0 +1,103 @@
+/*
+ * Copyright 2009, Stephan A&#195;&#159;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ *  All rights reserved. Distributed under the terms of the MIT License.
+ */
+
+#include &quot;ProgressReporter.h&quot;
+
+#include &lt;stdio.h&gt;
+
+
+ProgressReporter::ProgressReporter(const BMessenger&amp; messenger,
+		BMessage* message)
+	:
+	fStartTime(0),
+
+	fBytesToWrite(0),
+	fBytesWritten(0),
+
+	fItemsToWrite(0),
+	fItemsWritten(0),
+
+	fMessenger(messenger),
+	fMessage(message)
+{
+}
+
+
+ProgressReporter::~ProgressReporter()
+{
+	delete fMessage;
+}
+
+
+void
+ProgressReporter::Reset()
+{
+	fBytesToWrite = 0;
+	fBytesWritten = 0;
+
+	fItemsToWrite = 0;
+	fItemsWritten = 0;
+
+	if (fMessage) {
+		BMessage message(*fMessage);
+		message.AddString(&quot;status&quot;, &quot;Collecting copy information.&quot;);
+		fMessenger.SendMessage(&amp;message);
+	}
+}
+
+
+void
+ProgressReporter::AddItems(uint64 count, off_t bytes)
+{
+	fBytesToWrite += bytes;
+	fItemsToWrite += count;
+}
+
+
+void
+ProgressReporter::StartTimer()
+{
+	fStartTime = system_time();
+
+	printf(&quot;%lld bytes to write in %lld files\n&quot;, fBytesToWrite,
+		fItemsToWrite);
+
+	if (fMessage) {
+		BMessage message(*fMessage);
+		message.AddString(&quot;status&quot;, &quot;Performing installation.&quot;);
+		fMessenger.SendMessage(&amp;message);
+	}
+}
+
+
+void
+ProgressReporter::ItemsWritten(uint64 items, off_t bytes,
+	const char* itemName, const char* targetFolder)
+{
+	fItemsWritten += items;
+	fBytesWritten += bytes;
+
+	_UpdateProgress(itemName, targetFolder);
+}
+
+
+void
+ProgressReporter::_UpdateProgress(const char* itemName,
+	const char* targetFolder)
+{
+	if (fMessage == NULL)
+		return;
+
+	// TODO: Could add time to finish calculation here...
+
+	BMessage message(*fMessage);
+	float progress = 100.0 * fBytesWritten / fBytesToWrite;
+	message.AddFloat(&quot;progress&quot;, progress);
+	message.AddInt32(&quot;current&quot;, fItemsWritten);
+	message.AddInt32(&quot;maximum&quot;, fItemsToWrite);
+	message.AddString(&quot;item&quot;, itemName);
+	message.AddString(&quot;folder&quot;, targetFolder);
+	fMessenger.SendMessage(&amp;message);
+}

Added: haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.h
===================================================================
--- haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.h	2009-09-08 11:45:52 UTC (rev 32996)
+++ haiku/branches/releases/r1alpha1/src/apps/installer/ProgressReporter.h	2009-09-08 11:52:36 UTC (rev 32997)
@@ -0,0 +1,48 @@
+/*
+ * Copyright 2009, Stephan A&#195;&#159;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ *  All rights reserved. Distributed under the terms of the MIT License.
+ */
+#ifndef PROGRESS_REPORTER_H
+#define PROGRESS_REPORTER_H
+
+
+#include &lt;Messenger.h&gt;
+
+
+class ProgressReporter {
+public:
+								ProgressReporter(const BMessenger&amp; messenger,
+									BMessage* message);
+	virtual						~ProgressReporter();
+
+			void				Reset();
+
+			void				AddItems(uint64 count, off_t bytes);
+
+			void				StartTimer();
+
+			void				ItemsWritten(uint64 items, off_t bytes,
+									const char* itemName,
+									const char* targetFolder);
+
+			// TODO: Perhaps move cancelling here as well...
+
+private:
+			void				_UpdateProgress(const char* itemName,
+									const char* targetFolder);
+
+private:
+			bigtime_t			fStartTime;

[... truncated: 1118 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020465.html">[Haiku-commits] r32996 - haiku/trunk/build/jam
</A></li>
	<LI>Next message: <A HREF="020451.html">[Haiku-commits] r32998 - haiku/branches/releases/r1alpha1/build/jam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20450">[ date ]</a>
              <a href="thread.html#20450">[ thread ]</a>
              <a href="subject.html#20450">[ subject ]</a>
              <a href="author.html#20450">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
