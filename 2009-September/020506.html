<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r33028 - in haiku/branches/components/gallium3d:	build/jam data/system/boot headers/private/shared	src/add-ons/kernel/bus_managers/ata	src/add-ons/kernel/busses/ata/silicon_image_3112	src/add-ons/kernel/busses/scsi/ahci	src/add-ons/kernel/drivers/audio/hda	src/add-ons/kernel/file_systems/bfs	src/add-ons/kernel/file_systems/cdda	src/add-ons/kernel/file_systems/ext2	src/add-ons/kernel/file_systems/ramfs	src/add-ons/kernel/file_systems/reiserfs	src/add-ons/kernel/file_systems/udf	src/add-ons/kernel/generic/ata_adapter	src/add-ons/kernel/partitioning_systems/session	src/add-ons/mail_daemon/outbound_protocols/smtp	src/add-ons/tracker/zipomatic src/apps/installer	src/kits/interface src/system/kernel/arch/x86
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r33028%20-%20in%20haiku/branches/components/gallium3d%3A%0A%09build/jam%20data/system/boot%20headers/private/shared%0A%09src/add-ons/kernel/bus_managers/ata%0A%09src/add-ons/kernel/busses/ata/silicon_image_3112%0A%09src/add-ons/kernel/busses/scsi/ahci%0A%09src/add-ons/kernel/drivers/audio/hda%0A%09src/add-ons/kernel/file_systems/bfs%0A%09src/add-ons/kernel/file_systems/cdda%0A%09src/add-ons/kernel/file_systems/ext2%0A%09src/add-ons/kernel/file_systems/ramfs%0A%09src/add-ons/kernel/file_systems/reiserfs%0A%09src/add-ons/kernel/file_systems/udf%0A%09src/add-ons/kernel/generic/ata_adapter%0A%09src/add-ons/kernel/partitioning_systems/session%0A%09src/add-ons/mail_daemon/outbound_protocols/smtp%0A%09src/add-ons/tracker/zipomatic%20src/apps/installer%0A%09src/kits/interface%20src/system/kernel/arch/x86&In-Reply-To=%3C200909100010.n8A0AoxY010002%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020504.html">
   <LINK REL="Next"  HREF="020507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r33028 - in haiku/branches/components/gallium3d:	build/jam data/system/boot headers/private/shared	src/add-ons/kernel/bus_managers/ata	src/add-ons/kernel/busses/ata/silicon_image_3112	src/add-ons/kernel/busses/scsi/ahci	src/add-ons/kernel/drivers/audio/hda	src/add-ons/kernel/file_systems/bfs	src/add-ons/kernel/file_systems/cdda	src/add-ons/kernel/file_systems/ext2	src/add-ons/kernel/file_systems/ramfs	src/add-ons/kernel/file_systems/reiserfs	src/add-ons/kernel/file_systems/udf	src/add-ons/kernel/generic/ata_adapter	src/add-ons/kernel/partitioning_systems/session	src/add-ons/mail_daemon/outbound_protocols/smtp	src/add-ons/tracker/zipomatic src/apps/installer	src/kits/interface src/system/kernel/arch/x86</H1>
    <B>aljen at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r33028%20-%20in%20haiku/branches/components/gallium3d%3A%0A%09build/jam%20data/system/boot%20headers/private/shared%0A%09src/add-ons/kernel/bus_managers/ata%0A%09src/add-ons/kernel/busses/ata/silicon_image_3112%0A%09src/add-ons/kernel/busses/scsi/ahci%0A%09src/add-ons/kernel/drivers/audio/hda%0A%09src/add-ons/kernel/file_systems/bfs%0A%09src/add-ons/kernel/file_systems/cdda%0A%09src/add-ons/kernel/file_systems/ext2%0A%09src/add-ons/kernel/file_systems/ramfs%0A%09src/add-ons/kernel/file_systems/reiserfs%0A%09src/add-ons/kernel/file_systems/udf%0A%09src/add-ons/kernel/generic/ata_adapter%0A%09src/add-ons/kernel/partitioning_systems/session%0A%09src/add-ons/mail_daemon/outbound_protocols/smtp%0A%09src/add-ons/tracker/zipomatic%20src/apps/installer%0A%09src/kits/interface%20src/system/kernel/arch/x86&In-Reply-To=%3C200909100010.n8A0AoxY010002%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r33028 - in haiku/branches/components/gallium3d:	build/jam data/system/boot headers/private/shared	src/add-ons/kernel/bus_managers/ata	src/add-ons/kernel/busses/ata/silicon_image_3112	src/add-ons/kernel/busses/scsi/ahci	src/add-ons/kernel/drivers/audio/hda	src/add-ons/kernel/file_systems/bfs	src/add-ons/kernel/file_systems/cdda	src/add-ons/kernel/file_systems/ext2	src/add-ons/kernel/file_systems/ramfs	src/add-ons/kernel/file_systems/reiserfs	src/add-ons/kernel/file_systems/udf	src/add-ons/kernel/generic/ata_adapter	src/add-ons/kernel/partitioning_systems/session	src/add-ons/mail_daemon/outbound_protocols/smtp	src/add-ons/tracker/zipomatic src/apps/installer	src/kits/interface src/system/kernel/arch/x86">aljen at mail.berlios.de
       </A><BR>
    <I>Thu Sep 10 02:10:50 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020504.html">[Haiku-commits] r33027 - in	haiku/branches/releases/r1alpha1/src/add-ons/kernel:	bus_managers/ata busses/ata/silicon_image_3112	busses/scsi/ahci generic/ata_adapter
</A></li>
        <LI>Next message: <A HREF="020507.html">[Haiku-commits] r33029 - in haiku/branches/components/gallium3d: headers/os/opengl/GL src/add-ons/opengl/softpipe src/add-ons/opengl/trace src/kits/opengl src/kits/opengl/mesa src/kits/opengl/mesa/drivers/common src/kits/opengl/mesa/gallium/auxiliary/cso_cache src/kits/opengl/mesa/gallium/auxiliary/draw src/kits/opengl/mesa/gallium/auxiliary/gallivm src/kits/opengl/mesa/gallium/auxiliary/indices src/kits/opengl/mesa/gallium/auxiliary/pipebuffer src/kits/opengl/mesa/gallium/auxiliary/rtasm src/kits/opengl/mesa/gallium/auxiliary/tgsi src/kits/opengl/mesa/gallium/auxiliary/util src/kits/opengl/mesa/gallium/include/pipe src/kits/opengl/mesa/gallium/include/pipe/internal src/kits/opengl/mesa/gallium/include/state_tracker src/kits/opengl/mesa/glapi src/kits/opengl/mesa/main src/kits/opengl/mesa/math src/kits/opengl/mesa/shader src/kits/opengl/mesa/shader/slang src/kits/opengl/mesa/sparc src/kits/opengl/mesa/state_tracker src/kits/opengl/mesa/swrast src/kits/opengl/mesa/tnl src/kits/openg! l/mesa/vbo src/kits/opengl/mesa/vf src/kits/opengl/mesa/x86 src/kits/opengl/mesa/x86-64
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20506">[ date ]</a>
              <a href="thread.html#20506">[ thread ]</a>
              <a href="subject.html#20506">[ subject ]</a>
              <a href="author.html#20506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aljen
Date: 2009-09-10 02:10:29 +0200 (Thu, 10 Sep 2009)
New Revision: 33028
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=33028&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=33028&amp;view=rev</A>

Modified:
   haiku/branches/components/gallium3d/build/jam/HaikuImage
   haiku/branches/components/gallium3d/build/jam/ImageRules
   haiku/branches/components/gallium3d/build/jam/OptionalPackages
   haiku/branches/components/gallium3d/data/system/boot/Bootscript
   haiku/branches/components/gallium3d/data/system/boot/InstallerFinishScript
   haiku/branches/components/gallium3d/headers/private/shared/TrackerAddOnAppLaunch.h
   haiku/branches/components/gallium3d/src/add-ons/kernel/bus_managers/ata/ATAChannel.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/busses/ata/silicon_image_3112/silicon_image_3112.c
   haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_controller.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_port.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_sim.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/util.c
   haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/cdda/kernel_interface.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ext2/kernel_interface.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/reiserfs/kernel_interface.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/udf/kernel_interface.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/generic/ata_adapter/ata_adapter.c
   haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/Disc.cpp
   haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/scsi-mmc.h
   haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.cpp
   haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.h
   haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/Jamfile
   haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/ZipOMatic.cpp
   haiku/branches/components/gallium3d/src/apps/installer/UnzipEngine.cpp
   haiku/branches/components/gallium3d/src/kits/interface/TextView.cpp
   haiku/branches/components/gallium3d/src/system/kernel/arch/x86/arch_vm_translation_map.cpp
Log:
merged changes from trunk r32985-r33027

Modified: haiku/branches/components/gallium3d/build/jam/HaikuImage
===================================================================
--- haiku/branches/components/gallium3d/build/jam/HaikuImage	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/build/jam/HaikuImage	2009-09-10 00:10:29 UTC (rev 33028)
@@ -283,8 +283,8 @@
 # Deskbar Application links
 AddDirectoryToHaikuImage home config be Applications ;
 DESKBAR_APPLICATIONS = ActivityMonitor CharacterMap CodyCam CDPlayer DeskCalc
-	DiskProbe DriveSetup DiskUsage Expander Icon-O-Matic Magnify Mail
-	MediaConverter MediaPlayer MidiPlayer People PoorMan Screenshot
+	DiskProbe DriveSetup DiskUsage Expander Icon-O-Matic Installer Magnify
+	Mail MediaConverter MediaPlayer MidiPlayer People PoorMan Screenshot
 	SoundRecorder StyledEdit Terminal TV
 ;
 local linkTarget ;

Modified: haiku/branches/components/gallium3d/build/jam/ImageRules
===================================================================
--- haiku/branches/components/gallium3d/build/jam/ImageRules	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/build/jam/ImageRules	2009-09-10 00:10:29 UTC (rev 33028)
@@ -758,13 +758,18 @@
 	}
 }
 
-rule InstallOptionalHaikuImagePackage package : url : dirTokens
+rule InstallOptionalHaikuImagePackage package : url : dirTokens : isCDPackage
 {
 	# download zip file
 	local zipFile = [ DownloadOptionalPackage $(package) : $(url) ] ;
 
-	# unzip onto image
-	UnzipArchiveToHaikuImage $(dirTokens) : $(zipFile) ;
+	if ( $(isCDPackage) = true || $(isCDPackage) = 1 ) &amp;&amp; $(HAIKU_CD_NAME) {
+		# copy onto image
+		AddFilesToHaikuImage _packages_ : $(zipFile) ;
+	} else {
+		# unzip onto image
+		UnzipArchiveToHaikuImage $(dirTokens) : $(zipFile) ;
+	}
 }
 
 rule AddEntryToHaikuImageUserGroupFile file : entry

Modified: haiku/branches/components/gallium3d/build/jam/OptionalPackages
===================================================================
--- haiku/branches/components/gallium3d/build/jam/OptionalPackages	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/build/jam/OptionalPackages	2009-09-10 00:10:29 UTC (rev 33028)
@@ -12,7 +12,7 @@
 
 
 # Available Optional Packages:
-#	APR					- support libraries used for example by SVN
+#	APR					- support libraries used for example by Subversion
 #	APR-util
 #	Beam				- powerful native e-mail client
 #	BeBook				- the classic BeOS API documentation
@@ -70,6 +70,7 @@
 		InstallOptionalHaikuImagePackage apr-1.3.8-r1a1-x86-gcc2-2009-08-29
 			: $(baseURL)/apr-1.3.8-r1a1-x86-gcc2-2009-08-29.zip
 			:
+			: true
 		;
 	}
 }
@@ -83,6 +84,7 @@
 		InstallOptionalHaikuImagePackage apr-util-1.3.9-r1a1-x86-gcc2-2009-08-29
 			: $(baseURL)/apr-util-1.3.9-r1a1-x86-gcc2-2009-08-29.zip
 			:
+			: true
 		;
 	}
 }
@@ -237,6 +239,7 @@
 			clucene-0.9.21svn-x86-gcc4-haiku-2009-08-11
 			: $(baseURL)/clucene-0.9.21-x86-gcc4-haiku-2009-08-11.zip
 			:
+			: true
 		;
 	}
 }
@@ -249,8 +252,8 @@
 	} else {
 		InstallOptionalHaikuImagePackage curl-7.19.6-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/curl-7.19.6-r1a1-x86-gcc2-2009-08-30.zip
-
 			:
+			: true
 		;
 	}
 }
@@ -264,6 +267,7 @@
 		InstallOptionalHaikuImagePackage cvs-1.12.13-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/cvs-1.12.13-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -273,13 +277,21 @@
 if [ IsOptionalHaikuImagePackageAdded Development ] &amp;&amp; $(TARGET_ARCH) = x86 {
 	# autotools
 	InstallOptionalHaikuImagePackage autoconf-2.64-r1a1-x86-gcc2-2009-08-27
-		: $(baseURL)/autoconf-2.64-r1a1-x86-gcc2-2009-08-27.zip ;
+		: $(baseURL)/autoconf-2.64-r1a1-x86-gcc2-2009-08-27.zip
+		:
+		: true ;
 	InstallOptionalHaikuImagePackage automake-1.11-r1a1-x86-gcc2-2009-08-27
-		: $(baseURL)/automake-1.11-r1a1-x86-gcc2-2009-08-27.zip ;
+		: $(baseURL)/automake-1.11-r1a1-x86-gcc2-2009-08-27.zip
+		:
+		: true ;
 	InstallOptionalHaikuImagePackage libtool-2.2.6a-r1a1-x86-gcc2-2009-08-28
-		: $(baseURL)/libtool-2.2.6a-r1a1-x86-gcc2-2009-08-28.zip ;
+		: $(baseURL)/libtool-2.2.6a-r1a1-x86-gcc2-2009-08-28.zip
+		:
+		: true ;
 	InstallOptionalHaikuImagePackage texinfo-4.13a-r1a1-x86-gcc2-2009-08-30
-		: $(baseURL)/texinfo-4.13a-r1a1-x86-gcc2-2009-08-30.zip ;
+		: $(baseURL)/texinfo-4.13a-r1a1-x86-gcc2-2009-08-30.zip
+		:
+		: true ;
 }
 
 
@@ -423,6 +435,7 @@
 		InstallOptionalHaikuImagePackage expat-2.0.1-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/expat-2.0.1-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -459,6 +472,7 @@
 		InstallOptionalHaikuImagePackage git-1.6.4.2-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/git-1.6.4.2-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -471,7 +485,7 @@
 	} else if $(HAIKU_GCC_VERSION[1]) &gt;= 4 {
 		InstallOptionalHaikuImagePackage
 			KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31
-			:  $(baseURL)/KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31.zip
+			: $(baseURL)/KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31.zip
 			:
 		;
 		AddSymlinkToHaikuImage home config be Desktop\ Applets
@@ -479,7 +493,7 @@
 	} else {
 		InstallOptionalHaikuImagePackage
 			KeymapSwitcher-1.2.4-r1a1-x86-gcc2-2009-09-06
-			:  $(baseURL)/KeymapSwitcher-1.2.4-r1a1-x86-gcc2-2009-09-06.zip
+			: $(baseURL)/KeymapSwitcher-1.2.4-r1a1-x86-gcc2-2009-09-06.zip
 			:
 		;
 		AddSymlinkToHaikuImage home config be Desktop\ Applets
@@ -493,8 +507,8 @@
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package LibIconv available for $(TARGET_ARCH)&quot; ;
 	} else {
-		InstallOptionalHaikuImagePackage libiconv-1.13.1-r1a1-x86-gcc2-2009-09-07
-			: $(baseURL)/libiconv-1.13.1-r1a1-x86-gcc2-2009-09-07.zip
+		InstallOptionalHaikuImagePackage libiconv-1.13.1-r1a1-x86-gcc2-2009-09-08
+			: $(baseURL)/libiconv-1.13.1-r1a1-x86-gcc2-2009-09-08.zip
 			:
 		;
 	}
@@ -521,9 +535,10 @@
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package LibXML2 available for $(TARGET_ARCH)&quot; ;
 	} else {
-		InstallOptionalHaikuImagePackage libxml2-2.7.3-git-r1a1-x86-gcc2-2009-08-30
-			: $(baseURL)/libxml2-2.7.3-git-r1a1-x86-gcc2-2009-08-30.zip
+		InstallOptionalHaikuImagePackage libxml2-2.7.3-r1a1-x86-gcc2-2009-09-08
+			: $(baseURL)/libxml2-2.7.3-r1a1-x86-gcc2-2009-09-08.zip
 			:
+			: true
 		;
 	}
 }
@@ -554,6 +569,7 @@
 		InstallOptionalHaikuImagePackage mercurial-1.3.1-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/mercurial-1.3.1-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -580,6 +596,7 @@
 		InstallOptionalHaikuImagePackage neon-0.28.6-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/neon-0.28.6-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -704,8 +721,8 @@
 				: $(baseURL)/Pe-2.4.2-x86-gcc4-2009-08-04.zip
 			;
 		} else {
-			InstallOptionalHaikuImagePackage Pe-2.4.2-r593-r1a1-x86-gcc2-2009-09-04
-				: $(baseURL)/Pe-2.4.2-r593-r1a1-x86-gcc2-2009-09-04.zip
+			InstallOptionalHaikuImagePackage Pe-2.4.2-r593-r1a1-x86-gcc2-2009-09-08
+				: $(baseURL)/Pe-2.4.2-r593-r1a1-x86-gcc2-2009-09-08.zip
 			;
 		}
 
@@ -722,9 +739,10 @@
 	if $(TARGET_ARCH) != x86 {
 		Echo &quot;No optional package Perl available for $(TARGET_ARCH)&quot; ;
 	} else {
-		InstallOptionalHaikuImagePackage perl-5.10.0-gcc2-2008-10-29
-			: $(baseURL)/perl-5.10.0-gcc2-2008-10-29.zip
+		InstallOptionalHaikuImagePackage perl-5.10.1-r1a1-x86-gcc2-2009-09-08
+			: $(baseURL)/perl-5.10.1-r1a1-x86-gcc2-2009-09-08.zip
 			:
+			: true
 		;
 	}
 }
@@ -738,6 +756,7 @@
 		InstallOptionalHaikuImagePackage python-2.6.2-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/python-2.6.2-r1a1-x86-gcc2-2009-08-30.zip
 			:
+			: true
 		;
 	}
 }
@@ -763,8 +782,8 @@
 	} else {
 		InstallOptionalHaikuImagePackage sqlite-3.6.17-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/sqlite-3.6.17-r1a1-x86-gcc2-2009-08-30.zip
-
 			:
+			: true
 		;
 	}
 }
@@ -778,6 +797,7 @@
 		InstallOptionalHaikuImagePackage subversion-1.6.5-r1a1-x86-gcc2-2009-09-02
 			: $(baseURL)/subversion-1.6.5-r1a1-x86-gcc2-2009-09-02.zip
 			:
+			: true
 		;
 	}
 }
@@ -952,7 +972,6 @@
 	} else {
 		InstallOptionalHaikuImagePackage yasm-0.8.0-r1a1-x86-gcc2-2009-08-30
 			: $(baseURL)/yasm-0.8.0-r1a1-x86-gcc2-2009-08-30.zip
-
 			:
 		;
 	}

Modified: haiku/branches/components/gallium3d/data/system/boot/Bootscript
===================================================================
--- haiku/branches/components/gallium3d/data/system/boot/Bootscript	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/data/system/boot/Bootscript	2009-09-10 00:10:29 UTC (rev 33028)
@@ -102,9 +102,8 @@
 
 # Now ask the user if he wants to run the Installer or continue to the Desktop.
 if [ &quot;$isReadOnly&quot; = &quot;yes&quot; ]; then
-	# Create Installer links (using the write overlay)
+	# Create Installer link (using the write overlay)
 	ln -sf /boot/system/apps/Installer /boot/home/Desktop/Installer
-	ln -sf /boot/system/apps/Installer /boot/home/config/be/Applications/Installer
 
 	/bin/alert &quot;Do you wish to run the Installer or continue booting to the Desktop?&quot; &quot;Installer&quot; &quot;Desktop&quot;
 	if [ $? -eq 0 ]; then

Modified: haiku/branches/components/gallium3d/data/system/boot/InstallerFinishScript
===================================================================
--- haiku/branches/components/gallium3d/data/system/boot/InstallerFinishScript	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/data/system/boot/InstallerFinishScript	2009-09-10 00:10:29 UTC (rev 33028)
@@ -15,8 +15,7 @@
 
 mkdir -p &quot;$target/var/tmp&quot;
 
-# remove Installer links
-rm -f $target/home/Desktop/Installer
-rm -f $target/home/config/be/Applications/Installer
+# remove Installer link
+rm -f &quot;$target/home/Desktop/Installer&quot;
 
 makebootable &quot;$target&quot;

Modified: haiku/branches/components/gallium3d/headers/private/shared/TrackerAddOnAppLaunch.h
===================================================================
--- haiku/branches/components/gallium3d/headers/private/shared/TrackerAddOnAppLaunch.h	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/headers/private/shared/TrackerAddOnAppLaunch.h	2009-09-10 00:10:29 UTC (rev 33028)
@@ -52,17 +52,18 @@
 	if (get_ref_for_path(image.name, &amp;addonRef) != B_OK)
 		return;
 
-	if (be_roster-&gt;Launch(&amp;addonRef, refs) != B_OK) {
+	status = be_roster-&gt;Launch(&amp;addonRef, refs);
+	if (status == B_OK || status == B_ALREADY_RUNNING)
+		return;
 
-		// If launching by entry_ref fails it's probably futile to
-		// launch by signature this way, but we can try anyway.
+	// If launching by entry_ref fails it's probably futile to
+	// launch by signature this way, but we can try anyway.
 
-		app_info appInfo;
-		if (be_roster-&gt;GetAppInfo(&amp;addonRef, &amp;appInfo) != B_OK)
-			return;
+	app_info appInfo;
+	if (be_roster-&gt;GetAppInfo(&amp;addonRef, &amp;appInfo) != B_OK)
+		return;
 
-		be_roster-&gt;Launch(appInfo.signature, refs);
-	}
+	be_roster-&gt;Launch(appInfo.signature, refs);
 }
 
 

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/bus_managers/ata/ATAChannel.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/bus_managers/ata/ATAChannel.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/bus_managers/ata/ATAChannel.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -577,11 +577,22 @@
 status_t
 ATAChannel::SendRequest(ATARequest *request, uint32 flags)
 {
+	// TODO: implement this:
+	// resetting the device here would discard current configuration,
+	// it's better when the SCSI bus manager requests an external reset.
+
 	TRACE_FUNCTION(&quot;\n&quot;);
 	ATADevice *device = request-&gt;Device();
-	if (device-&gt;Select() != B_OK || WaitForIdle() != B_OK) {
-		// resetting the device here will discard current configuration,
-		// it's better when the SCSI bus manager requests an external reset.
+
+	TRACE(&quot;SendRequest status 0x%02x\n&quot;, AltStatus());
+
+	if (device-&gt;Select() != B_OK) {
+		TRACE_ERROR(&quot;device selection failed\n&quot;);
+		request-&gt;SetStatus(SCSI_SEL_TIMEOUT);
+		return B_TIMED_OUT;
+	}
+
+	if (WaitForIdle() != B_OK) {
 		TRACE_ERROR(&quot;device selection timeout\n&quot;);
 		request-&gt;SetStatus(SCSI_SEL_TIMEOUT);
 		return B_TIMED_OUT;

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/busses/ata/silicon_image_3112/silicon_image_3112.c
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/busses/ata/silicon_image_3112/silicon_image_3112.c	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/busses/ata/silicon_image_3112/silicon_image_3112.c	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1,5 +1,5 @@
 /*
- * Copyright 2006, Marcus Overhagen. All rights reserved.
+ * Copyright 2006-2009, Marcus Overhagen. All rights reserved.
  * Distributed under the terms of the MIT License.
  */
 
@@ -8,9 +8,10 @@
 #include &lt;string.h&gt;
 
 #include &lt;ata_adapter.h&gt;
+#include &lt;tracing.h&gt;
 
-#define TRACE(x...) dprintf(&quot;si-3112: &quot; x)
-//#define FLOW(x...)	dprintf(&quot;si-3112: &quot; x)
+#define TRACE(x...)	do { dprintf(&quot;si-3112: &quot; x); ktrace_printf(&quot;si-3112: &quot; x); } while (0)
+//#define FLOW(x...)	ktrace_printf(&quot;si-3112: &quot; x)
 #define FLOW(x...)
 
 
@@ -24,20 +25,13 @@
 	ASIC_SI3114 = 1,
 };
 
-#if 0
-static const char *adapter_asic_names[] = {
-	&quot;si3112&quot;,
-	&quot;si3114&quot;,
-	NULL
-};
-#endif
-
 static const struct {
 	uint16 channel_count;
 	uint32 mmio_bar_size;
+	const char *asic_name;
 } kASICData[2] = {
-	{ 2, 0x200 },
-	{ 4, 0x400 },
+	{ 2, 0x200, &quot;si3112&quot; },
+	{ 4, 0x400, &quot;si3114&quot; },
 };
 
 static const struct {
@@ -291,9 +285,10 @@
 	sDeviceManager-&gt;get_driver(parent, (driver_module_info **)&amp;pci, (void **)&amp;device);
 	sDeviceManager-&gt;put_node(parent);
 
-	TRACE(&quot;asic %ld\n&quot;, asicIndex);
-	TRACE(&quot;int_num %ld\n&quot;, interruptNumber);
-	TRACE(&quot;mmio_addr %p\n&quot;, (void *)mmioAddr);
+	TRACE(&quot;asic index %ld\n&quot;, asicIndex);
+	TRACE(&quot;asic name %s\n&quot;, kASICData[asicIndex].asic_name);
+	TRACE(&quot;int num %ld\n&quot;, interruptNumber);
+	TRACE(&quot;mmio addr %p\n&quot;, (void *)mmioAddr);
 
 	controller-&gt;pci = pci;
 	controller-&gt;device = device;
@@ -484,8 +479,9 @@
 
 	controller-&gt;channel[channelIndex] = channel;
 
-	// enable interrupts so the channel is ready to run
-	device_control_write(channel, ATA_DEVICE_CONTROL_BIT3);
+	// disable interrupts
+	device_control_write(channel, ATA_DEVICE_CONTROL_BIT3
+		| ATA_DEVICE_CONTROL_DISABLE_INTS);
 
 	*_channelCookie = channel;
 
@@ -505,14 +501,10 @@
 
 	TRACE(&quot;channel_uninit enter\n&quot;);
 
-	// disable IRQs
-	device_control_write(channel, ATA_DEVICE_CONTROL_BIT3 | ATA_DEVICE_CONTROL_DISABLE_INTS);
+	// disable interrupts
+	device_control_write(channel, ATA_DEVICE_CONTROL_BIT3
+		| ATA_DEVICE_CONTROL_DISABLE_INTS);
 
-	// catch spurious interrupt
-	// (some controllers generate an IRQ when you _disable_ interrupts,
-	//  they are delayed by less then 40 &#181;s, so 1 ms is safe)
-	snooze(1000);
-
 	delete_area(channel-&gt;prd_area);
 	free(channel);
 
@@ -793,9 +785,8 @@
 	int32 result;
 	int i;
 
-//	FLOW(&quot;handle_interrupt\n&quot;);
+	FLOW(&quot;handle_interrupt\n&quot;);
 
-
 	result = B_UNHANDLED_INTERRUPT;
 
 	for (i = 0; i &lt; controller-&gt;channel_count; i++) {
@@ -803,15 +794,16 @@
 		if (!channel || channel-&gt;lost)
 			continue;
 
-		// this could be a spurious interrupt, so always read status
-		// register unconditionally to acknowledge those
-		statusATA = *(channel-&gt;command_block + 7);
-
-		if (!channel-&gt;dma_active)
+		if (!channel-&gt;dma_active) {
+			// this could be a spurious interrupt, so read
+			// ata status register to acknowledge
+			*(channel-&gt;command_block + 7);
 			continue;
+		}
 
 		statusBM = *channel-&gt;bm_status_reg;
 		if (statusBM &amp; ATA_BM_STATUS_INTERRUPT) {
+			statusATA = *(channel-&gt;command_block + 7);
 			*channel-&gt;bm_status_reg
 				= (statusBM &amp; 0xf8) | ATA_BM_STATUS_INTERRUPT;
 			sATA-&gt;interrupt_handler(channel-&gt;ataChannel, statusATA);

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_controller.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_controller.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_controller.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1,5 +1,5 @@
 /*
- * Copyright 2007, Marcus Overhagen. All rights reserved.
+ * Copyright 2007-2009, Marcus Overhagen. All rights reserved.
  * Distributed under the terms of the MIT License.
  */
 
@@ -11,7 +11,7 @@
 #include &lt;string.h&gt;
 #include &lt;new&gt;
 
-#define TRACE(a...) dprintf(&quot;\33[34mahci:\33[0m &quot; a)
+#define TRACE(a...) dprintf(&quot;ahci: &quot; a)
 #define FLOW(a...)	dprintf(&quot;ahci: &quot; a)
 
 

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_port.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_port.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_port.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1,5 +1,5 @@
 /*
- * Copyright 2007-2008, Marcus Overhagen. All rights reserved.
+ * Copyright 2007-2009, Marcus Overhagen. All rights reserved.
  * Distributed under the terms of the MIT License.
  */
 
@@ -20,12 +20,12 @@
 
 #define TRACE_AHCI
 #ifdef TRACE_AHCI
-#	define TRACE(a...) dprintf(&quot;\33[34mahci:\33[0m &quot; a)
+#	define TRACE(a...) dprintf(&quot;ahci: &quot; a)
 #else
 #	define TRACE(a...)
 #endif
 //#define FLOW(a...)	dprintf(&quot;ahci: &quot; a)
-//#define RWTRACE(a...) dprintf(&quot;\33[34mahci:\33[0m &quot; a)
+//#define RWTRACE(a...) dprintf(&quot;ahci: &quot; a)
 #define FLOW(a...)
 #define RWTRACE(a...)
 

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_sim.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_sim.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/ahci_sim.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1,5 +1,5 @@
 /*
- * Copyright 2007, Marcus Overhagen. All rights reserved.
+ * Copyright 2007-2009, Marcus Overhagen. All rights reserved.
  * Distributed under the terms of the MIT License.
  */
 
@@ -9,7 +9,7 @@
 #include &lt;string.h&gt;
 #include &lt;new&gt;
 
-#define TRACE(a...) dprintf(&quot;\33[34mahci:\33[0m &quot; a)
+#define TRACE(a...) dprintf(&quot;ahci: &quot; a)
 //#define FLOW(a...)	dprintf(&quot;ahci: &quot; a)
 #define FLOW(a...)
 

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/util.c
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/util.c	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/busses/scsi/ahci/util.c	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1,5 +1,5 @@
 /*
- * Copyright 2004-2007, Marcus Overhagen. All rights reserved.
+ * Copyright 2004-2009, Marcus Overhagen. All rights reserved.
  * Distributed under the terms of the MIT License.
  */
 #include &quot;util.h&quot;
@@ -10,8 +10,8 @@
 #include &lt;string.h&gt;
 
 
-#define TRACE(a...) dprintf(&quot;\33[34mahci:\33[0m &quot; a)
-#define ERROR(a...) dprintf(&quot;\33[34mahci:\33[0m &quot; a)
+#define TRACE(a...) dprintf(&quot;ahci: &quot; a)
+#define ERROR(a...) dprintf(&quot;ahci: &quot; a)
 
 
 static inline uint32

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -45,8 +45,8 @@
 	{B_SR_96000, MAKE_RATE(48000, 2, 1), 96000},
 	{B_SR_176400, MAKE_RATE(44100, 4, 1), 176400},
 	{B_SR_192000, MAKE_RATE(48000, 4, 1), 192000},
-// TODO: What about this one?
-//	{B_SR_384000, MAKE_RATE(44100, ??, ??), 384000},
+	// this one is not supported by hardware.
+	// {B_SR_384000, MAKE_RATE(44100, ??, ??), 384000},
 };
 
 
@@ -114,6 +114,13 @@
 	stream-&gt;frames_count += stream-&gt;buffer_length;
 	stream-&gt;buffer_cycle = position / bufferSize;
 
+	// playback interrupts come early, offsets don't work on non intel
+	// TODO find out why
+	if (stream-&gt;type == STREAM_PLAYBACK
+		&amp;&amp; stream-&gt;controller-&gt;pci_info.vendor_id != INTEL_VENDORID) {
+		stream-&gt;buffer_cycle++;
+	}
+
 	release_spinlock(&amp;stream-&gt;lock);
 
 	release_sem_etc(controller-&gt;buffer_ready_sem, 1, B_DO_NOT_RESCHEDULE);
@@ -548,10 +555,10 @@
 
 	// Stream interrupts seem to arrive too early on most HDA
 	// so we adjust buffer descriptors to take this into account
-	// TODO check on other vendors, uncomment last line in stream_handle_interrupt()
+	// TODO check on other vendors, see in stream_handle_interrupt()
 	// Tested only on Intel ICH8
 	uint32 offset = 0;
-	if (stream-&gt;type == STREAM_PLAYBACK) {
+	if (stream-&gt;type == STREAM_PLAYBACK &amp;&amp; stream-&gt;controller-&gt;pci_info.vendor_id == INTEL_VENDORID) {
 		if (stream-&gt;sample_size == 2)
 			offset = 6;
 		else if (stream-&gt;sample_size &gt; 2)

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/bfs/kernel_interface.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1576,7 +1576,7 @@
 	// we don't ask here for directories only, because the bfs_open_index_dir()
 	// function utilizes us (so we must be able to open indices as well)
 	if (!inode-&gt;IsContainer())
-		RETURN_ERROR(B_BAD_VALUE);
+		RETURN_ERROR(B_NOT_A_DIRECTORY);
 
 	BPlusTree* tree = inode-&gt;Tree();
 	if (tree == NULL)

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/cdda/kernel_interface.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/cdda/kernel_interface.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/cdda/kernel_interface.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1785,7 +1785,7 @@
 
 	Inode* inode = (Inode*)_node-&gt;private_node;
 	if (!S_ISDIR(inode-&gt;Type()))
-		return B_BAD_VALUE;
+		return B_NOT_A_DIRECTORY;
 
 	if (inode != &amp;volume-&gt;RootNode())
 		panic(&quot;pipefs: found directory that's not the root!&quot;);

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ext2/kernel_interface.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ext2/kernel_interface.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ext2/kernel_interface.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -437,7 +437,7 @@
 		return status;
 
 	if (!inode-&gt;IsDirectory())
-		return B_BAD_VALUE;
+		return B_NOT_A_DIRECTORY;
 
 	DirectoryIterator* iterator = new(std::nothrow) DirectoryIterator(inode);
 	if (iterator == NULL)

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/ramfs/kernel_interface.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1180,14 +1180,14 @@
 	Node *node = (Node*)_node;
 FUNCTION((&quot;dir: (%Lu)\n&quot;, node-&gt;GetID()));
 	// get the Directory
-	status_t error = (node-&gt;IsDirectory() ? B_OK : B_BAD_VALUE);
+	status_t error = (node-&gt;IsDirectory() ? B_OK : B_NOT_A_DIRECTORY);
 	Directory *dir = NULL;
 	if (error == B_OK) {
 		dir = dynamic_cast&lt;Directory*&gt;(node);
 		if (!dir) {
 			FATAL((&quot;Node %Ld pretends to be a Directory, but isn't!\n&quot;,
 				   node-&gt;GetID()));
-			error = B_BAD_VALUE;
+			error = B_NOT_A_DIRECTORY;
 		}
 	}
 	// create a DirectoryCookie

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/reiserfs/kernel_interface.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/reiserfs/kernel_interface.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/reiserfs/kernel_interface.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -510,7 +510,7 @@
 	VNode *node = (VNode*)_node-&gt;private_node;
 FUNCTION((&quot;node: (%Ld: %lu, %lu)\n&quot;, node-&gt;GetID(), node-&gt;GetDirID(),
 		  node-&gt;GetObjectID()));
-	status_t error = (node-&gt;IsDir() ? B_OK : B_BAD_VALUE);
+	status_t error = (node-&gt;IsDir() ? B_OK : B_NOT_A_DIRECTORY);
 	if (error == B_OK) {
 		DirectoryCookie *iterator = new(nothrow) DirectoryCookie(
 			volume-&gt;GetTree(), node-&gt;GetDirID(), node-&gt;GetObjectID());

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/udf/kernel_interface.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/udf/kernel_interface.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/file_systems/udf/kernel_interface.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -310,7 +310,7 @@
 	if (!dir-&gt;IsDirectory()) {
 		TRACE_ERROR((&quot;udf_open_dir: given Icb is not a directory (type: %d)\n&quot;,
 			dir-&gt;Type()));
-		return B_BAD_VALUE;
+		return B_NOT_A_DIRECTORY;
 	}
 
 	DirectoryIterator *iterator = NULL;

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/generic/ata_adapter/ata_adapter.c
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/generic/ata_adapter/ata_adapter.c	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/generic/ata_adapter/ata_adapter.c	2009-09-10 00:10:29 UTC (rev 33028)
@@ -23,6 +23,15 @@
 
 #define TRACE dprintf
 
+#define INTERRUPT_TRACING 0
+#if INTERRUPT_TRACING 
+	#include &lt;tracing.h&gt;
+	#define TRACE_INT(a...) 	ktrace_printf(a)
+#else
+	#define TRACE_INT(a...)
+#endif
+
+
 static ata_for_controller_interface *sATA;
 static device_manager_info *sDeviceManager;
 
@@ -184,9 +193,12 @@
 	pci_device *device = channel-&gt;device;
 	uint8 statusATA, statusBM;
 
+	TRACE_INT(&quot;ata_adapter_inthand\n&quot;);
+
 	if (!channel-&gt;dmaing) {
 		// this could be a spurious interrupt, so read status
 		// register unconditionally to acknowledge those
+		TRACE_INT(&quot;ata_adapter_inthand: not DMA\n&quot;);
 		pci-&gt;read_io_8(device, channel-&gt;command_block_base + 7);
 		return B_UNHANDLED_INTERRUPT;
 	}
@@ -195,11 +207,13 @@
 	// will clear the interrupt status bit once ATA status is read
 	statusBM = pci-&gt;read_io_8(device, channel-&gt;bus_master_base
 		+ ATA_BM_STATUS_REG);
+	TRACE_INT(&quot;ata_adapter_inthand: BM-status 0x%02x\n&quot;, statusBM);
 
 	// test if the interrupt was really generated by our controller
 	if (statusBM &amp; ATA_BM_STATUS_INTERRUPT) {
 		// read ATA status register to acknowledge interrupt
 		statusATA = pci-&gt;read_io_8(device, channel-&gt;command_block_base + 7);
+		TRACE_INT(&quot;ata_adapter_inthand: ATA-status 0x%02x\n&quot;, statusATA);
 
 		// clear pending PCI bus master DMA interrupt, for those 
 		// controllers who don't clear it themselves
@@ -209,6 +223,7 @@
 		// signal interrupt to ATA stack
 		return sATA-&gt;interrupt_handler(channel-&gt;ataChannel, statusATA);
 	} else {
+		TRACE_INT(&quot;ata_adapter_inthand: not BM\n&quot;);
 		return B_UNHANDLED_INTERRUPT;
 	}
 }

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/Disc.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/Disc.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/Disc.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -223,7 +223,7 @@
 		TRACE((&quot;  pminutes = %d\n&quot;, entries[i].pminutes));
 		TRACE((&quot;  pseconds = %d\n&quot;, entries[i].pseconds));
 		TRACE((&quot;  pframes  = %d\n&quot;, entries[i].pframes));
-		TRACE((&quot;  lba      = %ld\n&quot;,
+		TRACE((&quot;  lba      = %lld\n&quot;,
 			msf_to_lba(make_msf_address(entries[i].pminutes,
 			entries[i].pseconds, entries[i].pframes))));
 	}
@@ -635,6 +635,13 @@
 					PRINT((&quot;found session #%ld info (data session)\n&quot;, index));
 
 					off_t startLBA = track-&gt;start_lba;
+					if (startLBA &lt; 0) {
+						WARN((&quot;%s: warning: invalid negative start LBA of %lld&quot;
+							&quot; for data track assuming 0\n&quot;, kModuleDebugName,
+							startLBA));
+						startLBA = 0;
+					}
+
 					off_t endLBA = track-&gt;next
 						? ((struct track*)track-&gt;next)-&gt;start_lba
 						: session-&gt;end_lba;

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/scsi-mmc.h
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/scsi-mmc.h	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/partitioning_systems/session/scsi-mmc.h	2009-09-10 00:10:29 UTC (rev 33028)
@@ -107,7 +107,7 @@
 */
 static
 inline
-uint32
+off_t
 msf_to_lba(msf_address msf)
 {
 	return (CDROM_FRAMES_PER_MINUTE * msf.minutes)

Modified: haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -358,6 +358,7 @@
 
         #ifdef USE_SSL
 		use_ssl = (fSettings-&gt;FindInt32(&quot;flavor&quot;) == 1);
+		use_STARTTLS = (fSettings-&gt;FindInt32(&quot;flavor&quot;) == 2);
 		ssl = NULL;
 		ctx = NULL;
 	#endif
@@ -458,8 +459,57 @@
 		return B_ERROR;
 	}
 
+	
+	
+	#ifdef USE_SSL
+	// Check for STARTTLS
+	if(use_STARTTLS)
+	{
+		const char *res = fLog.String();
+		char *p;
+		
+		SSL_library_init();
+		RAND_seed(this,sizeof(SMTPProtocol));
+		::sprintf(cmd, &quot;STARTTLS&quot;CRLF);
+		
+		if ((p = ::strstr(res, &quot;STARTTLS&quot;)) != NULL)
+		{
+			// Server advertises STARTTLS support
+			if(SendCommand(cmd) != B_OK)
+			{
+				delete[] cmd;
+				return B_ERROR;
+			}
+			
+			// We should start TLS negotiation
+			use_ssl = true;
+			ctx = SSL_CTX_new(TLSv1_method());
+    		ssl = SSL_new(ctx);
+    		sbio = BIO_new_socket(_fd,BIO_NOCLOSE);
+    		BIO_set_nbio(sbio, 0);
+    		SSL_set_bio(ssl, sbio, sbio);
+    		SSL_set_connect_state(ssl);
+    		if(SSL_do_handshake(ssl) != 1)
+    			return B_ERROR;
+    		
+    		// Should send EHLO command again
+    		if(!esmtp)
+    			::sprintf(cmd, &quot;HELO %s&quot;CRLF, localhost);
+    		else
+    			::sprintf(cmd, &quot;EHLO %s&quot;CRLF, localhost);
+    			
+    		if(SendCommand(cmd) != B_OK)
+    		{
+    			delete[] cmd;
+    			return B_ERROR;
+    		}
+		}
+
+	}
+	#endif
+	
 	delete[] cmd;
-
+	
 	// Check auth type
 	if (esmtp) {
 		const char *res = fLog.String();
@@ -1055,6 +1105,7 @@
 																B_MAIL_PROTOCOL_HAS_FLAVORS);
 	view-&gt;AddFlavor(&quot;Unencrypted&quot;);
 	view-&gt;AddFlavor(&quot;SSL&quot;);
+	view-&gt;AddFlavor(&quot;STARTTLS&quot;);
 	#else
 	BMailProtocolConfigView *view = new BMailProtocolConfigView(B_MAIL_PROTOCOL_HAS_AUTH_METHODS |
 																B_MAIL_PROTOCOL_HAS_USERNAME |

Modified: haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.h
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.h	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/mail_daemon/outbound_protocols/smtp/smtp.h	2009-09-10 00:10:29 UTC (rev 33028)
@@ -51,6 +51,7 @@
 		BIO *sbio;
 
 		bool use_ssl;
+		bool use_STARTTLS;
 #endif
 
 		status_t fStatus;

Modified: haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/Jamfile
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/Jamfile	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/Jamfile	2009-09-10 00:10:29 UTC (rev 33028)
@@ -1,5 +1,7 @@
 SubDir HAIKU_TOP src add-ons tracker zipomatic ;
 
+UsePrivateHeaders shared ;
+
 Application ZipOMatic-Z : 
 	GenericThread.cpp
 	ZipOMatic.cpp

Modified: haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/ZipOMatic.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/ZipOMatic.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/add-ons/tracker/zipomatic/ZipOMatic.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -7,27 +7,12 @@
 #include &lt;Alert.h&gt;
 #include &lt;Roster.h&gt;
 #include &lt;Screen.h&gt;
-#include &lt;TrackerAddOn.h&gt;
+#include &lt;TrackerAddOnAppLaunch.h&gt;
 
 #include &quot;ZipOMaticMisc.h&quot;
 #include &quot;ZipOMaticWindow.h&quot;
 
 
-extern &quot;C&quot; void 
-process_refs(entry_ref dirRef, BMessage* message, void*)
-{
-	status_t status = B_OK;
-	type_code refType = B_REF_TYPE;
-	int32 refCount = 0;
-	
-	status = message-&gt;GetInfo(&quot;refs&quot;, &amp;refType, &amp;refCount);
-	if (status != B_OK || refCount &lt; 1)
-		be_roster-&gt;Launch(ZIPOMATIC_APP_SIG);
-	else
-		be_roster-&gt;Launch(ZIPOMATIC_APP_SIG, message);
-}
-
-
 int
 main()
 {
@@ -65,6 +50,15 @@
 void 
 ZipOMatic::RefsReceived(BMessage* message)
 {
+	message-&gt;RemoveName(&quot;dir_ref&quot;);
+
+	entry_ref ref;
+	if (message-&gt;FindRef(&quot;refs&quot;, &amp;ref) != B_OK) {
+		if (!IsLaunching())
+			PostMessage(B_SILENT_RELAUNCH);
+		return;
+	}
+
 	if (IsLaunching())
 		fGotRefs = true;
 	

Modified: haiku/branches/components/gallium3d/src/apps/installer/UnzipEngine.cpp
===================================================================
--- haiku/branches/components/gallium3d/src/apps/installer/UnzipEngine.cpp	2009-09-09 15:08:28 UTC (rev 33027)
+++ haiku/branches/components/gallium3d/src/apps/installer/UnzipEngine.cpp	2009-09-10 00:10:29 UTC (rev 33028)
@@ -7,17 +7,15 @@
 
 #include &lt;new&gt;
 
-#include &lt;math.h&gt;
 #include &lt;stdio.h&gt;
 #include &lt;string.h&gt;
-#include &lt;sys/resource.h&gt;
 
 #include &lt;Directory.h&gt;
-#include &lt;fs_attr.h&gt;
-#include &lt;NodeInfo.h&gt;
+#include &lt;Entry.h&gt;
+#include &lt;File.h&gt;
+#include &lt;Node.h&gt;
 #include &lt;Path.h&gt;
 #include &lt;String.h&gt;
-#include &lt;SymLink.h&gt;
 
 #include &quot;CommandPipe.h&quot;
 #include &quot;SemaphoreLocker.h&quot;
@@ -108,12 +106,11 @@
 		ret = commandPipe.AddArg(&quot;-d&quot;);
 	if (ret == B_OK)
 		ret = commandPipe.AddArg(fDestinationFolder.String());
-	if (ret == B_OK)
-		ret = commandPipe.AddArg(&quot;-x&quot;);
-	if (ret == B_OK)
-		ret = commandPipe.AddArg(&quot;.OptionalPackageDescription&quot;);
-	if (ret != B_OK)
+	if (ret != B_OK) {
+		fprintf(stderr, &quot;Faild to construct argument list for unzip &quot;
+			&quot;process: %s\n&quot;, strerror(ret));
 		return ret;
+	}
 
 	// Launch the unzip thread and start reading the stdout and stderr output.

[... truncated: 148 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020504.html">[Haiku-commits] r33027 - in	haiku/branches/releases/r1alpha1/src/add-ons/kernel:	bus_managers/ata busses/ata/silicon_image_3112	busses/scsi/ahci generic/ata_adapter
</A></li>
	<LI>Next message: <A HREF="020507.html">[Haiku-commits] r33029 - in haiku/branches/components/gallium3d: headers/os/opengl/GL src/add-ons/opengl/softpipe src/add-ons/opengl/trace src/kits/opengl src/kits/opengl/mesa src/kits/opengl/mesa/drivers/common src/kits/opengl/mesa/gallium/auxiliary/cso_cache src/kits/opengl/mesa/gallium/auxiliary/draw src/kits/opengl/mesa/gallium/auxiliary/gallivm src/kits/opengl/mesa/gallium/auxiliary/indices src/kits/opengl/mesa/gallium/auxiliary/pipebuffer src/kits/opengl/mesa/gallium/auxiliary/rtasm src/kits/opengl/mesa/gallium/auxiliary/tgsi src/kits/opengl/mesa/gallium/auxiliary/util src/kits/opengl/mesa/gallium/include/pipe src/kits/opengl/mesa/gallium/include/pipe/internal src/kits/opengl/mesa/gallium/include/state_tracker src/kits/opengl/mesa/glapi src/kits/opengl/mesa/main src/kits/opengl/mesa/math src/kits/opengl/mesa/shader src/kits/opengl/mesa/shader/slang src/kits/opengl/mesa/sparc src/kits/opengl/mesa/state_tracker src/kits/opengl/mesa/swrast src/kits/opengl/mesa/tnl src/kits/openg! l/mesa/vbo src/kits/opengl/mesa/vf src/kits/opengl/mesa/x86 src/kits/opengl/mesa/x86-64
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20506">[ date ]</a>
              <a href="thread.html#20506">[ thread ]</a>
              <a href="subject.html#20506">[ subject ]</a>
              <a href="author.html#20506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
