<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r33099 - in haiku/branches/components/gallium3d:	headers/private headers/private/drm src/add-ons/kernel	src/add-ons/kernel/drivers src/add-ons/kernel/drivers/drm	src/add-ons/kernel/drivers/drm/test src/add-ons/kernel/drm
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r33099%20-%20in%20haiku/branches/components/gallium3d%3A%0A%09headers/private%20headers/private/drm%20src/add-ons/kernel%0A%09src/add-ons/kernel/drivers%20src/add-ons/kernel/drivers/drm%0A%09src/add-ons/kernel/drivers/drm/test%20src/add-ons/kernel/drm&In-Reply-To=%3C200909121546.n8CFkg0K003764%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020591.html">
   <LINK REL="Next"  HREF="020593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r33099 - in haiku/branches/components/gallium3d:	headers/private headers/private/drm src/add-ons/kernel	src/add-ons/kernel/drivers src/add-ons/kernel/drivers/drm	src/add-ons/kernel/drivers/drm/test src/add-ons/kernel/drm</H1>
    <B>aljen at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r33099%20-%20in%20haiku/branches/components/gallium3d%3A%0A%09headers/private%20headers/private/drm%20src/add-ons/kernel%0A%09src/add-ons/kernel/drivers%20src/add-ons/kernel/drivers/drm%0A%09src/add-ons/kernel/drivers/drm/test%20src/add-ons/kernel/drm&In-Reply-To=%3C200909121546.n8CFkg0K003764%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r33099 - in haiku/branches/components/gallium3d:	headers/private headers/private/drm src/add-ons/kernel	src/add-ons/kernel/drivers src/add-ons/kernel/drivers/drm	src/add-ons/kernel/drivers/drm/test src/add-ons/kernel/drm">aljen at mail.berlios.de
       </A><BR>
    <I>Sat Sep 12 17:46:42 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="020591.html">[Haiku-commits] r33098 - in	haiku/branches/components/gallium3d/src: add-ons/opengl/i915	add-ons/opengl/softpipe kits/opengl kits/opengl/gallium	kits/opengl/gallium/drivers/i915simple	kits/opengl/gallium/drivers/softpipe	kits/opengl/gallium/state_trackers/dri kits/opengl/glu	kits/opengl/glut kits/opengl/mesa	kits/opengl/mesa/drivers/dri/common
</A></li>
        <LI>Next message: <A HREF="020593.html">[Haiku-commits] r33100 - in	haiku/branches/components/gallium3d/src/kits/opengl/gallium:	. auxiliary auxiliary/rbug drivers drivers/failover	drivers/i915simple drivers/softpipe drivers/trace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20592">[ date ]</a>
              <a href="thread.html#20592">[ thread ]</a>
              <a href="subject.html#20592">[ subject ]</a>
              <a href="author.html#20592">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aljen
Date: 2009-09-12 17:46:37 +0200 (Sat, 12 Sep 2009)
New Revision: 33099
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=33099&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=33099&amp;view=rev</A>

Added:
   haiku/branches/components/gallium3d/headers/private/drm/
   haiku/branches/components/gallium3d/headers/private/drm/drm_module.h
   haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/
   haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/Jamfile
   haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/
   haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/Jamfile
   haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/drm_test.c
   haiku/branches/components/gallium3d/src/add-ons/kernel/drm/
   haiku/branches/components/gallium3d/src/add-ons/kernel/drm/Jamfile
   haiku/branches/components/gallium3d/src/add-ons/kernel/drm/drm_module.c
Modified:
   haiku/branches/components/gallium3d/src/add-ons/kernel/Jamfile
   haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/Jamfile
Log:
Added empty kernel drm code

Added: haiku/branches/components/gallium3d/headers/private/drm/drm_module.h
===================================================================
--- haiku/branches/components/gallium3d/headers/private/drm/drm_module.h	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/headers/private/drm/drm_module.h	2009-09-12 15:46:37 UTC (rev 33099)
@@ -0,0 +1,12 @@
+#ifndef __DRM_MODULE_H__
+#define __DRM_MODULE_H__
+
+#include &lt;module.h&gt;
+
+#define DRM_MODULE_NAME	&quot;drm/drm&quot;
+
+typedef struct {
+	module_info info;
+} drm_module_info;
+
+#endif // __DRM_MODULE_H__

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/Jamfile
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/Jamfile	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/Jamfile	2009-09-12 15:46:37 UTC (rev 33099)
@@ -5,6 +5,7 @@
 SubInclude HAIKU_TOP src add-ons kernel console ;
 SubInclude HAIKU_TOP src add-ons kernel cpu ;
 SubInclude HAIKU_TOP src add-ons kernel debugger ;
+SubInclude HAIKU_TOP src add-ons kernel drm ;
 SubInclude HAIKU_TOP src add-ons kernel drivers ;
 SubInclude HAIKU_TOP src add-ons kernel file_cache ;
 SubInclude HAIKU_TOP src add-ons kernel file_systems ;

Modified: haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/Jamfile
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/Jamfile	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/Jamfile	2009-09-12 15:46:37 UTC (rev 33099)
@@ -5,6 +5,7 @@
 SubInclude HAIKU_TOP src add-ons kernel drivers bus ;
 SubInclude HAIKU_TOP src add-ons kernel drivers audio ;
 SubInclude HAIKU_TOP src add-ons kernel drivers common ;
+SubInclude HAIKU_TOP src add-ons kernel drivers drm ;
 SubInclude HAIKU_TOP src add-ons kernel drivers disk ;
 SubInclude HAIKU_TOP src add-ons kernel drivers dvb ;
 SubInclude HAIKU_TOP src add-ons kernel drivers input ;

Added: haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/Jamfile
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/Jamfile	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/Jamfile	2009-09-12 15:46:37 UTC (rev 33099)
@@ -0,0 +1,3 @@
+SubDir HAIKU_TOP src add-ons kernel drivers drm ; 
+
+SubInclude HAIKU_TOP src add-ons kernel drivers drm test ;

Added: haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/Jamfile
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/Jamfile	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/Jamfile	2009-09-12 15:46:37 UTC (rev 33099)
@@ -0,0 +1,7 @@
+SubDir HAIKU_TOP src add-ons kernel drivers drm test ;
+
+UsePrivateHeaders kernel drm ;
+
+KernelAddon drm_test :
+	drm_test.c
+	;

Added: haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/drm_test.c
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/drm_test.c	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/drivers/drm/test/drm_test.c	2009-09-12 15:46:37 UTC (rev 33099)
@@ -0,0 +1,134 @@
+#include &lt;Drivers.h&gt;
+#include &lt;KernelExport.h&gt;
+
+#include &lt;drm_module.h&gt;
+#include &lt;lock.h&gt;
+
+#include &lt;string.h&gt;
+#include &lt;stdio.h&gt;
+
+#define DEVICE_NAME &quot;drm/0&quot;
+
+int32 api_version = B_CUR_DRIVER_API_VERSION;
+static mutex gLock;
+drm_module_info* gDrmModule;
+
+static status_t
+drm_test_open(const char* name, uint32 flags, void** cookie)
+{
+	dprintf(&quot;drm_test: drm_test_open\n&quot;);
+	*cookie = NULL;
+	return B_OK;
+}
+
+
+static status_t
+drm_test_close(void* cookie)
+{
+	dprintf(&quot;drm_test: drm_test_close\n&quot;);
+	return B_OK;
+}
+
+
+static status_t
+drm_test_freecookie(void* cookie)
+{
+	dprintf(&quot;drm_test: drm_test_freecookie\n&quot;);
+	return B_OK;
+}
+
+
+static status_t
+drm_test_ioctl(void* cookie, uint32 op, void* buffer, size_t length)
+{
+	dprintf(&quot;drm_test: drm_test_ioctl op: %ld buf: %p, len: %ld\n&quot;, op,
+		buffer, length);
+	return EPERM;
+}
+
+
+static status_t
+drm_test_read(void* cookie, off_t pos, void* buffer, size_t* length)
+{
+	dprintf(&quot;drm_test: drm_test_read gDrmModule: %p len: %ld\n&quot;,
+		gDrmModule, *length);
+	*length = 0;
+	return B_NOT_ALLOWED;
+}
+
+
+static status_t
+drm_test_write(void* cookie, off_t pos, const void* buffer, size_t *length)
+{
+	dprintf(&quot;drm_test: drm_test_write\n&quot;);
+	*length = 0;
+	return B_NOT_ALLOWED;
+}
+
+
+status_t
+init_hardware()
+{
+	dprintf(&quot;drm_test: init_hardware\n&quot;);
+	return B_OK;
+}
+
+
+const char**
+publish_devices(void)
+{
+	dprintf(&quot;drm_test: publish_devices\n&quot;);
+	static const char* devices[] = {
+		DEVICE_NAME,
+		NULL
+	};
+	return devices;
+}
+
+
+device_hooks*
+find_device(const char* name)
+{
+	dprintf(&quot;drm_test: find_device name: %s\n&quot;, name);
+	static device_hooks hooks = {
+		&amp;drm_test_open,
+		&amp;drm_test_close,
+		&amp;drm_test_freecookie,
+		&amp;drm_test_ioctl,
+		&amp;drm_test_read,
+		&amp;drm_test_write,
+		NULL,
+		NULL,
+		NULL,
+		NULL
+	};
+	
+	if (!strcmp(name, DEVICE_NAME))
+		return &hooks;
+	
+	return NULL;
+}
+
+
+status_t
+init_driver(void)
+{
+	dprintf(&quot;drm_test: init_driver\n&quot;);
+	if (get_module(DRM_MODULE_NAME, (module_info**)&amp;gDrmModule) &lt; B_OK) {
+		dprintf(&quot;drm_test: cannot get module \&quot;%s\&quot;\n&quot;, DRM_MODULE_NAME);
+		return B_ERROR;
+	}
+
+	dprintf(&quot;drm_test: \&quot;%s\&quot; module at %p\n&quot;, DRM_MODULE_NAME,
+		gDrmModule);
+
+	return B_OK;	
+}
+
+
+void
+uninit_driver(void)
+{
+	dprintf(&quot;drm_test: uninit_driver\n&quot;);
+	put_module(DRM_MODULE_NAME);
+}

Added: haiku/branches/components/gallium3d/src/add-ons/kernel/drm/Jamfile
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/drm/Jamfile	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/drm/Jamfile	2009-09-12 15:46:37 UTC (rev 33099)
@@ -0,0 +1,8 @@
+SubDir HAIKU_TOP src add-ons kernel drm ;
+
+UsePrivateKernelHeaders ;
+UsePrivateHeaders kernel drm ;
+
+KernelAddon drm :
+	drm_module.c
+	;

Added: haiku/branches/components/gallium3d/src/add-ons/kernel/drm/drm_module.c
===================================================================
--- haiku/branches/components/gallium3d/src/add-ons/kernel/drm/drm_module.c	2009-09-12 15:37:38 UTC (rev 33098)
+++ haiku/branches/components/gallium3d/src/add-ons/kernel/drm/drm_module.c	2009-09-12 15:46:37 UTC (rev 33099)
@@ -0,0 +1,63 @@
+#include &lt;KernelExport.h&gt;
+#include &lt;Drivers.h&gt;
+
+#include &lt;string.h&gt;
+
+#include &lt;drm_module.h&gt;
+#include &lt;lock.h&gt;
+
+
+#define TRACE_DRM_MODULE
+#ifdef TRACE_DRM_MODULE
+#	define TRACE(x...) dprintf(x)
+#else
+#	define TRACE(x...)
+#endif
+
+
+static status_t
+drm_module_init()
+{
+	TRACE(&quot;drm: drm_module_init\n&quot;);
+	return B_OK;	
+}
+
+
+static status_t
+drm_module_uninit()
+{
+	TRACE(&quot;drm: drm_module_uninit\n&quot;);
+	return B_OK;
+}
+
+
+static status_t
+drm_std_ops(int32 op, ...)
+{
+	TRACE(&quot;drm: drm_std_ops(0x%lx)\n&quot;, op);
+	switch (op) {
+		case B_MODULE_INIT:
+			return drm_module_init();
+		case B_MODULE_UNINIT:
+			return drm_module_uninit();
+		default:
+			return B_ERROR;
+	}
+	return B_OK;
+}
+
+
+static drm_module_info sDrmModule = {
+	// module info
+	{
+		DRM_MODULE_NAME,
+		0,
+		drm_std_ops
+	}
+};
+
+
+module_info *modules[] = {
+		(module_info *)&amp;sDrmModule,
+		NULL
+};


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020591.html">[Haiku-commits] r33098 - in	haiku/branches/components/gallium3d/src: add-ons/opengl/i915	add-ons/opengl/softpipe kits/opengl kits/opengl/gallium	kits/opengl/gallium/drivers/i915simple	kits/opengl/gallium/drivers/softpipe	kits/opengl/gallium/state_trackers/dri kits/opengl/glu	kits/opengl/glut kits/opengl/mesa	kits/opengl/mesa/drivers/dri/common
</A></li>
	<LI>Next message: <A HREF="020593.html">[Haiku-commits] r33100 - in	haiku/branches/components/gallium3d/src/kits/opengl/gallium:	. auxiliary auxiliary/rbug drivers drivers/failover	drivers/i915simple drivers/softpipe drivers/trace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20592">[ date ]</a>
              <a href="thread.html#20592">[ thread ]</a>
              <a href="subject.html#20592">[ subject ]</a>
              <a href="author.html#20592">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
