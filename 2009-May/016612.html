<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r30700 - in haiku/trunk: headers/os/drivers/bus	headers/private/drivers src/add-ons/kernel/busses/ata	src/add-ons/kernel/busses/ata/generic_ide_pci	src/add-ons/kernel/busses/ata/ide_isa	src/add-ons/kernel/busses/ata/it8211	src/add-ons/kernel/busses/ata/legacy_sata	src/add-ons/kernel/busses/ata/promise_tx2	src/add-ons/kernel/busses/ata/silicon_image_3112	src/add-ons/kernel/generic/ata_adapter
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30700%20-%20in%20haiku/trunk%3A%20headers/os/drivers/bus%0A%09headers/private/drivers%20src/add-ons/kernel/busses/ata%0A%09src/add-ons/kernel/busses/ata/generic_ide_pci%0A%09src/add-ons/kernel/busses/ata/ide_isa%0A%09src/add-ons/kernel/busses/ata/it8211%0A%09src/add-ons/kernel/busses/ata/legacy_sata%0A%09src/add-ons/kernel/busses/ata/promise_tx2%0A%09src/add-ons/kernel/busses/ata/silicon_image_3112%0A%09src/add-ons/kernel/generic/ata_adapter&In-Reply-To=%3C200905101704.n4AH48oK012239%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016679.html">
   <LINK REL="Next"  HREF="016614.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r30700 - in haiku/trunk: headers/os/drivers/bus	headers/private/drivers src/add-ons/kernel/busses/ata	src/add-ons/kernel/busses/ata/generic_ide_pci	src/add-ons/kernel/busses/ata/ide_isa	src/add-ons/kernel/busses/ata/it8211	src/add-ons/kernel/busses/ata/legacy_sata	src/add-ons/kernel/busses/ata/promise_tx2	src/add-ons/kernel/busses/ata/silicon_image_3112	src/add-ons/kernel/generic/ata_adapter</H1>
    <B>stippi at BerliOS</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30700%20-%20in%20haiku/trunk%3A%20headers/os/drivers/bus%0A%09headers/private/drivers%20src/add-ons/kernel/busses/ata%0A%09src/add-ons/kernel/busses/ata/generic_ide_pci%0A%09src/add-ons/kernel/busses/ata/ide_isa%0A%09src/add-ons/kernel/busses/ata/it8211%0A%09src/add-ons/kernel/busses/ata/legacy_sata%0A%09src/add-ons/kernel/busses/ata/promise_tx2%0A%09src/add-ons/kernel/busses/ata/silicon_image_3112%0A%09src/add-ons/kernel/generic/ata_adapter&In-Reply-To=%3C200905101704.n4AH48oK012239%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r30700 - in haiku/trunk: headers/os/drivers/bus	headers/private/drivers src/add-ons/kernel/busses/ata	src/add-ons/kernel/busses/ata/generic_ide_pci	src/add-ons/kernel/busses/ata/ide_isa	src/add-ons/kernel/busses/ata/it8211	src/add-ons/kernel/busses/ata/legacy_sata	src/add-ons/kernel/busses/ata/promise_tx2	src/add-ons/kernel/busses/ata/silicon_image_3112	src/add-ons/kernel/generic/ata_adapter">stippi at mail.berlios.de
       </A><BR>
    <I>Sun May 10 19:04:08 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="016679.html">[Haiku-commits] r30699 - haiku/trunk/src/preferences/keymap
</A></li>
        <LI>Next message: <A HREF="016614.html">[Haiku-commits] r30701 - haiku/trunk/src/apps/stylededit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16612">[ date ]</a>
              <a href="thread.html#16612">[ thread ]</a>
              <a href="subject.html#16612">[ subject ]</a>
              <a href="author.html#16612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: stippi
Date: 2009-05-10 19:04:04 +0200 (Sun, 10 May 2009)
New Revision: 30700
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=30700&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=30700&amp;view=rev</A>

Added:
   haiku/trunk/headers/private/drivers/ata_adapter.h
Modified:
   haiku/trunk/headers/os/drivers/bus/ATA.h
   haiku/trunk/src/add-ons/kernel/busses/ata/Jamfile
   haiku/trunk/src/add-ons/kernel/busses/ata/generic_ide_pci/generic_ide_pci.c
   haiku/trunk/src/add-ons/kernel/busses/ata/ide_isa/ide_isa.c
   haiku/trunk/src/add-ons/kernel/busses/ata/it8211/it8211.c
   haiku/trunk/src/add-ons/kernel/busses/ata/legacy_sata/legacy_sata.c
   haiku/trunk/src/add-ons/kernel/busses/ata/promise_tx2/promise_tx2.c
   haiku/trunk/src/add-ons/kernel/busses/ata/silicon_image_3112/silicon_image_3112.c
   haiku/trunk/src/add-ons/kernel/generic/ata_adapter/ata_adapter.c
Log:
I am trying to help a bit with the transition from IDE to ATA stack.
* Copied ide_adapter.h as ata_adapter.h in attempt to further
  separate the two stacks.
* Continued renaming stuff in drivers/bus/ATA.h
* Make all the busses/ata drivers include the new headers,
  specifically ata_types.h, ata_adapter.h and bus/ATA.h,
  they were all including ide_types and bus/IDE.h still
* Some renaming of global variables for coding style consistency
* Removed the promise driver from the build, it's not used on the
  image and I don't believe it compiled even for the old IDE stack.
* There is no more Command Queueing in the new ATA stack, so I
  removed the capability indication from the busses/ata drivers
  and ata_adapter.h.

The new ATA stack still boots fine on my computer and I proof-read
the diff like two times. Basically, this was a careful search&amp;replace
job only. The only things I am not sure about is renaming some
publishing related strings, but it seems to all work fine.


Modified: haiku/trunk/headers/os/drivers/bus/ATA.h
===================================================================
--- haiku/trunk/headers/os/drivers/bus/ATA.h	2009-05-10 13:47:54 UTC (rev 30699)
+++ haiku/trunk/headers/os/drivers/bus/ATA.h	2009-05-10 17:04:04 UTC (rev 30700)
@@ -25,7 +25,7 @@
 typedef unsigned int ata_reg_mask;
 
 // channel cookie, issued by ata bus manager
-typedef void *ata_channel;
+typedef void* ata_channel;
 
 // interface of controller driver
 typedef struct {

Copied: haiku/trunk/headers/private/drivers/ata_adapter.h (from rev 30689, haiku/trunk/headers/private/drivers/ide_adapter.h)
===================================================================
--- haiku/trunk/headers/private/drivers/ide_adapter.h	2009-05-10 04:04:06 UTC (rev 30689)
+++ haiku/trunk/headers/private/drivers/ata_adapter.h	2009-05-10 17:04:04 UTC (rev 30700)
@@ -0,0 +1,208 @@
+/*
+ * Copyright 2005-2007, Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de.</A> All rights reserved.
+ * Copyright 2002-04, Thomas Kurschel. All rights reserved.
+ *
+ * Distributed under the terms of the MIT License.
+ */
+#ifndef _ATA_PCI_H
+#define _ATA_PCI_H
+
+/*
+	ATA adapter library
+
+	Module to simplify writing an ATA adapter driver.
+
+	The interface is not very abstract, i.e. the actual driver is
+	free to access any controller or channel data of this library.
+*/
+
+
+#include &lt;bus/ATA.h&gt;
+#include &lt;bus/PCI.h&gt;
+#include &lt;ata_types.h&gt;
+
+
+// one Physical Region Descriptor (PRD)
+// (one region must not cross 64K boundary;
+//  the PRD table must not cross a 64K boundary)
+typedef struct prd_entry {
+	uint32 address;				// physical address of block (must be even)
+	uint16 count;				// size of block, 0 stands for 65536 (must be even)
+	uint8 res6;
+	LBITFIELD8_2(
+		res7_0 : 7,
+		EOT : 1					// 1 for last entry
+	);
+} prd_entry;
+
+// IDE bus master command register
+#define ATA_BM_COMMAND_START_STOP		0x01
+#define ATA_BM_COMMAND_READ_FROM_DEVICE	0x08
+
+// IDE bus master status register
+#define ATA_BM_STATUS_ACTIVE		0x01
+#define ATA_BM_STATUS_ERROR			0x02
+#define ATA_BM_STATUS_INTERRUPT		0x04
+#define ATA_BM_STATUS_MASTER_DMA	0x20
+#define ATA_BM_STATUS_SLAVE_DMA		0x40
+#define ATA_BM_STATUS_SIMPLEX_DMA	0x80
+
+// offset of bus master registers
+enum {
+	ATA_BM_COMMAND_REG	= 0,
+	ATA_BM_STATUS_REG	= 2,
+	ATA_BM_PRDT_ADDRESS	= 4
+		// offset of PRDT register; content must be dword-aligned
+};
+
+// bit mask in class_api of PCI configuration
+// (for adapters that can run in compatability mode)
+enum {
+	ATA_API_PRIMARY_NATIVE		= 1,	// primary channel is in native mode
+	ATA_API_PRIMARY_FIXED		= 2,	// primary channel can be switched to native mode
+	ATA_API_SECONDARY_NATIVE	= 4,	// secondary channel is in native mode
+	ATA_API_SECONDARY_FIXED		= 8		// secondary channel can be switched to native mode
+};
+
+
+// (maximum) size of S/G table
+// there are so many restrictions that we want to keep it inside one page
+// to be sure that we fulfill them all
+#define ATA_ADAPTER_MAX_SG_COUNT (B_PAGE_SIZE / sizeof( prd_entry ))
+
+
+// channel node items
+// io address of command block (uint16)
+#define ATA_ADAPTER_COMMAND_BLOCK_BASE &quot;ata_adapter/command_block_base&quot;
+// io address of control block (uint16)
+#define ATA_ADAPTER_CONTROL_BLOCK_BASE &quot;ata_adapter/control_block_base&quot;
+// interrupt number (uint8)
+// can also be defined in controller node if both channels use same IRQ!
+#define ATA_ADAPTER_INTNUM &quot;ata_adapter/irq&quot;
+// 0 if primary channel, 1 if secondary channel, 2 if tertiary, ... (uint8)
+#define ATA_ADAPTER_CHANNEL_INDEX &quot;ata_adapter/channel_index&quot;
+
+// controller node items
+// io address of bus master registers (uint16)
+#define ATA_ADAPTER_BUS_MASTER_BASE &quot;ata_adapter/bus_master_base&quot;
+
+
+// info about one channel
+typedef struct ata_adapter_channel_info {
+	pci_device_module_info *pci;
+	pci_device *device;
+
+	uint16 command_block_base;	// io address command block
+	uint16 control_block_base; // io address control block
+	uint16 bus_master_base;
+	int intnum;				// interrupt number
+
+	uint32 lost;			// != 0 if device got removed, i.e. if it must not
+							// be accessed anymore
+
+	ata_channel ataChannel;
+	device_node *node;
+
+	int32 (*inthand)( void *arg );
+
+	area_id prd_area;
+	prd_entry *prdt;
+	uint32 prdt_phys;
+	uint32 dmaing;
+} ata_adapter_channel_info;
+
+
+// info about controller
+typedef struct ata_adapter_controller_info {
+	pci_device_module_info *pci;
+	pci_device *device;
+
+	uint16 bus_master_base;
+
+	uint32 lost;			// != 0 if device got removed, i.e. if it must not
+							// be accessed anymore
+
+	device_node *node;
+} ata_adapter_controller_info;
+
+
+// interface of IDE adapter library
+typedef struct {
+	module_info info;
+
+	void (*set_channel)(ata_adapter_channel_info *channel,
+					ata_channel ataChannel);
+
+	// function calls that can be forwarded from actual driver
+	status_t (*write_command_block_regs)(ata_adapter_channel_info *channel,
+					ata_task_file *tf, ata_reg_mask mask);
+	status_t (*read_command_block_regs)(ata_adapter_channel_info *channel,
+					ata_task_file *tf, ata_reg_mask mask);
+
+	uint8 (*get_altstatus) (ata_adapter_channel_info *channel);
+	status_t (*write_device_control) (ata_adapter_channel_info *channel, uint8 val);
+
+	status_t (*write_pio)(ata_adapter_channel_info *channel, uint16 *data, int count, bool force_16bit);
+	status_t (*read_pio)(ata_adapter_channel_info *channel, uint16 *data, int count, bool force_16bit);
+
+	status_t (*prepare_dma)(ata_adapter_channel_info *channel, const physical_entry *sg_list,
+					size_t sg_list_count, bool to_device);
+	status_t (*start_dma)(ata_adapter_channel_info *channel);
+	status_t (*finish_dma)(ata_adapter_channel_info *channel);
+
+	// default functions that should be replaced by a more specific version
+	// (copy them from source code of this library and modify them at will)
+	int32 (*inthand)(void *arg);
+
+	// functions that must be called by init/uninit etc. of channel driver
+	status_t (*init_channel)(device_node *node,
+					ata_adapter_channel_info **cookie, size_t total_data_size,
+					int32 (*inthand)(void *arg));
+	void (*uninit_channel)(ata_adapter_channel_info *channel);
+	void (*channel_removed)(ata_adapter_channel_info *channel);
+
+	// publish channel node
+	status_t (*publish_channel)(device_node *controller_node,
+					const char *channel_module_name, uint16 command_block_base,
+					uint16 control_block_base, uint8 intnum, bool can_dma,
+					uint8 channel_index, const char *name,
+					const io_resource *resources, device_node **node);
+	// verify channel configuration and publish node on success
+	status_t (*detect_channel)(pci_device_module_info *pci, pci_device *pciDevice,
+					device_node *controller_node, const char *channel_module_name,
+					bool controller_can_dma, uint16 command_block_base,
+					uint16 control_block_base, uint16 bus_master_base,
+					uint8 intnum, uint8 channel_index, const char *name,
+					device_node **node, bool supports_compatibility_mode);
+
+	// functions that must be called by init/uninit etc. of controller driver
+	status_t (*init_controller)(device_node *node,
+					ata_adapter_controller_info **cookie, size_t total_data_size);
+	void (*uninit_controller)(ata_adapter_controller_info *controller);
+	void (*controller_removed)(ata_adapter_controller_info *controller);
+
+	// publish controller node
+	status_t (*publish_controller)(device_node *parent, uint16 bus_master_base,
+					io_resource *resources, const char *controller_driver,
+					const char *controller_driver_type, const char *controller_name,
+					bool can_dma, bool can_cq, uint32 dma_alignment, uint32 dma_boundary,
+					uint32 max_sg_block_size, device_node **node);
+	// verify controller configuration and publish node on success
+	status_t (*detect_controller)(pci_device_module_info *pci, pci_device *pciDevice,
+					device_node *parent, uint16 bus_master_base,
+					const char *controller_driver, const char *controller_driver_type,
+					const char *controller_name, bool can_dma, bool can_cq,
+					uint32 dma_alignment, uint32 dma_boundary, uint32 max_sg_block_size,
+					device_node **node);
+	// standard master probe for controller that registers controller and channel nodes
+	status_t (*probe_controller)(device_node *parent, const char *controller_driver,
+					const char *controller_driver_type, const char *controller_name,
+					const char *channel_module_name, bool can_dma, bool can_cq,
+					uint32 dma_alignment, uint32 dma_boundary, uint32 max_sg_block_size,
+					bool supports_compatibility_mode);
+} ata_adapter_interface;
+
+
+#define ATA_ADAPTER_MODULE_NAME &quot;generic/ata_adapter/v1&quot;
+
+#endif	/* _ATA_PCI_H */

Modified: haiku/trunk/src/add-ons/kernel/busses/ata/Jamfile
===================================================================
--- haiku/trunk/src/add-ons/kernel/busses/ata/Jamfile	2009-05-10 13:47:54 UTC (rev 30699)
+++ haiku/trunk/src/add-ons/kernel/busses/ata/Jamfile	2009-05-10 17:04:04 UTC (rev 30700)
@@ -3,6 +3,6 @@
 SubInclude HAIKU_TOP src add-ons kernel busses ata generic_ide_pci ;
 SubInclude HAIKU_TOP src add-ons kernel busses ata ide_isa ;
 SubInclude HAIKU_TOP src add-ons kernel busses ata it8211 ;
-SubInclude HAIKU_TOP src add-ons kernel busses ata promise_tx2 ;
+#SubInclude HAIKU_TOP src add-ons kernel busses ata promise_tx2 ;
 SubInclude HAIKU_TOP src add-ons kernel busses ata silicon_image_3112 ;
 SubInclude HAIKU_TOP src add-ons kernel busses ata legacy_sata ;

Modified: haiku/trunk/src/add-ons/kernel/busses/ata/generic_ide_pci/generic_ide_pci.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/busses/ata/generic_ide_pci/generic_ide_pci.c	2009-05-10 13:47:54 UTC (rev 30699)
+++ haiku/trunk/src/add-ons/kernel/busses/ata/generic_ide_pci/generic_ide_pci.c	2009-05-10 17:04:04 UTC (rev 30700)
@@ -9,64 +9,64 @@
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 
-#include &lt;ide_adapter.h&gt;
+#include &lt;ata_adapter.h&gt;
 
 #define GENERIC_IDE_PCI_CONTROLLER_MODULE_NAME &quot;busses/ata/generic_ide_pci/driver_v1&quot;
 #define GENERIC_IDE_PCI_CHANNEL_MODULE_NAME &quot;busses/ata/generic_ide_pci/channel/v1&quot;
 
-#define IDE_PCI_CONTROLLER_TYPE_NAME &quot;ide pci controller&quot;
+#define ATA_PCI_CONTROLLER_TYPE_NAME &quot;ata pci controller&quot;
 
-ide_for_controller_interface *ide;
-static ide_adapter_interface *ide_adapter;
-device_manager_info *pnp;
+ata_for_controller_interface *sATA;
+static ata_adapter_interface *sATAAdapter;
+device_manager_info *sDeviceManager;
 
 
 static void
-set_channel(void *cookie, ide_channel channel)
+set_channel(void *cookie, ata_channel channel)
 {
-	ide_adapter-&gt;set_channel((ide_adapter_channel_info *)cookie, channel);
+	sATAAdapter-&gt;set_channel((ata_adapter_channel_info *)cookie, channel);
 }
 
 
 static status_t
-write_command_block_regs(void *channel_cookie, ide_task_file *tf, ide_reg_mask mask)
+write_command_block_regs(void *channel_cookie, ata_task_file *tf, ata_reg_mask mask)
 {
-	return ide_adapter-&gt;write_command_block_regs((ide_adapter_channel_info *)channel_cookie, tf, mask);
+	return sATAAdapter-&gt;write_command_block_regs((ata_adapter_channel_info *)channel_cookie, tf, mask);
 }
 
 
 static status_t
-read_command_block_regs(void *channel_cookie, ide_task_file *tf, ide_reg_mask mask)
+read_command_block_regs(void *channel_cookie, ata_task_file *tf, ata_reg_mask mask)
 {
-	return ide_adapter-&gt;read_command_block_regs((ide_adapter_channel_info *)channel_cookie, tf, mask);
+	return sATAAdapter-&gt;read_command_block_regs((ata_adapter_channel_info *)channel_cookie, tf, mask);
 }
 
 
 static uint8
 get_altstatus(void *channel_cookie)
 {
-	return ide_adapter-&gt;get_altstatus((ide_adapter_channel_info *)channel_cookie);
+	return sATAAdapter-&gt;get_altstatus((ata_adapter_channel_info *)channel_cookie);
 }
 
 
 static status_t
 write_device_control(void *channel_cookie, uint8 val)
 {
-	return ide_adapter-&gt;write_device_control((ide_adapter_channel_info *)channel_cookie, val);
+	return sATAAdapter-&gt;write_device_control((ata_adapter_channel_info *)channel_cookie, val);
 }
 
 
 static status_t
 write_pio(void *channel_cookie, uint16 *data, int count, bool force_16bit)
 {
-	return ide_adapter-&gt;write_pio((ide_adapter_channel_info *)channel_cookie, data, count, force_16bit);
+	return sATAAdapter-&gt;write_pio((ata_adapter_channel_info *)channel_cookie, data, count, force_16bit);
 }
 
 
 static status_t
 read_pio(void *channel_cookie, uint16 *data, int count, bool force_16bit)
 {
-	return ide_adapter-&gt;read_pio((ide_adapter_channel_info *)channel_cookie, data, count, force_16bit);
+	return sATAAdapter-&gt;read_pio((ata_adapter_channel_info *)channel_cookie, data, count, force_16bit);
 }
 
 
@@ -75,73 +75,73 @@
 	const physical_entry *sg_list, size_t sg_list_count,
 	bool to_device)
 {
-	return ide_adapter-&gt;prepare_dma((ide_adapter_channel_info *)channel_cookie, sg_list, sg_list_count, to_device);
+	return sATAAdapter-&gt;prepare_dma((ata_adapter_channel_info *)channel_cookie, sg_list, sg_list_count, to_device);
 }
 
 
 static status_t
 start_dma(void *channel_cookie)
 {
-	return ide_adapter-&gt;start_dma((ide_adapter_channel_info *)channel_cookie);
+	return sATAAdapter-&gt;start_dma((ata_adapter_channel_info *)channel_cookie);
 }
 
 
 static status_t
 finish_dma(void *channel_cookie)
 {
-	return ide_adapter-&gt;finish_dma((ide_adapter_channel_info *)channel_cookie);
+	return sATAAdapter-&gt;finish_dma((ata_adapter_channel_info *)channel_cookie);
 }
 
 
 static status_t
 init_channel(device_node *node, void **channel_cookie)
 {
-	return ide_adapter-&gt;init_channel(node,
-		(ide_adapter_channel_info **)channel_cookie,
-		sizeof(ide_adapter_channel_info), ide_adapter-&gt;inthand);
+	return sATAAdapter-&gt;init_channel(node,
+		(ata_adapter_channel_info **)channel_cookie,
+		sizeof(ata_adapter_channel_info), sATAAdapter-&gt;inthand);
 }
 
 
 static void
 uninit_channel(void *channel_cookie)
 {
-	ide_adapter-&gt;uninit_channel((ide_adapter_channel_info *)channel_cookie);
+	sATAAdapter-&gt;uninit_channel((ata_adapter_channel_info *)channel_cookie);
 }
 
 
 static void
 channel_removed(void *channel_cookie)
 {
-	ide_adapter-&gt;channel_removed((ide_adapter_channel_info *)channel_cookie);
+	sATAAdapter-&gt;channel_removed((ata_adapter_channel_info *)channel_cookie);
 }
 
 
 static status_t
-init_controller(device_node *node, ide_adapter_controller_info **cookie)
+init_controller(device_node *node, ata_adapter_controller_info **cookie)
 {
-	return ide_adapter-&gt;init_controller(node, cookie,
-		sizeof( ide_adapter_controller_info));
+	return sATAAdapter-&gt;init_controller(node, cookie,
+		sizeof( ata_adapter_controller_info));
 }
 
 
 static void
-uninit_controller(ide_adapter_controller_info *controller)
+uninit_controller(ata_adapter_controller_info *controller)
 {
-	ide_adapter-&gt;uninit_controller(controller);
+	sATAAdapter-&gt;uninit_controller(controller);
 }
 
 
 static void
-controller_removed(ide_adapter_controller_info *controller)
+controller_removed(ata_adapter_controller_info *controller)
 {
-	return ide_adapter-&gt;controller_removed(controller);
+	return sATAAdapter-&gt;controller_removed(controller);
 }
 
 
 static status_t
 probe_controller(device_node *parent)
 {
-	return ide_adapter-&gt;probe_controller(parent,
+	return sATAAdapter-&gt;probe_controller(parent,
 		GENERIC_IDE_PCI_CONTROLLER_MODULE_NAME, &quot;generic_ide_pci&quot;,
 		&quot;Generic IDE PCI Controller&quot;,
 		GENERIC_IDE_PCI_CHANNEL_MODULE_NAME,
@@ -161,9 +161,9 @@
 	uint16 baseClass, subClass;
 
 	// make sure parent is an PCI IDE mass storage host adapter device node
-	if (pnp-&gt;get_attr_string(parent, B_DEVICE_BUS, &amp;bus, false) != B_OK
-		|| pnp-&gt;get_attr_uint16(parent, B_DEVICE_TYPE, &amp;baseClass, false) != B_OK
-		|| pnp-&gt;get_attr_uint16(parent, B_DEVICE_SUB_TYPE, &amp;subClass, false) != B_OK)
+	if (sDeviceManager-&gt;get_attr_string(parent, B_DEVICE_BUS, &amp;bus, false) != B_OK
+		|| sDeviceManager-&gt;get_attr_uint16(parent, B_DEVICE_TYPE, &amp;baseClass, false) != B_OK
+		|| sDeviceManager-&gt;get_attr_uint16(parent, B_DEVICE_SUB_TYPE, &amp;subClass, false) != B_OK)
 		return -1;
 
 	if (strcmp(bus, &quot;pci&quot;) || baseClass != PCI_mass_storage)
@@ -182,15 +182,15 @@
 
 
 module_dependency module_dependencies[] = {
-	{ IDE_FOR_CONTROLLER_MODULE_NAME, (module_info **)&amp;ide },
-	{ B_DEVICE_MANAGER_MODULE_NAME, (module_info **)&amp;pnp },
-	{ IDE_ADAPTER_MODULE_NAME, (module_info **)&amp;ide_adapter },
+	{ ATA_FOR_CONTROLLER_MODULE_NAME, (module_info **)&amp;sATA },
+	{ B_DEVICE_MANAGER_MODULE_NAME, (module_info **)&amp;sDeviceManager },
+	{ ATA_ADAPTER_MODULE_NAME, (module_info **)&amp;sATAAdapter },
 	{}
 };
 
 
 // exported interface
-static ide_controller_interface channel_interface = {
+static ata_controller_interface channel_interface = {
 	{
 		{
 			GENERIC_IDE_PCI_CHANNEL_MODULE_NAME,

Modified: haiku/trunk/src/add-ons/kernel/busses/ata/ide_isa/ide_isa.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/busses/ata/ide_isa/ide_isa.c	2009-05-10 13:47:54 UTC (rev 30699)
+++ haiku/trunk/src/add-ons/kernel/busses/ata/ide_isa/ide_isa.c	2009-05-10 17:04:04 UTC (rev 30700)
@@ -16,10 +16,8 @@
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 
+#include &lt;ata_adapter.h&gt;
 #include &lt;bus/ISA.h&gt;
-#include &lt;bus/IDE.h&gt;
-#include &lt;ide_types.h&gt;
-#include &lt;device_manager.h&gt;
 
 
 //#define TRACE_IDE_ISA
@@ -30,19 +28,19 @@
 #endif
 
 
-#define IDE_ISA_MODULE_NAME &quot;busses/ata/ide_isa/driver_v1&quot;
+#define ATA_ISA_MODULE_NAME &quot;busses/ata/ide_isa/driver_v1&quot;
 
 // private node item:
 // io address of command block
-#define IDE_ISA_COMMAND_BLOCK_BASE &quot;ide_isa/command_block_base&quot;
+#define ATA_ISA_COMMAND_BLOCK_BASE &quot;ide_isa/command_block_base&quot;
 // io address of control block
-#define IDE_ISA_CONTROL_BLOCK_BASE &quot;ide_isa/control_block_base&quot;
+#define ATA_ISA_CONTROL_BLOCK_BASE &quot;ide_isa/control_block_base&quot;
 // interrupt number
-#define IDE_ISA_INTNUM &quot;ide_isa/irq&quot;
+#define ATA_ISA_INTNUM &quot;ide_isa/irq&quot;
 
 
-ide_for_controller_interface *ide;
-device_manager_info *pnp;
+ata_for_controller_interface *sATA;
+device_manager_info *sDeviceManager;
 
 
 // info about one channel
@@ -55,34 +53,33 @@
 	uint32	lost;			// != 0 if device got removed, i.e. if it must not
 							// be accessed anymore
 
-	ide_channel ide_channel;
+	ata_channel ataChannel;
 	device_node *node;
 } channel_info;
 
 
-/*! publish node of an ide channel */
+/*! publish node of an ata channel */
 static status_t
 publish_channel(device_node *parent, uint16 command_block_base,
 	uint16 control_block_base, uint8 intnum, const char *name)
 {
 	device_attr attrs[] = {
-		{ B_DEVICE_FIXED_CHILD, B_STRING_TYPE, { string: IDE_FOR_CONTROLLER_MODULE_NAME }},
+		{ B_DEVICE_FIXED_CHILD, B_STRING_TYPE, { string: ATA_FOR_CONTROLLER_MODULE_NAME }},
 
-		// properties of this controller for ide bus manager
-		{ IDE_CONTROLLER_MAX_DEVICES_ITEM, B_UINT8_TYPE, { ui8: 2 }},
-		{ IDE_CONTROLLER_CAN_DMA_ITEM, B_UINT8_TYPE, { ui8: 0 }},
-		{ IDE_CONTROLLER_CAN_CQ_ITEM, B_UINT8_TYPE, { ui8: 1 }},
-		{ IDE_CONTROLLER_CONTROLLER_NAME_ITEM, B_STRING_TYPE, { string: name }},
+		// properties of this controller for ata bus manager
+		{ ATA_CONTROLLER_MAX_DEVICES_ITEM, B_UINT8_TYPE, { ui8: 2 }},
+		{ ATA_CONTROLLER_CAN_DMA_ITEM, B_UINT8_TYPE, { ui8: 0 }},
+		{ ATA_CONTROLLER_CONTROLLER_NAME_ITEM, B_STRING_TYPE, { string: name }},
 
 		// DMA properties; the 16 bit alignment is not necessary as
-		// the ide bus manager handles that very efficiently, but why
+		// the ata bus manager handles that very efficiently, but why
 		// not use the block device manager for doing that?
 		{ B_DMA_ALIGNMENT, B_UINT32_TYPE, { ui32: 1 }},
 
 		// private data to identify device
-		{ IDE_ISA_COMMAND_BLOCK_BASE, B_UINT16_TYPE, { ui16: command_block_base }},
-		{ IDE_ISA_CONTROL_BLOCK_BASE, B_UINT16_TYPE, { ui16: control_block_base }},
-		{ IDE_ISA_INTNUM, B_UINT8_TYPE, { ui8: intnum }},
+		{ ATA_ISA_COMMAND_BLOCK_BASE, B_UINT16_TYPE, { ui16: command_block_base }},
+		{ ATA_ISA_CONTROL_BLOCK_BASE, B_UINT16_TYPE, { ui16: control_block_base }},
+		{ ATA_ISA_INTNUM, B_UINT8_TYPE, { ui8: intnum }},
 		{ NULL }
 	};
 	io_resource resources[3] = {
@@ -94,7 +91,7 @@
 	TRACE(&quot;publishing %s, resources %#x %#x %d\n&quot;,
 		  name, command_block_base, control_block_base, intnum);
 
-	return pnp-&gt;register_node(parent, IDE_ISA_MODULE_NAME, attrs, resources,
+	return sDeviceManager-&gt;register_node(parent, ATA_ISA_MODULE_NAME, attrs, resources,
 		NULL);
 }
 
@@ -103,16 +100,16 @@
 
 
 static void
-set_channel(void *cookie, ide_channel ideChannel)
+set_channel(void *cookie, ata_channel ataChannel)
 {
 	channel_info *channel = cookie;
-	channel-&gt;ide_channel = ideChannel;
+	channel-&gt;ataChannel = ataChannel;
 }
 
 
 static status_t
-write_command_block_regs(void *channel_cookie, ide_task_file *tf,
-	ide_reg_mask mask)
+write_command_block_regs(void *channel_cookie, ata_task_file *tf,
+	ata_reg_mask mask)
 {
 	channel_info *channel = channel_cookie;
 	uint16 ioaddr = channel-&gt;command_block_base;
@@ -139,8 +136,8 @@
 
 
 static status_t
-read_command_block_regs(void *channel_cookie, ide_task_file *tf,
-	ide_reg_mask mask)
+read_command_block_regs(void *channel_cookie, ata_task_file *tf,
+	ata_reg_mask mask)
 {
 	channel_info *channel = channel_cookie;
 	uint16 ioaddr = channel-&gt;command_block_base;
@@ -256,7 +253,7 @@
 	// acknowledge IRQ
 	status = channel-&gt;isa-&gt;read_io_8(channel-&gt;command_block_base + 7);
 
-	return ide-&gt;irq_handler(channel-&gt;ide_channel, status);
+	return sATA-&gt;interrupt_handler(channel-&gt;ataChannel, status);
 }
 
 
@@ -291,7 +288,7 @@
 	const char *bus;
 
 	// make sure parent is really the ISA bus manager
-	if (pnp-&gt;get_attr_string(parent, B_DEVICE_BUS, &amp;bus, false))
+	if (sDeviceManager-&gt;get_attr_string(parent, B_DEVICE_BUS, &amp;bus, false))
 		return B_ERROR;
 
 	if (strcmp(bus, &quot;isa&quot;))
@@ -318,14 +315,14 @@
 	TRACE(&quot;ISA-IDE: channel init\n&quot;);
 
 	// get device data
-	if (pnp-&gt;get_attr_uint16(node, IDE_ISA_COMMAND_BLOCK_BASE, &amp;command_block_base, false) != B_OK
-		|| pnp-&gt;get_attr_uint16(node, IDE_ISA_CONTROL_BLOCK_BASE, &amp;control_block_base, false) != B_OK
-		|| pnp-&gt;get_attr_uint8(node, IDE_ISA_INTNUM, &amp;irq, false) != B_OK)
+	if (sDeviceManager-&gt;get_attr_uint16(node, ATA_ISA_COMMAND_BLOCK_BASE, &amp;command_block_base, false) != B_OK
+		|| sDeviceManager-&gt;get_attr_uint16(node, ATA_ISA_CONTROL_BLOCK_BASE, &amp;control_block_base, false) != B_OK
+		|| sDeviceManager-&gt;get_attr_uint8(node, ATA_ISA_INTNUM, &amp;irq, false) != B_OK)
 		return B_ERROR;
 
-	parent = pnp-&gt;get_parent_node(node);
-	pnp-&gt;get_driver(parent, (driver_module_info **)&amp;isa, NULL);
-	pnp-&gt;put_node(parent);
+	parent = sDeviceManager-&gt;get_parent_node(node);
+	sDeviceManager-&gt;get_driver(parent, (driver_module_info **)&amp;isa, NULL);
+	sDeviceManager-&gt;put_node(parent);
 
 	channel = (channel_info *)malloc(sizeof(channel_info));
 	if (channel == NULL)
@@ -340,7 +337,7 @@
 	channel-&gt;command_block_base = command_block_base;
 	channel-&gt;control_block_base = control_block_base;
 	channel-&gt;intnum = irq;
-	channel-&gt;ide_channel = NULL;
+	channel-&gt;ataChannel = NULL;
 
 	res = install_io_interrupt_handler(channel-&gt;intnum,
 		inthand, channel, 0);
@@ -351,7 +348,7 @@
 	}
 
 	// enable interrupts so the channel is ready to run
-	write_device_control(channel, ide_devctrl_bit3);
+	write_device_control(channel, ATA_DEVICE_CONTROL_BIT3);
 
 	*_cookie = channel;
 	return B_OK;
@@ -370,7 +367,7 @@
 	TRACE(&quot;ISA-IDE: channel uninit\n&quot;);
 
 	// disable IRQs
-	write_device_control(channel, ide_devctrl_bit3 | ide_devctrl_nien);
+	write_device_control(channel, ATA_DEVICE_CONTROL_BIT3 | ATA_DEVICE_CONTROL_DISABLE_INTS);
 
 	// catch spurious interrupt
 	// (some controllers generate an IRQ when you _disable_ interrupts,
@@ -416,16 +413,16 @@
 
 
 module_dependency module_dependencies[] = {
-	{ IDE_FOR_CONTROLLER_MODULE_NAME, (module_info **)&amp;ide },
-	{ B_DEVICE_MANAGER_MODULE_NAME, (module_info **)&amp;pnp },
+	{ ATA_FOR_CONTROLLER_MODULE_NAME, (module_info **)&amp;sATA },
+	{ B_DEVICE_MANAGER_MODULE_NAME, (module_info **)&amp;sDeviceManager },
 	{}
 };
 
 // exported interface
-static ide_controller_interface sISAControllerInterface = {
+static ata_controller_interface sISAControllerInterface = {
 	{
 		{
-			IDE_ISA_MODULE_NAME,
+			ATA_ISA_MODULE_NAME,
 			0,
 			NULL
 		},

Modified: haiku/trunk/src/add-ons/kernel/busses/ata/it8211/it8211.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/busses/ata/it8211/it8211.c	2009-05-10 13:47:54 UTC (rev 30699)
+++ haiku/trunk/src/add-ons/kernel/busses/ata/it8211/it8211.c	2009-05-10 17:04:04 UTC (rev 30700)
@@ -6,7 +6,7 @@
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 
-#include &lt;ide_adapter.h&gt;
+#include &lt;ata_adapter.h&gt;
 
 #define IT8211_CONTROLLER_MODULE_NAME &quot;busses/ata/it8211/driver_v1&quot;
 #define IT8211_CHANNEL_MODULE_NAME &quot;busses/ata/it8211/channel/v1&quot;
@@ -14,64 +14,64 @@
 #define PCI_VENDOR_ITE			0x1283
 #define PCI_DEVICE_ITE_IT8211	0x8211
 
-static ide_adapter_interface *sIDEAdapter;
+static ata_adapter_interface *sATAAdapter;
 static device_manager_info *sDeviceManager;
 
 
 static void
-it8211_set_channel(void *channelCookie, ide_channel channel)
+it8211_set_channel(void *channelCookie, ata_channel channel)
 {
-	sIDEAdapter-&gt;set_channel((ide_adapter_channel_info *)channelCookie,
+	sATAAdapter-&gt;set_channel((ata_adapter_channel_info *)channelCookie,
 		channel);
 }
 
 
 static status_t
-it8211_write_command_block_regs(void *channelCookie, ide_task_file *taskFile,
-	ide_reg_mask registerMask)
+it8211_write_command_block_regs(void *channelCookie, ata_task_file *taskFile,
+	ata_reg_mask registerMask)
 {
-	return sIDEAdapter-&gt;write_command_block_regs(
-		(ide_adapter_channel_info *)channelCookie, taskFile, registerMask);
+	return sATAAdapter-&gt;write_command_block_regs(
+		(ata_adapter_channel_info *)channelCookie, taskFile, registerMask);
 }
 
 
 static status_t
-it8211_read_command_block_regs(void *channelCookie, ide_task_file *taskFile,
-	ide_reg_mask registerMask)
+it8211_read_command_block_regs(void *channelCookie, ata_task_file *taskFile,
+	ata_reg_mask registerMask)
 {
-	return sIDEAdapter-&gt;read_command_block_regs(
-		(ide_adapter_channel_info *)channelCookie, taskFile, registerMask);
+	return sATAAdapter-&gt;read_command_block_regs(
+		(ata_adapter_channel_info *)channelCookie, taskFile, registerMask);
 }
 
 
 static uint8
 it8211_get_altstatus(void *channelCookie)
 {
-	return sIDEAdapter-&gt;get_altstatus((ide_adapter_channel_info *)channelCookie);
+	return sATAAdapter-&gt;get_altstatus((ata_adapter_channel_info *)channelCookie);
 }
 
 
 static status_t
 it8211_write_device_control(void *channelCookie, uint8 value)
 {
-	return sIDEAdapter-&gt;write_device_control(
-		(ide_adapter_channel_info *)channelCookie, value);
+	return sATAAdapter-&gt;write_device_control(
+		(ata_adapter_channel_info *)channelCookie, value);
 }
 
 
 static status_t
 it8211_write_pio(void *channelCookie, uint16 *data, int count, bool force16bit)
 {
-	return sIDEAdapter-&gt;write_pio(
-		(ide_adapter_channel_info *)channelCookie, data, count, force16bit);
+	return sATAAdapter-&gt;write_pio(
+		(ata_adapter_channel_info *)channelCookie, data, count, force16bit);
 }
 
 
 static status_t
 it8211_read_pio(void *channelCookie, uint16 *data, int count, bool force16bit)
 {
-	return sIDEAdapter-&gt;read_pio(
-		(ide_adapter_channel_info *)channelCookie, data, count, force16bit);
+	return sATAAdapter-&gt;read_pio(
+		(ata_adapter_channel_info *)channelCookie, data, count, force16bit);
 }
 
 
@@ -79,7 +79,7 @@
 it8211_prepare_dma(void *channelCookie, const physical_entry *sgList,
 	size_t sgListCount, bool toDevice)
 {
-	return sIDEAdapter-&gt;prepare_dma((ide_adapter_channel_info *)channelCookie,
+	return sATAAdapter-&gt;prepare_dma((ata_adapter_channel_info *)channelCookie,
 		sgList, sgListCount, toDevice);
 }
 
@@ -87,67 +87,67 @@
 static status_t
 it8211_start_dma(void *channelCookie)
 {
-	return sIDEAdapter-&gt;start_dma((ide_adapter_channel_info *)channelCookie);
+	return sATAAdapter-&gt;start_dma((ata_adapter_channel_info *)channelCookie);
 }
 
 
 static status_t
 it8211_finish_dma(void *channelCookie)
 {
-	return sIDEAdapter-&gt;finish_dma((ide_adapter_channel_info *)channelCookie);
+	return sATAAdapter-&gt;finish_dma((ata_adapter_channel_info *)channelCookie);
 }
 
 
 static status_t
 init_channel(device_node *node, void **channelCookie)
 {
-	return sIDEAdapter-&gt;init_channel(node,
-		(ide_adapter_channel_info **)channelCookie,
-		sizeof(ide_adapter_channel_info), sIDEAdapter-&gt;inthand);
+	return sATAAdapter-&gt;init_channel(node,
+		(ata_adapter_channel_info **)channelCookie,
+		sizeof(ata_adapter_channel_info), sATAAdapter-&gt;inthand);
 }
 
 
 static void
 uninit_channel(void *channelCookie)
 {
-	sIDEAdapter-&gt;uninit_channel((ide_adapter_channel_info *)channelCookie);
+	sATAAdapter-&gt;uninit_channel((ata_adapter_channel_info *)channelCookie);
 }
 
 
 static void
 channel_removed(void *channelCookie)
 {
-	sIDEAdapter-&gt;channel_removed((ide_adapter_channel_info *)channelCookie);
+	sATAAdapter-&gt;channel_removed((ata_adapter_channel_info *)channelCookie);
 }
 
 
 static status_t
 init_controller(device_node *node, void **cookie)
 {
-	return sIDEAdapter-&gt;init_controller(node,
-		(ide_adapter_controller_info **)cookie,
-		sizeof(ide_adapter_controller_info));
+	return sATAAdapter-&gt;init_controller(node,
+		(ata_adapter_controller_info **)cookie,
+		sizeof(ata_adapter_controller_info));
 }
 
 
 static void
 uninit_controller(void *cookie)
 {
-	sIDEAdapter-&gt;uninit_controller((ide_adapter_controller_info *)cookie);
+	sATAAdapter-&gt;uninit_controller((ata_adapter_controller_info *)cookie);
 }
 
 
 static void
 controller_removed(void *cookie)
 {
-	sIDEAdapter-&gt;controller_removed((ide_adapter_controller_info *)cookie);
+	sATAAdapter-&gt;controller_removed((ata_adapter_controller_info *)cookie);
 }
 
 
 static status_t
 probe_controller(device_node *parent)
 {
-	return sIDEAdapter-&gt;probe_controller(parent,
+	return sATAAdapter-&gt;probe_controller(parent,
 		IT8211_CONTROLLER_MODULE_NAME, &quot;it8211&quot;,
 		&quot;ITE IT8211&quot;, IT8211_CHANNEL_MODULE_NAME,
 		true,		/* DMA */
@@ -182,13 +182,13 @@
 
 module_dependency module_dependencies[] = {
 	{ B_DEVICE_MANAGER_MODULE_NAME, (module_info **)&amp;sDeviceManager },
-	{ IDE_ADAPTER_MODULE_NAME, (module_info **)&amp;sIDEAdapter },
+	{ ATA_ADAPTER_MODULE_NAME, (module_info **)&amp;sATAAdapter },
 	{}
 };
 
 
 // exported interface
-static ide_controller_interface sChannelInterface = {
+static ata_controller_interface sChannelInterface = {
 	{
 		{
 			IT8211_CHANNEL_MODULE_NAME,

Modified: haiku/trunk/src/add-ons/kernel/busses/ata/legacy_sata/legacy_sata.c
===================================================================
--- haiku/trunk/src/add-ons/kernel/busses/ata/legacy_sata/legacy_sata.c	2009-05-10 13:47:54 UTC (rev 30699)
+++ haiku/trunk/src/add-ons/kernel/busses/ata/legacy_sata/legacy_sata.c	2009-05-10 17:04:04 UTC (rev 30700)
@@ -6,15 +6,13 @@
 #include &lt;KernelExport.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
-#include &lt;device_manager.h&gt;
-#include &lt;bus/IDE.h&gt;
-#include &lt;ide_adapter.h&gt;
+#include &lt;ata_adapter.h&gt;
 
 
 #define DRIVER_PRETTY_NAME	&quot;Legacy SATA&quot;
 #define CONTROLLER_NAME		DRIVER_PRETTY_NAME
 #define CONTROLLER_MODULE_NAME	&quot;busses/ata/legacy_sata/driver_v1&quot;
-#define CHANNEL_MODULE_NAME	&quot;busses/ide/legacy_sata/channel/v1&quot;
+#define CHANNEL_MODULE_NAME	&quot;busses/ata/legacy_sata/channel/v1&quot;
 
 #define TRACE(a...)		dprintf(DRIVER_PRETTY_NAME &quot;: &quot; a)
 #define FLOW(a...)		dprintf(DRIVER_PRETTY_NAME &quot;: &quot; a)
@@ -55,9 +53,9 @@
 	&quot;Tertiary Channel&quot;, &quot;Quaternary Channel&quot;
 };
 
-static ide_for_controller_interface* ide;
-static ide_adapter_interface* ide_adapter;
-static device_manager_info* dm;
+static ata_for_controller_interface* sATA;
+static ata_adapter_interface* sATAAdapter;
+static device_manager_info* sDeviceManager;
 
 
 static float
@@ -69,15 +67,15 @@
 	const char *bus = NULL;
 
 	// get the bus (should be PCI)
-	if (dm-&gt;get_attr_string(parent, B_DEVICE_BUS, &amp;bus, false) != B_OK)
+	if (sDeviceManager-&gt;get_attr_string(parent, B_DEVICE_BUS, &amp;bus, false) != B_OK)
 		return B_ERROR;
 	if (strcmp(bus, &quot;pci&quot;) != 0) {
 		return B_ERROR;
 	}
 
 	// get vendor and device ID
-	if ((res=dm-&gt;get_attr_uint16(parent, B_DEVICE_VENDOR_ID, &amp;vendor_id, false)) != B_OK
-		|| (res=dm-&gt;get_attr_uint16(parent, B_DEVICE_ID, &amp;device_id, false)) != B_OK) {
+	if ((res = sDeviceManager-&gt;get_attr_uint16(parent, B_DEVICE_VENDOR_ID, &amp;vendor_id, false)) != B_OK
+		|| (res = sDeviceManager-&gt;get_attr_uint16(parent, B_DEVICE_ID, &amp;device_id, false)) != B_OK) {
 		return res;
 	}
 
@@ -140,7 +138,7 @@
 
 	TRACE(&quot;controller_probe\n&quot;);
 
-	dm-&gt;get_driver(parent, (driver_module_info **)&amp;pci, (void **)&amp;device);
+	sDeviceManager-&gt;get_driver(parent, (driver_module_info **)&amp;pci, (void **)&amp;device);
 
 	device_id = pci-&gt;read_pci_config(device, PCI_device_id, 2);
 	vendor_id = pci-&gt;read_pci_config(device, PCI_vendor_id, 2);
@@ -192,7 +190,7 @@
 		control_block_base[index] &amp;= PCI_address_io_mask;
 	}
 
-	res = ide_adapter-&gt;detect_controller(pci, device, parent, bus_master_base,
+	res = sATAAdapter-&gt;detect_controller(pci, device, parent, bus_master_base,
 		CONTROLLER_MODULE_NAME, &quot;&quot; /* XXX: unused: controller_driver_type*/, CONTROLLER_NAME, true,
 		true, 1, 0xffff, 0x10000, &amp;controller_node);
 	// don't register if controller is already registered!
@@ -207,7 +205,7 @@
 	// ignore errors during registration of channels - could be a simple rescan collision
 
 	for (index = 0; index &lt; num_channels; index++) {
-		res = ide_adapter-&gt;detect_channel(pci, device, controller_node, CHANNEL_MODULE_NAME,
+		res = sATAAdapter-&gt;detect_channel(pci, device, controller_node, CHANNEL_MODULE_NAME,
 			true, command_block_base[index], control_block_base[index], bus_master_base,
 			int_num, index, kChannelNames[index], &amp;channels[index], false);
 
@@ -227,129 +225,129 @@
 static status_t
 controller_init(device_node *node, void **controller_cookie)
 {
-	return ide_adapter-&gt;init_controller(
-		node, (ide_adapter_controller_info**)controller_cookie,
-		sizeof(ide_adapter_controller_info));
+	return sATAAdapter-&gt;init_controller(
+		node, (ata_adapter_controller_info**)controller_cookie,
+		sizeof(ata_adapter_controller_info));
 }
 
 
 static void
 controller_uninit(void *controller_cookie)
 {
-	ide_adapter-&gt;uninit_controller(controller_cookie);
+	sATAAdapter-&gt;uninit_controller(controller_cookie);
 }
 
 
 static void
 controller_removed(void *controller_cookie)
 {
-	ide_adapter-&gt;controller_removed(
-		(ide_adapter_controller_info*)controller_cookie);
+	sATAAdapter-&gt;controller_removed(
+		(ata_adapter_controller_info*)controller_cookie);
 }
 
 
 static status_t
 channel_init(device_node *node, void **channel_cookie)
 {
-	return ide_adapter-&gt;init_channel(node,
-		(ide_adapter_channel_info**)channel_cookie,
-		sizeof(ide_adapter_channel_info),
-		ide_adapter-&gt;inthand);
+	return sATAAdapter-&gt;init_channel(node,
+		(ata_adapter_channel_info**)channel_cookie,
+		sizeof(ata_adapter_channel_info),
+		sATAAdapter-&gt;inthand);
 }
 
 
 static void
 channel_uninit(void *channel_cookie)
 {
-	ide_adapter-&gt;uninit_channel(channel_cookie);
+	sATAAdapter-&gt;uninit_channel(channel_cookie);

[... truncated: 1377 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016679.html">[Haiku-commits] r30699 - haiku/trunk/src/preferences/keymap
</A></li>
	<LI>Next message: <A HREF="016614.html">[Haiku-commits] r30701 - haiku/trunk/src/apps/stylededit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16612">[ date ]</a>
              <a href="thread.html#16612">[ thread ]</a>
              <a href="subject.html#16612">[ subject ]</a>
              <a href="author.html#16612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
