<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r30623 - haiku/trunk/src/kits/app
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30623%20-%20haiku/trunk/src/kits/app&In-Reply-To=%3C200905041031.n44AVlbS022641%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016495.html">
   <LINK REL="Next"  HREF="016489.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r30623 - haiku/trunk/src/kits/app</H1>
    <B>bonefish at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r30623%20-%20haiku/trunk/src/kits/app&In-Reply-To=%3C200905041031.n44AVlbS022641%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r30623 - haiku/trunk/src/kits/app">bonefish at mail.berlios.de
       </A><BR>
    <I>Mon May  4 12:31:47 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="016495.html">[Haiku-commits] r30622 -	haiku/trunk/src/add-ons/accelerants/common
</A></li>
        <LI>Next message: <A HREF="016489.html">[Haiku-commits] r30624 - haiku/trunk/src/kits/app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16488">[ date ]</a>
              <a href="thread.html#16488">[ thread ]</a>
              <a href="subject.html#16488">[ subject ]</a>
              <a href="author.html#16488">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2009-05-04 12:31:45 +0200 (Mon, 04 May 2009)
New Revision: 30623
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=30623&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=30623&amp;view=rev</A>

Modified:
   haiku/trunk/src/kits/app/Roster.cpp
Log:
* BRoster::_TranslateRef(): Changed error handling style. No functional change.
* Automatic white space cleanup.


Modified: haiku/trunk/src/kits/app/Roster.cpp
===================================================================
--- haiku/trunk/src/kits/app/Roster.cpp	2009-05-04 09:03:19 UTC (rev 30622)
+++ haiku/trunk/src/kits/app/Roster.cpp	2009-05-04 10:31:45 UTC (rev 30623)
@@ -8,7 +8,7 @@
  */
 
 /*!	BRoster class lets you launch apps and keeps track of apps
-	that are running. 
+	that are running.
 	Global be_roster represents the default BRoster.
 	app_info structure provides info for a running app.
 */
@@ -547,7 +547,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a mimeType or \a app.
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -589,7 +589,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a mimeType or \a app.
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -821,7 +821,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a mimeType
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -868,7 +868,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a mimeType
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -908,7 +908,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a mimeType
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -953,7 +953,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a ref
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -1007,7 +1007,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a ref
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -1057,7 +1057,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a ref
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -1119,13 +1119,13 @@
 		err = reply.what == B_REG_RESULT ? (status_t)B_OK : (status_t)B_BAD_REPLY;
 	if (!err)
 		err = reply.FindInt32(&quot;result&quot;, &amp;result);
-	if (!err) 
+	if (!err)
 		err = result;
 	// Clear the result if an error occured
 	if (err &amp;&amp; refList)
 		refList-&gt;MakeEmpty();
 	// No return value, how sad :-(
-//	return err;	
+//	return err;
 }
 
 // GetRecentDocuments
@@ -1160,13 +1160,13 @@
 		err = reply.what == B_REG_RESULT ? (status_t)B_OK : (status_t)B_BAD_REPLY;
 	if (!err)
 		err = reply.FindInt32(&quot;result&quot;, &amp;result);
-	if (!err) 
+	if (!err)
 		err = result;
 	// Clear the result if an error occured
 	if (err &amp;&amp; refList)
 		refList-&gt;MakeEmpty();
 	// No return value, how sad :-(
-//	return err;	
+//	return err;
 }
 
 // GetRecentFolders
@@ -1196,13 +1196,13 @@
 		err = reply.what == B_REG_RESULT ? (status_t)B_OK : (status_t)B_BAD_REPLY;
 	if (!err)
 		err = reply.FindInt32(&quot;result&quot;, &amp;result);
-	if (!err) 
+	if (!err)
 		err = result;
 	// Clear the result if an error occured
 	if (err &amp;&amp; refList)
 		refList-&gt;MakeEmpty();
 	// No return value, how sad :-(
-//	return err;	
+//	return err;
 }
 
 // GetRecentApps
@@ -1229,13 +1229,13 @@
 		err = reply.what == B_REG_RESULT ? (status_t)B_OK : (status_t)B_BAD_REPLY;
 	if (!err)
 		err = reply.FindInt32(&quot;result&quot;, &amp;result);
-	if (!err) 
+	if (!err)
 		err = result;
 	// Clear the result if an error occured
 	if (err &amp;&amp; refList)
 		refList-&gt;MakeEmpty();
 	// No return value, how sad :-(
-//	return err;	
+//	return err;
 }
 
 // AddToRecentDocuments
@@ -1249,18 +1249,18 @@
 	BMessage reply;
 	status_t result;
 	char *callingAppSig = NULL;
-	
+
 	// If no signature is supplied, look up the signature of
 	// the calling app
 	if (!err &amp;&amp; !appSig) {
 		app_info info;
 		err = GetRunningAppInfo(be_app-&gt;Team(), &amp;info);
 		if (!err)
-			callingAppSig = info.signature;	
+			callingAppSig = info.signature;
 	}
 
 	// Build and send the message, read the reply
-	if (!err) 
+	if (!err)
 		err = msg.AddRef(&quot;ref&quot;, doc);
 	if (!err)
 		err = msg.AddString(&quot;app sig&quot;, (appSig ? appSig : callingAppSig));
@@ -1269,7 +1269,7 @@
 		err = reply.what == B_REG_RESULT ? (status_t)B_OK : (status_t)B_BAD_REPLY;
 	if (!err)
 		err = reply.FindInt32(&quot;result&quot;, &amp;result);
-	if (!err) 
+	if (!err)
 		err = result;
 	if (err)
 		DBG(OUT(&quot;WARNING: BRoster::AddToRecentDocuments() failed with error 0x%lx\n&quot;, err));
@@ -1286,18 +1286,18 @@
 	BMessage reply;
 	status_t result;
 	char *callingAppSig = NULL;
-	
+
 	// If no signature is supplied, look up the signature of
 	// the calling app
 	if (!err &amp;&amp; !appSig) {
 		app_info info;
 		err = GetRunningAppInfo(be_app-&gt;Team(), &amp;info);
 		if (!err)
-			callingAppSig = info.signature;	
+			callingAppSig = info.signature;
 	}
 
 	// Build and send the message, read the reply
-	if (!err) 
+	if (!err)
 		err = msg.AddRef(&quot;ref&quot;, folder);
 	if (!err)
 		err = msg.AddString(&quot;app sig&quot;, (appSig ? appSig : callingAppSig));
@@ -1306,7 +1306,7 @@
 		err = reply.what == B_REG_RESULT ? (status_t)B_OK : (status_t)B_BAD_REPLY;
 	if (!err)
 		err = reply.FindInt32(&quot;result&quot;, &amp;result);
-	if (!err) 
+	if (!err)
 		err = result;
 	if (err)
 		DBG(OUT(&quot;WARNING: BRoster::AddToRecentDocuments() failed with error 0x%lx\n&quot;, err));
@@ -1621,7 +1621,7 @@
 		error = request.AddInt32(&quot;team&quot;, team);
 	if (error == B_OK &amp;&amp; token &gt; 0)
 		error = request.AddInt32(&quot;token&quot;, (int32)token);
-	
+
 	// send the request
 	BMessage reply;
 	if (error == B_OK)
@@ -1645,7 +1645,7 @@
 		} else if (reply.FindInt32(&quot;error&quot;, &amp;error) != B_OK)
 			error = B_ERROR;
 	}
-	
+
 	return error;
 }
 
@@ -1801,7 +1801,7 @@
 	\return
 	- \c B_OK: Everything went fine.
 	- \c B_BAD_VALUE: \c NULL \a mimeType and \a ref.
-	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor 
+	- \c B_LAUNCH_FAILED_NO_PREFERRED_APP: Neither with the supplied type nor
 	  with its supertype (if the supplied isn't a supertype itself) a
 	  preferred application is associated.
 	- \c B_LAUNCH_FAILED_APP_NOT_FOUND: The supplied type is not installed or
@@ -2114,92 +2114,100 @@
 	// resolve ref, if necessary
 	BEntry entry;
 	status_t error = entry.SetTo(ref, false);
-	if (error == B_OK &amp;&amp; entry.IsSymLink()) {
+	if (error != B_OK)
+		return error;
+
+	if (entry.IsSymLink()) {
 		// ref refers to a link
-		error = entry.SetTo(ref, true);
-		if (error == B_OK)
-			error = entry.GetRef(ref);
-		if (error != B_OK)
-			error = B_LAUNCH_FAILED_NO_RESOLVE_LINK;
+		if (entry.SetTo(ref, true) != B_OK || entry.GetRef(ref) != B_OK)
+			return B_LAUNCH_FAILED_NO_RESOLVE_LINK;
 	}
 
 	// init node
 	BNode node;
-	if (error == B_OK)
-		error = node.SetTo(ref);
+	error = node.SetTo(ref);
+	if (error != B_OK)
+		return error;
+
 	// get permissions
 	mode_t permissions;
-	if (error == B_OK)
-		error = node.GetPermissions(&amp;permissions);
-	if (error == B_OK) {
-		if ((permissions &amp; S_IXUSR) &amp;&amp; node.IsFile()) {
-			// node is executable and a file -- we're done
-			*appRef = *ref;
-			error = appFile-&gt;SetTo(appRef, B_READ_ONLY);
+	error = node.GetPermissions(&amp;permissions);
+	if (error != B_OK)
+		return error;
 
-			// get the app's signature via a BAppFileInfo
-			BAppFileInfo appFileInfo;
-			if (error == B_OK)
-				error = appFileInfo.SetTo(appFile);
+	if ((permissions &amp; S_IXUSR) &amp;&amp; node.IsFile()) {
+		// node is executable and a file -- we're done
+		*appRef = *ref;
+		error = appFile-&gt;SetTo(appRef, B_READ_ONLY);
+		if (error != B_OK)
+			return error;
 
-			char type[B_MIME_TYPE_LENGTH];
-			bool isDocument = true;
+		// get the app's signature via a BAppFileInfo
+		BAppFileInfo appFileInfo;
+		error = appFileInfo.SetTo(appFile);
+		if (error != B_OK)
+			return error;
 
-			if (error == B_OK) {
-				// don't worry, if the file doesn't have a signature, just
-				// unset the supplied object
-				if (appFileInfo.GetSignature(type) == B_OK)
-					error = appMeta-&gt;SetTo(type);
-				else
-					appMeta-&gt;Unset();
-				if (appFileInfo.GetType(type) == B_OK
-					&amp;&amp; !strcasecmp(type, B_APP_MIME_TYPE))
-					isDocument = false;
-			}
-			if (_wasDocument)
-				*_wasDocument = isDocument;
-		} else {
-			// the node is not exectuable or not a file
-			// init a node info
-			BNodeInfo nodeInfo;
-			if (error == B_OK)
-				error = nodeInfo.SetTo(&amp;node);
-			char preferredApp[B_MIME_TYPE_LENGTH];
-			if (error == B_OK) {
-				// if the file has a preferred app, let _TranslateType() find
-				// it for us
-				bool foundPreferredApp = false;
-				if (nodeInfo.GetPreferredApp(preferredApp) == B_OK) {
-					error = _TranslateType(preferredApp, appMeta, appRef,
-										   appFile);
-					if (error == B_OK)
-						foundPreferredApp = true;
-				}
-				
-				if (!foundPreferredApp) {
-					// no preferred app or existing one was not found -- we
-					// need to get the file's type
+		char type[B_MIME_TYPE_LENGTH];
+		bool isDocument = true;
 
-					error = B_OK; // reset error.
+		// don't worry, if the file doesn't have a signature, just
+		// unset the supplied object
+		if (appFileInfo.GetSignature(type) == B_OK) {
+			error = appMeta-&gt;SetTo(type);
+			if (error != B_OK)
+				return error;
+		} else
+			appMeta-&gt;Unset();
 
-					char fileType[B_MIME_TYPE_LENGTH];
+		if (appFileInfo.GetType(type) == B_OK
+			&amp;&amp; !strcasecmp(type, B_APP_MIME_TYPE)) {
+			isDocument = false;
+		}
 
-					// get the type from the file, or guess a type
-					if (nodeInfo.GetType(fileType) != B_OK)
-						error = _SniffFile(ref, &amp;nodeInfo, fileType);
+		if (_wasDocument)
+			*_wasDocument = isDocument;
 
-					// now let _TranslateType() do the actual work
-					if (error == B_OK) {
-						error = _TranslateType(fileType, appMeta, appRef,
-											   appFile);
-					}
-				}
-			}
-			if (_wasDocument)
-				*_wasDocument = true;
-		}
+		return B_OK;
 	}
-	return error;
+
+	// the node is not exectuable or not a file
+	// init a node info
+	BNodeInfo nodeInfo;
+	error = nodeInfo.SetTo(&amp;node);
+	if (error != B_OK)
+		return error;
+
+	// if the file has a preferred app, let _TranslateType() find
+	// it for us
+	char preferredApp[B_MIME_TYPE_LENGTH];
+	if (nodeInfo.GetPreferredApp(preferredApp) == B_OK
+		&amp;&amp; _TranslateType(preferredApp, appMeta, appRef, appFile) == B_OK) {
+		if (_wasDocument)
+			*_wasDocument = true;
+		return B_OK;
+	}
+
+	// no preferred app or existing one was not found -- we
+	// need to get the file's type
+
+	// get the type from the file, or guess a type
+	char fileType[B_MIME_TYPE_LENGTH];
+	if (nodeInfo.GetType(fileType) != B_OK) {
+		error = _SniffFile(ref, &amp;nodeInfo, fileType);
+		if (error != B_OK)
+			return error;
+	}
+
+	// now let _TranslateType() do the actual work
+	error = _TranslateType(fileType, appMeta, appRef, appFile);
+	if (error != B_OK)
+		return error;
+
+	if (_wasDocument)
+		*_wasDocument = true;
+
+	return B_OK;
 }
 
 // _TranslateType
@@ -2355,7 +2363,7 @@
 	If \a messageList is not \c NULL or empty, those messages are sent first,
 	then follow \c B_ARGV_RECEIVED, \c B_REFS_RECEIVED and finally
 	\c B_READ_TO_RUN.
-	
+
 	\c B_ARGV_RECEIVED is sent only, if \a args is not \c NULL and contains
 	more than one element. \c B_REFS_RECEIVED is sent only, if \a ref is not
 	\c NULL.
@@ -2406,7 +2414,7 @@
 			for (int32 i = 0; i &lt; argc; i++)
 				message.AddString(&quot;argv&quot;, args[i]);
 			messenger.SendMessage(&amp;message);
-		} else if (ref) { 
+		} else if (ref) {
 			printf(&quot;_SendToRunning : B_REFS_RECEIVED\n&quot;);
 			BMessage message(B_REFS_RECEIVED);
 			message.AddRef(&quot;refs&quot;, ref);
@@ -2521,9 +2529,9 @@
 // LoadRecentLists
 /*! \brief Loads the system's recently used document, folder, and
 	application lists from the specified file.
-	
+
 	\note The current lists are cleared before loading the new lists
-	
+
 	\param filename The name of the file to load from
 */
 void
@@ -2553,7 +2561,7 @@
 // SaveRecentLists
 /*! \brief Saves the system's recently used document, folder, and
 	application lists to the specified file.
-	
+
 	\param filename The name of the file to save to
 */
 void
@@ -2843,6 +2851,6 @@
 		else if (modificationTime1 &gt; modificationTime2)
 			result = 1;
 	}
-	return result;	
+	return result;
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016495.html">[Haiku-commits] r30622 -	haiku/trunk/src/add-ons/accelerants/common
</A></li>
	<LI>Next message: <A HREF="016489.html">[Haiku-commits] r30624 - haiku/trunk/src/kits/app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16488">[ date ]</a>
              <a href="thread.html#16488">[ thread ]</a>
              <a href="subject.html#16488">[ subject ]</a>
              <a href="author.html#16488">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
