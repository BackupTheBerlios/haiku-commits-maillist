<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r26376 - in haiku/branches/developer/bonefish/vm:	headers/libs/agg headers/os/bluetooth/HCI	headers/os/interface headers/posix headers/private/app	headers/private/kernel headers/private/kernel/disk_device_manager	headers/private/kernel/fs headers/private/kernel/util	headers/private/libroot src/add-ons/kernel/drivers/audio/hda	src/add-ons/kernel/drivers/bluetooth/h2/h2generic	src/kits/interface src/preferences/fonts	src/preferences/print src/servers/app	src/servers/app/drawing/Painter	src/servers/app/drawing/Painter/drawing_modes	src/servers/bluetooth src/system/kernel	src/system/kernel/debug src/system/kernel/device_manager	src/system/kernel/disk_device_manager src/system/kernel/fs	src/system/kernel/messaging src/system/libroot/os	src/system/libroot/posix src/system/runtime_loader
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26376%20-%20in%20haiku/branches/developer/bonefish/vm%3A%0A%09headers/libs/agg%20headers/os/bluetooth/HCI%0A%09headers/os/interface%20headers/posix%20headers/private/app%0A%09headers/private/kernel%20headers/private/kernel/disk_device_manager%0A%09headers/private/kernel/fs%20headers/private/kernel/util%0A%09headers/private/libroot%20src/add-ons/kernel/drivers/audio/hda%0A%09src/add-ons/kernel/drivers/bluetooth/h2/h2generic%0A%09src/kits/interface%20src/preferences/fonts%0A%09src/preferences/print%20src/servers/app%0A%09src/servers/app/drawing/Painter%0A%09src/servers/app/drawing/Painter/drawing_modes%0A%09src/servers/bluetooth%20src/system/kernel%0A%09src/system/kernel/debug%20src/system/kernel/device_manager%0A%09src/system/kernel/disk_device_manager%20src/system/kernel/fs%0A%09src/system/kernel/messaging%20src/system/libroot/os%0A%09src/system/libroot/posix%20src/system/runtime_loader&In-Reply-To=%3C200807102004.m6AK4cBd023402%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010191.html">
   <LINK REL="Next"  HREF="010193.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r26376 - in haiku/branches/developer/bonefish/vm:	headers/libs/agg headers/os/bluetooth/HCI	headers/os/interface headers/posix headers/private/app	headers/private/kernel headers/private/kernel/disk_device_manager	headers/private/kernel/fs headers/private/kernel/util	headers/private/libroot src/add-ons/kernel/drivers/audio/hda	src/add-ons/kernel/drivers/bluetooth/h2/h2generic	src/kits/interface src/preferences/fonts	src/preferences/print src/servers/app	src/servers/app/drawing/Painter	src/servers/app/drawing/Painter/drawing_modes	src/servers/bluetooth src/system/kernel	src/system/kernel/debug src/system/kernel/device_manager	src/system/kernel/disk_device_manager src/system/kernel/fs	src/system/kernel/messaging src/system/libroot/os	src/system/libroot/posix src/system/runtime_loader</H1>
    <B>bonefish at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26376%20-%20in%20haiku/branches/developer/bonefish/vm%3A%0A%09headers/libs/agg%20headers/os/bluetooth/HCI%0A%09headers/os/interface%20headers/posix%20headers/private/app%0A%09headers/private/kernel%20headers/private/kernel/disk_device_manager%0A%09headers/private/kernel/fs%20headers/private/kernel/util%0A%09headers/private/libroot%20src/add-ons/kernel/drivers/audio/hda%0A%09src/add-ons/kernel/drivers/bluetooth/h2/h2generic%0A%09src/kits/interface%20src/preferences/fonts%0A%09src/preferences/print%20src/servers/app%0A%09src/servers/app/drawing/Painter%0A%09src/servers/app/drawing/Painter/drawing_modes%0A%09src/servers/bluetooth%20src/system/kernel%0A%09src/system/kernel/debug%20src/system/kernel/device_manager%0A%09src/system/kernel/disk_device_manager%20src/system/kernel/fs%0A%09src/system/kernel/messaging%20src/system/libroot/os%0A%09src/system/libroot/posix%20src/system/runtime_loader&In-Reply-To=%3C200807102004.m6AK4cBd023402%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r26376 - in haiku/branches/developer/bonefish/vm:	headers/libs/agg headers/os/bluetooth/HCI	headers/os/interface headers/posix headers/private/app	headers/private/kernel headers/private/kernel/disk_device_manager	headers/private/kernel/fs headers/private/kernel/util	headers/private/libroot src/add-ons/kernel/drivers/audio/hda	src/add-ons/kernel/drivers/bluetooth/h2/h2generic	src/kits/interface src/preferences/fonts	src/preferences/print src/servers/app	src/servers/app/drawing/Painter	src/servers/app/drawing/Painter/drawing_modes	src/servers/bluetooth src/system/kernel	src/system/kernel/debug src/system/kernel/device_manager	src/system/kernel/disk_device_manager src/system/kernel/fs	src/system/kernel/messaging src/system/libroot/os	src/system/libroot/posix src/system/runtime_loader">bonefish at mail.berlios.de
       </A><BR>
    <I>Thu Jul 10 22:04:38 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="010191.html">[Haiku-commits] r26375 - in haiku/branches/developer/bonefish/vm:	headers/private/kernel src/system/kernel src/system/kernel/vm
</A></li>
        <LI>Next message: <A HREF="010193.html">[Haiku-commits] r26377 - in haiku/trunk: headers/private/net	src/kits/network src/kits/network/libnetapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10192">[ date ]</a>
              <a href="thread.html#10192">[ thread ]</a>
              <a href="subject.html#10192">[ subject ]</a>
              <a href="author.html#10192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2008-07-10 22:03:36 +0200 (Thu, 10 Jul 2008)
New Revision: 26376
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=26376&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=26376&amp;view=rev</A>

Added:
   haiku/branches/developer/bonefish/vm/headers/private/libroot/dirent_private.h
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/AdvancedSettingsView.cpp
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/AdvancedSettingsView.h
   haiku/branches/developer/bonefish/vm/src/servers/app/agg_scanline_storage_subpix.h
   haiku/branches/developer/bonefish/vm/src/servers/app/agg_scanline_u_subpix.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/agg_renderer_scanline_subpix.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAddSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaCCSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaCOSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaCOSolidSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaPCSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaPOSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeAlphaPOSolidSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeBlendSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeCopySUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeCopySolidSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeCopyTextSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeEraseSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeInvertSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeMaxSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeMinSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeOverSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeOverSolidSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeSelectSUBPIX.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingModeSubtractSUBPIX.h
Modified:
   haiku/branches/developer/bonefish/vm/headers/libs/agg/agg_renderer_base.h
   haiku/branches/developer/bonefish/vm/headers/os/bluetooth/HCI/btHCI_transport.h
   haiku/branches/developer/bonefish/vm/headers/os/interface/View.h
   haiku/branches/developer/bonefish/vm/headers/posix/dirent.h
   haiku/branches/developer/bonefish/vm/headers/private/app/ServerProtocol.h
   haiku/branches/developer/bonefish/vm/headers/private/kernel/boot_splash.h
   haiku/branches/developer/bonefish/vm/headers/private/kernel/disk_device_manager/KDiskDeviceManager.h
   haiku/branches/developer/bonefish/vm/headers/private/kernel/fs/node_monitor.h
   haiku/branches/developer/bonefish/vm/headers/private/kernel/util/KMessage.h
   haiku/branches/developer/bonefish/vm/headers/private/kernel/util/OpenHashTable.h
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2generic.c
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2util.c
   haiku/branches/developer/bonefish/vm/src/kits/interface/Font.cpp
   haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp
   haiku/branches/developer/bonefish/vm/src/kits/interface/Window.cpp
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.cpp
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.h
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontView.h
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontsSettings.cpp
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/Jamfile
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.cpp
   haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.h
   haiku/branches/developer/bonefish/vm/src/preferences/print/AddPrinterDialog.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/Desktop.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/Desktop.h
   haiku/branches/developer/bonefish/vm/src/servers/app/DesktopSettings.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/DesktopSettings.h
   haiku/branches/developer/bonefish/vm/src/servers/app/DesktopSettingsPrivate.h
   haiku/branches/developer/bonefish/vm/src/servers/app/FontCacheEntry.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/FontCacheEntry.h
   haiku/branches/developer/bonefish/vm/src/servers/app/FontEngine.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/FontEngine.h
   haiku/branches/developer/bonefish/vm/src/servers/app/ProfileMessageSupport.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/ServerApp.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/ServerApp.h
   haiku/branches/developer/bonefish/vm/src/servers/app/Window.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/Window.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/AGGTextRenderer.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/AGGTextRenderer.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/Painter.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/Painter.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/agg_renderer_region.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/defines.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/DrawingMode.h
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/PixelFormat.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/drawing_modes/PixelFormat.h
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/BluetoothServer.cpp
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.cpp
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/LocalDeviceHandler.cpp
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/LocalDeviceHandler.h
   haiku/branches/developer/bonefish/vm/src/system/kernel/boot_splash.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/debug/blue_screen.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/device_manager/devfs.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/disk_device_manager/KDiskDeviceManager.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/elf.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/fs/node_monitor.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/fs/rootfs.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/fs/vfs_boot.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/main.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/messaging/KMessage.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/module.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/team.cpp
   haiku/branches/developer/bonefish/vm/src/system/libroot/os/fs_attr.c
   haiku/branches/developer/bonefish/vm/src/system/libroot/os/fs_index.c
   haiku/branches/developer/bonefish/vm/src/system/libroot/os/fs_query.cpp
   haiku/branches/developer/bonefish/vm/src/system/libroot/posix/dirent.c
   haiku/branches/developer/bonefish/vm/src/system/runtime_loader/utility.cpp
Log:
Synchronized with trunk r26375.


Modified: haiku/branches/developer/bonefish/vm/headers/libs/agg/agg_renderer_base.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/libs/agg/agg_renderer_base.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/libs/agg/agg_renderer_base.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -205,7 +205,23 @@
 
             m_ren-&gt;blend_hline(x1, y, x2 - x1 + 1, c, cover);
         }
+		
+		//--------------------------------------------------------------------
+        void blend_hline_subpix(int x1, int y, int x2, 
+                                const color_type&amp; c, cover_type cover)
+        {
+            if(x1 &gt; x2) { int t = x2; x2 = x1; x1 = t; }
+            if(y  &gt; ymax()) return;
+            if(y  &lt; ymin()) return;
+            if(x1 &gt; xmax()) return;
+            if(x2 &lt; xmin()) return;
 
+            if(x1 &lt; xmin()) x1 = xmin();
+            if(x2 &gt; xmax()) x2 = xmax();
+
+            m_ren-&gt;blend_hline_subpix(x1, y, x2 - x1 + 1, c, cover);
+        }
+
         //--------------------------------------------------------------------
         void blend_vline(int x, int y1, int y2, 
                          const color_type&amp; c, cover_type cover)
@@ -280,7 +296,30 @@
             }
             m_ren-&gt;blend_solid_hspan(x, y, len, c, covers);
         }
+		
+		//--------------------------------------------------------------------
+        void blend_solid_hspan_subpix(int x, int y, int len, 
+                                      const color_type&amp; c, 
+                                      const cover_type* covers)
+        {
+            if(y &gt; ymax()) return;
+            if(y &lt; ymin()) return;
 
+            if(x &lt; xmin())
+            {
+                len -= 3 * (xmin() - x);
+                if(len &lt;= 0) return;
+                covers += 3*(xmin() - x);
+                x = xmin();
+            }
+            if(x + len / 3 &gt; xmax())
+            {
+                len = 3 * (xmax() - x + 1);
+                if(len &lt;= 0) return;
+            }
+            m_ren-&gt;blend_solid_hspan_subpix(x, y, len, c, covers);
+        }
+
         //--------------------------------------------------------------------
         void blend_solid_vspan(int x, int y, int len, 
                                const color_type&amp; c, 

Modified: haiku/branches/developer/bonefish/vm/headers/os/bluetooth/HCI/btHCI_transport.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/os/bluetooth/HCI/btHCI_transport.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/os/bluetooth/HCI/btHCI_transport.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -13,11 +13,11 @@
 #include &lt;net_buffer.h&gt;
 #include &lt;Drivers.h&gt;
 
-typedef enum { ANCILLYANT = 1, 
-               RUNNING, 
-               LEAVING,
-               SENDING,
-               PROCESSING
+typedef enum { ANCILLYANT = (1&lt;&lt;0), 
+               RUNNING    = (1&lt;&lt;1), 
+               LEAVING    = (1&lt;&lt;2),
+               SENDING    = (1&lt;&lt;3),
+               PROCESSING = (1&lt;&lt;4)
               } bt_transport_status_t;
 
 typedef uint8 bt_stat_t; 
@@ -84,6 +84,7 @@
 
 enum {
 	ISSUE_BT_COMMAND = B_DEVICE_OP_CODES_END + BT_IOCTLS_OFFSET ,
+	BT_UP,
 	GET_STATICS,
 	GET_NOTIFICATION_PORT, 
     GET_HCI_ID

Modified: haiku/branches/developer/bonefish/vm/headers/os/interface/View.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/os/interface/View.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/os/interface/View.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -43,7 +43,11 @@
 enum {
 	B_LOCK_WINDOW_FOCUS		= 0x00000001,
 	B_SUSPEND_VIEW_FOCUS	= 0x00000002,
-	B_NO_POINTER_HISTORY	= 0x00000004
+	B_NO_POINTER_HISTORY	= 0x00000004,
+	// new in Haiku (unless this flag is
+	// specified, both BWindow and BView::GetMouse()
+	// will filter out older mouse moved messages)
+	B_FULL_POINTER_HISTORY	= 0x00000008
 };
 
 enum {

Modified: haiku/branches/developer/bonefish/vm/headers/posix/dirent.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/posix/dirent.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/posix/dirent.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -1,6 +1,7 @@
-/* 
-** Distributed under the terms of the Haiku License.
-*/
+/*
+ * Copyright 2002-2008, Haiku Inc. All Rights Reserved.
+ * Distributed under the terms of the MIT License.
+ */
 #ifndef _DIRENT_H
 #define _DIRENT_H
 
@@ -17,10 +18,7 @@
 	char			d_name[1];	/* name of the entry (null byte terminated) */
 } dirent_t;
 
-typedef struct {
-	int				fd;
-	struct dirent	ent;
-} DIR;
+typedef struct __DIR DIR;
 
 #ifndef MAXNAMLEN
 #	ifdef  NAME_MAX

Modified: haiku/branches/developer/bonefish/vm/headers/private/app/ServerProtocol.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/private/app/ServerProtocol.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/private/app/ServerProtocol.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -6,6 +6,7 @@
  *		DarkWyrm &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bpmagic at columbus.rr.com</A>&gt;
  *		J&#233;r&#244;me Duval, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jerome.duval at free.fr</A>
  *		Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de</A>
+ *		Andrej Spielmann, &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">andrej.spielmann at seh.ox.ac.uk</A>&gt;
  */
 #ifndef APP_SERVER_PROTOCOL_H
 #define APP_SERVER_PROTOCOL_H
@@ -188,6 +189,11 @@
 	AS_GET_SHOW_ALL_DRAGGERS,
 	AS_SET_SHOW_ALL_DRAGGERS,
 
+	AS_SET_FONT_SUBPIXEL_ANTIALIASING,
+	AS_GET_FONT_SUBPIXEL_ANTIALIASING,
+	AS_SET_HINTING,
+	AS_GET_HINTING,
+
 	// Graphics calls
 	AS_SET_HIGH_COLOR,
 	AS_SET_LOW_COLOR,

Modified: haiku/branches/developer/bonefish/vm/headers/private/kernel/boot_splash.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/private/kernel/boot_splash.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/private/kernel/boot_splash.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -29,6 +29,7 @@
 #endif
 
 void boot_splash_init(uint8 * boot_splash);
+void boot_splash_uninit(void);
 void boot_splash_set_stage(int stage);
 
 #ifdef __cplusplus

Modified: haiku/branches/developer/bonefish/vm/headers/private/kernel/disk_device_manager/KDiskDeviceManager.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/private/kernel/disk_device_manager/KDiskDeviceManager.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/private/kernel/disk_device_manager/KDiskDeviceManager.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -102,6 +102,7 @@
 	struct DiskSystemMap;
 	struct PartitionMap;
 	struct PartitionSet;
+	class DiskSystemWatcher;
 	class DeviceWatcher;
 
 	static status_t _CheckMediaStatusDaemon(void* self);
@@ -132,6 +133,7 @@
 	PartitionSet				*fObsoletePartitions;
 	thread_id					fMediaChecker;
 	volatile bool				fTerminating;
+	DiskSystemWatcher			*fDiskSystemWatcher;
 	DeviceWatcher				*fDeviceWatcher;
 
 	static KDiskDeviceManager	*sDefaultManager;

Modified: haiku/branches/developer/bonefish/vm/headers/private/kernel/fs/node_monitor.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/private/kernel/fs/node_monitor.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/private/kernel/fs/node_monitor.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -17,9 +17,9 @@
 
 class NotificationListener;
 
-extern status_t remove_node_listener(dev_t device, dev_t node,
+extern status_t remove_node_listener(dev_t device, ino_t node,
 	NotificationListener&amp; listener);
-extern status_t add_node_listener(dev_t device, dev_t node, uint32 flags,
+extern status_t add_node_listener(dev_t device, ino_t node, uint32 flags,
 	NotificationListener&amp; listener);
 
 extern &quot;C&quot; {

Modified: haiku/branches/developer/bonefish/vm/headers/private/kernel/util/KMessage.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/private/kernel/util/KMessage.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/private/kernel/util/KMessage.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -1,4 +1,4 @@
-/* 
+/*
  * Copyright 2005-2007, Ingo Weinhold, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bonefish at users.sf.net.</A> All rights reserved.
  * Distributed under the terms of the MIT License.
  */
@@ -55,6 +55,7 @@
 	status_t FindField(const char *name, type_code type,
 		KMessageField *field) const;
 	status_t GetNextField(KMessageField *field) const;
+	bool IsEmpty() const;
 
 	status_t AddData(const char *name, type_code type, const void *data,
 		int32 numBytes, bool isFixedSize = true);
@@ -135,7 +136,7 @@
 	status_t ReceiveFrom(port_id fromPort, bigtime_t timeout = -1,
 		port_message_info* messageInfo = NULL);
 
-	void Dump(void (*printFunc)(const char*,...));
+	void Dump(void (*printFunc)(const char*, ...)) const;
 
 private:
 	friend class KMessageField;
@@ -201,7 +202,7 @@
 	type_code TypeCode() const;
 	bool HasFixedElementSize() const;
 	int32 ElementSize() const;		// if HasFixedElementSize()
-	
+
 	status_t AddElement(const void *data, int32 size = -1);
 	status_t AddElements(const void *data, int32 count, int32 elementSize = -1);
 	const void *ElementAt(int32 index, int32 *size = NULL) const;

Modified: haiku/branches/developer/bonefish/vm/headers/private/kernel/util/OpenHashTable.h
===================================================================
--- haiku/branches/developer/bonefish/vm/headers/private/kernel/util/OpenHashTable.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/headers/private/kernel/util/OpenHashTable.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -1,9 +1,6 @@
 /*
  * Copyright 2007, Hugo Santos. All Rights Reserved.
  * Distributed under the terms of the MIT License.
- *
- * Authors:
- *      Hugo Santos, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">hugosantos at gmail.com</A>
  */
 #ifndef _KERNEL_UTIL_OPEN_HASH_TABLE_H
 #define _KERNEL_UTIL_OPEN_HASH_TABLE_H
@@ -20,7 +17,7 @@
 
 	struct Foo : HashTableLink&lt;Foo&gt; {
 		int bar;
-	
+
 		HashTableLink&lt;Foo&gt; otherLink;
 	};
 
@@ -126,6 +123,8 @@
 		fItemCount++;
 	}
 
+	// TODO: a ValueType* Remove(const KeyType&amp; key) method is missing
+
 	bool Remove(ValueType *value)
 	{
 		if (!RemoveUnchecked(value))

Copied: haiku/branches/developer/bonefish/vm/headers/private/libroot/dirent_private.h (from rev 26375, haiku/trunk/headers/private/libroot/dirent_private.h)

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -41,8 +41,7 @@
 #define MAX_INPUTS				32
 #define MAX_IO_WIDGETS			8
 
-/* FIXME: Find out why we need so much! */
-#define DEFAULT_FRAMES_PER_BUFFER	4096
+#define DEFAULT_FRAMES_PER_BUFFER	512
 
 #define STREAM_MAX_BUFFERS	10
 #define STREAM_MIN_BUFFERS	2

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2generic.c
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2generic.c	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2generic.c	2008-07-10 20:03:36 UTC (rev 26376)
@@ -429,8 +429,8 @@
 	}	
 	
 	acquire_sem(bdev-&gt;lock);	
-	// Set HCI_RUNNING
-	if ( TEST_AND_SET(&amp;bdev-&gt;state, RUNNING) ) {
+	// Set RUNNING
+	if ( TEST_AND_SET(&amp;bdev-&gt;state, ANCILLYANT) ) {
 	    flowf(&quot;dev already running! - reOpened device!\n&quot;);
 	    return B_ERROR;
 	}	
@@ -451,7 +451,7 @@
 	// dumping the USB frames	
     init_room(&amp;bdev-&gt;eventRoom);
     init_room(&amp;bdev-&gt;aclRoom);
-    //Init_room(new_bt_dev-&gt;scoRoom);
+    //init_room(new_bt_dev-&gt;scoRoom);
     
    	list_init(&amp;bdev-&gt;snetBufferRecycleTrash);		
     			
@@ -470,37 +470,15 @@
         hdev = bdev-&gt;num;
     }    	
 	bdev-&gt;hdev = hdev;		
+		
 
-	//  H: set the special flags
 
-    //  EVENTS
-	err = submit_rx_event(bdev);
-	if (err != B_OK)    
-	    goto unrun;	    
-#if BT_DRIVER_SUPPORTS_ACL        	
-	// ACL
-	for (i = 0; i &lt; MAX_ACL_IN_WINDOW; i++)  {		
-		err = submit_rx_acl(bdev);
-		if (err != B_OK &amp;&amp; i == 0 )
-		    goto unrun;			    
-	}
-#endif
-
-#if BT_DRIVER_SUPPORTS_SCO
-	// TODO:  SCO / eSCO
-#endif	
-		
 	*cookie = bdev;	
 	release_sem(bdev-&gt;lock);	
 
 	flowf(&quot; successful\n&quot;);
 	return B_OK;
 
-unrun:
-    CLEAR_BIT(bdev-&gt;state, RUNNING);	// Set the flaq in the HCI world
-	flowf(&quot;Queuing failed device stops running\n&quot;);
-
-	return err;
 }
 
 
@@ -617,13 +595,42 @@
 		    snb_put(snbuf, params, size);
 			
 			err = submit_tx_command(bdev, snbuf);
-		    		
+			debugf(&quot;device launched %ld\n&quot;, err);				    		
 		break;
 		
+		case BT_UP:
+
+		    //  EVENTS
+			err = submit_rx_event(bdev);
+			if (err != B_OK) {
+			    CLEAR_BIT(bdev-&gt;state, ANCILLYANT);
+				flowf(&quot;Queuing failed device stops running\n&quot;);
+				break;
+			}
+			
+			#if BT_DRIVER_SUPPORTS_ACL // ACL
+			for (i = 0; i &lt; MAX_ACL_IN_WINDOW; i++) {
+				err = submit_rx_acl(bdev);
+				if (err != B_OK &amp;&amp; i == 0 ) {
+	  			    CLEAR_BIT(bdev-&gt;state, ANCILLYANT);	// Set the flaq in the HCI world
+					flowf(&quot;Queuing failed device stops running\n&quot;);
+					break;
+			   	}
+			}
+			#endif
+			
+			SET_BIT(bdev-&gt;state, RUNNING);
+			
+			#if BT_DRIVER_SUPPORTS_SCO
+				// TODO:  SCO / eSCO
+			#endif
+			flowf(&quot;device launched\n&quot;);
+		break;
+		
 		case GET_STATICS:
 		    memcpy(params, &amp;bdev-&gt;stat, sizeof(bt_hci_statistics));
 		    err = B_OK;
-		break;		
+		break;
 
 		case GET_HCI_ID:
 		    *(hci_id*)params = bdev-&gt;hdev;

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2util.c
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2util.c	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/bluetooth/h2/h2generic/h2util.c	2008-07-10 20:03:36 UTC (rev 26376)
@@ -62,12 +62,14 @@
 void
 nb_destroy(net_buffer* nbuf)
 {
+	if (nbuf == NULL)
+		return;
 
     /* Free possible allocated */
     if (nbuf-&gt;COOKIEFIELD != NULL)
         free((void*)nbuf-&gt;COOKIEFIELD);
 
-// TODO check for survivers...
+	// TODO check for survivers...
 	if (nb != NULL)
 	    nb-&gt;free(nbuf);
     

Modified: haiku/branches/developer/bonefish/vm/src/kits/interface/Font.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/kits/interface/Font.cpp	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/kits/interface/Font.cpp	2008-07-10 20:03:36 UTC (rev 26376)
@@ -7,6 +7,7 @@
  *		J&#233;r&#244;me Duval, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">jerome.duval at free.fr</A>
  *		Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de</A>
  *		Stephan A&#223;mus &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">superstippi at gmx.de</A>&gt;
+ *		Andrej Spielmann, &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">andrej.spielmann at seh.ox.ac.uk</A>&gt;
  */
 
 
@@ -183,7 +184,7 @@
 				delete family;
 				return B_NO_MEMORY;
 			}
-			
+
 			link.ReadString(style-&gt;name);
 			link.Read&lt;uint16&gt;(&amp;style-&gt;face);
 			link.Read&lt;uint32&gt;(&amp;style-&gt;flags);
@@ -365,12 +366,12 @@
 	\param family the new family for the system font
 	\param style the new style for the system font
 	\param size the size for the system font to have
-	
+
 	R5 used a global area offset table to set the system fonts in the Font
 	preferences panel. Bleah.
 */
 void
-_set_system_font_(const char *which, font_family family, font_style style, 
+_set_system_font_(const char *which, font_family family, font_style style,
 	float size)
 {
 	BPrivate::AppServerLink link;
@@ -405,6 +406,59 @@
 }
 
 
+void
+_set_font_subpixel_antialiasing_(bool subpix)
+{
+	BPrivate::AppServerLink link;
+
+	link.StartMessage(AS_SET_FONT_SUBPIXEL_ANTIALIASING);
+	link.Attach&lt;bool&gt;(subpix);
+	link.Flush();
+}
+
+
+status_t
+_get_font_subpixel_antialiasing_(bool* subpix)
+{
+	BPrivate::AppServerLink link;
+
+	link.StartMessage(AS_GET_FONT_SUBPIXEL_ANTIALIASING);
+	int32 status = B_ERROR;
+	if (link.FlushWithReply(status) != B_OK
+		|| status &lt; B_OK)
+		return status;
+	link.Read&lt;bool&gt;(subpix);
+	return B_OK;
+}
+
+
+void
+_set_hinting_(bool hinting)
+{
+	BPrivate::AppServerLink link;
+
+	link.StartMessage(AS_SET_HINTING);
+	link.Attach&lt;bool&gt;(hinting);
+	link.Flush();
+}
+
+
+status_t
+_get_hinting_(bool* hinting)
+{
+
+	BPrivate::AppServerLink link;
+
+	link.StartMessage(AS_GET_HINTING);
+	int32 status = B_ERROR;
+	if (link.FlushWithReply(status) != B_OK
+		|| status &lt; B_OK)
+		return status;
+	link.Read&lt;bool&gt;(hinting);
+	return B_OK;
+}
+
+
 /*!
 	\brief Returns the number of installed font families
 	\return The number of installed font families
@@ -469,7 +523,7 @@
 	\param flags if non-NULL, the values of the flags IS_FIXED and
 		B_HAS_TUNED_FONT are returned
 	\return B_ERROR if the index does not correspond to a font style
-	
+
 	The face value returned by this function is not very reliable. At the same
 	time, the value returned should be fairly reliable, returning the proper
 	flag for 90%-99% of font names.
@@ -500,7 +554,7 @@
 //	#pragma mark -
 
 
-BFont::BFont() 
+BFont::BFont()
 	:
 	// initialise for be_plain_font (avoid circular definition)
 	fFamilyID(0),
@@ -619,7 +673,7 @@
 	\param family Font family to set
 	\param face Font face to set.
 	\return B_ERROR if family does not exists or face is an invalid value.
-	
+
 	To comply with the BeBook, this function will only set valid values - i.e.
 	passing a nonexistent family will cause only the face to be set.
 	Additionally, if a particular  face does not exist in a family, the closest
@@ -817,8 +871,8 @@
 	_GetExtraFlags();
 	return (font_direction)(fExtraFlags &gt;&gt; B_PRIVATE_FONT_DIRECTION_SHIFT);
 }
- 
 
+
 bool
 BFont::IsFixed() const
 {
@@ -830,7 +884,7 @@
 /*!
 	\brief Returns true if the font is fixed-width and contains both full
 		   and half-width characters
-	
+
 	This was left unimplemented as of R5. It was a way to work with both
 	Kanji and Roman characters in the same fixed-width font.
 */
@@ -943,7 +997,7 @@
 
 
 void
-BFont::GetTruncatedStrings(const char *stringArray[], int32 numStrings, 
+BFont::GetTruncatedStrings(const char *stringArray[], int32 numStrings,
 	uint32 mode, float width, BString resultArray[]) const
 {
 	if (stringArray &amp;&amp; resultArray &amp;&amp; numStrings &gt; 0) {
@@ -967,7 +1021,7 @@
 
 
 void
-BFont::GetTruncatedStrings(const char *stringArray[], int32 numStrings, 
+BFont::GetTruncatedStrings(const char *stringArray[], int32 numStrings,
 	uint32 mode, float width, char *resultArray[]) const
 {
 	if (stringArray &amp;&amp; numStrings &gt; 0) {
@@ -1018,7 +1072,7 @@
 
 
 void
-BFont::GetStringWidths(const char *stringArray[], const int32 lengthArray[], 
+BFont::GetStringWidths(const char *stringArray[], const int32 lengthArray[],
 	int32 numStrings, float widthArray[]) const
 {
 	if (!stringArray || !lengthArray || numStrings &lt; 1 || !widthArray)
@@ -1232,7 +1286,7 @@
 	link.Attach&lt;float&gt;(fShear);
 	link.Attach&lt;float&gt;(fFalseBoldWidth);
 	link.Attach&lt;uint8&gt;(fSpacing);
-	
+
 	link.Attach&lt;uint32&gt;(fFlags);
 	link.Attach&lt;font_metric_mode&gt;(mode);
 	link.Attach&lt;bool&gt;(string_escapement);

Modified: haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp	2008-07-10 20:03:36 UTC (rev 26376)
@@ -1393,7 +1393,11 @@
 {
 	_CheckOwnerLockAndSwitchCurrent();
 
-	if (checkMessageQueue) {
+	uint32 eventOptions = fEventOptions | fMouseEventOptions;
+	bool noHistory = eventOptions &amp; B_NO_POINTER_HISTORY;
+	bool fullHistory = eventOptions &amp; B_FULL_POINTER_HISTORY;
+
+	if (checkMessageQueue &amp;&amp; !noHistory) {
 		Window()-&gt;UpdateIfNeeded();
 		BMessageQueue *queue = Window()-&gt;MessageQueue();
 		queue-&gt;Lock();
@@ -1410,6 +1414,30 @@
 					if (!Window()-&gt;_StealMouseMessage(message, deleteMessage))
 						continue;
 
+					if (!fullHistory &amp;&amp; message-&gt;what == B_MOUSE_MOVED) {
+						// Check if the message is too old. Some applications
+						// check the message queue in such a way that mouse
+						// messages *must* pile up. This check makes them work
+						// as intended, although these applications could simply
+						// use the version of BView::GetMouse() that does not
+						// check the history. Also note that it isn't a problem
+						// to delete the message in case there is not a newer
+						// one. If we don't find a message in the queue, we will
+						// just fall back to asking the app_sever directly. So
+						// the imposed delay will not be a problem on slower
+						// computers. This check also prevents another problem,
+						// when the message that we use is *not* removed from
+						// the queue. Subsequent calls to GetMouse() would find
+						// this message over and over!
+						bigtime_t eventTime;
+						if (message-&gt;FindInt64(&quot;when&quot;, &amp;eventTime) == B_OK
+							&amp;&amp; system_time() - eventTime &gt; 10000) {
+							// just discard the message
+							if (deleteMessage)
+								delete message;
+							continue;
+						}
+					}
 					message-&gt;FindPoint(&quot;screen_where&quot;, location);
 					message-&gt;FindInt32(&quot;buttons&quot;, (int32 *)buttons);
 					queue-&gt;Unlock();

Modified: haiku/branches/developer/bonefish/vm/src/kits/interface/Window.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/kits/interface/Window.cpp	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/kits/interface/Window.cpp	2008-07-10 20:03:36 UTC (rev 26376)
@@ -1092,8 +1092,34 @@
 		case B_MOUSE_MOVED:
 		{
 			if (BView *view = dynamic_cast&lt;BView *&gt;(target)) {
-				if (((view-&gt;fEventOptions | view-&gt;fMouseEventOptions)
-						&amp; B_NO_POINTER_HISTORY) != 0) {
+
+				uint32 eventOptions = view-&gt;fEventOptions
+					| view-&gt;fMouseEventOptions;
+				bool noHistory = eventOptions &amp; B_NO_POINTER_HISTORY;
+				bool dropIfLate = !(eventOptions &amp; B_FULL_POINTER_HISTORY);
+
+				bigtime_t eventTime;
+				if (msg-&gt;FindInt64(&quot;when&quot;, (int64*)&amp;eventTime) &lt; B_OK)
+					eventTime = system_time();
+
+				uint32 transit;
+				msg-&gt;FindInt32(&quot;be:transit&quot;, (int32*)&amp;transit);
+				// don't drop late messages with these important transit values
+				if (transit == B_ENTERED_VIEW || transit == B_EXITED_VIEW)
+					dropIfLate = false;
+
+				// TODO: The dropping code may have the following problem:
+				// On slower computers, 20ms may just be to abitious a delay.
+				// There, we might constantly check the message queue for a
+				// newer message, not find any, and still use the only but
+				// later than 20ms message, which of course makes the whole
+				// thing later than need be. An adaptive delay would be
+				// kind of neat, but would probably use additional BWindow
+				// members to count the successful versus fruitless queue
+				// searches and the delay value itself or something similar.
+
+				if (noHistory
+					|| (dropIfLate &amp;&amp; (system_time() - eventTime &gt; 20000))) {
 					// filter out older mouse moved messages in the queue
 					_DequeueAll();
 					BMessageQueue *queue = MessageQueue();
@@ -1102,6 +1128,9 @@
 					BMessage *moved;
 					for (int32 i = 0; (moved = queue-&gt;FindMessage(i)) != NULL; i++) {
 						if (moved != msg &amp;&amp; moved-&gt;what == B_MOUSE_MOVED) {
+							// there is a newer mouse moved message in the
+							// queue, just ignore the current one, the newer one
+							// will be handled here eventually
 							queue-&gt;Unlock();
 							return;
 						}
@@ -1111,19 +1140,9 @@
 
 				BPoint where;
 				uint32 buttons;
-				uint32 transit;
 				msg-&gt;FindPoint(&quot;be:view_where&quot;, &amp;where);
 				msg-&gt;FindInt32(&quot;buttons&quot;, (int32*)&amp;buttons);
-				msg-&gt;FindInt32(&quot;be:transit&quot;, (int32*)&amp;transit);
 
-#if 0
-				bigtime_t when;
-				if (msg-&gt;FindInt64(&quot;when&quot;, (int64*)&amp;when) &lt; B_OK)
-					printf(&quot;BWindow B_MOUSE_MOVED no when\n&quot;);
-				else if (system_time() - when &gt; 5000)
-					printf(&quot;BWindow B_MOUSE_MOVED lagging behind\n&quot;);
-#endif
-
 				BMessage* dragMessage = NULL;
 				if (msg-&gt;HasMessage(&quot;be:drag_message&quot;)) {
 					dragMessage = new BMessage();

Copied: haiku/branches/developer/bonefish/vm/src/preferences/fonts/AdvancedSettingsView.cpp (from rev 26375, haiku/trunk/src/preferences/fonts/AdvancedSettingsView.cpp)

Copied: haiku/branches/developer/bonefish/vm/src/preferences/fonts/AdvancedSettingsView.h (from rev 26375, haiku/trunk/src/preferences/fonts/AdvancedSettingsView.h)

Modified: haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.cpp	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.cpp	2008-07-10 20:03:36 UTC (rev 26376)
@@ -114,7 +114,7 @@
 	// it doesn't overlap the box outline.
 	rect = fPreviewBox-&gt;Bounds().InsetByCopy(3, 3);
 	fPreviewText = new BStringView(rect, &quot;preview text&quot;,
-		&quot;The quick brown fox jumps over the lazy dog.&quot;, 
+		&quot;The quick brown fox jumps over the lazy dog.&quot;,
 		B_FOLLOW_LEFT_RIGHT);
 	fPreviewText-&gt;SetFont(&amp;fCurrentFont);
 	fPreviewBox-&gt;AddChild(fPreviewText);
@@ -172,7 +172,7 @@
 	GetPreferredSize(&amp;width, &amp;height);
 
 	if (width &gt; Bounds().Width()) {
-		fSizesMenuField-&gt;MoveTo(fMaxFontNameWidth + fDivider + 40.0f, 
+		fSizesMenuField-&gt;MoveTo(fMaxFontNameWidth + fDivider + 40.0f,
 				fFontsMenuField-&gt;Bounds().top);
 		ResizeTo(width, height);
 	}
@@ -424,7 +424,7 @@
 void
 FontSelectionView::UpdateFontsMenu()
 {
-	int32 numFamilies = count_font_families(); 
+	int32 numFamilies = count_font_families();
 
 	fFontsMenu-&gt;RemoveItems(0, fFontsMenu-&gt;CountItems(), true);
 	BFont font;
@@ -434,8 +434,8 @@
 	font_style currentStyle;
 	fCurrentFont.GetFamilyAndStyle(&amp;currentFamily, &amp;currentStyle);
 
-	for (int32 i = 0; i &lt; numFamilies; i++) { 
-		font_family family; 
+	for (int32 i = 0; i &lt; numFamilies; i++) {
+		font_family family;
 		uint32 flags;
 		if (get_font_family(i, &amp;family, &amp;flags) != B_OK)
 			continue;
@@ -457,10 +457,10 @@
 		BMenuItem* familyItem = new BMenuItem(stylesMenu, message);
 		fFontsMenu-&gt;AddItem(familyItem);
 
-		int32 numStyles = count_font_styles(family); 
+		int32 numStyles = count_font_styles(family);
 
 		for (int32 j = 0; j &lt; numStyles; j++) {
-			font_style style; 
+			font_style style;
 			if (get_font_style(family, j, &amp;style, &amp;flags) != B_OK)
 				continue;
 

Modified: haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontSelectionView.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -61,5 +61,5 @@
 		BFont			fCurrentFont;
 		float			fMaxFontNameWidth;
 };
-	
+
 #endif	/* FONT_SELECTION_VIEW_H */

Modified: haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontView.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontView.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontView.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -12,6 +12,7 @@
 
 
 #include &quot;FontSelectionView.h&quot;
+#include &quot;AdvancedSettingsView.h&quot;
 
 
 class FontView : public BView {
@@ -29,9 +30,9 @@
 		bool	IsRevertable();
 
 	private:
-		FontSelectionView 	*fPlainView;
-		FontSelectionView 	*fBoldView;
-		FontSelectionView 	*fFixedView;
+		FontSelectionView		*fPlainView;
+		FontSelectionView		*fBoldView;
+		FontSelectionView		*fFixedView;
 };
-	
+
 #endif	/* FONT_VIEW_H */

Modified: haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontsSettings.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontsSettings.cpp	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/preferences/fonts/FontsSettings.cpp	2008-07-10 20:03:36 UTC (rev 26376)
@@ -32,27 +32,27 @@
 		path.Append(kSettingsFile);
 		BFile file(path.Path(), B_READ_ONLY);
 
-		if (file.InitCheck() != B_OK) 
+		if (file.InitCheck() != B_OK)
 			SetDefaults();
 		else if (msg.Unflatten(&amp;file) != B_OK)
 			SetDefaults();
 		else
 			msg.FindPoint(&quot;windowlocation&quot;, &amp;fCorner);
 	}
-}	
-	
+}
 
+
 FontsSettings::~FontsSettings()
 {
 	BPath path;
 	BMessage msg;
-	
-	if (find_directory(B_USER_SETTINGS_DIRECTORY, &amp;path) &lt; B_OK) 
+
+	if (find_directory(B_USER_SETTINGS_DIRECTORY, &amp;path) &lt; B_OK)
 		return;
-	
+
 	path.Append(kSettingsFile);
 	BFile file(path.Path(), B_WRITE_ONLY|B_CREATE_FILE);
-	
+
 	if (file.InitCheck() == B_OK) {
 		msg.AddPoint(&quot;windowlocation&quot;, fCorner);
 		msg.Flatten(&amp;file);

Modified: haiku/branches/developer/bonefish/vm/src/preferences/fonts/Jamfile
===================================================================
--- haiku/branches/developer/bonefish/vm/src/preferences/fonts/Jamfile	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/preferences/fonts/Jamfile	2008-07-10 20:03:36 UTC (rev 26376)
@@ -5,6 +5,7 @@
 
 Preference Fonts :
 	FontSelectionView.cpp
+	AdvancedSettingsView.cpp
 	FontsSettings.cpp
 	FontView.cpp
 	main.cpp

Modified: haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.cpp	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.cpp	2008-07-10 20:03:36 UTC (rev 26376)
@@ -6,6 +6,7 @@
  *		Mark Hogben
  *		DarkWyrm &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">bpmagic at columbus.rr.com</A>&gt;
  *		Axel D&#246;rfler, <A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">axeld at pinc-software.de</A>
+ *		Andrej Spielmann, &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/haiku-commits">andrej.spielmann at seh.ox.ac.uk</A>&gt;
  */
 
 
@@ -25,7 +26,7 @@
 
 
 MainWindow::MainWindow()
-	: BWindow(BRect(100, 100, 445, 340), &quot;Fonts&quot;, B_TITLED_WINDOW,
+	: BWindow(BRect(100, 100, 445, 410), &quot;Fonts&quot;, B_TITLED_WINDOW,
 		B_NOT_RESIZABLE | B_ASYNCHRONOUS_CONTROLS | B_NOT_ZOOMABLE)
 {
 	BRect rect = Bounds();
@@ -36,7 +37,8 @@
 	rect.left = 10;
 	rect.top = rect.bottom - 10;
 	fDefaultsButton = new BButton(rect, &quot;defaults&quot;, &quot;Defaults&quot;,
-		new BMessage(kMsgSetDefaults), B_FOLLOW_LEFT | B_FOLLOW_BOTTOM, B_WILL_DRAW);
+		new BMessage(kMsgSetDefaults), B_FOLLOW_LEFT
+			| B_FOLLOW_BOTTOM, B_WILL_DRAW);
 	fDefaultsButton-&gt;ResizeToPreferred();
 	fDefaultsButton-&gt;SetEnabled(false);
 	float buttonHeight = fDefaultsButton-&gt;Bounds().Height();
@@ -56,11 +58,13 @@
 	rect.top += 5;
 	rect.bottom -= 20 + buttonHeight;
 	rect.left += 5;
-	BTabView *tabView = new BTabView(rect, &quot;tabview&quot;, B_WIDTH_FROM_LABEL); 
+	BTabView *tabView = new BTabView(rect, &quot;tabview&quot;, B_WIDTH_FROM_LABEL);
 
 	rect = tabView-&gt;ContainerView()-&gt;Bounds().InsetByCopy(5, 8);
 	fFontsView = new FontView(rect);
 
+	fAdvancedSettings = new AdvancedSettingsView(rect, &quot;Advanced&quot;);
+
 	tabView-&gt;AddTab(fFontsView);
 
 	fFontsView-&gt;UpdateFonts();
@@ -83,7 +87,8 @@
 		tabView-&gt;ContainerView()-&gt;ResizeBy(0, heightDiff);
 	}
 
-	ResizeTo(tabView-&gt;Bounds().Width() + 10, tabView-&gt;Frame().bottom + 20 + buttonHeight);
+	ResizeTo(tabView-&gt;Bounds().Width() + 10, tabView-&gt;Frame().bottom + 20
+		+ buttonHeight);
 	view-&gt;AddChild(tabView);
 	fFontsView-&gt;ResizeToPreferred();
 
@@ -99,6 +104,23 @@
 			_Center();
 	}
 
+	tabView-&gt;AddTab(fAdvancedSettings);
+
+	fAdvancedSettings-&gt;RelayoutIfNeeded();
+	fAdvancedSettings-&gt;GetPreferredSize(&amp;width, &amp;height);
+	
+	widthDiff = width + 10 - tabView-&gt;ContainerView()-&gt;Bounds().Width();
+	if (widthDiff &gt; 0) {
+		tabView-&gt;ResizeBy(widthDiff, 0);
+		tabView-&gt;ContainerView()-&gt;ResizeBy(widthDiff, 0);
+	}
+	
+	heightDiff = height + 16 - tabView-&gt;ContainerView()-&gt;Bounds().Height();
+	if (heightDiff &gt; 0) {
+		tabView-&gt;ResizeBy(0, heightDiff);
+		tabView-&gt;ContainerView()-&gt;ResizeBy(0, heightDiff);
+	}
+
 	fRunner = new BMessageRunner(this, new BMessage(kMsgCheckFonts), 3000000);
 		// every 3 seconds
 
@@ -127,19 +149,25 @@
 {
 	switch (message-&gt;what) {
 		case kMsgUpdate:
-			fDefaultsButton-&gt;SetEnabled(fFontsView-&gt;IsDefaultable());
-			fRevertButton-&gt;SetEnabled(fFontsView-&gt;IsRevertable());
+			fDefaultsButton-&gt;SetEnabled(fFontsView-&gt;IsDefaultable()
+								|| fAdvancedSettings-&gt;IsDefaultable());
+			fRevertButton-&gt;SetEnabled(fFontsView-&gt;IsRevertable()
+								|| fAdvancedSettings-&gt;IsRevertable());
 			break;
 
 		case kMsgSetDefaults:
 			fFontsView-&gt;SetDefaults();
+			fAdvancedSettings-&gt;SetDefaults();
 			fDefaultsButton-&gt;SetEnabled(false);
-			fRevertButton-&gt;SetEnabled(fFontsView-&gt;IsRevertable());
+			fRevertButton-&gt;SetEnabled(fFontsView-&gt;IsRevertable()
+								|| fAdvancedSettings-&gt;IsRevertable());
 			break;
 
 		case kMsgRevert:
 			fFontsView-&gt;Revert();
-			fDefaultsButton-&gt;SetEnabled(fFontsView-&gt;IsDefaultable());
+			fAdvancedSettings-&gt;Revert();
+			fDefaultsButton-&gt;SetEnabled(fFontsView-&gt;IsDefaultable()
+								|| fAdvancedSettings-&gt;IsDefaultable());
 			fRevertButton-&gt;SetEnabled(false);
 			break;
 

Modified: haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.h	2008-07-10 19:50:34 UTC (rev 26375)
+++ haiku/branches/developer/bonefish/vm/src/preferences/fonts/MainWindow.h	2008-07-10 20:03:36 UTC (rev 26376)
@@ -12,6 +12,7 @@
 
 
 #include &quot;FontsSettings.h&quot;

[... truncated: 4472 lines follow ...]

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010191.html">[Haiku-commits] r26375 - in haiku/branches/developer/bonefish/vm:	headers/private/kernel src/system/kernel src/system/kernel/vm
</A></li>
	<LI>Next message: <A HREF="010193.html">[Haiku-commits] r26377 - in haiku/trunk: headers/private/net	src/kits/network src/kits/network/libnetapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10192">[ date ]</a>
              <a href="thread.html#10192">[ thread ]</a>
              <a href="subject.html#10192">[ subject ]</a>
              <a href="author.html#10192">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
