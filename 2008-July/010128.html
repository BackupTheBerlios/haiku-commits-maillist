<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Haiku-commits] r26334 - in	haiku/branches/developer/bonefish/vm/src:	add-ons/kernel/busses/scsi/ahci	add-ons/kernel/drivers/audio/ac97/auich	add-ons/kernel/drivers/audio/ac97/auvia	add-ons/kernel/drivers/audio/echo	add-ons/kernel/drivers/audio/emuxki add-ons/kernel/drivers/audio/hda	add-ons/kernel/file_systems/bfs	add-ons/media/media-add-ons/multi_audio kits/interface	servers/app/drawing servers/app/drawing/Painter	servers/bluetooth servers/input system/kernel/arch/x86	system/kernel/vm tests/servers/app	tests/servers/app/lagging_get_mouse tests/servers/app/statusbar
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/haiku-commits/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26334%20-%20in%0A%09haiku/branches/developer/bonefish/vm/src%3A%0A%09add-ons/kernel/busses/scsi/ahci%0A%09add-ons/kernel/drivers/audio/ac97/auich%0A%09add-ons/kernel/drivers/audio/ac97/auvia%0A%09add-ons/kernel/drivers/audio/echo%0A%09add-ons/kernel/drivers/audio/emuxki%20add-ons/kernel/drivers/audio/hda%0A%09add-ons/kernel/file_systems/bfs%0A%09add-ons/media/media-add-ons/multi_audio%20kits/interface%0A%09servers/app/drawing%20servers/app/drawing/Painter%0A%09servers/bluetooth%20servers/input%20system/kernel/arch/x86%0A%09system/kernel/vm%20tests/servers/app%0A%09tests/servers/app/lagging_get_mouse%20tests/servers/app/statusbar&In-Reply-To=%3C200807090215.m692FRAS032687%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010127.html">
   <LINK REL="Next"  HREF="010129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Haiku-commits] r26334 - in	haiku/branches/developer/bonefish/vm/src:	add-ons/kernel/busses/scsi/ahci	add-ons/kernel/drivers/audio/ac97/auich	add-ons/kernel/drivers/audio/ac97/auvia	add-ons/kernel/drivers/audio/echo	add-ons/kernel/drivers/audio/emuxki add-ons/kernel/drivers/audio/hda	add-ons/kernel/file_systems/bfs	add-ons/media/media-add-ons/multi_audio kits/interface	servers/app/drawing servers/app/drawing/Painter	servers/bluetooth servers/input system/kernel/arch/x86	system/kernel/vm tests/servers/app	tests/servers/app/lagging_get_mouse tests/servers/app/statusbar</H1>
    <B>bonefish at mail.berlios.de</B> 
    <A HREF="mailto:haiku-commits%40lists.berlios.de?Subject=Re%3A%20%5BHaiku-commits%5D%20r26334%20-%20in%0A%09haiku/branches/developer/bonefish/vm/src%3A%0A%09add-ons/kernel/busses/scsi/ahci%0A%09add-ons/kernel/drivers/audio/ac97/auich%0A%09add-ons/kernel/drivers/audio/ac97/auvia%0A%09add-ons/kernel/drivers/audio/echo%0A%09add-ons/kernel/drivers/audio/emuxki%20add-ons/kernel/drivers/audio/hda%0A%09add-ons/kernel/file_systems/bfs%0A%09add-ons/media/media-add-ons/multi_audio%20kits/interface%0A%09servers/app/drawing%20servers/app/drawing/Painter%0A%09servers/bluetooth%20servers/input%20system/kernel/arch/x86%0A%09system/kernel/vm%20tests/servers/app%0A%09tests/servers/app/lagging_get_mouse%20tests/servers/app/statusbar&In-Reply-To=%3C200807090215.m692FRAS032687%40sheep.berlios.de%3E"
       TITLE="[Haiku-commits] r26334 - in	haiku/branches/developer/bonefish/vm/src:	add-ons/kernel/busses/scsi/ahci	add-ons/kernel/drivers/audio/ac97/auich	add-ons/kernel/drivers/audio/ac97/auvia	add-ons/kernel/drivers/audio/echo	add-ons/kernel/drivers/audio/emuxki add-ons/kernel/drivers/audio/hda	add-ons/kernel/file_systems/bfs	add-ons/media/media-add-ons/multi_audio kits/interface	servers/app/drawing servers/app/drawing/Painter	servers/bluetooth servers/input system/kernel/arch/x86	system/kernel/vm tests/servers/app	tests/servers/app/lagging_get_mouse tests/servers/app/statusbar">bonefish at mail.berlios.de
       </A><BR>
    <I>Wed Jul  9 04:15:27 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="010127.html">[Haiku-commits] r26333 - haiku/trunk/src/system/kernel/vm
</A></li>
        <LI>Next message: <A HREF="010129.html">[Haiku-commits] r26335 - haiku/trunk/src/system/kernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10128">[ date ]</a>
              <a href="thread.html#10128">[ thread ]</a>
              <a href="subject.html#10128">[ subject ]</a>
              <a href="author.html#10128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bonefish
Date: 2008-07-09 04:15:07 +0200 (Wed, 09 Jul 2008)
New Revision: 26334
ViewCVS: <A HREF="http://svn.berlios.de/viewcvs/haiku?rev=26334&amp;view=rev">http://svn.berlios.de/viewcvs/haiku?rev=26334&amp;view=rev</A>

Added:
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/Jamfile
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/main.cpp
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/run
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/Jamfile
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/main.cpp
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/run
Removed:
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/Jamfile
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/main.cpp
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/run
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/Jamfile
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/main.cpp
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/run
Modified:
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/busses/scsi/ahci/sata_request.cpp
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auich/auich.c
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auvia/auvia.c
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/echo/echo.cpp
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp
   haiku/branches/developer/bonefish/vm/src/add-ons/kernel/file_systems/bfs/Utility.cpp
   haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioDevice.cpp
   haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioNode.cpp
   haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/DrawingEngine.cpp
   haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/Painter.cpp
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.cpp
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.h
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIDelegate.h
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.cpp
   haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.h
   haiku/branches/developer/bonefish/vm/src/servers/input/InputServer.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/arch/x86/vm86.cpp
   haiku/branches/developer/bonefish/vm/src/system/kernel/vm/vm.cpp
   haiku/branches/developer/bonefish/vm/src/tests/servers/app/Jamfile
Log:
Synchronized with trunk at r26333.

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/busses/scsi/ahci/sata_request.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/busses/scsi/ahci/sata_request.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/busses/scsi/ahci/sata_request.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -111,6 +111,7 @@
 
 	if (fCcb) {
 		fCcb-&gt;data_resid = fCcb-&gt;data_length - bytesTransfered;
+		fCcb-&gt;device_status = SCSI_STATUS_GOOD;
 		fCcb-&gt;subsys_status = SCSI_REQ_CMP;
 		if (tfd &amp; (ATA_ERR | ATA_DF)) {
 			fCcb-&gt;subsys_status = SCSI_REQ_CMP_ERR;

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auich/auich.c
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auich/auich.c	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auich/auich.c	2008-07-09 02:15:07 UTC (rev 26334)
@@ -331,6 +331,7 @@
 		
 	stream-&gt;frames_count = 0;
 	stream-&gt;real_time = 0;
+	stream-&gt;buffer_cycle = 0;
 	stream-&gt;update_needed = false;
 	
 	/* allocate memory for our dma ops */

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auvia/auvia.c
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auvia/auvia.c	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/ac97/auvia/auvia.c	2008-07-09 02:15:07 UTC (rev 26334)
@@ -313,6 +313,7 @@
 		
 	stream-&gt;frames_count = 0;
 	stream-&gt;real_time = 0;
+	stream-&gt;buffer_cycle = 0;
 	stream-&gt;update_needed = false;
 	
 	/* allocate memory for our dma ops */

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/echo/echo.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/echo/echo.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/echo/echo.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -372,6 +372,7 @@
 	
 	stream-&gt;frames_count = 0;
 	stream-&gt;real_time = 0;
+	stream-&gt;buffer_cycle = 0;
 	stream-&gt;update_needed = false;
 	
 	status = lock();

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/emuxki/emuxki.c	2008-07-09 02:15:07 UTC (rev 26334)
@@ -1636,6 +1636,7 @@
 		
 	stream-&gt;frames_count = 0;
 	stream-&gt;real_time = 0;
+	stream-&gt;buffer_cycle = 0;
 	stream-&gt;update_needed = false;
 
 	/* Init voices list */

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/driver.h	2008-07-09 02:15:07 UTC (rev 26334)
@@ -149,8 +149,8 @@
 					/* Physical addresses for buffer */
 	sem_id		buffer_ready_sem;
 	bigtime_t	real_time;
-	uint32		frames_count;
-	uint32		buffer_cycle;
+	uint64		frames_count;
+	int32		buffer_cycle;
 
 	uint32		rate, bps;			/* Samplerate &amp; bits per sample */
 
@@ -168,7 +168,7 @@
 		return controller-&gt;Read16(HDAC_STREAM_BASE + offset + reg);
 	}
 
-	uint8 Read32(uint32 reg)
+	uint32 Read32(uint32 reg)
 	{
 		return controller-&gt;Read32(HDAC_STREAM_BASE + offset + reg);
 	}
@@ -178,12 +178,12 @@
 		*(controller-&gt;regs + HDAC_STREAM_BASE + offset + reg) = value;
 	}
 
-	void Write16(uint32 reg, uint8 value)
+	void Write16(uint32 reg, uint16 value)
 	{
 		*(vuint16*)(controller-&gt;regs + HDAC_STREAM_BASE + offset + reg) = value;
 	}
 
-	void Write32(uint32 reg, uint8 value)
+	void Write32(uint32 reg, uint32 value)
 	{
 		*(vuint32*)(controller-&gt;regs + HDAC_STREAM_BASE + offset + reg) = value;
 	}

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/drivers/audio/hda/hda_controller.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -26,6 +26,8 @@
 	(((controller)-&gt;num_input_streams + (controller)-&gt;num_output_streams \
 		+ (index)) * HDAC_STREAM_SIZE)
 
+#define PAGE_ALIGN(size)	(((size) + B_PAGE_SIZE - 1) &amp; ~(B_PAGE_SIZE - 1))
+
 static const struct {
 	uint32 multi_rate;
 	uint32 hw_rate;
@@ -197,15 +199,15 @@
 	}
 	for (uint32 i = 0; i &lt; controller-&gt;num_output_streams; i++) {
 		controller-&gt;Write8(HDAC_STREAM_CONTROL0 + HDAC_STREAM_BASE
-			+ HDAC_INPUT_STREAM_OFFSET(controller, i), 0);
+			+ HDAC_OUTPUT_STREAM_OFFSET(controller, i), 0);
 		controller-&gt;Write8(HDAC_STREAM_STATUS + HDAC_STREAM_BASE
-			+ HDAC_INPUT_STREAM_OFFSET(controller, i), 0);
+			+ HDAC_OUTPUT_STREAM_OFFSET(controller, i), 0);
 	}
 	for (uint32 i = 0; i &lt; controller-&gt;num_bidir_streams; i++) {
 		controller-&gt;Write8(HDAC_STREAM_CONTROL0 + HDAC_STREAM_BASE
-			+ HDAC_INPUT_STREAM_OFFSET(controller, i), 0);
+			+ HDAC_BIDIR_STREAM_OFFSET(controller, i), 0);
 		controller-&gt;Write8(HDAC_STREAM_STATUS + HDAC_STREAM_BASE
-			+ HDAC_INPUT_STREAM_OFFSET(controller, i), 0);
+			+ HDAC_BIDIR_STREAM_OFFSET(controller, i), 0);
 	}
 
 	// stop DMA
@@ -305,7 +307,7 @@
 	posSize = 8 * (controller-&gt;num_input_streams
 		+ controller-&gt;num_output_streams + controller-&gt;num_bidir_streams);
 
-	memSize = (posOffset + posSize + B_PAGE_SIZE - 1) &amp; ~(B_PAGE_SIZE - 1);
+	memSize = PAGE_ALIGN(posOffset + posSize);
 
 	/* Allocate memory area */
 	controller-&gt;corb_rirb_pos_area = create_area(&quot;hda corb/rirb/pos&quot;,
@@ -504,7 +506,7 @@
 
 	/* Calculate total size of all buffers (aligned to size of B_PAGE_SIZE) */
 	alloc = bufferSize * stream-&gt;num_buffers;
-	alloc = (alloc + B_PAGE_SIZE - 1) &amp; (~(B_PAGE_SIZE -1));
+	alloc = PAGE_ALIGN(alloc);
 
 	/* Allocate memory for buffers */
 	stream-&gt;buffer_area = create_area(&quot;hda buffers&quot;, (void**)&amp;buffer,
@@ -533,7 +535,7 @@
 
 	/* Now allocate BDL for buffer range */
 	alloc = stream-&gt;num_buffers * sizeof(bdl_entry_t);
-	alloc = (alloc + B_PAGE_SIZE - 1) &amp; ~(B_PAGE_SIZE - 1);
+	alloc = PAGE_ALIGN(alloc);
 
 	stream-&gt;buffer_descriptors_area = create_area(&quot;hda buffer descriptors&quot;,
 		(void**)&amp;bufferDescriptors, B_ANY_KERNEL_ADDRESS, alloc,

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/kernel/file_systems/bfs/Utility.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/kernel/file_systems/bfs/Utility.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/kernel/file_systems/bfs/Utility.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -60,8 +60,8 @@
 	if (index == -1)
 		return false;
 
+	count--;
 	memmove(&amp;values[index], &amp;values[index + 1], (count - index) * sizeof(off_t));
-	count--;
 
 	return true;
 }

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioDevice.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioDevice.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioDevice.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -180,18 +180,18 @@
 
 	for (int32 i = 0; i &lt; fBufferList.return_playback_buffers; i++) {
 		for (int32 j = 0; j &lt; fBufferList.return_playback_channels; j++) {
-			PRINT((&quot;fBufferList.playback_buffers[%d][%d].base: %p\n&quot;,
+			PRINT((&quot;fBufferList.playback_buffers[%ld][%ld].base: %p\n&quot;,
 				i, j, fBufferList.playback_buffers[i][j].base));
-			PRINT((&quot;fBufferList.playback_buffers[%d][%d].stride: %i\n&quot;,
+			PRINT((&quot;fBufferList.playback_buffers[%ld][%ld].stride: %li\n&quot;,
 				i, j, fBufferList.playback_buffers[i][j].stride));
 		}
 	}
 
 	for (int32 i = 0; i &lt; fBufferList.return_record_buffers; i++) {
 		for (int32 j = 0; j &lt; fBufferList.return_record_channels; j++) {
-			PRINT((&quot;fBufferList.record_buffers[%d][%d].base: %p\n&quot;,
+			PRINT((&quot;fBufferList.record_buffers[%ld][%ld].base: %p\n&quot;,
 				i, j, fBufferList.record_buffers[i][j].base));
-			PRINT((&quot;fBufferList.record_buffers[%d][%d].stride: %i\n&quot;,
+			PRINT((&quot;fBufferList.record_buffers[%ld][%ld].stride: %li\n&quot;,
 				i, j, fBufferList.record_buffers[i][j].stride));
 		}
 	}

Modified: haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioNode.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioNode.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/add-ons/media/media-add-ons/multi_audio/MultiAudioNode.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -129,7 +129,7 @@
 	fPreferredFormat.u.raw_audio.format = MultiAudio::convert_to_media_format(fDevice-&gt;FormatInfo().output.format);
 	fPreferredFormat.u.raw_audio.valid_bits = MultiAudio::convert_to_valid_bits(fDevice-&gt;FormatInfo().output.format);
 	fPreferredFormat.u.raw_audio.channel_count = 2;
-	fPreferredFormat.u.raw_audio.frame_rate = MultiAudio::convert_to_sample_rate(fDevice-&gt;FormatInfo().input.rate);		// measured in Hertz
+	fPreferredFormat.u.raw_audio.frame_rate = MultiAudio::convert_to_sample_rate(fDevice-&gt;FormatInfo().output.rate);		// measured in Hertz
 	fPreferredFormat.u.raw_audio.byte_order = B_MEDIA_HOST_ENDIAN;
 
 	// we'll use the consumer's preferred buffer size, if any
@@ -224,7 +224,7 @@
 				&amp;&amp; ( fDevice-&gt;Description().channels[i].designations &amp; B_CHANNEL_LEFT ||
 					!(fDevice-&gt;Description().channels[i].designations &amp; B_CHANNEL_SURROUND_BUS)))
 			) {
-			PRINT((&quot;NodeRegistered() : creating an input for %i\n&quot;, i));
+			PRINT((&quot;NodeRegistered() : creating an input for %li\n&quot;, i));
 			PRINT((&quot;%ld\t%d\t0x%lx\t0x%lx\n&quot;,
 				fDevice-&gt;Description().channels[i].channel_id,
 				fDevice-&gt;Description().channels[i].kind,
@@ -270,7 +270,7 @@
 				&amp;&amp; ( fDevice-&gt;Description().channels[i].designations &amp; B_CHANNEL_LEFT ||
 					!(fDevice-&gt;Description().channels[i].designations &amp; B_CHANNEL_SURROUND_BUS)))
 			) {
-			PRINT((&quot;NodeRegistered() : creating an output for %i\n&quot;, i));
+			PRINT((&quot;NodeRegistered() : creating an output for %li\n&quot;, i));
 			PRINT((&quot;%ld\t%d\t0x%lx\t0x%lx\n&quot;,fDevice-&gt;Description().channels[i].channel_id,
 											fDevice-&gt;Description().channels[i].kind,
 											fDevice-&gt;Description().channels[i].designations,
@@ -320,7 +320,7 @@
 		index++;
 	}
 
-	PRINT((&quot;apply configuration in : %ld\n&quot;, system_time() - start));
+	PRINT((&quot;apply configuration in : %Ld\n&quot;, system_time() - start));
 }
 
 
@@ -409,7 +409,7 @@
 	node_input *channel = (node_input *)fInputs.ItemAt(*cookie);
 	*_input = channel-&gt;fInput;
 	*cookie += 1;
-	PRINT((&quot;input.format : %u\n&quot;, channel-&gt;fInput.format.u.raw_audio.format));
+	PRINT((&quot;input.format : %lu\n&quot;, channel-&gt;fInput.format.u.raw_audio.format));
 	return B_OK;
 }
 
@@ -1011,7 +1011,7 @@
 	} else {
 		//WriteBuffer(buffer, *channel);
 		if (channel-&gt;fBuffer != NULL) {
-			PRINT((&quot;MultiAudioNode::HandleBuffer snoozing recycling channelId : %i, how_early:%lli\n&quot;, channel-&gt;fChannelId, how_early));
+			PRINT((&quot;MultiAudioNode::HandleBuffer snoozing recycling channelId : %li, how_early:%Ld\n&quot;, channel-&gt;fChannelId, howEarly));
 			//channel-&gt;fBuffer-&gt;Recycle();
 			snooze(100);
 			if (channel-&gt;fBuffer != NULL)
@@ -1019,7 +1019,7 @@
 			else
 				channel-&gt;fBuffer = buffer;
 		} else {
-			//PRINT((&quot;MultiAudioNode::HandleBuffer writing channelId : %i, how_early:%lli\n&quot;, channel-&gt;fChannelId, how_early));
+			//PRINT((&quot;MultiAudioNode::HandleBuffer writing channelId : %li, how_early:%Ld\n&quot;, channel-&gt;fChannelId, how_early));
 			channel-&gt;fBuffer = buffer;
 		}
 	}
@@ -1032,7 +1032,7 @@
 	bigtime_t lateness, bool realTimeEvent)
 {
 	//CALLED();
-	PRINT((&quot;MultiAudioNode::HandleDataStatus status:%li, lateness:%li\n&quot;, event-&gt;data, lateness));
+	PRINT((&quot;MultiAudioNode::HandleDataStatus status:%li, lateness:%Li\n&quot;, event-&gt;data, lateness));
 	switch (event-&gt;data) {
 		case B_DATA_NOT_AVAILABLE:
 			break;
@@ -1168,7 +1168,7 @@
 {
 	CALLED();
 
-	PRINT((&quot;id : %i\n&quot;, id));
+	PRINT((&quot;id : %li\n&quot;, id));
 	BParameter* parameter = NULL;
 	for (int32 i = 0; i &lt; fWeb-&gt;CountParameters(); i++) {
 		parameter = fWeb-&gt;ParameterAt(i);
@@ -1223,7 +1223,7 @@
 				}
 
 				for (uint32 i = 0; i &lt; *size / sizeof(float); i++) {
-					PRINT((&quot;GetParameterValue B_CONTINUOUS_PARAMETER value[%i] : %f\n&quot;, i, ((float*)value)[i]));
+					PRINT((&quot;GetParameterValue B_CONTINUOUS_PARAMETER value[%li] : %f\n&quot;, i, ((float*)value)[i]));
 				}
 			} else if (parameter-&gt;Type() == BParameter::B_DISCRETE_PARAMETER) {
 				BDiscreteParameter* discrete = (BDiscreteParameter*)parameter;
@@ -1235,7 +1235,7 @@
 				*size = sizeof(int32);
 
 				for (uint32 i = 0; i &lt; *size / sizeof(int32); i++) {
-					PRINT((&quot;GetParameterValue B_DISCRETE_PARAMETER value[%i] : %i\n&quot;, i, ((int32*)value)[i]));
+					PRINT((&quot;GetParameterValue B_DISCRETE_PARAMETER value[%li] : %li\n&quot;, i, ((int32*)value)[i]));
 				}
 			}
 		}
@@ -1249,7 +1249,7 @@
 	const void* value, size_t size)
 {
 	CALLED();
-	PRINT((&quot;id : %i, performance_time : %lld, size : %i\n&quot;, id, performanceTime, size));
+	PRINT((&quot;id : %li, performance_time : %lld, size : %li\n&quot;, id, performanceTime, size));
 
 	BParameter* parameter = NULL;
 	for (int32 i = 0; i &lt; fWeb-&gt;CountParameters(); i++) {
@@ -1270,7 +1270,7 @@
 
 	if (parameter-&gt;Type() == BParameter::B_CONTINUOUS_PARAMETER) {
 		for (uint32 i = 0; i &lt; size / sizeof(float); i++) {
-			PRINT((&quot;SetParameterValue B_CONTINUOUS_PARAMETER value[%i] : %f\n&quot;, i, ((float*)value)[i]));
+			PRINT((&quot;SetParameterValue B_CONTINUOUS_PARAMETER value[%li] : %f\n&quot;, i, ((float*)value)[i]));
 		}
 		info.item_count = 1;
 		values[0].id = id;
@@ -1283,7 +1283,7 @@
 		}
 	} else if (parameter-&gt;Type() == BParameter::B_DISCRETE_PARAMETER) {
 		for (uint32 i = 0; i &lt; size / sizeof(int32); i++) {
-			PRINT((&quot;SetParameterValue B_DISCRETE_PARAMETER value[%i] : %i\n&quot;, i, ((int32*)value)[i]));
+			PRINT((&quot;SetParameterValue B_DISCRETE_PARAMETER value[%li] : %li\n&quot;, i, ((int32*)value)[i]));
 		}
 
 		BDiscreteParameter* discrete = (BDiscreteParameter*)parameter;
@@ -1312,7 +1312,7 @@
 	CALLED();
 	BParameterWeb* web = new BParameterWeb;
 
-	PRINT((&quot;MixControlInfo().control_count : %i\n&quot;,
+	PRINT((&quot;MixControlInfo().control_count : %li\n&quot;,
 		fDevice-&gt;MixControlInfo().control_count));
 
 	multi_mix_control* controls = fDevice-&gt;MixControlInfo().controls;
@@ -1389,7 +1389,7 @@
 				i++;
 			}
 
-			PRINT((&quot;num parameters : %d\n&quot;, numParameters));
+			PRINT((&quot;num parameters : %ld\n&quot;, numParameters));
 			if (numParameters &gt; 0) {
 				(group-&gt;ParameterAt(numParameters - 1))-&gt;AddOutput(
 					group-&gt;ParameterAt(numParameters));
@@ -1981,7 +1981,7 @@
 			&amp;&amp; parameter-&gt;Type() != BParameter::B_DISCRETE_PARAMETER)
 			continue;
 
-		PRINT((&quot;getting parameter %i\n&quot;, parameter-&gt;ID()));
+		PRINT((&quot;getting parameter %li\n&quot;, parameter-&gt;ID()));
 		size_t size = bufferSize;
 		while ((err = GetParameterValue(parameter-&gt;ID(), &amp;lastChange, buffer,
 				&amp;size)) == B_NO_MEMORY &amp;&amp; bufferSize &lt; 128 * 1024) {

Modified: haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/kits/interface/View.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -1440,13 +1440,16 @@
 			// TODO: ServerWindow replies with an int32 here
 
 		ConvertFromScreen(location);
-			// TODO: in beos R5, location is already converted to the view local coordinate system,
-			// so if an app checks the window message queue by itself, it might not find what it expects.
-			// NOTE: the fact that we have mouse coords in screen space in our queue avoids the problem
-			// that messages already in the queue will be outdated as soon as a window or even the
-			// view moves. The second situation being quite common actually, also with regards to
-			// scrolling. An app reading these messages would have to know the locations of the window
-			// and view for each message... otherwise it is potentially broken anyways.
+			// TODO: in beos R5, location is already converted to the view
+			// local coordinate system, so if an app checks the window message
+			// queue by itself, it might not find what it expects.
+			// NOTE: the fact that we have mouse coords in screen space in our
+			// queue avoids the problem that messages already in the queue will
+			// be outdated as soon as a window or even the view moves. The
+			// second situation being quite common actually, also with regards
+			// to scrolling. An app reading these messages would have to know
+			// the locations of the window and view for each message...
+			// otherwise it is potentially broken anyways.
 	} else
 		*buttons = 0;
 }
@@ -1532,11 +1535,14 @@
 
 	_CheckLockAndSwitchCurrent();
 
+	float xDiff = where.x - fBounds.left;
+	float yDiff = where.y - fBounds.top;
+
 	// if we're attached to a window tell app_server about this change
 	if (fOwner) {
 		fOwner-&gt;fLink-&gt;StartMessage(AS_VIEW_SCROLL);
-		fOwner-&gt;fLink-&gt;Attach&lt;float&gt;(where.x - fBounds.left);
-		fOwner-&gt;fLink-&gt;Attach&lt;float&gt;(where.y - fBounds.top);
+		fOwner-&gt;fLink-&gt;Attach&lt;float&gt;(xDiff);
+		fOwner-&gt;fLink-&gt;Attach&lt;float&gt;(yDiff);
 
 		fOwner-&gt;fLink-&gt;Flush();
 
@@ -1547,9 +1553,9 @@
 	fBounds.OffsetTo(where.x, where.y);
 
 	// then set the new values of the scrollbars
-	if (fHorScroller)
+	if (fHorScroller &amp;&amp; xDiff != 0.0)
 		fHorScroller-&gt;SetValue(fBounds.left);
-	if (fVerScroller)
+	if (fVerScroller &amp;&amp; yDiff != 0.0)
 		fVerScroller-&gt;SetValue(fBounds.top);
 
 }

Modified: haiku/branches/developer/bonefish/vm/src/servers/app/drawing/DrawingEngine.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/app/drawing/DrawingEngine.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/app/drawing/DrawingEngine.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -1067,12 +1067,14 @@
 	BPoint penLocation = pt;
 
 	// try a fast clipping path
-	float fontSize = fPainter-&gt;Font().Size();
-	BRect clippingFrame = fPainter-&gt;ClippingRegion()-&gt;Frame();
-	if (pt.x &gt; clippingFrame.right || pt.y + fontSize &lt; clippingFrame.top
-		|| pt.y - fontSize &gt; clippingFrame.bottom) {
-		penLocation.x += StringWidth(string, length, delta);
-		return penLocation;
+	if (fPainter-&gt;ClippingRegion()) {
+		float fontSize = fPainter-&gt;Font().Size();
+		BRect clippingFrame = fPainter-&gt;ClippingRegion()-&gt;Frame();
+		if (pt.x &gt; clippingFrame.right || pt.y + fontSize &lt; clippingFrame.top
+			|| pt.y - fontSize &gt; clippingFrame.bottom) {
+			penLocation.x += StringWidth(string, length, delta);
+			return penLocation;
+		}
 	}
 
 	// use a FontCacheRefernece to speed up the second pass of

Modified: haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/Painter.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/Painter.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/app/drawing/Painter/Painter.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -45,6 +45,13 @@
 #include &quot;Painter.h&quot;
 
 
+//#define TRACE_PAINTER
+#ifdef TRACE_PAINTER
+#	define TRACE(x...)		printf(x)
+#else
+#	define TRACE(x...)
+#endif
+
 #define CHECK_CLIPPING	if (!fValidClipping) return BRect(0, 0, -1, -1);
 #define CHECK_CLIPPING_NO_RETURN	if (!fValidClipping) return;
 
@@ -1049,6 +1056,16 @@
 		// the native bitmap coordinate system
 		BRect actualBitmapRect(bitmap-&gt;Bounds());
 
+		TRACE(&quot;Painter::DrawBitmap()\n&quot;);
+		TRACE(&quot;   actualBitmapRect = (%.1f, %.1f) - (%.1f, %.1f)\n&quot;,
+			actualBitmapRect.left, actualBitmapRect.top,
+			actualBitmapRect.right, actualBitmapRect.bottom);
+		TRACE(&quot;   bitmapRect = (%.1f, %.1f) - (%.1f, %.1f)\n&quot;,
+			bitmapRect.left, bitmapRect.top, bitmapRect.right,
+			bitmapRect.bottom);
+		TRACE(&quot;   viewRect = (%.1f, %.1f) - (%.1f, %.1f)\n&quot;,
+			viewRect.left, viewRect.top, viewRect.right, viewRect.bottom);
+
 		agg::rendering_buffer srcBuffer;
 		srcBuffer.attach(bitmap-&gt;Bits(),
 						 bitmap-&gt;Width(),
@@ -1304,10 +1321,16 @@
 	}
 
 	if (!fSubpixelPrecise) {
+		align_rect_to_pixels(&amp;bitmapRect);
 		align_rect_to_pixels(&amp;viewRect);
-		align_rect_to_pixels(&amp;bitmapRect);
 	}
-		
+
+	TRACE(&quot;Painter::_DrawBitmap()\n&quot;);
+	TRACE(&quot;   bitmapRect = (%.1f, %.1f) - (%.1f, %.1f)\n&quot;,
+		bitmapRect.left, bitmapRect.top, bitmapRect.right, bitmapRect.bottom);
+	TRACE(&quot;   viewRect = (%.1f, %.1f) - (%.1f, %.1f)\n&quot;,
+		viewRect.left, viewRect.top, viewRect.right, viewRect.bottom);
+
 	double xScale = (viewRect.Width() + 1) / (bitmapRect.Width() + 1);
 	double yScale = (viewRect.Height() + 1) / (bitmapRect.Height() + 1);
 
@@ -1512,6 +1535,11 @@
 							  double xScale, double yScale,
 							  BRect viewRect) const
 {
+	TRACE(&quot;Painter::_DrawBitmapGeneric32()\n&quot;);
+	TRACE(&quot;   offset: %.1f, %.1f\n&quot;, xOffset, yOffset);
+	TRACE(&quot;   scale: %.3f, %.3f\n&quot;, xScale, yScale);
+	TRACE(&quot;   viewRect: (%.1f, %.1f) - (%.1f, %.1f)\n&quot;,
+		viewRect.left, viewRect.top, viewRect.right, viewRect.bottom);
 	// AGG pipeline
 
 	// pixel format attached to bitmap
@@ -1524,8 +1552,10 @@
 //											   -actualBitmapRect.top);
 
 	agg::trans_affine imgMatrix;
+	imgMatrix *= agg::trans_affine_translation(xOffset - viewRect.left,
+		yOffset - viewRect.top);
 	imgMatrix *= agg::trans_affine_scaling(xScale, yScale);
-	imgMatrix *= agg::trans_affine_translation(xOffset, yOffset);
+	imgMatrix *= agg::trans_affine_translation(viewRect.left, viewRect.top);
 	imgMatrix.invert();
 
 	// image interpolator

Modified: haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -15,7 +15,7 @@
 }
 
 status_t
-HCIControllerAccessor::IssueCommand(raw_command* rc, size_t size)
+HCIControllerAccessor::IssueCommand(raw_command rc, size_t size)
 {
 
 	if (GetID() &lt; 0)
@@ -24,3 +24,11 @@
 
 	return B_ERROR;
 }
+
+
+status_t 
+HCIControllerAccessor::Launch() {
+
+	return B_OK;
+
+}

Modified: haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.h	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIControllerAccessor.h	2008-07-09 02:15:07 UTC (rev 26334)
@@ -17,7 +17,8 @@
 
 	public:
 		HCIControllerAccessor(BPath* path);
-		status_t IssueCommand(raw_command* rc,  size_t size);
+		status_t IssueCommand(raw_command rc,  size_t size);
+		status_t Launch();
 };
 
 #endif

Modified: haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIDelegate.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIDelegate.h	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCIDelegate.h	2008-07-09 02:15:07 UTC (rev 26334)
@@ -41,16 +41,15 @@
 
 		}
 						
+		
 		hci_id GetID(void)
 		{
 			return fHID;
 		}
-				
-		virtual status_t IssueCommand(raw_command rc, size_t size)
-		{
-			return B_ERROR;
-		}
-	
+
+		virtual status_t IssueCommand(raw_command rc, size_t size)=0;		
+		virtual status_t Launch()=0;
+
 	protected:
 		
 

Modified: haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -33,3 +33,11 @@
 
 	return ioctl(fFD, ISSUE_BT_COMMAND, rc, size);
 }
+
+
+status_t 
+HCITransportAccessor::Launch() {
+
+	return B_OK;
+
+}

Modified: haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.h
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.h	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/bluetooth/HCITransportAccessor.h	2008-07-09 02:15:07 UTC (rev 26334)
@@ -17,6 +17,8 @@
 	public:
 		HCITransportAccessor(BPath* path);
 		status_t IssueCommand(raw_command rc, size_t size);
+		status_t Launch();
+		
 };
 
 #endif

Modified: haiku/branches/developer/bonefish/vm/src/servers/input/InputServer.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/servers/input/InputServer.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/servers/input/InputServer.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -1492,6 +1492,9 @@
 					PRINT((&quot;new position : %f, %f\n&quot;, fMousePos.x, fMousePos.y));
 				}
 
+				if (!event-&gt;HasInt64(&quot;when&quot;))
+					event-&gt;AddInt64(&quot;when&quot;, system_time());
+
 				event-&gt;AddInt32(&quot;modifiers&quot;, fKeyInfo.modifiers);
 				break;
 	   		}

Modified: haiku/branches/developer/bonefish/vm/src/system/kernel/arch/x86/vm86.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/system/kernel/arch/x86/vm86.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/system/kernel/arch/x86/vm86.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -44,8 +44,8 @@
 #define PUSHF   0x9c
 #define STI     0xfb
 
-#define I_FLAG          (1 &lt;&lt; 9)
-#define DIRECTION_FLAG  (1 &lt;&lt; 10)
+#define I_FLAG          (1u &lt;&lt; 9)
+#define DIRECTION_FLAG  (1u &lt;&lt; 10)
 
 #define CSEG 0x2e
 #define SSEG 0x36
@@ -442,7 +442,7 @@
 				uint16 flags = state-&gt;regs.flags;
 
 				/* store real IF */
-				flags &amp;= I_FLAG;
+				flags &amp;= ~I_FLAG;
 				flags |= (uint16)state-&gt;if_flag &lt;&lt; 9;
 
 				pushw(&amp;state-&gt;regs, flags);
@@ -475,10 +475,11 @@
 		case PUSHF:
 		{
 			TRACE_NP(&quot;PUSHF&quot;);
-			uint16 flags = state-&gt;regs.flags &amp; I_FLAG;
+			uint32 flags = state-&gt;regs.flags;
 
 			/* store real IF */
-			flags |= (uint16)state-&gt;if_flag &lt;&lt; 9;
+			flags &amp;= ~I_FLAG;
+			flags |= (uint32)state-&gt;if_flag &lt;&lt; 9;
 			if (prefix.size)
 				pushl(&amp;state-&gt;regs, flags);
 			else

Modified: haiku/branches/developer/bonefish/vm/src/system/kernel/vm/vm.cpp
===================================================================
--- haiku/branches/developer/bonefish/vm/src/system/kernel/vm/vm.cpp	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/system/kernel/vm/vm.cpp	2008-07-09 02:15:07 UTC (rev 26334)
@@ -204,8 +204,8 @@
 	addr_t		committed;
 };
 
-static const int kCacheInfoTableCount = 10240;
-static cache_info sCacheInfoTable[kCacheInfoTableCount];
+static const int kCacheInfoTableCount = 100 * 1024;
+static cache_info* sCacheInfoTable;
 
 #endif	// DEBUG_CACHE_LIST
 
@@ -3104,7 +3104,7 @@
 	if (level == 0)
 		kprintf(&quot;/%lu&quot;, info.page_count);
 
-	if (cache-&gt;type == CACHE_TYPE_RAM) {
+	if (cache-&gt;type == CACHE_TYPE_RAM || level == 0 &amp;&amp; info.committed &gt; 0) {
 		kprintf(&quot;, committed: %lld&quot;, cache-&gt;committed_size);
 
 		if (level == 0)
@@ -3137,6 +3137,11 @@
 static int
 dump_caches(int argc, char **argv)
 {
+	if (sCacheInfoTable == NULL) {
+		kprintf(&quot;No cache info table!\n&quot;);
+		return 0;
+	}
+
 	bool sortByPageCount = true;
 
 	for (int32 i = 1; i &lt; argc; i++) {
@@ -3157,7 +3162,10 @@
 	while (cache) {
 		totalCount++;
 		if (cache-&gt;source == NULL) {
-			cache_info&amp; info = sCacheInfoTable[rootCount++];
+			cache_info stackInfo;
+			cache_info&amp; info = rootCount &lt; (uint32)kCacheInfoTableCount
+				? sCacheInfoTable[rootCount] : stackInfo;
+			rootCount++;
 			info.cache = cache;
 			info.page_count = 0;
 			info.committed = 0;
@@ -3169,9 +3177,12 @@
 		cache = cache-&gt;debug_next;
 	}
 
-	qsort(sCacheInfoTable, rootCount, sizeof(cache_info),
-		sortByPageCount
-			? &amp;cache_info_compare_page_count : &amp;cache_info_compare_committed);
+	if (rootCount &lt;= (uint32)kCacheInfoTableCount) {
+		qsort(sCacheInfoTable, rootCount, sizeof(cache_info),
+			sortByPageCount
+				? &amp;cache_info_compare_page_count
+				: &amp;cache_info_compare_committed);
+	}
 
 	kprintf(&quot;total committed memory: %lld, total used pages: %lu\n&quot;,
 		totalCommitted, totalPages);
@@ -3179,10 +3190,13 @@
 		&quot;tree...\n\n&quot;, totalCount, rootCount,
 		sortByPageCount ? &quot;page count&quot; : &quot;committed size&quot;);
 
-	for (uint32 i = 0; i &lt; rootCount; i++) {
-		cache_info&amp; info = sCacheInfoTable[i];
-		dump_caches_recursively(info.cache, info, 0);
-	}
+	if (rootCount &lt;= (uint32)kCacheInfoTableCount) {
+		for (uint32 i = 0; i &lt; rootCount; i++) {
+			cache_info&amp; info = sCacheInfoTable[i];
+			dump_caches_recursively(info.cache, info, 0);
+		}
+	} else
+		kprintf(&quot;Cache info table too small! Can't sort and print caches!\n&quot;);
 
 	return 0;
 }
@@ -3840,6 +3854,13 @@
 			B_ALREADY_WIRED, B_KERNEL_READ_AREA | B_KERNEL_WRITE_AREA);
 	}
 
+#if DEBUG_CACHE_LIST
+	create_area(&quot;cache info table&quot;, (void**)&amp;sCacheInfoTable,
+		B_ANY_KERNEL_ADDRESS,
+		ROUNDUP(kCacheInfoTableCount * sizeof(cache_info), B_PAGE_SIZE),
+		B_FULL_LOCK, B_KERNEL_READ_AREA | B_KERNEL_WRITE_AREA);
+#endif	// DEBUG_CACHE_LIST
+
 	// add some debugger commands
 	add_debugger_command(&quot;areas&quot;, &amp;dump_area_list, &quot;Dump a list of all areas&quot;);
 	add_debugger_command(&quot;area&quot;, &amp;dump_area, &quot;Dump info about a particular area&quot;);

Modified: haiku/branches/developer/bonefish/vm/src/tests/servers/app/Jamfile
===================================================================
--- haiku/branches/developer/bonefish/vm/src/tests/servers/app/Jamfile	2008-07-09 01:56:58 UTC (rev 26333)
+++ haiku/branches/developer/bonefish/vm/src/tests/servers/app/Jamfile	2008-07-09 02:15:07 UTC (rev 26334)
@@ -173,6 +173,7 @@
 SubInclude HAIKU_TOP src tests servers app event_mask ;
 SubInclude HAIKU_TOP src tests servers app following ;
 SubInclude HAIKU_TOP src tests servers app idle_test ;
+SubInclude HAIKU_TOP src tests servers app lagging_get_mouse ;
 SubInclude HAIKU_TOP src tests servers app lock_focus ;
 SubInclude HAIKU_TOP src tests servers app look_and_feel ;
 SubInclude HAIKU_TOP src tests servers app menu_crash ;
@@ -183,6 +184,7 @@
 SubInclude HAIKU_TOP src tests servers app resize_limits ;
 SubInclude HAIKU_TOP src tests servers app scrollbar ;
 SubInclude HAIKU_TOP src tests servers app scrolling ;
+SubInclude HAIKU_TOP src tests servers app statusbar ;
 SubInclude HAIKU_TOP src tests servers app stress_test ;
 SubInclude HAIKU_TOP src tests servers app textview ;
 SubInclude HAIKU_TOP src tests servers app view_state ;

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse (from rev 26333, haiku/trunk/src/tests/servers/app/lagging_get_mouse)

Deleted: haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/Jamfile

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/Jamfile (from rev 26333, haiku/trunk/src/tests/servers/app/lagging_get_mouse/Jamfile)

Deleted: haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/main.cpp

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/main.cpp (from rev 26333, haiku/trunk/src/tests/servers/app/lagging_get_mouse/main.cpp)

Deleted: haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/run

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/lagging_get_mouse/run (from rev 26333, haiku/trunk/src/tests/servers/app/lagging_get_mouse/run)

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar (from rev 26333, haiku/trunk/src/tests/servers/app/statusbar)

Deleted: haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/Jamfile

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/Jamfile (from rev 26333, haiku/trunk/src/tests/servers/app/statusbar/Jamfile)

Deleted: haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/main.cpp

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/main.cpp (from rev 26333, haiku/trunk/src/tests/servers/app/statusbar/main.cpp)

Deleted: haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/run

Copied: haiku/branches/developer/bonefish/vm/src/tests/servers/app/statusbar/run (from rev 26333, haiku/trunk/src/tests/servers/app/statusbar/run)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010127.html">[Haiku-commits] r26333 - haiku/trunk/src/system/kernel/vm
</A></li>
	<LI>Next message: <A HREF="010129.html">[Haiku-commits] r26335 - haiku/trunk/src/system/kernel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10128">[ date ]</a>
              <a href="thread.html#10128">[ thread ]</a>
              <a href="subject.html#10128">[ subject ]</a>
              <a href="author.html#10128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/haiku-commits">More information about the Haiku-commits
mailing list</a><br>
</body></html>
